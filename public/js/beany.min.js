/*! jQuery v1.11.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */

//# sourceMappingURL=jquery.min.map;
//     Underscore.js 1.7.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/* Phaser v2.0.7 - http://phaser.io - @photonstorm - (c) 2014 Photon Storm Ltd. */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function g(e){var t=e.length,n=h.type(e);return"function"===n||h.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function S(e,t,n){if(h.isFunction(t))return h.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return h.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(E.test(t))return h.filter(t,e,n);t=h.filter(t,e)}return h.grep(e,function(e){return h.inArray(e,t)>=0!==n})}function A(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function _(e){var t=M[e]={};return h.each(e.match(O)||[],function(e,n){t[n]=!0}),t}function P(){T.addEventListener?(T.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(T.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))}function H(){(T.addEventListener||"load"===event.type||"complete"===T.readyState)&&(P(),h.ready())}function q(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(I,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:F.test(n)?h.parseJSON(n):n}catch(i){}h.data(e,t,n)}else n=void 0}return n}function R(e){var t;for(t in e)if(("data"!==t||!h.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function U(e,t,r,i){if(h.acceptData(e)){var s,o,u=h.expando,a=e.nodeType,f=a?h.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||void 0!==r||"string"!=typeof t)return l||(l=a?e[u]=n.pop()||h.guid++:u),f[l]||(f[l]=a?{}:{toJSON:h.noop}),("object"==typeof t||"function"==typeof t)&&(i?f[l]=h.extend(f[l],t):f[l].data=h.extend(f[l].data,t)),o=f[l],i||(o.data||(o.data={}),o=o.data),void 0!==r&&(o[h.camelCase(t)]=r),"string"==typeof t?(s=o[t],null==s&&(s=o[h.camelCase(t)])):s=o,s}}function z(e,t,n){if(h.acceptData(e)){var r,i,s=e.nodeType,o=s?h.cache:e,u=s?e[h.expando]:h.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){h.isArray(t)?t=t.concat(h.map(t,h.camelCase)):t in r?t=[t]:(t=h.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!R(r):!h.isEmptyObject(r))return}(n||(delete o[u].data,R(o[u])))&&(s?h.cleanData([e],!0):l.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function et(){return!0}function tt(){return!1}function nt(){try{return T.activeElement}catch(e){}}function rt(e){var t=it.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function wt(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==B?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==B?e.querySelectorAll(t||"*"):void 0;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[i]);i++)!t||h.nodeName(r,t)?s.push(r):h.merge(s,wt(r,t));return void 0===t||t&&h.nodeName(e,t)?h.merge([e],s):s}function Et(e){J.test(e.type)&&(e.defaultChecked=e.checked)}function St(e,t){return h.nodeName(e,"table")&&h.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function xt(e){return e.type=(null!==h.find.attr(e,"type"))+"/"+e.type,e}function Tt(e){var t=vt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Nt(e,t){for(var n,r=0;null!=(n=e[r]);r++)h._data(n,"globalEval",!t||h._data(t[r],"globalEval"))}function Ct(e,t){if(1===t.nodeType&&h.hasData(e)){var n,r,i,s=h._data(e),o=h._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)h.event.add(t,n,u[n][r])}o.data&&(o.data=h.extend({},o.data))}}function kt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!l.noCloneEvent&&t[h.expando]){i=h._data(t);for(r in i.events)h.removeEvent(t,r,i.handle);t.removeAttribute(h.expando)}"script"===n&&t.text!==e.text?(xt(t).text=e.text,Tt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),l.html5Clone&&e.innerHTML&&!h.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&J.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Ot(t,n){var r,i=h(n.createElement(t)).appendTo(n.body),s=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(i[0]))?r.display:h.css(i[0],"display");return i.detach(),s}function Mt(e){var t=T,n=At[e];return n||(n=Ot(e,t),"none"!==n&&n||(Lt=(Lt||h("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Lt[0].contentWindow||Lt[0].contentDocument).document,t.write(),t.close(),n=Ot(e,t),Lt.detach()),At[e]=n),n}function jt(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function Vt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Xt.length;while(i--)if(t=Xt[i]+n,t in e)return t;return r}function $t(e,t){for(var n,r,i,s=[],o=0,u=e.length;u>o;o++)r=e[o],r.style&&(s[o]=h._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&V(r)&&(s[o]=h._data(r,"olddisplay",Mt(r.nodeName)))):(i=V(r),(n&&"none"!==n||!i)&&h._data(r,"olddisplay",i?n:h.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function Jt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Kt(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;4>s;s+=2)"margin"===n&&(o+=h.css(e,n+X[s],!0,i)),r?("content"===n&&(o-=h.css(e,"padding"+X[s],!0,i)),"margin"!==n&&(o-=h.css(e,"border"+X[s]+"Width",!0,i))):(o+=h.css(e,"padding"+X[s],!0,i),"padding"!==n&&(o+=h.css(e,"border"+X[s]+"Width",!0,i)));return o}function Qt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=Pt(e),o=l.boxSizing&&"border-box"===h.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Ht(e,t,s),(0>i||null==i)&&(i=e.style[t]),Dt.test(i))return i;r=o&&(l.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Kt(e,t,n||(o?"border":"content"),r,s)+"px"}function Gt(e,t,n,r,i){return new Gt.prototype.init(e,t,n,r,i)}function on(){return setTimeout(function(){Yt=void 0}),Yt=h.now()}function un(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=X[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function an(e,t,n){for(var r,i=(sn[t]||[]).concat(sn["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function fn(e,t,n){var r,i,s,o,u,a,f,c,p=this,d={},v=e.style,m=e.nodeType&&V(e),g=h._data(e,"fxshow");n.queue||(u=h._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,p.always(function(){p.always(function(){u.unqueued--,h.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=h.css(e,"display"),c="none"===f?h._data(e,"olddisplay")||Mt(e.nodeName):f,"inline"===c&&"none"===h.css(e,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Mt(e.nodeName)?v.zoom=1:v.display="inline-block")),n.overflow&&(v.overflow="hidden",l.shrinkWrapBlocks()||p.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],en.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[r])continue;m=!0}d[r]=g&&g[r]||h.style(e,r)}else f=void 0;if(h.isEmptyObject(d))"inline"===("none"===f?Mt(e.nodeName):f)&&(v.display=f);else{g?"hidden"in g&&(m=g.hidden):g=h._data(e,"fxshow",{}),s&&(g.hidden=!m),m?h(e).show():p.done(function(){h(e).hide()}),p.done(function(){var t;h._removeData(e,"fxshow");for(t in d)h.style(e,t,d[t])});for(r in d)o=an(m?g[r]:0,r,p),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function ln(e,t){var n,r,i,s,o;for(n in e)if(r=h.camelCase(n),i=t[r],s=e[n],h.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=h.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function cn(e,t,n){var r,i,s=0,o=rn.length,u=h.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;for(var t=Yt||on(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:h.extend({},t),opts:h.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||on(),duration:n.duration,tweens:[],createTween:function(t,n){var r=h.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(ln(l,f.opts.specialEasing);o>s;s++)if(r=rn[s].call(f,e,l,f.opts))return r;return h.map(l,an,f),h.isFunction(f.opts.start)&&f.opts.start.call(e,f),h.fx.timer(h.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Fn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(O)||[];if(h.isFunction(n))while(r=s[i++])"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function In(e,t,n,r){function o(u){var a;return i[u]=!0,h.each(e[u]||[],function(e,u){var f=u(t,n,r);return"string"!=typeof f||s||i[f]?s?!(a=f):void 0:(t.dataTypes.unshift(f),o(f),!1)}),a}var i={},s=e===Hn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function qn(e,t){var n,r,i=h.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&h.extend(!0,e,n),e}function Rn(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function Un(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Jn(e,t,n,r){var i;if(h.isArray(t))h.each(t,function(t,i){n||Wn.test(e)?r(e,i):Jn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==h.type(t))r(e,t);else for(i in t)Jn(e+"["+i+"]",t[i],n,r)}function Yn(){try{return new e.XMLHttpRequest}catch(t){}}function Zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function ir(e){return h.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l={},c="1.11.1",h=function(e,t){return new h.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,d=/^-ms-/,v=/-([\da-z])/gi,m=function(e,t){return t.toUpperCase()};h.fn=h.prototype={jquery:c,constructor:h,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=h.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return h.each(this,e,t)},map:function(e){return this.pushStack(h.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},h.extend=h.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;for("boolean"==typeof o&&(f=o,o=arguments[u]||{},u++),"object"==typeof o||h.isFunction(o)||(o={}),u===a&&(o=this,u--);a>u;u++)if(null!=(i=arguments[u]))for(r in i)e=o[r],n=i[r],o!==n&&(f&&n&&(h.isPlainObject(n)||(t=h.isArray(n)))?(t?(t=!1,s=e&&h.isArray(e)?e:[]):s=e&&h.isPlainObject(e)?e:{},o[r]=h.extend(f,s,n)):void 0!==n&&(o[r]=n));return o},h.extend({expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===h.type(e)},isArray:Array.isArray||function(e){return"array"===h.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!h.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==h.type(e)||e.nodeType||h.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(l.ownLast)for(t in e)return f.call(e,t);for(t in e);return void 0===t||f.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&h.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(d,"ms-").replace(v,m)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=g(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(g(Object(e))?h.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(n>r)e[i++]=t[r++];if(n!==n)while(void 0!==t[r])e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=g(e),a=[];if(u)for(;o>s;s++)r=t(e[s],s,n),null!=r&&a.push(r);else for(s in e)r=t(e[s],s,n),null!=r&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return"string"==typeof t&&(s=e[t],t=e,e=s),h.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||h.guid++,i):void 0},now:function(){return+(new Date)},support:l}),h.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var y=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(l=t.nodeType)&&9!==l)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+mt(d[c]);S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",")}if(x)try{return P.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function ut(e){return e[w]=!0,e}function at(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(e){return e&&typeof e.getElementsByTagName!==L&&e}function vt(){}function mt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n){for(var r=0,i=t.length;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>a;a++)if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&St(e.slice(a,i)),s>i&&St(e=e.slice(i)),s>i&&mt(e))}h.push(n)}return yt(h)}function xt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=_.call(a));y=wt(y)}P.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(a)}return l&&(S=E,f=b),g};return n?ut(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function(e,t){return e===t&&(c=!0),0},L="undefined",A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;return i!==p&&9===i.nodeType&&i.documentElement?(p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h()},!1):o.attachEvent&&o.attachEvent("onunload",function(){h()})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==L?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==L&&v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(i.querySelectorAll))&&(at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked")}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},i):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=B.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ht(t);return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt,o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):N(e,a).slice(0)},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=St(t[n]),s[w]?r.push(s):i.push(s);s=C(e,xt(i,r)),s.selector=e}return s},a=st.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&mt(f),!e)return P.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),at(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ft("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ft("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),at(function(e){return null==e.getAttribute("disabled")})||ft(j,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),st}(e);h.find=y,h.expr=y.selectors,h.expr[":"]=h.expr.pseudos,h.unique=y.uniqueSort,h.text=y.getText,h.isXMLDoc=y.isXML,h.contains=y.contains;var b=h.expr.match.needsContext,w=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^.[^:#\[\.,]*$/;h.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?h.find.matchesSelector(r,e)?[r]:[]:h.find.matches(e,h.grep(t,function(e){return 1===e.nodeType}))},h.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(h(e).filter(function(){for(t=0;i>t;t++)if(h.contains(r[t],this))return!0}));for(t=0;i>t;t++)h.find(e,r[t],n);return n=this.pushStack(i>1?h.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(S(this,e||[],!1))},not:function(e){return this.pushStack(S(this,e||[],!0))},is:function(e){return!!S(this,"string"==typeof e&&b.test(e)?h(e):e||[],!1).length}});var x,T=e.document,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=h.fn.init=function(e,t){var n,r;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||x).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof h?t[0]:t,h.merge(this,h.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:T,!0)),w.test(n[1])&&h.isPlainObject(t))for(n in t)h.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(r=T.getElementById(n[2]),r&&r.parentNode){if(r.id!==n[2])return x.find(e);this.length=1,this[0]=r}return this.context=T,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):h.isFunction(e)?"undefined"!=typeof x.ready?x.ready(e):e(h):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),h.makeArray(e,this))};C.prototype=h.fn,x=h(T);var k=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};h.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&9!==i.nodeType&&(void 0===n||1!==i.nodeType||!h(i).is(n)))1===i.nodeType&&r.push(i),i=i[t];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),h.fn.extend({has:function(e){var t,n=h(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(h.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,s=[],o=b.test(e)||"string"!=typeof e?h(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&h.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?h.unique(s):s)},index:function(e){return e?"string"==typeof e?h.inArray(this[0],h(e)):h.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(h.unique(h.merge(this.get(),h(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),h.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h.dir(e,"parentNode")},parentsUntil:function(e,t,n){return h.dir(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return h.dir(e,"nextSibling")},prevAll:function(e){return h.dir(e,"previousSibling")},nextUntil:function(e,t,n){return h.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return h.dir(e,"previousSibling",n)},siblings:function(e){return h.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return h.sibling(e.firstChild)},contents:function(e){return h.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:h.merge([],e.childNodes)}},function(e,t){h.fn[e]=function(n,r){var i=h.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=h.filter(r,i)),this.length>1&&(L[e]||(i=h.unique(i)),k.test(e)&&(i=i.reverse())),this.pushStack(i)}});var O=/\S+/g,M={};h.Callbacks=function(e){e="string"==typeof e?M[e]||_(e):h.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){for(n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;u&&i>s;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;!function s(t){h.each(t,function(t,n){var r=h.type(n);"function"===r?e.unique&&l.has(n)||u.push(n):n&&n.length&&"string"!==r&&s(n)})}(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&h.each(arguments,function(e,n){var r;while((r=h.inArray(n,u,r))>-1)u.splice(r,1),t&&(i>=r&&i--,s>=r&&s--)}),this},has:function(e){return e?h.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=void 0,this},disabled:function(){return!u},lock:function(){return a=void 0,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return!u||r&&!a||(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},h.extend({Deferred:function(e){var t=[["resolve","done",h.Callbacks("once memory"),"resolved"],["reject","fail",h.Callbacks("once memory"),"rejected"],["notify","progress",h.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return h.Deferred(function(n){h.each(t,function(t,s){var o=h.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&h.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?h.extend(e,r):r}},i={};return r.pipe=r.then,h.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=1!==i||e&&h.isFunction(e.promise)?i:0,o=1===s?e:h.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)n[t]&&h.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,n),o.promise()}});var D;h.fn.ready=function(e){return h.ready.promise().done(e),this},h.extend({isReady:!1,readyWait:1,holdReady:function(e){e?h.readyWait++:h.ready(!0)},ready:function(e){if(e===!0?!--h.readyWait:!h.isReady){if(!T.body)return setTimeout(h.ready);h.isReady=!0,e!==!0&&--h.readyWait>0||(D.resolveWith(T,[h]),h.fn.triggerHandler&&(h(T).triggerHandler("ready"),h(T).off("ready")))}}}),h.ready.promise=function(t){if(!D)if(D=h.Deferred(),"complete"===T.readyState)setTimeout(h.ready);else if(T.addEventListener)T.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{T.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var n=!1;try{n=null==e.frameElement&&T.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!h.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}P(),h.ready()}}()}return D.promise(t)};var B="undefined",j;for(j in h(l))break;l.ownLast="0"!==j,l.inlineBlockNeedsLayout=!1,h(function(){var e,t,n,r;n=T.getElementsByTagName("body")[0],n&&n.style&&(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(r))}),function(){var e=T.createElement("div");if(null==l.deleteExpando){l.deleteExpando=!0;try{delete e.test}catch(t){l.deleteExpando=!1}}e=null}(),h.acceptData=function(e){var t=h.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var F=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,I=/([A-Z])/g;h.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?h.cache[e[h.expando]]:e[h.expando],!!e&&!R(e)},data:function(e,t,n){return U(e,t,n)},removeData:function(e,t){return z(e,t)},_data:function(e,t,n){return U(e,t,n,!0)},_removeData:function(e,t){return z(e,t,!0)}}),h.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(i=h.data(s),1===s.nodeType&&!h._data(s,"parsedAttrs"))){n=o.length;while(n--)o[n]&&(r=o[n].name,0===r.indexOf("data-")&&(r=h.camelCase(r.slice(5)),q(s,r,i[r])));h._data(s,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){h.data(this,e)}):arguments.length>1?this.each(function(){h.data(this,e,t)}):s?q(s,e,h.data(s,e)):void 0},removeData:function(e){return this.each(function(){h.removeData(this,e)})}}),h.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=h._data(e,t),n&&(!r||h.isArray(n)?r=h._data(e,t,h.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=h.queue(e,t),r=n.length,i=n.shift(),s=h._queueHooks(e,t),o=function(){h.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return h._data(e,n)||h._data(e,n,{empty:h.Callbacks("once memory").add(function(){h._removeData(e,t+"queue"),h._removeData(e,n)})})}}),h.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?h.queue(this[0],e):void 0===t?this:this.each(function(){var n=h.queue(this,e,t);h._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&h.dequeue(this,e)})},dequeue:function(e){return this.each(function(){h.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=h.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(o--)n=h._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var W=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,X=["Top","Right","Bottom","Left"],V=function(e,t){return e=t||e,"none"===h.css(e,"display")||!h.contains(e.ownerDocument,e)},$=h.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=null==n;if("object"===h.type(n)){i=!0;for(u in n)h.access(e,t,u,n[u],!0,s,o)}else if(void 0!==r&&(i=!0,h.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(h(e),n)})),t))for(;a>u;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)));return i?e:f?t.call(e):a?t(e[0],n):s},J=/^(?:checkbox|radio)$/i;!function(){var e=T.createElement("input"),t=T.createElement("div"),n=T.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===t.firstChild.nodeType,l.tbody=!t.getElementsByTagName("tbody").length,l.htmlSerialize=!!t.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==T.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,n.appendChild(e),l.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){l.noCloneEvent=!1}),t.cloneNode(!0).click()),null==l.deleteExpando){l.deleteExpando=!0;try{delete t.test}catch(r){l.deleteExpando=!1}}}(),function(){var t,n,r=T.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(l[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),l[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var K=/^(?:input|select|textarea)$/i,Q=/^key/,G=/^(?:mouse|pointer|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=/^([^.]*)(?:\.(.+)|)$/;h.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h._data(e);if(g){n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=h.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof h===B||e&&h.event.triggered===e.type?void 0:h.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(O)||[""],u=t.length;while(u--)s=Z.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort(),d&&(f=h.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=h.event.special[d]||{},c=h.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&h.expr.match.needsContext.test(i),namespace:v.join(".")},a),(p=o[d])||(p=o[d]=[],p.delegateCount=0,f.setup&&f.setup.call(e,r,v,l)!==!1||(e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l))),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),h.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h.hasData(e)&&h._data(e);if(g&&(l=g.events)){t=(t||"").match(O)||[""],f=t.length;while(f--)if(u=Z.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort(),d){c=h.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,p=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=p.length;while(s--)o=p[s],!i&&m!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(p.splice(s,1),o.selector&&p.delegateCount--,c.remove&&c.remove.call(e,o));a&&!p.length&&(c.teardown&&c.teardown.call(e,v,g.handle)!==!1||h.removeEvent(e,d,g.handle),delete l[d])}else for(d in l)h.event.remove(e,d+t[f],n,r,!0);h.isEmptyObject(l)&&(delete g.handle,h._removeData(e,"events"))}},trigger:function(t,n,r,i){var s,o,u,a,l,c,p,d=[r||T],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];if(u=c=r=r||T,3!==r.nodeType&&8!==r.nodeType&&!Y.test(v+h.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[h.expando]?t:new h.Event(v,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:h.makeArray(n,[t]),l=h.event.special[v]||{},i||!l.trigger||l.trigger.apply(r,n)!==!1)){if(!i&&!l.noBubble&&!h.isWindow(r)){for(a=l.delegateType||v,Y.test(a+v)||(u=u.parentNode);u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||T)&&d.push(c.defaultView||c.parentWindow||e)}p=0;while((u=d[p++])&&!t.isPropagationStopped())t.type=p>1?a:l.bindType||v,s=(h._data(u,"events")||{})[t.type]&&h._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&h.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());if(t.type=v,!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&h.acceptData(r)&&o&&r[v]&&!h.isWindow(r)){c=r[o],c&&(r[o]=null),h.event.triggered=v;try{r[v]()}catch(g){}h.event.triggered=void 0,c&&(r[o]=c)}return t.result}},dispatch:function(e){e=h.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(h._data(this,"events")||{})[e.type]||[],l=h.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=h.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((h.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||"click"!==e.type))for(;a!=this;a=a.parentNode||this)if(1===a.nodeType&&(a.disabled!==!0||"click"!==e.type)){for(i=[],s=0;u>s;s++)r=t[s],n=r.selector+" ",void 0===i[n]&&(i[n]=r.needsContext?h(n,this).index(a)>=0:h.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[h.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=G.test(i)?this.mouseHooks:Q.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new h.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||T),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||T,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==nt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===nt()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return h.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return h.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=h.extend(new h.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?h.event.trigger(i,null,t):h.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},h.removeEvent=T.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===B&&(e[r]=null),e.detachEvent(r,n))},h.Event=function(e,t){return this instanceof h.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?et:tt):this.type=e,t&&h.extend(this,t),this.timeStamp=e&&e.timeStamp||h.now(),void (this[h.expando]=!0)):new h.Event(e,t)},h.Event.prototype={isDefaultPrevented:tt,isPropagationStopped:tt,isImmediatePropagationStopped:tt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=et,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=et,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=et,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},h.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){h.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!h.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),l.submitBubbles||(h.event.special.submit={setup:function(){return h.nodeName(this,"form")?!1:void h.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=h.nodeName(t,"input")||h.nodeName(t,"button")?t.form:void 0;n&&!h._data(n,"submitBubbles")&&(h.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),h._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&h.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return h.nodeName(this,"form")?!1:void h.event.remove(this,"._submit")}}),l.changeBubbles||(h.event.special.change={setup:function(){return K.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(h.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),h.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),h.event.simulate("change",this,e,!0)})),!1):void h.event.add(this,"beforeactivate._change",function(e){var t=e.target;K.test(t.nodeName)&&!h._data(t,"changeBubbles")&&(h.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||h.event.simulate("change",this.parentNode,e,!0)}),h._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return h.event.remove(this,"._change"),!K.test(this.nodeName)}}),l.focusinBubbles||h.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){h.event.simulate(t,e.target,h.event.fix(e),!0)};h.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=h._data(r,t);i||r.addEventListener(e,n,!0),h._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=h._data(r,t)-1;i?h._data(r,t,i):(r.removeEventListener(e,n,!0),h._removeData(r,t))}}}),h.fn.extend({on:function(e,t,n,r,i){var s,o;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=void 0):null==r&&("string"==typeof t?(r=n,n=void 0):(r=n,n=t,t=void 0)),r===!1)r=tt;else if(!r)return this;return 1===i&&(o=r,r=function(e){return h().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=h.guid++)),this.each(function(){h.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,h(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=tt),this.each(function(){h.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){h.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?h.event.trigger(e,t,n,!0):void 0}});var it="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",st=/ jQuery\d+="(?:null|\d+)"/g,ot=new RegExp("<(?:"+it+")[\\s/>]","i"),ut=/^\s+/,at=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ft=/<([\w:]+)/,lt=/<tbody/i,ct=/<|&#?\w+;/,ht=/<(?:script|style|link)/i,pt=/checked\s*(?:[^=]|=\s*.checked.)/i,dt=/^$|\/(?:java|ecma)script/i,vt=/^true\/(.*)/,mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},yt=rt(T),bt=yt.appendChild(T.createElement("div"));gt.optgroup=gt.option,gt.tbody=gt.tfoot=gt.colgroup=gt.caption=gt.thead,gt.th=gt.td,h.extend({clone:function(e,t,n){var r,i,s,o,u,a=h.contains(e.ownerDocument,e);if(l.html5Clone||h.isXMLDoc(e)||!ot.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(bt.innerHTML=e.outerHTML,bt.removeChild(s=bt.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||h.isXMLDoc(e)))for(r=wt(s),u=wt(e),o=0;null!=(i=u[o]);++o)r[o]&&kt(i,r[o]);if(t)if(n)for(u=u||wt(e),r=r||wt(s),o=0;null!=(i=u[o]);o++)Ct(i,r[o]);else Ct(e,s);return r=wt(s,"script"),r.length>0&&Nt(r,!a&&wt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){for(var i,s,o,u,a,f,c,p=e.length,d=rt(t),v=[],m=0;p>m;m++)if(s=e[m],s||0===s)if("object"===h.type(s))h.merge(v,s.nodeType?[s]:s);else if(ct.test(s)){u=u||d.appendChild(t.createElement("div")),a=(ft.exec(s)||["",""])[1].toLowerCase(),c=gt[a]||gt._default,u.innerHTML=c[1]+s.replace(at,"<$1></$2>")+c[2],i=c[0];while(i--)u=u.lastChild;if(!l.leadingWhitespace&&ut.test(s)&&v.push(t.createTextNode(ut.exec(s)[0])),!l.tbody){s="table"!==a||lt.test(s)?"<table>"!==c[1]||lt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)h.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}h.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}else v.push(t.createTextNode(s));u&&d.removeChild(u),l.appendChecked||h.grep(wt(v,"input"),Et),m=0;while(s=v[m++])if((!r||-1===h.inArray(s,r))&&(o=h.contains(s.ownerDocument,s),u=wt(d.appendChild(s),"script"),o&&Nt(u),n)){i=0;while(s=u[i++])dt.test(s.type||"")&&n.push(s)}return u=null,d},cleanData:function(e,t){for(var r,i,s,o,u=0,a=h.expando,f=h.cache,c=l.deleteExpando,p=h.event.special;null!=(r=e[u]);u++)if((t||h.acceptData(r))&&(s=r[a],o=s&&f[s])){if(o.events)for(i in o.events)p[i]?h.event.remove(r,i):h.removeEvent(r,i,o.handle);f[s]&&(delete f[s],c?delete r[a]:typeof r.removeAttribute!==B?r.removeAttribute(a):r[a]=null,n.push(s))}}}),h.fn.extend({text:function(e){return $(this,function(e){return void 0===e?h.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=St(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=St(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?h.filter(e,this):this,i=0;null!=(n=r[i]);i++)t||1!==n.nodeType||h.cleanData(wt(n)),n.parentNode&&(t&&h.contains(n.ownerDocument,n)&&Nt(wt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&h.cleanData(wt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&h.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return h.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(st,""):void 0;if(!("string"!=typeof e||ht.test(e)||!l.htmlSerialize&&ot.test(e)||!l.leadingWhitespace&&ut.test(e)||gt[(ft.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(at,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(h.cleanData(wt(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,h.cleanData(wt(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,c=this.length,p=this,d=c-1,v=e[0],m=h.isFunction(v);if(m||c>1&&"string"==typeof v&&!l.checkClone&&pt.test(v))return this.each(function(n){var r=p.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(c&&(a=h.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(o=h.map(wt(a,"script"),xt),s=o.length;c>f;f++)r=a,f!==d&&(r=h.clone(r,!0,!0),s&&h.merge(o,wt(r,"script"))),t.call(this[f],r,f);if(s)for(u=o[o.length-1].ownerDocument,h.map(o,Tt),f=0;s>f;f++)r=o[f],dt.test(r.type||"")&&!h._data(r,"globalEval")&&h.contains(u,r)&&(r.src?h._evalUrl&&h._evalUrl(r.src):h.globalEval((r.text||r.textContent||r.innerHTML||"").replace(mt,"")));a=n=null}return this}}),h.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){h.fn[e]=function(e){for(var n,r=0,i=[],o=h(e),u=o.length-1;u>=r;r++)n=r===u?this:this.clone(!0),h(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var Lt,At={};!function(){var e;l.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,r;return n=T.getElementsByTagName("body")[0],n&&n.style?(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(T.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(r),e):void 0}}();var _t=/^margin/,Dt=new RegExp("^("+W+")(?!px)[a-z%]+$","i"),Pt,Ht,Bt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Pt=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==o||h.contains(e.ownerDocument,e)||(o=h.style(e,t)),Dt.test(o)&&_t.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),void 0===o?o:o+""}):T.documentElement.currentStyle&&(Pt=function(e){return e.currentStyle},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n[t]:void 0,null==o&&u&&u[t]&&(o=u[t]),Dt.test(o)&&!Bt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left="fontSize"===t?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),void 0===o?o:o+""||"auto"}),!function(){var t,n,r,i,s,o,u;if(t=T.createElement("div"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=r&&r.style){n.cssText="float:left;opacity:.5",l.opacity="0.5"===n.opacity,l.cssFloat=!!n.cssFloat,t.style.backgroundClip="content-box",t.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===t.style.backgroundClip,l.boxSizing=""===n.boxSizing||""===n.MozBoxSizing||""===n.WebkitBoxSizing,h.extend(l,{reliableHiddenOffsets:function(){return null==o&&a(),o},boxSizingReliable:function(){return null==s&&a(),s},pixelPosition:function(){return null==i&&a(),i},reliableMarginRight:function(){return null==u&&a(),u}});function a(){var t,n,r,a;n=T.getElementsByTagName("body")[0],n&&n.style&&(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",i=s=!1,u=!0,e.getComputedStyle&&(i="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,a=t.appendChild(T.createElement("div")),a.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",a.style.marginRight=a.style.width="0",t.style.width="1px",u=!parseFloat((e.getComputedStyle(a,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=t.getElementsByTagName("td"),a[0].style.cssText="margin:0;border:0;padding:0;display:none",o=0===a[0].offsetHeight,o&&(a[0].style.display="",a[1].style.display="none",o=0===a[0].offsetHeight),n.removeChild(r))}}}(),h.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var Ft=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,qt=/^(none|table(?!-c[ea]).+)/,Rt=new RegExp("^("+W+")(.*)$","i"),Ut=new RegExp("^([+-])=("+W+")","i"),zt={position:"absolute",visibility:"hidden",display:"block"},Wt={letterSpacing:"0",fontWeight:"400"},Xt=["Webkit","O","Moz","ms"];h.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ht(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,o,u=h.camelCase(t),a=e.style;if(t=h.cssProps[u]||(h.cssProps[u]=Vt(a,u)),o=h.cssHooks[t]||h.cssHooks[u],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:a[t];if(s=typeof n,"string"===s&&(i=Ut.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(h.css(e,t)),s="number"),null!=n&&n===n&&("number"!==s||h.cssNumber[u]||(n+="px"),l.clearCloneStyle||""!==n||0!==t.indexOf("background")||(a[t]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(e,n,r)))))try{a[t]=n}catch(f){}}},css:function(e,t,n,r){var i,s,o,u=h.camelCase(t);return t=h.cssProps[u]||(h.cssProps[u]=Vt(e.style,u)),o=h.cssHooks[t]||h.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),void 0===s&&(s=Ht(e,t,r)),"normal"===s&&t in Wt&&(s=Wt[t]),""===n||n?(i=parseFloat(s),n===!0||h.isNumeric(i)?i||0:s):s}}),h.each(["height","width"],function(e,t){h.cssHooks[t]={get:function(e,n,r){return n?qt.test(h.css(e,"display"))&&0===e.offsetWidth?h.swap(e,zt,function(){return Qt(e,t,r)}):Qt(e,t,r):void 0},set:function(e,n,r){var i=r&&Pt(e);return Jt(e,n,r?Kt(e,t,r,l.boxSizing&&"border-box"===h.css(e,"boxSizing",!1,i),i):0)}}}),l.opacity||(h.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=h.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===h.trim(s.replace(Ft,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ft.test(s)?s.replace(Ft,i):s+" "+i)}}),h.cssHooks.marginRight=jt(l.reliableMarginRight,function(e,t){return t?h.swap(e,{display:"inline-block"},Ht,[e,"marginRight"]):void 0}),h.each({margin:"",padding:"",border:"Width"},function(e,t){h.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+X[r]+t]=s[r]||s[r-2]||s[0];return i}},_t.test(e)||(h.cssHooks[e+t].set=Jt)}),h.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,s={},o=0;if(h.isArray(t)){for(r=Pt(e),i=t.length;i>o;o++)s[t[o]]=h.css(e,t[o],!1,r);return s}return void 0!==n?h.style(e,t,n):h.css(e,t)},e,t,arguments.length>1)},show:function(){return $t(this,!0)},hide:function(){return $t(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){V(this)?h(this).show():h(this).hide()})}}),h.Tween=Gt,Gt.prototype={constructor:Gt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(h.cssNumber[n]?"":"px")},cur:function(){var e=Gt.propHooks[this.prop];return e&&e.get?e.get(this):Gt.propHooks._default.get(this)},run:function(e){var t,n=Gt.propHooks[this.prop];return this.pos=t=this.options.duration?h.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Gt.propHooks._default.set(this),this}},Gt.prototype.init.prototype=Gt.prototype,Gt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=h.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){h.fx.step[e.prop]?h.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[h.cssProps[e.prop]]||h.cssHooks[e.prop])?h.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Gt.propHooks.scrollTop=Gt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},h.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},h.fx=Gt.prototype.init,h.fx.step={};var Yt,Zt,en=/^(?:toggle|show|hide)$/,tn=new RegExp("^(?:([+-])=|)("+W+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[fn],sn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=tn.exec(t),s=i&&i[3]||(h.cssNumber[e]?"":"px"),o=(h.cssNumber[e]||"px"!==s&&+r)&&tn.exec(h.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,h.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};h.Animation=h.extend(cn,{tweener:function(e,t){h.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],sn[n]=sn[n]||[],sn[n].unshift(t)},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}}),h.speed=function(e,t,n){var r=e&&"object"==typeof e?h.extend({},e):{complete:n||!n&&t||h.isFunction(e)&&e,duration:e,easing:n&&t||t&&!h.isFunction(t)&&t};return r.duration=h.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in h.fx.speeds?h.fx.speeds[r.duration]:h.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){h.isFunction(r.old)&&r.old.call(this),r.queue&&h.dequeue(this,r.queue)},r},h.fn.extend({fadeTo:function(e,t,n,r){return this.filter(V).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=h.isEmptyObject(e),s=h.speed(t,n,r),o=function(){var t=cn(this,h.extend({},e),s);(i||h._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",s=h.timers,o=h._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&nn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&h.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=h._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=h.timers,o=r?r.length:0;for(n.finish=!0,h.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),h.each(["toggle","show","hide"],function(e,t){var n=h.fn[t];h.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(un(t,!0),e,r,i)}}),h.each({slideDown:un("show"),slideUp:un("hide"),slideToggle:un("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){h.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),h.timers=[],h.fx.tick=function(){var e,t=h.timers,n=0;for(Yt=h.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||h.fx.stop(),Yt=void 0},h.fx.timer=function(e){h.timers.push(e),e()?h.fx.start():h.timers.pop()},h.fx.interval=13,h.fx.start=function(){Zt||(Zt=setInterval(h.fx.tick,h.fx.interval))},h.fx.stop=function(){clearInterval(Zt),Zt=null},h.fx.speeds={slow:600,fast:200,_default:400},h.fn.delay=function(e,t){return e=h.fx?h.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i;t=T.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=T.createElement("select"),i=n.appendChild(T.createElement("option")),e=t.getElementsByTagName("input")[0],r.style.cssText="top:1px",l.getSetAttribute="t"!==t.className,l.style=/top/.test(r.getAttribute("style")),l.hrefNormalized="/a"===r.getAttribute("href"),l.checkOn=!!e.value,l.optSelected=i.selected,l.enctype=!!T.createElement("form").enctype,n.disabled=!0,l.optDisabled=!i.disabled,e=T.createElement("input"),e.setAttribute("value",""),l.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),l.radioValue="t"===e.value}();var hn=/\r/g;h.fn.extend({val:function(e){var t,n,r,i=this[0];if(arguments.length)return r=h.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,h(this).val()):e,null==i?i="":"number"==typeof i?i+="":h.isArray(i)&&(i=h.map(i,function(e){return null==e?"":e+""})),t=h.valHooks[this.type]||h.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=h.valHooks[i.type]||h.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(hn,""):null==n?"":n)}}),h.extend({valHooks:{option:{get:function(e){var t=h.find.attr(e,"value");return null!=t?t:h.trim(h.text(e))}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(l.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&h.nodeName(n.parentNode,"optgroup"))){if(t=h(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=h.makeArray(t),o=i.length;while(o--)if(r=i[o],h.inArray(h.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),i}}}}),h.each(["radio","checkbox"],function(){h.valHooks[this]={set:function(e,t){return h.isArray(t)?e.checked=h.inArray(h(e).val(),t)>=0:void 0}},l.checkOn||(h.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var pn,dn,vn=h.expr.attrHandle,mn=/^(?:checked|selected)$/i,gn=l.getSetAttribute,yn=l.input;h.fn.extend({attr:function(e,t){return $(this,h.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){h.removeAttr(this,e)})}}),h.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===B?h.prop(e,t,n):(1===s&&h.isXMLDoc(e)||(t=t.toLowerCase(),r=h.attrHooks[t]||(h.expr.match.bool.test(t)?dn:pn)),void 0===n?r&&"get"in r&&null!==(i=r.get(e,t))?i:(i=h.find.attr(e,t),null==i?void 0:i):null!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):void h.removeAttr(e,t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(O);if(s&&1===e.nodeType)while(n=s[i++])r=h.propFix[n]||n,h.expr.match.bool.test(n)?yn&&gn||!mn.test(n)?e[r]=!1:e[h.camelCase("default-"+n)]=e[r]=!1:h.attr(e,n,""),e.removeAttribute(gn?n:r)},attrHooks:{type:{set:function(e,t){if(!l.radioValue&&"radio"===t&&h.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),dn={set:function(e,t,n){return t===!1?h.removeAttr(e,n):yn&&gn||!mn.test(n)?e.setAttribute(!gn&&h.propFix[n]||n,n):e[h.camelCase("default-"+n)]=e[n]=!0,n}},h.each(h.expr.match.bool.source.match(/\w+/g),function(e,t){var n=vn[t]||h.find.attr;vn[t]=yn&&gn||!mn.test(t)?function(e,t,r){var i,s;return r||(s=vn[t],vn[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,vn[t]=s),i}:function(e,t,n){return n?void 0:e[h.camelCase("default-"+t)]?t.toLowerCase():null}}),yn&&gn||(h.attrHooks.value={set:function(e,t,n){return h.nodeName(e,"input")?void (e.defaultValue=t):pn&&pn.set(e,t,n)}}),gn||(pn={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},vn.id=vn.name=vn.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},h.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:pn.set},h.attrHooks.contenteditable={set:function(e,t,n){pn.set(e,""===t?!1:t,n)}},h.each(["width","height"],function(e,t){h.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),l.style||(h.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var bn=/^(?:input|select|textarea|button|object)$/i,wn=/^(?:a|area)$/i;h.fn.extend({prop:function(e,t){return $(this,h.prop,e,t,arguments.length>1)},removeProp:function(e){return e=h.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),h.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return s=1!==o||!h.isXMLDoc(e),s&&(t=h.propFix[t]||t,i=h.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=h.find.attr(e,"tabindex");return t?parseInt(t,10):bn.test(e.nodeName)||wn.test(e.nodeName)&&e.href?0:-1}}}}),l.hrefNormalized||h.each(["href","src"],function(e,t){h.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),l.optSelected||(h.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),h.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){h.propFix[this.toLowerCase()]=this}),l.enctype||(h.propFix.enctype="encoding");var En=/[\t\r\n\f]/g;h.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f="string"==typeof e&&e;if(h.isFunction(e))return this.each(function(t){h(this).addClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(O)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(En," "):" ")){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=h.trim(r),n.className!==o&&(n.className=o)}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=0===arguments.length||"string"==typeof e&&e;if(h.isFunction(e))return this.each(function(t){h(this).removeClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(O)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(En," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?h.trim(r):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(h.isFunction(e)?function(n){h(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n){var t,r=0,i=h(this),s=e.match(O)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else(n===B||"boolean"===n)&&(this.className&&h._data(this,"__className__",this.className),this.className=this.className||e===!1?"":h._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(En," ").indexOf(t)>=0)return!0;return!1}}),h.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){h.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),h.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var Sn=h.now(),xn=/\?/,Tn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;h.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=h.trim(t+"");return i&&!h.trim(i.replace(Tn,function(e,t,i,s){return n&&t&&(r=0),0===r?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():h.error("Invalid JSON: "+t)},h.parseXML=function(t){var n,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||h.error("Invalid XML: "+t),n};var Nn,Cn,kn=/#.*$/,Ln=/([?&])_=[^&]*/,An=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,On=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mn=/^(?:GET|HEAD)$/,_n=/^\/\//,Dn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Pn={},Hn={},Bn="*/".concat("*");try{Cn=location.href}catch(jn){Cn=T.createElement("a"),Cn.href="",Cn=Cn.href}Nn=Dn.exec(Cn.toLowerCase())||[],h.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Cn,type:"GET",isLocal:On.test(Nn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Bn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":h.parseJSON,"text xml":h.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?qn(qn(e,h.ajaxSettings),t):qn(h.ajaxSettings,e)},ajaxPrefilter:Fn(Pn),ajaxTransport:Fn(Hn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;2!==b&&(b=2,o&&clearTimeout(o),a=void 0,s=r||"",E.readyState=e>0?4:0,f=e>=200&&300>e||304===e,n&&(w=Rn(l,E,n)),w=Un(l,w,E,f),f?(l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(h.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(h.etag[i]=S)),204===e||"HEAD"===l.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=void 0,u&&p.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(p.trigger("ajaxComplete",[E,l]),--h.active||h.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,i,s,o,u,a,f,l=h.ajaxSetup({},t),c=l.context||l,p=l.context&&(c.nodeType||c.jquery)?h(c):h.event,d=h.Deferred(),v=h.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!f){f={};while(t=An.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};if(d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||Cn)+"").replace(kn,"").replace(_n,Nn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=h.trim(l.dataType||"*").toLowerCase().match(O)||[""],null==l.crossDomain&&(n=Dn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Nn[1]&&n[2]===Nn[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Nn[3]||("http:"===Nn[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=h.param(l.data,l.traditional)),In(Pn,l,t,E),2===b)return E;u=l.global,u&&0===h.active++&&h.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Mn.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(xn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ln.test(i)?i.replace(Ln,"$1_="+Sn++):i+(xn.test(i)?"&":"?")+"_="+Sn++)),l.ifModified&&(h.lastModified[i]&&E.setRequestHeader("If-Modified-Since",h.lastModified[i]),h.etag[i]&&E.setRequestHeader("If-None-Match",h.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Bn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&2!==b){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);if(a=In(Hn,l,t,E)){E.readyState=1,u&&p.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(2>b))throw S;x(-1,S)}}else x(-1,"No Transport");return E}return E.abort()},getJSON:function(e,t,n){return h.get(e,t,n,"json")},getScript:function(e,t){return h.get(e,void 0,t,"script")}}),h.each(["get","post"],function(e,t){h[t]=function(e,n,r,i){return h.isFunction(n)&&(i=i||r,r=n,n=void 0),h.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),h.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){h.fn[t]=function(e){return this.on(t,e)}}),h._evalUrl=function(e){return h.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},h.fn.extend({wrapAll:function(e){if(h.isFunction(e))return this.each(function(t){h(this).wrapAll(e.call(this,t))});if(this[0]){var t=h(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(h.isFunction(e)?function(t){h(this).wrapInner(e.call(this,t))}:function(){var t=h(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h.isFunction(e);return this.each(function(n){h(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){h.nodeName(this,"body")||h(this).replaceWith(this.childNodes)}).end()}}),h.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!l.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||h.css(e,"display"))},h.expr.filters.visible=function(e){return!h.expr.filters.hidden(e)};var zn=/%20/g,Wn=/\[\]$/,Xn=/\r?\n/g,Vn=/^(?:submit|button|image|reset|file)$/i,$n=/^(?:input|select|textarea|keygen)/i;h.param=function(e,t){var n,r=[],i=function(e,t){t=h.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=h.ajaxSettings&&h.ajaxSettings.traditional),h.isArray(e)||e.jquery&&!h.isPlainObject(e))h.each(e,function(){i(this.name,this.value)});else for(n in e)Jn(n,e[n],t,i);return r.join("&").replace(zn,"+")},h.fn.extend({serialize:function(){return h.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=h.prop(this,"elements");return e?h.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!h(this).is(":disabled")&&$n.test(this.nodeName)&&!Vn.test(e)&&(this.checked||!J.test(e))}).map(function(e,t){var n=h(this).val();return null==n?null:h.isArray(n)?h.map(n,function(e){return{name:t.name,value:e.replace(Xn,"\r\n")}}):{name:t.name,value:n.replace(Xn,"\r\n")}}).get()}}),h.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Yn()||Zn()}:Yn;var Kn=0,Qn={},Gn=h.ajaxSettings.xhr();e.ActiveXObject&&h(e).on("unload",function(){for(var e in Qn)Qn[e](void 0,!0)}),l.cors=!!Gn&&"withCredentials"in Gn,Gn=l.ajax=!!Gn,Gn&&h.ajaxTransport(function(e){if(!e.crossDomain||l.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Kn;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)void 0!==n[i]&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||4===s.readyState))if(delete Qn[o],t=void 0,s.onreadystatechange=h.noop,i)4!==s.readyState&&s.abort();else{f={},u=s.status,"string"==typeof s.responseText&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}u||!e.isLocal||e.crossDomain?1223===u&&(u=204):u=f.text?200:404}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?4===s.readyState?setTimeout(t):s.onreadystatechange=Qn[o]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),h.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return h.globalEval(e),e}}}),h.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),h.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=T.head||h("head")[0]||T.documentElement;return{send:function(r,i){t=T.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var er=[],tr=/(=)\?(?=&|$)|\?\?/;h.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=er.pop()||h.expando+"_"+Sn++;return this[e]=!0,e}}),h.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(tr.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tr.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=h.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(tr,"$1"+i):t.jsonp!==!1&&(t.url+=(xn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||h.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,er.push(i)),o&&h.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),h.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||T;var r=w.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=h.buildFragment([e],t,i),i&&i.length&&h(i).remove(),h.merge([],r.childNodes))};var nr=h.fn.load;h.fn.load=function(e,t,n){if("string"!=typeof e&&nr)return nr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=h.trim(e.slice(u,e.length)),e=e.slice(0,u)),h.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&h.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?h("<div>").append(h.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},h.expr.filters.animated=function(e){return h.grep(h.timers,function(t){return e===t.elem}).length};var rr=e.document.documentElement;h.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=h.css(e,"position"),c=h(e),p={};"static"===l&&(e.style.position="relative"),u=c.offset(),s=h.css(e,"top"),a=h.css(e,"left"),f=("absolute"===l||"fixed"===l)&&h.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),h.isFunction(t)&&(t=t.call(e,n,u)),null!=t.top&&(p.top=t.top-u.top+o),null!=t.left&&(p.left=t.left-u.left+i),"using"in t?t.using.call(e,p):c.css(p)}},h.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){h.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(s)return t=s.documentElement,h.contains(t,i)?(typeof i.getBoundingClientRect!==B&&(r=i.getBoundingClientRect()),n=ir(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===h.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),h.nodeName(e[0],"html")||(n=e.offset()),n.top+=h.css(e[0],"borderTopWidth",!0),n.left+=h.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-h.css(r,"marginTop",!0),left:t.left-n.left-h.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||rr;while(e&&!h.nodeName(e,"html")&&"static"===h.css(e,"position"))e=e.offsetParent;return e||rr})}}),h.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);h.fn[e]=function(r){return $(this,function(e,r,i){var s=ir(e);return void 0===i?s?t in s?s[t]:s.document.documentElement[r]:e[r]:void (s?s.scrollTo(n?h(s).scrollLeft():i,n?i:h(s).scrollTop()):e[r]=i)},e,r,arguments.length,null)}}),h.each(["top","left"],function(e,t){h.cssHooks[t]=jt(l.pixelPosition,function(e,n){return n?(n=Ht(e,t),Dt.test(n)?h(e).position()[t]+"px":n):void 0})}),h.each({Height:"height",Width:"width"},function(e,t){h.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){h.fn[r]=function(r,i){var s=arguments.length&&(n||"boolean"!=typeof r),o=n||(r===!0||i===!0?"margin":"border");return $(this,function(t,n,r){var i;return h.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?h.css(t,n,o):h.style(t,n,r,o)},t,s?r:void 0,s,null)}})}),h.fn.size=function(){return this.length},h.fn.andSelf=h.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return h});var sr=e.jQuery,or=e.$;return h.noConflict=function(t){return e.$===h&&(e.$=or),t&&e.jQuery===h&&(e.jQuery=sr),h},typeof t===B&&(e.jQuery=e.$=h),h}),function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void (this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var r,i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=Array(s),u=0;s>u;u++)r=i?i[u]:u,o[u]=t(e[r],r,e);return o};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length,u=0;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[u++]:u++]}for(;o>u;u++)i=s?s[u]:u,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[--o]:--o]}for(;o--;)i=s?s[o]:o,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},p.filter=p.select=function(e,t,n){var r=[];return null==e?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},p.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=p.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);for(var i=n(t),s=0,o=e.length;o>s;){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];p.isArray(a)||p.isArguments(a)?t?s.apply(r,a):g(a,t,n,r):n||r.push(a)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(null==e)return[];p.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,u=e.length;u>o;o++){var a=e[o];if(t)o&&s===a||i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var s=e[r];if(!p.contains(t,s)){for(var o=1;n>o&&p.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))}},p.partial=function(e){var t=o.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===p&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;t>f&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},p.pairs=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){for(var t={},n=p.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(r in e){var s=e[r];t(s,r,e)&&(i[r]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;l>f;f++)r=a[f],r in e&&(i[r]=e[r])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if("[object Array]"===i){if(f=e.length,l=f===t.length)for(;f--&&(l=b(e[f],t[f],n,r)););}else{var c,h=p.keys(e);if(f=h.length,l=p.keys(t).length===f)for(;f--&&(c=h[f],l=p.has(t,c)&&b(e[c],t[c],n,r)););}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&1===e.nodeType},p.isArray=l||function(e){return"[object Array]"===a.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof /./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===a.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return null!=e&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(null==e)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),define("game/states/load",function(){}),define("game/states/start",function(){}),define("game/states/play",function(){}),define("game/states/end",function(){}),function(){var e=this,t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v1.6.1",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t._UID=0,"undefined"!=typeof Float32Array?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array):(t.Float32Array=Array,t.Uint16Array=Array),t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.dontSayHello=!1,t.sayHello=function(e){if(!t.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var n=["%c %c %c Pixi.js "+t.VERSION+" - "+e+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,n)}else window.console&&console.log("Pixi.js "+t.VERSION+" - http://www.pixijs.com/");t.dontSayHello=!0}},t.Point=function(e,t){this.x=e||0,this.y=t||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var n=[],r=0,i=e.length;i>r;r+=2)n.push(new t.Point(e[r],e[r+1]));e=n}this.points=e},t.Polygon.prototype.clone=function(){for(var e=[],n=0;n<this.points.length;n++)e.push(this.points[n].clone());return new t.Polygon(e)},t.Polygon.prototype.contains=function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var s=this.points[r].x,o=this.points[r].y,u=this.points[i].x,a=this.points[i].y,f=o>t!=a>t&&(u-s)*(t-o)/(a-o)+s>e;f&&(n=!n)}return n},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,i>=n+r},t.Circle.prototype.getBounds=function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width,r=(t-this.y)/this.height;return n*=n,r*=r,1>=n+r},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new Float32Array(9));var t=this.array;return e?(t[0]=this.a,t[1]=this.c,t[2]=0,t[3]=this.b,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.b,t[2]=this.tx,t[3]=this.c,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},t.identityMatrix=new t.Matrix,t.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},t.Matrix2=t.determineMatrixArrayType(),t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,t.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){for(var t=[],n=0;n<e.length;n++)for(var r=e[n].passes,i=0;i<r.length;i++)t.push(r[i]);this._filterBlock={target:this,filterPasses:t}}this._filters=e}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e)}}),t.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.parent.worldTransform,t=this.worldTransform,n=this.pivot.x,r=this.pivot.y,i=this._cr*this.scale.x,s=-this._sr*this.scale.y,o=this._sr*this.scale.x,u=this._cr*this.scale.y,a=this.position.x-i*n-r*s,f=this.position.y-u*r-n*o,l=e.a,c=e.b,h=e.c,p=e.d;t.a=l*i+c*o,t.b=l*s+c*u,t.tx=l*a+c*f+e.tx,t.c=h*i+p*o,t.d=h*s+p*u,t.ty=h*a+p*f+e.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e){var n=this.getLocalBounds(),r=new t.RenderTexture(0|n.width,0|n.height,e);return r.render(this,new t.Point(-n.x,-n.y)),r},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var n=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,this._cachedSprite.texture.render(this,new t.Point(-e.x,-e.y)),this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._filters=r,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(e){e=e},t.DisplayObject.prototype._renderCanvas=function(e){e=e},Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/(t/this.scale.x):1,this._width=e}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/(t/this.scale.y):1,this._height=e}}),t.DisplayObjectContainer.prototype.addChild=function(e){return this.addChildAt(e,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.stage&&e.setStageReference(this.stage),e;throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(e,t){if(e!==t){var n=this.children.indexOf(e),r=this.children.indexOf(t);if(0>n||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=t,this.children[r]=e}},t.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")},t.DisplayObjectContainer.prototype.removeChild=function(e){return this.removeChildAt(this.children.indexOf(e))},t.DisplayObjectContainer.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(e,1),t},t.DisplayObjectContainer.prototype.removeChildren=function(e,t){var n=e||0,r="number"==typeof t?t:this.children.length,i=r-n;if(i>0&&r>=i){for(var s=this.children.splice(n,i),o=0;o<s.length;o++){var u=s[o];this.stage&&u.removeStageReference(),u.parent=void 0}return s}throw new Error("Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(t.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var e=0,n=this.children.length;n>e;e++)this.children[e].updateTransform()},t.DisplayObjectContainer.prototype.getBounds=function(e){if(0===this.children.length)return t.EmptyRectangle;if(e){var n=this.worldTransform;this.worldTransform=e,this.updateTransform(),this.worldTransform=n}for(var r,i,s,o=1/0,u=1/0,a=-1/0,f=-1/0,l=!1,c=0,h=this.children.length;h>c;c++){var p=this.children[c];p.visible&&(l=!0,r=this.children[c].getBounds(e),o=o<r.x?o:r.x,u=u<r.y?u:r.y,i=r.width+r.x,s=r.height+r.y,a=a>i?a:i,f=f>s?f:s)}if(!l)return t.EmptyRectangle;var d=this._bounds;return d.x=o,d.y=u,d.width=a-o,d.height=f-u,d},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var n=0,r=this.children.length;r>n;n++)this.children[n].updateTransform();var i=this.getBounds();return this.worldTransform=e,i},t.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0);for(var t=0,n=this.children.length;n>t;t++){var r=this.children[t];r.setStageReference(e)}},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0,t=this.children.length;t>e;e++){var n=this.children[e];n.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);var t,n;if(this._mask||this._filters){for(this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),t=0,n=this.children.length;n>t;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),e.spriteBatch.start()}else for(t=0,n=this.children.length;n>t;t++)this.children[t]._renderWebGL(e)}},t.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);this._mask&&e.maskManager.pushMask(this._mask,e.context);for(var t=0,n=this.children.length;n>t;t++){var r=this.children[t];r._renderCanvas(e)}this._mask&&e.maskManager.popMask(e.context)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,e.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Sprite.prototype.setTexture=function(e){this.texture=e,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(e){var t=this.texture.frame.width,n=this.texture.frame.height,r=t*(1-this.anchor.x),i=t*-this.anchor.x,s=n*(1-this.anchor.y),o=n*-this.anchor.y,u=e||this.worldTransform,a=u.a,f=u.c,l=u.b,c=u.d,h=u.tx,p=u.ty,d=a*i+l*o+h,v=c*o+f*i+p,m=a*r+l*o+h,g=c*o+f*r+p,y=a*r+l*s+h,b=c*s+f*r+p,w=a*i+l*s+h,E=c*s+f*i+p,S=-1/0,x=-1/0,T=1/0,N=1/0;T=T>d?d:T,T=T>m?m:T,T=T>y?y:T,T=T>w?w:T,N=N>v?v:N,N=N>g?g:N,N=N>b?b:N,N=N>E?E:N,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S,x=v>x?v:x,x=g>x?g:x,x=b>x?b:x,x=E>x?E:x;var C=this._bounds;return C.x=T,C.width=S-T,C.y=N,C.height=x-N,this._currentBounds=C,C},t.Sprite.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)){var t,n;if(this._mask||this._filters){var r=e.spriteBatch;for(this._filters&&(r.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),e.maskManager.pushMask(this.mask,e),r.start()),r.render(this),t=0,n=this.children.length;n>t;t++)this.children[t]._renderWebGL(e);r.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),r.start()}else for(e.spriteBatch.render(this),t=0,n=this.children.length;n>t;t++)this.children[t]._renderWebGL(e)}},t.Sprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e.context),this.texture.valid){e.context.globalAlpha=this.worldAlpha,e.roundPixels?e.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):e.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n,r,this.texture.crop.width,this.texture.crop.height)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n,r,this.texture.crop.width,this.texture.crop.height)}for(var i=0,s=this.children.length;s>i;i++)this.children[i]._renderCanvas(e);this._mask&&e.maskManager.popMask(e.context)}},t.Sprite.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(n)},t.Sprite.fromImage=function(e,n,r){var i=t.Texture.fromImage(e,n,r);return new t.Sprite(i)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){t.DisplayObject.prototype.updateTransform.call(this)},t.SpriteBatch.prototype._renderWebGL=function(e){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(e.gl),e.spriteBatch.stop(),e.shaderManager.setShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(e){var n=e.context;n.globalAlpha=this.worldAlpha,t.DisplayObject.prototype.updateTransform.call(this);for(var r=this.worldTransform,i=!0,s=0;s<this.children.length;s++){var o=this.children[s];if(o.visible){var u=o.texture,a=u.frame;if(n.globalAlpha=this.worldAlpha*o.alpha,o.rotation%(2*Math.PI)===0)i&&(n.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty),i=!1),n.drawImage(u.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*-a.width*o.scale.x+o.position.x+.5|0,o.anchor.y*-a.height*o.scale.y+o.position.y+.5|0,a.width*o.scale.x,a.height*o.scale.y);else{i||(i=!0),t.DisplayObject.prototype.updateTransform.call(o);var f=o.worldTransform;e.roundPixels?n.setTransform(f.a,f.c,f.b,f.d,0|f.tx,0|f.ty):n.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),n.drawImage(u.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*-a.width+.5|0,o.anchor.y*-a.height+.5|0,a.width,a.height)}}}},t.AbstractFilter=function(e,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=e||[]},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.Text=function(e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(n)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowAngle=e.dropShadowAngle||Math.PI/6,e.dropShadowDistance=e.dropShadowDistance||4,e.dropShadowColor=e.dropShadowColor||"black",this.style=e,this.dirty=!0},t.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,i=0;i<t.length;i++){var s=this.context.measureText(t[i]).width;n[i]=s,r=Math.max(r,s)}var o=r+this.style.strokeThickness;this.style.dropShadow&&(o+=this.style.dropShadowDistance),this.canvas.width=o+this.context.lineWidth;var u=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,a=u*t.length;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.height=a,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";var f,l;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var c=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,h=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(i=0;i<t.length;i++)f=this.style.strokeThickness/2,l=this.style.strokeThickness/2+i*u,"right"===this.style.align?f+=r-n[i]:"center"===this.style.align&&(f+=(r-n[i])/2),this.style.fill&&this.context.fillText(t[i],f+c,l+h)}for(this.context.fillStyle=this.style.fill,i=0;i<t.length;i++)f=this.style.strokeThickness/2,l=this.style.strokeThickness/2+i*u,"right"===this.style.align?f+=r-n[i]:"center"===this.style.align&&(f+=(r-n[i])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[i],f,l),this.style.fill&&this.context.fillText(t[i],f,l);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},t.Text.prototype._renderWebGL=function(e){this.requiresUpdate&&(this.requiresUpdate=!1,t.updateWebGLTexture(this.texture.baseTexture,e.gl)),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.updateTransform.call(this)},t.Text.prototype.determineFontHeight=function(e){var n=t.Text.heightCache[e];if(!n){var r=document.getElementsByTagName("body")[0],i=document.createElement("div"),s=document.createTextNode("M");i.appendChild(s),i.setAttribute("style",e+";position:absolute;top:0;left:0"),r.appendChild(i),n=i.offsetHeight,t.Text.heightCache[e]=n,r.removeChild(i)}return n},t.Text.prototype.wordWrap=function(e){for(var t="",n=e.split("\n"),r=0;r<n.length;r++){for(var i=this.style.wordWrapWidth,s=n[r].split(" "),o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;0===o||a>i?(o>0&&(t+="\n"),t+=s[o],i=this.style.wordWrapWidth-u):(i-=a,t+=" "+s[o])}r<n.length-1&&(t+="\n")}return t},t.Text.prototype.destroy=function(e){this.context=null,this.canvas=null,this.texture.destroy(void 0===e?!0:e)},t.Text.heightCache={},t.BitmapText=function(e,n){t.DisplayObjectContainer.call(this),this._pool=[],this.setText(e),this.setStyle(n),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var n=e.font.split(" ");this.fontName=n[n.length-1],this.fontSize=n.length>=2?parseInt(n[n.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],n=new t.Point,r=null,i=[],s=0,o=[],u=0,a=this.fontSize/e.size,f=0;f<this.text.length;f++){var l=this.text.charCodeAt(f);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(f)))o.push(n.x),s=Math.max(s,n.x),u++,n.x=0,n.y+=e.lineHeight,r=null;else{var c=e.chars[l];c&&(r&&c[r]&&(n.x+=c.kerning[r]),i.push({texture:c.texture,line:u,charCode:l,position:new t.Point(n.x+c.xOffset,n.y+c.yOffset)}),n.x+=c.xAdvance,r=l)}}o.push(n.x),s=Math.max(s,n.x);var h=[];for(f=0;u>=f;f++){var p=0;"right"===this.style.align?p=s-o[f]:"center"===this.style.align&&(p=(s-o[f])/2),h.push(p)}var d=this.children.length,v=i.length,m=this.tint||16777215;for(f=0;v>f;f++){var g=d>f?this.children[f]:this._pool.pop();g?g.setTexture(i[f].texture):g=new t.Sprite(i[f].texture),g.position.x=(i[f].position.x+h[i[f].line])*a,g.position.y=i[f].position.y*a,g.scale.x=g.scale.y=a,g.tint=m,g.parent||this.addChild(g)}for(;this.children.length>v;){var y=this.getChildAt(this.children.length-1);this._pool.push(y),this.removeChild(y)}this.textWidth=s*a,this.textHeight=(n.y+e.lineHeight)*a},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(e){this.interactionManager.setTargetDomElement(e)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var n=0,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"]||window[r[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),r=Math.max(0,16-(t-n)),i=window.setTimeout(function(){e(t+r)},r);return n=t+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,t.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var s=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,s)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function s(e){return e&&(s.prototype=e),this instanceof s?void 0:new s}(r.prototype),n}}()),t.AjaxRequest=function(){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new window.ActiveXObject(e[t])}catch(n){}},t.canUseNewCanvasBlendModes=function(){var e=document.createElement("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="#000",t.fillRect(0,0,1,1),t.globalCompositeOperation="multiply",t.fillStyle="#fff",t.fillRect(0,0,1,1),0===t.getImageData(0,0,1,1).data[0]},t.getNextPowerOfTwo=function(e){if(e>0&&0===(e&e-1))return e;for(var t=1;e>t;)t<<=1;return t},t.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].unshift(n)},this.dispatchEvent=this.emit=function(t){if(e[t.type]&&e[t.type].length)for(var n=e[t.type].length-1;n>=0;n--)e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){if(void 0!==e[t]){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},this.removeAllEventListeners=function(t){var n=e[t];n&&(n.length=0)}},t.PolyK={},t.PolyK.Triangulate=function(e){var n=!0,r=e.length>>1;if(3>r)return[];for(var i=[],s=[],o=0;r>o;o++)s.push(o);o=0;for(var u=r;u>3;){var a=s[(o+0)%u],f=s[(o+1)%u],l=s[(o+2)%u],c=e[2*a],h=e[2*a+1],p=e[2*f],d=e[2*f+1],v=e[2*l],m=e[2*l+1],g=!1;if(t.PolyK._convex(c,h,p,d,v,m,n)){g=!0;for(var y=0;u>y;y++){var w=s[y];if(w!==a&&w!==f&&w!==l&&t.PolyK._PointInTriangle(e[2*w],e[2*w+1],c,h,p,d,v,m)){g=!1;break}}}if(g)i.push(a,f,l),s.splice((o+1)%u,1),u--,o=0;else if(o++>3*u){if(!n)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(i=[],s=[],o=0;r>o;o++)s.push(o);o=0,u=r,n=!1}}return i.push(s[0],s[1],s[2]),i},t.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&1>w+E},t.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0===o},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,n){return t._CompileShader(e,n,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,n){return t._CompileShader(e,n,e.FRAGMENT_SHADER)},t._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(window.console.log(e.getShaderInfoLog(i)),null)},t.compileProgram=function(e,n,r){var i=t.CompileFragmentShader(e,r),s=t.CompileVertexShader(e,n),o=e.createProgram();return e.attachShader(o,s),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},t.PixiShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=e.getUniformLocation(n,r);this.initUniforms(),this.program=n},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e,t=this.gl;for(var n in this.uniforms){e=this.uniforms[n];var r=e.type;"sampler2D"===r?(e._init=!1,null!==e.value&&this.initSampler2D(e)):"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],e.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}},t.PixiShader.prototype.initSampler2D=function(e){if(e.value&&e.value.baseTexture&&e.value.baseTexture.hasLoaded){var t=this.gl;if(t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]),e.textureData){var n=e.textureData,r=n.magFilter?n.magFilter:t.LINEAR,i=n.minFilter?n.minFilter:t.LINEAR,s=n.wrapS?n.wrapS:t.CLAMP_TO_EDGE,o=n.wrapT?n.wrapT:t.CLAMP_TO_EDGE,u=n.luminance?t.LUMINANCE:t.RGBA;if(n.repeat&&(s=t.REPEAT,o=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!n.flipY),n.width){var a=n.width?n.width:512,f=n.height?n.height:2,l=n.border?n.border:0;t.texImage2D(t.TEXTURE_2D,0,u,a,f,l,u,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,u,t.RGBA,t.UNSIGNED_BYTE,e.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o)}t.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,n=this.gl;for(var r in this.uniforms)e=this.uniforms[r],1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(n,e.uniformLocation,e.transpose,e.value):e.glFunc.call(n,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(n.activeTexture(n["TEXTURE"+this.textureCount]),n.bindTexture(n.TEXTURE_2D,e.value.baseTexture._glTextures[n.id]||t.createWebGLTexture(e.value.baseTexture,n)),n.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.uMatrix=e.getUniformLocation(n,"uMatrix"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(n,"aPositionCoord"),this.aScale=e.getAttribLocation(n,"aScale"),this.aRotation=e.getAttribLocation(n,"aRotation"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=n},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.color=e.getUniformLocation(n,"color"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,n){var r,i=n.gl,s=n.projection,o=n.offset,u=n.shaderManager.primitiveShader;e.dirty&&t.WebGLGraphics.updateGraphics(e,i);for(var a=e._webGL[i.id],f=0;f<a.data.length;f++)1===a.data[f].mode?(r=a.data[f],n.stencilManager.pushStencil(e,r,n),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(r.indices.length-4)),n.stencilManager.popStencil(e,r,n),this.last=r.mode):(r=a.data[f],n.shaderManager.setShader(u),u=n.shaderManager.primitiveShader,i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform1f(u.alpha,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,r.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(u.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,r.indices.length,i.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,n){var r=e._webGL[n.id];r||(r=e._webGL[n.id]={lastIndex:0,data:[],gl:n}),e.dirty=!1;var i;if(e.clearDirty){for(e.clearDirty=!1,i=0;i<r.data.length;i++){var s=r.data[i];s.reset(),t.WebGLGraphics.graphicsDataPool.push(s)}r.data=[],r.lastIndex=0}var o;for(i=r.lastIndex;i<e.graphicsData.length;i++){var u=e.graphicsData[i];u.type===t.Graphics.POLY?(u.fill&&u.points.length>6&&(u.points.length>10?(o=t.WebGLGraphics.switchMode(r,1),t.WebGLGraphics.buildComplexPoly(u,o)):(o=t.WebGLGraphics.switchMode(r,0),t.WebGLGraphics.buildPoly(u,o))),u.lineWidth>0&&(o=t.WebGLGraphics.switchMode(r,0),t.WebGLGraphics.buildLine(u,o))):(o=t.WebGLGraphics.switchMode(r,0),u.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(u,o):u.type===t.Graphics.CIRC||u.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(u,o):u.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(u,o)),r.lastIndex++}for(i=0;i<r.data.length;i++)o=r.data[i],o.dirty&&o.upload()},t.WebGLGraphics.switchMode=function(e,n){var r;return e.data.length?(r=e.data[e.data.length-1],(r.mode!==n||1===n)&&(r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r))):(r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r)),r.dirty=!0,r},t.WebGLGraphics.buildRectangle=function(e,n){var r=e.points,i=r[0],s=r[1],o=r[2],u=r[3];if(e.fill){var a=t.hex2rgb(e.fillColor),f=e.fillAlpha,l=a[0]*f,c=a[1]*f,h=a[2]*f,p=n.points,d=n.indices,v=p.length/6;p.push(i,s),p.push(l,c,h,f),p.push(i+o,s),p.push(l,c,h,f),p.push(i,s+u),p.push(l,c,h,f),p.push(i+o,s+u),p.push(l,c,h,f),d.push(v,v,v+1,v+2,v+3,v+3)}if(e.lineWidth){var m=e.points;e.points=[i,s,i+o,s,i+o,s+u,i,s+u,i,s],t.WebGLGraphics.buildLine(e,n),e.points=m}},t.WebGLGraphics.buildRoundedRectangle=function(e,n){var r=e.points,i=r[0],s=r[1],o=r[2],u=r[3],a=r[4],f=[];if(f.push(i,s+a),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i,s+u-a,i,s+u,i+a,s+u)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o-a,s+u,i+o,s+u,i+o,s+u-a)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o,s+a,i+o,s,i+o-a,s)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+a,s,i,s,i,s+a)),e.fill){var l=t.hex2rgb(e.fillColor),c=e.fillAlpha,h=l[0]*c,p=l[1]*c,d=l[2]*c,v=n.points,m=n.indices,g=v.length/6,y=t.PolyK.Triangulate(f),w=0;for(w=0;w<y.length;w+=3)m.push(y[w]+g),m.push(y[w]+g),m.push(y[w+1]+g),m.push(y[w+2]+g),m.push(y[w+2]+g);for(w=0;w<f.length;w++)v.push(f[w],f[++w],h,p,d,c)}if(e.lineWidth){var E=e.points;e.points=f,t.WebGLGraphics.buildLine(e,n),e.points=E}},t.WebGLGraphics.quadraticBezierCurve=function(e,t,n,r,i,s){function o(e,t,n){var r=t-e;return e+r*n}for(var u,a,f,l,c,h,p=20,d=[],v=0,m=0;p>=m;m++)v=m/p,u=o(e,n,v),a=o(t,r,v),f=o(n,i,v),l=o(r,s,v),c=o(u,f,v),h=o(a,l,v),d.push(c,h);return d},t.WebGLGraphics.buildCircle=function(e,n){var r=e.points,i=r[0],s=r[1],o=r[2],u=r[3],a=40,f=2*Math.PI/a,l=0;if(e.fill){var c=t.hex2rgb(e.fillColor),h=e.fillAlpha,p=c[0]*h,d=c[1]*h,v=c[2]*h,m=n.points,g=n.indices,y=m.length/6;for(g.push(y),l=0;a+1>l;l++)m.push(i,s,p,d,v,h),m.push(i+Math.sin(f*l)*o,s+Math.cos(f*l)*u,p,d,v,h),g.push(y++,y++);g.push(y-1)}if(e.lineWidth){var w=e.points;for(e.points=[],l=0;a+1>l;l++)e.points.push(i+Math.sin(f*l)*o,s+Math.cos(f*l)*u);t.WebGLGraphics.buildLine(e,n),e.points=w}},t.WebGLGraphics.buildLine=function(e,n){var r=0,i=e.points;if(0!==i.length){if(e.lineWidth%2)for(r=0;r<i.length;r++)i[r]+=.5;var s=new t.Point(i[0],i[1]),o=new t.Point(i[i.length-2],i[i.length-1]);if(s.x===o.x&&s.y===o.y){i=i.slice(),i.pop(),i.pop(),o=new t.Point(i[i.length-2],i[i.length-1]);var u=o.x+.5*(s.x-o.x),a=o.y+.5*(s.y-o.y);i.unshift(u,a),i.push(u,a)}var f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k,L,A,O,M,_,D=n.points,P=n.indices,H=i.length/2,B=i.length,j=D.length/6,F=e.lineWidth/2,I=t.hex2rgb(e.lineColor),q=e.lineAlpha,R=I[0]*q,U=I[1]*q,z=I[2]*q;for(c=i[0],h=i[1],p=i[2],d=i[3],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,D.push(c-g,h-y,R,U,z,q),D.push(c+g,h+y,R,U,z,q),r=1;H-1>r;r++)c=i[2*(r-1)],h=i[2*(r-1)+1],p=i[2*r],d=i[2*r+1],v=i[2*(r+1)],m=i[2*(r+1)+1],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,w=-(d-m),E=p-v,_=Math.sqrt(w*w+E*E),w/=_,E/=_,w*=F,E*=F,T=-y+h-(-y+d),N=-g+p-(-g+c),C=(-g+c)*(-y+d)-(-g+p)*(-y+h),k=-E+m-(-E+d),L=-w+p-(-w+v),A=(-w+v)*(-E+d)-(-w+p)*(-E+m),O=T*L-k*N,Math.abs(O)<.1?(O+=10.1,D.push(p-g,d-y,R,U,z,q),D.push(p+g,d+y,R,U,z,q)):(f=(N*A-L*C)/O,l=(k*C-T*A)/O,M=(f-p)*(f-p)+(l-d)+(l-d),M>19600?(S=g-w,x=y-E,_=Math.sqrt(S*S+x*x),S/=_,x/=_,S*=F,x*=F,D.push(p-S,d-x),D.push(R,U,z,q),D.push(p+S,d+x),D.push(R,U,z,q),D.push(p-S,d-x),D.push(R,U,z,q),B++):(D.push(f,l),D.push(R,U,z,q),D.push(p-(f-p),d-(l-d)),D.push(R,U,z,q)));for(c=i[2*(H-2)],h=i[2*(H-2)+1],p=i[2*(H-1)],d=i[2*(H-1)+1],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,D.push(p-g,d-y),D.push(R,U,z,q),D.push(p+g,d+y),D.push(R,U,z,q),P.push(j),r=0;B>r;r++)P.push(j++);P.push(j-1)}},t.WebGLGraphics.buildComplexPoly=function(e,n){var r=e.points.slice();if(!(r.length<6)){var i=n.indices;n.points=r,n.alpha=e.fillAlpha,n.color=t.hex2rgb(e.fillColor);for(var s,o,u=1/0,a=-1/0,f=1/0,l=-1/0,c=0;c<r.length;c+=2)s=r[c],o=r[c+1],u=u>s?s:u,a=s>a?s:a,f=f>o?o:f,l=o>l?o:l;r.push(u,f,a,f,a,l,u,l);var h=r.length/2;for(c=0;h>c;c++)i.push(c)}},t.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){var i=n.points,s=n.indices,o=r.length/2,u=t.hex2rgb(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,h=t.PolyK.Triangulate(r),p=i.length/6,d=0;for(d=0;d<h.length;d+=3)s.push(h[d]+p),s.push(h[d]+p),s.push(h[d+1]+p),s.push(h[d+2]+p),s.push(h[d+2]+p);for(d=0;o>d;d++)i.push(r[2*d],r[2*d+1],f,l,c,a)}},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.WebGLRenderer=function(e,n,r,i,s,o){t.defaultRenderer||(t.sayHello("webGL"),t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.transparent=!!i,this.preserveDrawingBuffer=o,this.width=e||800,this.height=n||600,this.view=r||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!s,premultipliedAlpha:!!i,stencil:!0,preserveDrawingBuffer:o};var u=null;if(["experimental-webgl","webgl"].forEach(function(e){try{u=u||this.view.getContext(e,this.options)}catch(t){}},this),!u)throw new Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=u,this.glContextId=u.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=u,t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[u.SRC_ALPHA,u.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[u.SRC_ALPHA,u.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[u.ONE,u.ONE_MINUS_SRC_ALPHA]),this.projection=new t.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new t.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new t.WebGLShaderManager(u),this.spriteBatch=new t.WebGLSpriteBatch(u),this.maskManager=new t.WebGLMaskManager(u),this.filterManager=new t.WebGLFilterManager(u,this.transparent),this.stencilManager=new t.WebGLStencilManager(u),this.blendModeManager=new t.WebGLBlendModeManager(u),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,u.useProgram(this.shaderManager.defaultShader.program),u.disable(u.DEPTH_TEST),u.disable(u.CULL_FACE),u.enable(u.BLEND),u.colorMask(!0,!0,!0,this.transparent)},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(e.interactive&&e.interactionManager.removeEvents(),this.__stage=e),t.WebGLRenderer.updateTextures(),e.updateTransform(),e._interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)));var n=this.gl;n.viewport(0,0,this.width,this.height),n.bindFramebuffer(n.FRAMEBUFFER,null),this.transparent?n.clearColor(0,0,0,0):n.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),n.clear(n.COLOR_BUFFER_BIT),this.renderDisplayObject(e,this.projection),e.interactive?e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)):e._interactiveEventsAdded&&(e._interactiveEventsAdded=!1,e.interactionManager.setTarget(this))}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,n,r){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=n,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.updateTextures=function(){var e=0;for(e=0;e<t.Texture.frameUpdates.length;e++)t.WebGLRenderer.updateTextureFrame(t.Texture.frameUpdates[e]);for(e=0;e<t.texturesToDestroy.length;e++)t.WebGLRenderer.destroyTexture(t.texturesToDestroy[e]);t.texturesToUpdate.length=0,t.texturesToDestroy.length=0,t.Texture.frameUpdates.length=0},t.WebGLRenderer.destroyTexture=function(e){for(var n=e._glTextures.length-1;n>=0;n--){var r=e._glTextures[n],i=t.glContexts[n];i&&r&&i.deleteTexture(r)}e._glTextures.length=0},t.WebGLRenderer.updateTextureFrame=function(e){e._updateWebGLuvs()},t.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},t.createWebGLTexture=function(e,n){return e.hasLoaded&&(e._glTextures[n.id]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),n.bindTexture(n.TEXTURE_2D,null),e._dirty[n.id]=!1),e._glTextures[n.id]},t.updateWebGLTexture=function(e,n){e._glTextures[n.id]&&(n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e._dirty[n.id]=!1)},t.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(e){try{this.gl=this.view.getContext("webgl",this.options)}catch(n){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var r=this.gl;r.id=t.WebGLRenderer.glContextId++,this.shaderManager.setContext(r),this.spriteBatch.setContext(r),this.primitiveBatch.setContext(r),this.maskManager.setContext(r),this.filterManager.setContext(r),this.renderSession.gl=this.gl,r.disable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var i in t.TextureCache){var s=t.TextureCache[i].baseTexture;s._glTextures=[]}this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.primitiveBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(e){this.gl=e,this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var n=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(n[0],n[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(e){this.maskStack=[],this.maskPosition=0,this.setContext(e),this.reverse=!1,this.count=0},t.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},t.WebGLMaskManager.prototype.pushMask=function(e,n){var r=n.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,r),e._webGL[r.id].data.length&&n.stencilManager.pushStencil(e,e._webGL[r.id].data[0],n)},t.WebGLMaskManager.prototype.popMask=function(e,t){var n=this.gl;t.stencilManager.popStencil(e,e._webGL[n.id].data[0],t)},t.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},t.WebGLStencilManager=function(e){this.stencilStack=[],this.setContext(e),this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(e){this.gl=e},t.WebGLStencilManager.prototype.pushStencil=function(e,t,n){var r=this.gl;this.bindGraphics(e,t,n),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var i=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===t.mode?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(i+1),255):r.stencilFunc(r.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i+1,255):r.stencilFunc(r.EQUAL,255-(i+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,n,r){this._currentGraphics=e;var i,s=this.gl,o=r.projection,u=r.offset;1===n.mode?(i=r.shaderManager.complexPrimativeShader,r.shaderManager.setShader(i),s.uniformMatrix3fv(i.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(i.projectionVector,o.x,-o.y),s.uniform2f(i.offsetVector,-u.x,-u.y),s.uniform3fv(i.tintColor,t.hex2rgb(e.tint)),s.uniform3fv(i.color,n.color),s.uniform1f(i.alpha,e.worldAlpha*n.alpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(i.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer)):(i=r.shaderManager.primitiveShader,r.shaderManager.setShader(i),s.uniformMatrix3fv(i.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(i.projectionVector,o.x,-o.y),s.uniform2f(i.offsetVector,-u.x,-u.y),s.uniform3fv(i.tintColor,t.hex2rgb(e.tint)),s.uniform1f(i.alpha,e.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(i.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(i.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(e,t,n){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var i=this.count;this.bindGraphics(e,t,n),r.colorMask(!1,!1,!1,!1),1===t.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)):(this.reverse?(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},t.WebGLShaderManager=function(e){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.shaderMap=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)},t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimativeShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<e.length;t++){var n=e[t];this.tempAttribState[n]=!0}var r=this.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?r.enableVertexAttribArray(t):r.disableVertexAttribArray(t))},t.WebGLShaderManager.prototype.setShader=function(e){return this._currentId===e._UID?!1:(this._currentId=e._UID,this.currentShader=e,this.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(e){this.vertSize=6,this.size=2e3;var t=4*this.size*this.vertSize,n=6*this.size;this.vertices=new Float32Array(t),this.indices=new Uint16Array(n),this.lastIndexCount=0;for(var r=0,i=0;n>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(e),this.dirty=!0,this.textures=[],this.blendModes=[]},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},t.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(e){var t=e.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=t.baseTexture);var n=t._uvs;if(n){var r,i,s,o,u=e.worldAlpha,a=e.tint,f=this.vertices,l=e.anchor.x,c=e.anchor.y;if(t.trim){var h=t.trim;i=h.x-l*h.width,r=i+t.crop.width,o=h.y-c*h.height,s=o+t.crop.height}else r=t.frame.width*(1-l),i=t.frame.width*-l,s=t.frame.height*(1-c),o=t.frame.height*-c;var p=4*this.currentBatchSize*this.vertSize,d=e.worldTransform,v=d.a,m=d.c,g=d.b,y=d.d,b=d.tx,w=d.ty;f[p++]=v*i+g*o+b,f[p++]=y*o+m*i+w,f[p++]=n.x0,f[p++]=n.y0,f[p++]=u,f[p++]=a,f[p++]=v*r+g*o+b,f[p++]=y*o+m*r+w,f[p++]=n.x1,f[p++]=n.y1,f[p++]=u,f[p++]=a,f[p++]=v*r+g*s+b,f[p++]=y*s+m*r+w,f[p++]=n.x2,f[p++]=n.y2,f[p++]=u,f[p++]=a,f[p++]=v*i+g*s+b,f[p++]=y*s+m*i+w,f[p++]=n.x3,f[p++]=n.y3,f[p++]=u,f[p++]=a,this.textures[this.currentBatchSize]=e.texture.baseTexture,this.blendModes[this.currentBatchSize]=e.blendMode,this.currentBatchSize++}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var n=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var r=e._uvs;e.tilePosition.x%=n.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=n.baseTexture.height*e.tileScaleOffset.y;var i=e.tilePosition.x/(n.baseTexture.width*e.tileScaleOffset.x),s=e.tilePosition.y/(n.baseTexture.height*e.tileScaleOffset.y),o=e.width/n.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),u=e.height/n.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);r.x0=0-i,r.y0=0-s,r.x1=1*o-i,r.y1=0-s,r.x2=1*o-i,r.y2=1*u-s,r.x3=0-i,r.y3=1*u-s;var a=e.worldAlpha,f=e.tint,l=this.vertices,c=e.width,h=e.height,p=e.anchor.x,d=e.anchor.y,v=c*(1-p),m=c*-p,g=h*(1-d),y=h*-d,w=4*this.currentBatchSize*this.vertSize,E=e.worldTransform,S=E.a,x=E.c,T=E.b,N=E.d,C=E.tx,k=E.ty;l[w++]=S*m+T*y+C,l[w++]=N*y+x*m+k,l[w++]=r.x0,l[w++]=r.y0,l[w++]=a,l[w++]=f,l[w++]=S*v+T*y+C,l[w++]=N*y+x*v+k,l[w++]=r.x1,l[w++]=r.y1,l[w++]=a,l[w++]=f,l[w++]=S*v+T*g+C,l[w++]=N*g+x*v+k,l[w++]=r.x2,l[w++]=r.y2,l[w++]=a,l[w++]=f,l[w++]=S*m+T*g+C,l[w++]=N*g+x*m+k,l[w++]=r.x3,l[w++]=r.y3,l[w++]=a,l[w++]=f,this.textures[this.currentBatchSize]=n.baseTexture,this.blendModes[this.currentBatchSize]=e.blendMode,this.currentBatchSize++},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1,e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,t.x,t.y);var n=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,n,0),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,n,8),e.vertexAttribPointer(this.shader.colorAttribute,2,e.FLOAT,!1,n,16)}if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var r=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,r)}for(var i,s,o=0,u=0,a=null,f=this.renderSession.blendModeManager.currentBlendMode,l=0,c=this.currentBatchSize;c>l;l++)i=this.textures[l],s=this.blendModes[l],(a!==i||f!==s)&&(this.renderBatch(a,o,u),u=l,o=0,a=i,f=s,this.renderSession.blendModeManager.setBlendMode(f)),o++;this.renderBatch(a,o,u),this.currentBatchSize=0}},t.WebGLSpriteBatch.prototype.renderBatch=function(e,n,r){if(0!==n){var i=this.gl;i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]||t.createWebGLTexture(e,i)),e._dirty[i.id]&&t.updateWebGLTexture(this.currentBaseTexture,i),i.drawElements(i.TRIANGLES,6*n,i.UNSIGNED_SHORT,6*r*2),this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var t=4*this.size*this.vertSize,n=6*this.maxSize;this.vertices=new Float32Array(t),this.indices=new Uint16Array(n),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,i=0;n>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(e,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=e.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(e){var t=e.children,n=t[0];if(n.texture._uvs){this.currentBaseTexture=n.texture.baseTexture,n.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(n.blendMode));for(var r=0,i=t.length;i>r;r++)this.renderSprite(t[r]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(e){if(e.visible&&(e.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=e.texture.baseTexture,e.texture._uvs))){var t,n,r,i,s,o,u,a,f=this.vertices;if(t=e.texture._uvs,n=e.texture.frame.width,r=e.texture.frame.height,e.texture.trim){var l=e.texture.trim;s=l.x-e.anchor.x*l.width,i=s+e.texture.crop.width,u=l.y-e.anchor.y*l.height,o=u+e.texture.crop.height}else i=e.texture.frame.width*(1-e.anchor.x),s=e.texture.frame.width*-e.anchor.x,o=e.texture.frame.height*(1-e.anchor.y),u=e.texture.frame.height*-e.anchor.y;a=4*this.currentBatchSize*this.vertSize,f[a++]=s,f[a++]=u,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x0,f[a++]=t.y1,f[a++]=e.alpha,f[a++]=i,f[a++]=u,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x1,f[a++]=t.y1,f[a++]=e.alpha,f[a++]=i,f[a++]=o,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x2,f[a++]=t.y2,f[a++]=e.alpha,f[a++]=s,f[a++]=o,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x3,f[a++]=t.y3,f[a++]=e.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;if(this.currentBaseTexture._glTextures[e.id]||t.createWebGLTexture(this.currentBaseTexture,e),e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]),this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var n=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,n)}e.drawElements(e.TRIANGLES,6*this.currentBatchSize,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,t.x,t.y),e.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var n=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,n,0),e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,!1,n,8),e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,!1,n,16),e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,!1,n,24),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,n,28),e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,!1,n,36)},t.WebGLFilterManager=function(e,t){this.transparent=t,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(e)},t.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(e,t){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=2*n.x,this.height=2*-n.y,this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(e){var n=this.gl,r=this.renderSession.projection,i=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new t.FilterTexture(this.gl,this.width,this.height),n.bindTexture(n.TEXTURE_2D,o.texture);var u=e._filterArea,a=s.padding;u.x-=a,u.y-=a,u.width+=2*a,u.height+=2*a,u.x<0&&(u.x=0),u.width>this.width&&(u.width=this.width),u.y<0&&(u.y=0),u.height>this.height&&(u.height=this.height),n.bindFramebuffer(n.FRAMEBUFFER,o.frameBuffer),n.viewport(0,0,u.width,u.height),r.x=u.width/2,r.y=-u.height/2,i.x=-u.x,i.y=-u.y,this.renderSession.shaderManager.setShader(this.defaultShader),n.uniform2f(this.defaultShader.projectionVector,u.width/2,-u.height/2),n.uniform2f(this.defaultShader.offsetVector,-u.x,-u.y),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),e._glFilterTexture=o},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,n=this.filterStack.pop(),r=n._filterArea,i=n._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(n.filterPasses.length>1){e.viewport(0,0,r.width,r.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var u=i,a=this.texturePool.pop();a||(a=new t.FilterTexture(this.gl,this.width,this.height)),a.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var f=0;f<n.filterPasses.length-1;f++){var l=n.filterPasses[f];e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),this.applyFilterPass(l,r,r.width,r.height);var c=u;u=a,a=c}e.enable(e.BLEND),i=u,this.texturePool.push(a)}var h=n.filterPasses[n.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var p=this.width,d=this.height,v=0,m=0,g=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];r=y._filterArea,p=r.width,d=r.height,v=r.x,m=r.y,g=y._glFilterTexture.frameBuffer}s.x=p/2,s.y=-d/2,o.x=v,o.y=m,r=n._filterArea;var w=r.x-v,E=r.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=w,this.vertexArray[1]=E+r.height,this.vertexArray[2]=w+r.width,this.vertexArray[3]=E+r.height,this.vertexArray[4]=w,this.vertexArray[5]=E,this.vertexArray[6]=w+r.width,this.vertexArray[7]=E,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,p,d),e.bindFramebuffer(e.FRAMEBUFFER,g),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.texture),this.applyFilterPass(h,r,p,d),this.renderSession.shaderManager.setShader(this.defaultShader),e.uniform2f(this.defaultShader.projectionVector,p/2,-d/2),e.uniform2f(this.defaultShader.offsetVector,-v,-m),this.texturePool.push(i),n._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,n,r,i){var s=this.gl,o=e.shaders[s.id];o||(o=new t.PixiShader(s),o.fragmentSrc=e.fragmentSrc,o.uniforms=e.uniforms,o.init(),e.shaders[s.id]=o),this.renderSession.shaderManager.setShader(o),s.uniform2f(o.projectionVector,r/2,-i/2),s.uniform2f(o.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(o.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var e=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.uvBuffer),e.deleteBuffer(this.colorBuffer),e.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,n,r,i){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),i=i||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(n,r)},t.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(e,t){if(this.width!==e||this.height!==t){this.width=e,this.height=t;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t)}},t.FilterTexture.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.pushMask=function(e,n){n.save();var r=e.alpha,i=e.worldTransform;n.setTransform(i.a,i.c,i.b,i.d,i.tx,i.ty),t.CanvasGraphics.renderGraphicsMask(e,n),n.clip(),e.worldAlpha=r},t.CanvasMaskManager.prototype.popMask=function(e){e.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,n){var r=e.texture;n=t.CanvasTinter.roundColor(n);var i="#"+("00000"+(0|n).toString(16)).substr(-6);if(r.tintCache=r.tintCache||{},r.tintCache[i])return r.tintCache[i];var s=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(r,n,s),t.CanvasTinter.convertTintToImage){var o=new Image;o.src=s.toDataURL(),r.tintCache[i]=o}else r.tintCache[i]=s,t.CanvasTinter.canvas=null;return s},t.CanvasTinter.tintWithMultiply=function(e,t,n){var r=n.getContext("2d"),i=e.frame;n.width=i.width,n.height=i.height,r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithOverlay=function(e,t,n){var r=n.getContext("2d"),i=e.frame;n.width=i.width,n.height=i.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithPerPixel=function(e,n,r){var i=r.getContext("2d"),s=e.frame;r.width=s.width,r.height=s.height,i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var o=t.hex2rgb(n),u=o[0],a=o[1],f=o[2],l=i.getImageData(0,0,s.width,s.height),c=l.data,h=0;h<c.length;h+=4)c[h+0]*=u,c[h+1]*=a,c[h+2]*=f;i.putImageData(l,0,0)},t.CanvasTinter.roundColor=function(e){var n=t.CanvasTinter.cacheStepsPerColorChannel,r=t.hex2rgb(e);return r[0]=Math.min(255,r[0]/n*n),r[1]=Math.min(255,r[1]/n*n),r[2]=Math.min(255,r[2]/n*n),t.rgb2hex(r)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,n,r,i){t.defaultRenderer||(t.sayHello("Canvas"),t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.clearBeforeRender=!0,this.transparent=!!i,t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over")),this.width=e||800,this.height=n||600,this.view=r||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){t.texturesToUpdate.length=0,t.texturesToDestroy.length=0,e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),t.Texture.frameUpdates.length>0&&(t.Texture.frameUpdates.length=0)},t.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},t.CanvasRenderer.prototype.renderDisplayObject=function(e,t){this.renderSession.context=t||this.context,e._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=n.length/2;this.count++,t.beginPath();for(var i=1;r-2>i;i++){var s=2*i,o=n[s],u=n[s+2],a=n[s+4],f=n[s+1],l=n[s+3],c=n[s+5];t.moveTo(o,f),t.lineTo(u,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},t.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var s=1;i-2>s;s++){var o=2*s,u=n[o],a=n[o+2],f=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5],p=r[o]*e.texture.width,d=r[o+2]*e.texture.width,v=r[o+4]*e.texture.width,m=r[o+1]*e.texture.height,g=r[o+3]*e.texture.height,y=r[o+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(u,l),t.lineTo(a,c),t.lineTo(f,h),t.closePath(),t.clip();var b=p*g+m*v+d*y-g*v-m*d-p*y,w=u*g+m*f+a*y-g*f-m*a-u*y,E=p*a+u*v+d*f-a*v-u*d-p*f,S=p*g*f+m*a*v+u*d*y-u*g*v-m*d*f-p*a*y,x=l*g+m*h+c*y-g*h-m*c-l*y,T=p*c+l*v+d*h-c*v-l*d-p*h,N=p*g*h+m*c*v+l*d*y-l*g*v-m*d*h-p*c*y;t.transform(w/b,x/b,E/b,T/b,S/b,N/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},t.CanvasBuffer=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t},t.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,n){for(var r=e.worldAlpha,i="",s=0;s<e.graphicsData.length;s++){var o=e.graphicsData[s],u=o.points;if(n.strokeStyle=i="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),n.lineWidth=o.lineWidth,o.type===t.Graphics.POLY){n.beginPath(),n.moveTo(u[0],u[1]);for(var a=1;a<u.length/2;a++)n.lineTo(u[2*a],u[2*a+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}else if(o.type===t.Graphics.RECT)(o.fillColor||0===o.fillColor)&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),n.fillRect(u[0],u[1],u[2],u[3])),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.strokeRect(u[0],u[1],u[2],u[3]));else if(o.type===t.Graphics.CIRC)n.beginPath(),n.arc(u[0],u[1],u[2],0,2*Math.PI),n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke());else if(o.type===t.Graphics.ELIP){var f=o.points,l=2*f[2],c=2*f[3],h=f[0]-l/2,p=f[1]-c/2;n.beginPath();var d=.5522848,v=l/2*d,m=c/2*d,g=h+l,y=p+c,w=h+l/2,E=p+c/2;n.moveTo(h,E),n.bezierCurveTo(h,E-m,w-v,p,w,p),n.bezierCurveTo(w+v,p,g,E-m,g,E),n.bezierCurveTo(g,E+m,w+v,y,w,y),n.bezierCurveTo(w-v,y,h,E+m,h,E),n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}else if(o.type===t.Graphics.RREC){var S=u[0],x=u[1],T=u[2],N=u[3],C=u[4],k=Math.min(T,N)/2|0;C=C>k?k:C,n.beginPath(),n.moveTo(S,x+C),n.lineTo(S,x+N-C),n.quadraticCurveTo(S,x+N,S+C,x+N),n.lineTo(S+T-C,x+N),n.quadraticCurveTo(S+T,x+N,S+T,x+N-C),n.lineTo(S+T,x+C),n.quadraticCurveTo(S+T,x,S+T-C,x),n.lineTo(S+C,x),n.quadraticCurveTo(S,x,S,x+C),n.closePath(),(o.fillColor||0===o.fillColor)&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,n){var r=e.graphicsData.length;if(0!==r){r>1&&(r=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var i=0;1>i;i++){var s=e.graphicsData[i],o=s.points;if(s.type===t.Graphics.POLY){n.beginPath(),n.moveTo(o[0],o[1]);for(var u=1;u<o.length/2;u++)n.lineTo(o[2*u],o[2*u+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&n.closePath()}else if(s.type===t.Graphics.RECT)n.beginPath(),n.rect(o[0],o[1],o[2],o[3]),n.closePath();else if(s.type===t.Graphics.CIRC)n.beginPath(),n.arc(o[0],o[1],o[2],0,2*Math.PI),n.closePath();else if(s.type===t.Graphics.ELIP){var a=s.points,f=2*a[2],l=2*a[3],c=a[0]-f/2,h=a[1]-l/2;n.beginPath();var p=.5522848,d=f/2*p,v=l/2*p,m=c+f,g=h+l,y=c+f/2,w=h+l/2;n.moveTo(c,w),n.bezierCurveTo(c,w-v,y-d,h,y,h),n.bezierCurveTo(y+d,h,m,w-v,m,w),n.bezierCurveTo(m,w+v,y+d,g,y,g),n.bezierCurveTo(y-d,g,c,w+v,c,w),n.closePath()}else if(s.type===t.Graphics.RREC){var E=o[0],S=o[1],x=o[2],T=o[3],N=o[4],C=Math.min(x,T)/2|0;N=N>C?C:N,n.beginPath(),n.moveTo(E,S+N),n.lineTo(E,S+T-N),n.quadraticCurveTo(E,S+T,E+N,S+T),n.lineTo(E+x-N,S+T),n.quadraticCurveTo(E+x,S+T,E+x,S+T-N),n.lineTo(E+x,S+N),n.quadraticCurveTo(E+x,S,E+x-N,S),n.lineTo(E+N,S),n.quadraticCurveTo(E,S,E,S+N),n.closePath()}}}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10,this.dirty=!0},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,n,r){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=n||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY},this.graphicsData.push(this.currentPath),this},t.Graphics.prototype.moveTo=function(e,n){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY},this.currentPath.points.push(e,n),this.graphicsData.push(this.currentPath),this},t.Graphics.prototype.lineTo=function(e,t){return this.currentPath.points.push(e,t),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(e,t,n,r){0===this.currentPath.points.length&&this.moveTo(0,0);var i,s,o=20,u=this.currentPath.points;0===u.length&&this.moveTo(0,0);for(var a=u[u.length-2],f=u[u.length-1],l=0,c=1;o>=c;c++)l=c/o,i=a+(e-a)*l,s=f+(t-f)*l,u.push(i+(e+(n-e)*l-i)*l,s+(t+(r-t)*l-s)*l);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(e,t,n,r,i,s){0===this.currentPath.points.length&&this.moveTo(0,0);for(var o,u,a,f,l,c=20,h=this.currentPath.points,p=h[h.length-2],d=h[h.length-1],v=0,m=1;c>m;m++)v=m/c,o=1-v,u=o*o,a=u*o,f=v*v,l=f*v,h.push(a*p+3*u*v*e+3*o*f*n+l*i,a*d+3*u*v*t+3*o*f*r+l*s);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(e,t,n,r,i){0===this.currentPath.points.length&&this.moveTo(e,t);var s=this.currentPath.points,o=s[s.length-2],u=s[s.length-1],a=u-t,f=o-e,l=r-t,c=n-e,h=Math.abs(a*c-f*l);if(1e-8>h||0===i)s.push(e,t);else{var p=a*a+f*f,d=l*l+c*c,v=a*l+f*c,m=i*Math.sqrt(p)/h,g=i*Math.sqrt(d)/h,y=m*v/p,b=g*v/d,w=m*c+g*f,E=m*l+g*a,S=f*(g+y),x=a*(g+y),T=c*(m+b),N=l*(m+b),C=Math.atan2(x-E,S-w),k=Math.atan2(N-E,T-w);this.arc(w+e,E+t,i,C,k,f*l>c*a)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(e,t,n,r,i,s){var o=e+Math.cos(r)*n,u=t+Math.sin(r)*n,a=this.currentPath.points;if((0!==a.length&&a[a.length-2]!==o||a[a.length-1]!==u)&&(this.moveTo(o,u),a=this.currentPath.points),r===i)return this;!s&&r>=i?i+=2*Math.PI:s&&i>=r&&(r+=2*Math.PI);var f=s?-1*(r-i):i-r,l=Math.abs(f)/(2*Math.PI)*40;if(0===f)return this;for(var c=f/(2*l),h=2*c,p=Math.cos(c),d=Math.sin(c),v=l-1,m=v%1/v,g=0;v>=g;g++){var y=g+m*g,b=c+r+h*y,w=Math.cos(b),E=-Math.sin(b);a.push((p*w+d*E)*n+e,(p*-E+d*w)*n+t)}return this.dirty=!0,this},t.Graphics.prototype.drawPath=function(e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(e),this.dirty=!0,this},t.Graphics.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=arguments.length<2?1:t,this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,n,r,i){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,n,r,i],type:t.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.drawRoundedRect=function(e,n,r,i,s){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,n,r,i,s],type:t.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.drawCircle=function(e,n,r){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,n,r,r],type:t.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.drawEllipse=function(e,n,r,i){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,n,r,i],type:t.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},t.Graphics.prototype.generateTexture=function(){var e=this.getBounds(),n=new t.CanvasBuffer(e.width,e.height),r=t.Texture.fromCanvas(n.canvas);return n.context.translate(-e.x,-e.y),t.CanvasGraphics.renderGraphics(this,n.context),r},t.Graphics.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),t.updateWebGLTexture(this._cachedSprite.texture.baseTexture,e.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var n=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(n[0],n[1])}if(t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var r=0,i=this.children.length;i>r;r++)this.children[r]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var n=e.context,r=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e.context),n.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty),t.CanvasGraphics.renderGraphics(this,n);for(var i=0,s=this.children.length;s>i;i++)this.children[i]._renderCanvas(e);this._mask&&e.maskManager.popMask(e.context)}},t.Graphics.prototype.getBounds=function(e){this.bounds||this.updateBounds();var t=this.bounds.x,n=this.bounds.width+this.bounds.x,r=this.bounds.y,i=this.bounds.height+this.bounds.y,s=e||this.worldTransform,o=s.a,u=s.c,a=s.b,f=s.d,l=s.tx,c=s.ty,h=o*n+a*i+l,p=f*i+u*n+c,d=o*t+a*i+l,v=f*i+u*t+c,m=o*t+a*r+l,g=f*r+u*t+c,y=o*n+a*r+l,b=f*r+u*n+c,w=h,E=p,S=h,x=p;S=S>d?d:S,S=S>m?m:S,S=S>y?y:S,x=x>v?v:x,x=x>g?g:x,x=x>b?b:x,w=d>w?d:w,w=m>w?m:w,w=y>w?y:w,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E;var T=this._bounds;return T.x=S,T.width=w-S,T.y=x,T.height=E-x,T},t.Graphics.prototype.updateBounds=function(){for(var e,n,r,i,s,o=1/0,u=-1/0,a=1/0,f=-1/0,l=0;l<this.graphicsData.length;l++){var c=this.graphicsData[l],h=c.type,p=c.lineWidth;if(e=c.points,h===t.Graphics.RECT)n=e[0]-p/2,r=e[1]-p/2,i=e[2]+p,s=e[3]+p,o=o>n?n:o,u=n+i>u?n+i:u,a=a>r?n:a,f=r+s>f?r+s:f;else if(h===t.Graphics.CIRC||h===t.Graphics.ELIP)n=e[0],r=e[1],i=e[2]+p/2,s=e[3]+p/2,o=o>n-i?n-i:o,u=n+i>u?n+i:u,a=a>r-s?r-s:a,f=r+s>f?r+s:f;else for(var d=0;d<e.length;d+=2)n=e[d],r=e[d+1],o=o>n-p?n-p:o,u=n+p>u?n+p:u,a=a>r-p?r-p:a,f=r+p>f?r+p:f}var v=this.boundsPadding;this.bounds=new t.Rectangle(o-v,a-v,u-o+2*v,f-a+2*v)},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var n=new t.CanvasBuffer(e.width,e.height),r=t.Texture.fromCanvas(n.canvas);this._cachedSprite=new t.Sprite(r),this._cachedSprite.buffer=n,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Graphics.RREC=4,t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(e){!this.visible||this.alpha<=0||(e.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(e),e.shaderManager.setShader(e.shaderManager.stripShader),this._renderStrip(e),e.spriteBatch.start())},t.Strip.prototype._initWebGL=function(e){var t=e.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var n=e.gl,r=e.projection,i=e.offset,s=e.shaderManager.stripShader;n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),n.uniform2f(s.projectionVector,r.x,-r.y),n.uniform2f(s.offsetVector,-i.x,-i.y),n.uniform1f(s.alpha,1),this.dirty?(this.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.verticies,n.STATIC_DRAW),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvs,n.STATIC_DRAW),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]||t.createWebGLTexture(this.texture.baseTexture,n)),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]||t.createWebGLTexture(this.texture.baseTexture,n)),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,this.indices.length,n.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var t=e.context,n=this.worldTransform;e.roundPixels?t.setTransform(n.a,n.c,n.b,n.d,0|n.tx,0|n.ty):t.setTransform(n.a,n.c,n.b,n.d,n.tx,n.ty);var r=this,i=r.verticies,s=r.uvs,o=i.length/2;this.count++;for(var u=0;o-2>u;u++){var a=2*u,f=i[a],l=i[a+2],c=i[a+4],h=i[a+1],p=i[a+3],d=i[a+5],v=(f+l+c)/3,m=(h+p+d)/3,g=f-v,y=h-m,b=Math.sqrt(g*g+y*y);f=v+g/b*(b+3),h=m+y/b*(b+3),g=l-v,y=p-m,b=Math.sqrt(g*g+y*y),l=v+g/b*(b+3),p=m+y/b*(b+3),g=c-v,y=d-m,b=Math.sqrt(g*g+y*y),c=v+g/b*(b+3),d=m+y/b*(b+3);var w=s[a]*r.texture.width,E=s[a+2]*r.texture.width,S=s[a+4]*r.texture.width,x=s[a+1]*r.texture.height,T=s[a+3]*r.texture.height,N=s[a+5]*r.texture.height;t.save(),t.beginPath(),t.moveTo(f,h),t.lineTo(l,p),t.lineTo(c,d),t.closePath(),t.clip();var C=w*T+x*S+E*N-T*S-x*E-w*N,k=f*T+x*c+l*N-T*c-x*l-f*N,L=w*l+f*S+E*c-l*S-f*E-w*c,A=w*T*c+x*l*S+f*E*N-f*T*S-x*E*c-w*l*N,O=h*T+x*d+p*N-T*d-x*p-h*N,M=w*p+h*S+E*d-p*S-h*E-w*d,_=w*T*d+x*p*S+h*E*N-h*T*S-x*E*d-w*p*N;t.transform(k/C,O/C,L/C,M/C,A/C,_/C),t.drawImage(r.texture.baseTexture.source,0,0),t.restore()}},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Rope=function(e,n){t.Strip.call(this,e),this.points=n,this.verticies=new t.Float32Array(4*n.length),this.uvs=new t.Float32Array(4*n.length),this.colors=new t.Float32Array(2*n.length),this.indices=new t.Uint16Array(2*n.length),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=e[0],r=this.indices,i=this.colors;this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,i[0]=1,i[1]=1,r[0]=0,r[1]=1;for(var s,o,u,a=e.length,f=1;a>f;f++)s=e[f],o=4*f,u=f/(a-1),f%2?(t[o]=u,t[o+1]=0,t[o+2]=u,t[o+3]=1):(t[o]=u,t[o+1]=0,t[o+2]=u,t[o+3]=1),o=2*f,i[o]=1,i[o+1]=1,o=2*f,r[o]=o,r[o+1]=o+1,n=s}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var n,r=e[0],i={x:0,y:0};this.count-=.2;for(var s,o,u,a,f,l=this.verticies,c=e.length,h=0;c>h;h++)s=e[h],o=4*h,n=h<e.length-1?e[h+1]:s,i.y=-(n.x-r.x),i.x=n.y-r.y,u=10*(1-h/(c-1)),u>1&&(u=1),a=Math.sqrt(i.x*i.x+i.y*i.y),f=this.texture.height/2,i.x/=a,i.y/=a,i.x*=f,i.y*=f,l[o]=s.x+i.x,l[o+1]=s.y+i.y,l[o+2]=s.x-i.x,l[o+3]=s.y-i.y,r=s;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(e){this.texture=e},t.TilingSprite=function(e,n,r){t.Sprite.call(this,e),this._width=n||100,this._height=r||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),t.TilingSprite.prototype.setTexture=function(e){this.texture!==e&&(this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var n,r;for(this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.updateWebGLTexture(this.tilingTexture.baseTexture,e.gl),this.tilingTexture.needsUpdate=!1)):e.spriteBatch.renderTilingSprite(this),n=0,r=this.children.length;r>n;n++)this.children[n]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),e.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){var n=e.context;this._mask&&e.maskManager.pushMask(this._mask,n),n.globalAlpha=this.worldAlpha;var r,i,s=this.worldTransform;if(n.setTransform(s.a,s.c,s.b,s.d,s.tx,s.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=n.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var o=this.tilePosition,u=this.tileScale;for(o.x%=this.tilingTexture.baseTexture.width,o.y%=this.tilingTexture.baseTexture.height,n.scale(u.x,u.y),n.translate(o.x,o.y),n.fillStyle=this.__tilePattern,n.fillRect(-o.x+this.anchor.x*-this._width,-o.y+this.anchor.y*-this._height,this._width/u.x,this._height/u.y),n.scale(1/u.x,1/u.y),n.translate(-o.x,-o.y),this._mask&&e.maskManager.popMask(e.context),r=0,i=this.children.length;i>r;r++)this.children[r]._renderCanvas(e)}},t.TilingSprite.prototype.getBounds=function(){var e=this._width,t=this._height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,i=t*(1-this.anchor.y),s=t*-this.anchor.y,o=this.worldTransform,u=o.a,a=o.c,f=o.b,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=-1/0,S=-1/0,x=1/0,T=1/0;x=x>p?p:x,x=x>v?v:x,x=x>g?g:x,x=x>b?b:x,T=T>d?d:T,T=T>m?m:T,T=T>y?y:T,T=T>w?w:T,E=p>E?p:E,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S;var N=this._bounds;return N.x=x,N.width=E-x,N.y=T,N.height=S-T,this._currentBounds=N,N},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(this.texture.baseTexture.hasLoaded){var n,r,i=this.texture,s=i.frame,o=s.width!==i.baseTexture.width||s.height!==i.baseTexture.height,u=!1;if(e?(n=t.getNextPowerOfTwo(s.width),r=t.getNextPowerOfTwo(s.height),(s.width!==n||s.height!==r)&&(u=!0)):o&&(n=s.width,r=s.height,u=!0),u){var a;this.tilingTexture&&this.tilingTexture.isTiling?(a=this.tilingTexture.canvasBuffer,a.resize(n,r),this.tilingTexture.baseTexture.width=n,this.tilingTexture.baseTexture.height=r,this.tilingTexture.needsUpdate=!0):(a=new t.CanvasBuffer(n,r),this.tilingTexture=t.Texture.fromCanvas(a.canvas),this.tilingTexture.canvasBuffer=a,this.tilingTexture.isTiling=!0),a.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,n,r),this.tileScaleOffset.x=s.width/n,this.tileScaleOffset.y=s.height/r}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i;this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},t.BaseTextureCache={},t.texturesToUpdate=[],t.texturesToDestroy=[],t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,n){if(t.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=n||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this.id=t.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],e){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,t.texturesToUpdate.push(this);else{var r=this;this.source.onload=function(){r.hasLoaded=!0,r.width=r.source.width,r.height=r.source.height;for(var e=0;e<r._glTextures.length;e++)r._dirty[e]=!0;r.dispatchEvent({type:"loaded",content:r})},this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null,this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,t.texturesToDestroy.push(this)},t.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},t.BaseTexture.fromImage=function(e,n,r){var i=t.BaseTextureCache[e];if(void 0===n&&-1===e.indexOf("data:")&&(n=!0),!i){var s=new Image;n&&(s.crossOrigin=""),s.src=e,i=new t.BaseTexture(s,r),i.imageUrl=e,t.BaseTextureCache[e]=i}return i},t.BaseTexture.fromCanvas=function(e,n){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var r=t.BaseTextureCache[e._pixiId];return r||(r=new t.BaseTexture(e,n),t.BaseTextureCache[e._pixiId]=r),r},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,n){if(t.EventTarget.call(this),this.noFrame=!1,n||(this.noFrame=!0,n=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=n,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new t.Rectangle(0,0,1,1),e.hasLoaded)this.noFrame&&(n=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(n);else{var r=this;e.addEventListener("loaded",function(){r.onBaseTextureLoaded()})}},t.Texture.prototype.constructor=t.Texture,t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(e){if(this.noFrame=!1,this.frame=e,this.width=e.width,this.height=e.height,this.crop.x=e.x,this.crop.y=e.y,this.crop.width=e.width,this.crop.height=e.height,!this.trim&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=e&&e.width&&e.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&t.Texture.frameUpdates.push(this)},t.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,n=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=e.x/n,this._uvs.y0=e.y/r,this._uvs.x1=(e.x+e.width)/n,this._uvs.y1=e.y/r,this._uvs.x2=(e.x+e.width)/n,this._uvs.y2=(e.y+e.height)/r,this._uvs.x3=e.x/n,this._uvs.y3=(e.y+e.height)/r},t.Texture.fromImage=function(e,n,r){var i=t.TextureCache[e];return i||(i=new t.Texture(t.BaseTexture.fromImage(e,n,r)),t.TextureCache[e]=i),i},t.Texture.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return n},t.Texture.fromCanvas=function(e,n){var r=t.BaseTexture.fromCanvas(e,n);return new t.Texture(r)},t.Texture.addTextureToCache=function(e,n){t.TextureCache[n]=e},t.Texture.removeTextureFromCache=function(e){var n=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],n},t.Texture.frameUpdates=[],t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.RenderTexture=function(e,n,r,i){if(t.EventTarget.call(this),this.width=e||100,this.height=n||100,this.frame=new t.Rectangle(0,0,this.width,this.height),this.crop=new t.Rectangle(0,0,this.width,this.height),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=i||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=r||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var s=this.renderer.gl;this.textureBuffer=new t.FilterTexture(s,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[s.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,t.Texture.frameUpdates.push(this)},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,n,r){(e!==this.width||n!==this.height)&&(this.width=this.frame.width=this.crop.width=e,this.height=this.frame.height=this.crop.height=n,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))},t.RenderTexture.prototype.clear=function(){this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},t.RenderTexture.prototype.renderWebGL=function(e,n,r){var i=this.renderer.gl;i.colorMask(!0,!0,!0,!0),i.viewport(0,0,this.width,this.height),i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),r&&this.textureBuffer.clear();var s=e.children,o=e.worldTransform;e.worldTransform=t.RenderTexture.tempMatrix,e.worldTransform.d=-1,e.worldTransform.ty=-2*this.projection.y,n&&(e.worldTransform.tx=n.x,e.worldTransform.ty-=n.y);for(var u=0,a=s.length;a>u;u++)s[u].updateTransform();t.WebGLRenderer.updateTextures(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(e,this.projection,this.textureBuffer.frameBuffer),e.worldTransform=o,this.renderer.spriteBatch.dirty=!0},t.RenderTexture.prototype.renderCanvas=function(e,n,r){var i=e.children,s=e.worldTransform;e.worldTransform=t.RenderTexture.tempMatrix,n?(e.worldTransform.tx=n.x,e.worldTransform.ty=n.y):(e.worldTransform.tx=0,e.worldTransform.ty=0);for(var o=0,u=i.length;u>o;o++)i[o].updateTransform();r&&this.textureBuffer.clear();var a=this.textureBuffer.context;this.renderer.renderDisplayObject(e,a),a.setTransform(1,0,0,1,0,0),e.worldTransform=s},t.RenderTexture.tempMatrix=new t.Matrix,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define("PIXI",function(){return e.PIXI=t}()):e.PIXI=t}.call(this),function(){var e=this,t=t||{VERSION:"2.0.7",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(PIXI.InteractionManager=PIXI.InteractionManager||function(){},PIXI.dontSayHello=!0,t.Utils={getProperty:function(e,t){for(var n=t.split("."),r=n.pop(),i=n.length,s=1,o=n[0];i>s&&(e=e[o]);)o=n[s],s++;return e?e[r]:null},setProperty:function(e,t,n){for(var r=t.split("."),i=r.pop(),s=r.length,o=1,u=r[0];s>o&&(e=e[u]);)u=r[o],o++;return e&&(e[i]=n),e},transposeArray:function(e){for(var t=new Array(e[0].length),n=0;n<e[0].length;n++){t[n]=new Array(e.length-1);for(var r=e.length-1;r>-1;r--)t[n][r]=e[r][n]}return t},rotateArray:function(e,n){if("string"!=typeof n&&(n=(n%360+360)%360),90===n||-270===n||"rotateLeft"===n)e=t.Utils.transposeArray(e),e=e.reverse();else if(-90===n||270===n||"rotateRight"===n)e=e.reverse(),e=t.Utils.transposeArray(e);else if(180===Math.abs(n)||"rotate180"===n){for(var r=0;r<e.length;r++)e[r].reverse();e=e.reverse()}return e},parseDimension:function(e,t){var n=0,r=0;return"string"==typeof e?"%"===e.substr(-1)?(n=parseInt(e,10)/100,r=0===t?window.innerWidth*n:window.innerHeight*n):r=parseInt(e,10):r=e,r},shuffle:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},pad:function(e,t,n,r){if("undefined"==typeof t)var t=0;if("undefined"==typeof n)var n=" ";if("undefined"==typeof r)var r=3;var i=0;if(t+1>=e.length)switch(r){case 1:e=(new Array(t+1-e.length)).join(n)+e;break;case 3:var s=Math.ceil((i=t-e.length)/2),o=i-s;e=(new Array(o+1)).join(n)+e+(new Array(s+1)).join(n);break;default:e+=(new Array(t+1-e.length)).join(n)}return e},isPlainObject:function(e){if("object"!=typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!{}.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),f===a&&(u=this,--a);f>a;a++)if(null!=(e=arguments[a]))for(n in e)r=u[n],i=e[n],u!==i&&(l&&i&&(t.Utils.isPlainObject(i)||(s=Array.isArray(i)))?(s?(s=!1,o=r&&Array.isArray(r)?r:[]):o=r&&t.Utils.isPlainObject(r)?r:{},u[n]=t.Utils.extend(l,o,i)):void 0!==i&&(u[n]=i));return u},mixin:function(e,n){if(!e||"object"!=typeof e)return n;for(var r in e){var i=e[r];if(!i.childNodes&&!i.cloneNode){var s=typeof e[r];n[r]=e[r]&&"object"===s?typeof n[r]===s?t.Utils.mixin(e[r],n[r]):t.Utils.mixin(e[r],new i.constructor):e[r]}}return n}},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var s=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,s)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function s(e){return e&&(s.prototype=e),this instanceof s?void 0:new s}(r.prototype),n}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Array.prototype.forEach||(Array.prototype.forEach=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)i in t&&e.call(r,t[i],i,t)}),"function"!=typeof window.Uint32Array){var n=function(e){var t=new Array;window[e]=function(e){if("number"==typeof e){Array.call(this,e),this.length=e;for(var t=0;t<this.length;t++)this[t]=0}else{Array.call(this,e.length),this.length=e.length;for(var t=0;t<this.length;t++)this[t]=e[t]}},window[e].prototype=t,window[e].constructor=window[e]};n("Uint32Array"),n("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),t.Circle=function(e,t,n){e=e||0,t=t||0,n=n||0,this.x=e,this.y=t,this._diameter=n,this._radius=n>0?.5*n:0},t.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},setTo:function(e,t,n){return this.x=e,this.y=t,this._diameter=n,this._radius=.5*n,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.diameter=this._diameter,e},distance:function(e,n){return"undefined"==typeof n&&(n=!1),n?t.Math.distanceRounded(this.x,this.y,e.x,e.y):t.Math.distance(this.x,this.y,e.x,e.y)},clone:function(e){return"undefined"==typeof e?e=new t.Circle(this.x,this.y,this.diameter):e.setTo(this.x,this.y,this.diameter),e},contains:function(e,n){return t.Circle.contains(this,e,n)},circumferencePoint:function(e,n,r){return t.Circle.circumferencePoint(this,e,n,r)},offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},t.Circle.prototype.constructor=t.Circle,Object.defineProperty(t.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){e>0&&(this._diameter=e,this._radius=.5*e)}}),Object.defineProperty(t.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){e>0&&(this._radius=e,this._diameter=2*e)}}),Object.defineProperty(t.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){e>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-e}}),Object.defineProperty(t.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){e<this.x?(this._radius=0,this._diameter=0):this.radius=e-this.x}}),Object.defineProperty(t.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){e>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-e}}),Object.defineProperty(t.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){e<this.y?(this._radius=0,this._diameter=0):this.radius=e-this.y}}),Object.defineProperty(t.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(t.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(e){e===!0&&this.setTo(0,0,0)}}),t.Circle.contains=function(e,t,n){if(e.radius>0&&t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom){var r=(e.x-t)*(e.x-t),i=(e.y-n)*(e.y-n);return r+i<=e.radius*e.radius}return!1},t.Circle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.diameter==t.diameter},t.Circle.intersects=function(e,n){return t.Math.distance(e.x,e.y,n.x,n.y)<=e.radius+n.radius},t.Circle.circumferencePoint=function(e,n,r,i){return"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=new t.Point),r===!0&&(n=t.Math.degToRad(n)),i.x=e.x+e.radius*Math.cos(n),i.y=e.y+e.radius*Math.sin(n),i},t.Circle.intersectsRectangle=function(e,t){var n=Math.abs(e.x-t.x-t.halfWidth),r=t.halfWidth+e.radius;if(n>r)return!1;var i=Math.abs(e.y-t.y-t.halfHeight),s=t.halfHeight+e.radius;if(i>s)return!1;if(n<=t.halfWidth||i<=t.halfHeight)return!0;var o=n-t.halfWidth,u=i-t.halfHeight,a=o*o,f=u*u,l=e.radius*e.radius;return l>=a+f},PIXI.Circle=t.Circle,t.Point=function(e,t){e=e||0,t=t||0,this.x=e,this.y=t},t.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(e,t){return this.x=e||0,this.y=t||(0!==t?this.x:0),this},set:function(e,t){return this.x=e||0,this.y=t||(0!==t?this.x:0),this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},multiply:function(e,t){return this.x*=e,this.y*=t,this},divide:function(e,t){return this.x/=e,this.y/=t,this},clampX:function(e,n){return this.x=t.Math.clamp(this.x,e,n),this},clampY:function(e,n){return this.y=t.Math.clamp(this.y,e,n),this},clamp:function(e,n){return this.x=t.Math.clamp(this.x,e,n),this.y=t.Math.clamp(this.y,e,n),this},clone:function(e){return"undefined"==typeof e?e=new t.Point(this.x,this.y):e.setTo(this.x,this.y),e},copyTo:function(e){return e.x=this.x,e.y=this.y,e},distance:function(e,n){return t.Point.distance(this,e,n)},equals:function(e){return e.x===this.x&&e.y===this.y},angle:function(e,n){return"undefined"==typeof n&&(n=!1),n?t.Math.radToDeg(Math.atan2(e.y-this.y,e.x-this.x)):Math.atan2(e.y-this.y,e.x-this.x)},angleSq:function(e){return this.subtract(e).angle(e.subtract(this))},rotate:function(e,n,r,i,s){return t.Point.rotate(this,e,n,r,i,s)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(e){return this.normalize().multiply(e,e)},normalize:function(){if(!this.isZero()){var e=this.getMagnitude();this.x/=e,this.y/=e}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},t.Point.prototype.constructor=t.Point,t.Point.add=function(e,n,r){return"undefined"==typeof r&&(r=new t.Point),r.x=e.x+n.x,r.y=e.y+n.y,r},t.Point.subtract=function(e,n,r){return"undefined"==typeof r&&(r=new t.Point),r.x=e.x-n.x,r.y=e.y-n.y,r},t.Point.multiply=function(e,n,r){return"undefined"==typeof r&&(r=new t.Point),r.x=e.x*n.x,r.y=e.y*n.y,r},t.Point.divide=function(e,n,r){return"undefined"==typeof r&&(r=new t.Point),r.x=e.x/n.x,r.y=e.y/n.y,r},t.Point.equals=function(e,t){return e.x===t.x&&e.y===t.y},t.Point.angle=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},t.Point.angleSq=function(e,t){return e.subtract(t).angle(t.subtract(e))},t.Point.negative=function(e,n){return"undefined"==typeof n&&(n=new t.Point),n.setTo(-e.x,-e.y)},t.Point.multiplyAdd=function(e,n,r,i){return"undefined"==typeof i&&(i=new t.Point),i.setTo(e.x+n.x*r,e.y+n.y*r)},t.Point.interpolate=function(e,n,r,i){return"undefined"==typeof i&&(i=new t.Point),i.setTo(e.x+(n.x-e.x)*r,e.y+(n.y-e.y)*r)},t.Point.perp=function(e,n){return"undefined"==typeof n&&(n=new t.Point),n.setTo(-e.y,e.x)},t.Point.rperp=function(e,n){return"undefined"==typeof n&&(n=new t.Point),n.setTo(e.y,-e.x)},t.Point.distance=function(e,n,r){return"undefined"==typeof r&&(r=!1),r?t.Math.distanceRounded(e.x,e.y,n.x,n.y):t.Math.distance(e.x,e.y,n.x,n.y)},t.Point.project=function(e,n,r){"undefined"==typeof r&&(r=new t.Point);var i=e.dot(n)/n.getMagnitudeSq();return 0!==i&&r.setTo(i*n.x,i*n.y),r},t.Point.projectUnit=function(e,n,r){"undefined"==typeof r&&(r=new t.Point);var i=e.dot(n);return 0!==i&&r.setTo(i*n.x,i*n.y),r},t.Point.normalRightHand=function(e,n){return"undefined"==typeof n&&(n=new t.Point),n.setTo(-1*e.y,e.x)},t.Point.normalize=function(e,n){"undefined"==typeof n&&(n=new t.Point);var r=e.getMagnitude();return 0!==r&&n.setTo(e.x/r,e.y/r),n},t.Point.rotate=function(e,n,r,i,s,o){return s=s||!1,o=o||null,s&&(i=t.Math.degToRad(i)),null===o&&(o=Math.sqrt((n-e.x)*(n-e.x)+(r-e.y)*(r-e.y))),e.setTo(n+o*Math.cos(i),r+o*Math.sin(i))},t.Point.centroid=function(e,n){if("undefined"==typeof n&&(n=new t.Point),"[object Array]"!==Object.prototype.toString.call(e))throw new Error("Phaser.Point. Parameter 'points' must be an array");var r=e.length;if(1>r)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===r)return n.copyFrom(e[0]),n;for(var i=0;r>i;i++)t.Point.add(n,e[i],n);return n.divide(r,r),n},PIXI.Point=t.Point,t.Rectangle=function(e,t,n,r){e=e||0,t=t||0,n=n||0,r=r||0,this.x=e,this.y=t,this.width=n,this.height=r},t.Rectangle.prototype={offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},inflate:function(e,n){return t.Rectangle.inflate(this,e,n)},size:function(e){return t.Rectangle.size(this,e)},clone:function(e){return t.Rectangle.clone(this,e)},contains:function(e,n){return t.Rectangle.contains(this,e,n)},containsRect:function(e){return t.Rectangle.containsRect(this,e)},equals:function(e){return t.Rectangle.equals(this,e)},intersection:function(e,n){return t.Rectangle.intersection(this,e,n)},intersects:function(e,n){return t.Rectangle.intersects(this,e,n)},intersectsRaw:function(e,n,r,i,s){return t.Rectangle.intersectsRaw(this,e,n,r,i,s)},union:function(e,n){return t.Rectangle.union(this,e,n)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(t.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(t.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(t.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<=this.y?0:this.y-e}}),Object.defineProperty(t.Rectangle.prototype,"bottomRight",{get:function(){return new t.Point(this.right,this.bottom)},set:function(e){this.right=e.x,this.bottom=e.y}}),Object.defineProperty(t.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){this.width=e>=this.right?0:this.right-e,this.x=e}}),Object.defineProperty(t.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<=this.x?0:e-this.x}}),Object.defineProperty(t.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(t.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(t.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}}),Object.defineProperty(t.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}}),Object.defineProperty(t.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(t.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(t.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){e>=this.bottom?(this.height=0,this.y=e):this.height=this.bottom-e}}),Object.defineProperty(t.Rectangle.prototype,"topLeft",{get:function(){return new t.Point(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(t.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),t.Rectangle.prototype.constructor=t.Rectangle,t.Rectangle.inflate=function(e,t,n){return e.x-=t,e.width+=2*t,e.y-=n,e.height+=2*n,e},t.Rectangle.inflatePoint=function(e,n){return t.Rectangle.inflate(e,n.x,n.y)},t.Rectangle.size=function(e,n){return"undefined"==typeof n||null===n?n=new t.Point(e.width,e.height):n.setTo(e.width,e.height),n},t.Rectangle.clone=function(e,n){return"undefined"==typeof n||null===n?n=new t.Rectangle(e.x,e.y,e.width,e.height):n.setTo(e.x,e.y,e.width,e.height),n},t.Rectangle.contains=function(e,t,n){return e.width<=0||e.height<=0?!1:t>=e.x&&t<=e.right&&n>=e.y&&n<=e.bottom},t.Rectangle.containsRaw=function(e,t,n,r,i,s){return i>=e&&e+n>=i&&s>=t&&t+r>=s},t.Rectangle.containsPoint=function(e,n){return t.Rectangle.contains(e,n.x,n.y)},t.Rectangle.containsRect=function(e,t){return e.volume>t.volume?!1:e.x>=t.x&&e.y>=t.y&&e.right<=t.right&&e.bottom<=t.bottom},t.Rectangle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.width==t.width&&e.height==t.height},t.Rectangle.intersection=function(e,n,r){return"undefined"==typeof r&&(r=new t.Rectangle),t.Rectangle.intersects(e,n)&&(r.x=Math.max(e.x,n.x),r.y=Math.max(e.y,n.y),r.width=Math.min(e.right,n.right)-r.x,r.height=Math.min(e.bottom,n.bottom)-r.y),r},t.Rectangle.intersects=function(e,t){return e.width<=0||e.height<=0||t.width<=0||t.height<=0?!1:!(e.right<t.x||e.bottom<t.y||e.x>t.right||e.y>t.bottom)},t.Rectangle.intersectsRaw=function(e,t,n,r,i,s){return"undefined"==typeof s&&(s=0),!(t>e.right+s||n<e.left-s||r>e.bottom+s||i<e.top-s)},t.Rectangle.union=function(e,n,r){return"undefined"==typeof r&&(r=new t.Rectangle),r.setTo(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.max(e.right,n.right)-Math.min(e.left,n.left),Math.max(e.bottom,n.bottom)-Math.min(e.top,n.top))},PIXI.Rectangle=t.Rectangle,PIXI.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Line=function(e,n,r,i){e=e||0,n=n||0,r=r||0,i=i||0,this.start=new t.Point(e,n),this.end=new t.Point(r,i)},t.Line.prototype={setTo:function(e,t,n,r){return this.start.setTo(e,t),this.end.setTo(n,r),this},fromSprite:function(e,t,n){return"undefined"==typeof n&&(n=!1),n?this.setTo(e.center.x,e.center.y,t.center.x,t.center.y):this.setTo(e.x,e.y,t.x,t.y)},intersects:function(e,n,r){return t.Line.intersectsPoints(this.start,this.end,e.start,e.end,n,r)},pointOnLine:function(e,t){return(e-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(t-this.start.y)},pointOnSegment:function(e,t){var n=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),i=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(e,t)&&e>=n&&r>=e&&t>=i&&s>=t},coordinatesOnLine:function(e,t){"undefined"==typeof e&&(e=1),"undefined"==typeof t&&(t=[]);var n=Math.round(this.start.x),r=Math.round(this.start.y),i=Math.round(this.end.x),s=Math.round(this.end.y),o=Math.abs(i-n),u=Math.abs(s-r),a=i>n?1:-1,f=s>r?1:-1,l=o-u;t.push([n,r]);for(var c=1;n!=i||r!=s;){var h=l<<1;h>-u&&(l-=u,n+=a),o>h&&(l+=o,r+=f),c%e===0&&t.push([n,r]),c++}return t}},Object.defineProperty(t.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(t.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(t.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(t.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(t.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(t.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),t.Line.intersectsPoints=function(e,n,r,i,s,o){"undefined"==typeof s&&(s=!0),"undefined"==typeof o&&(o=new t.Point);var u=n.y-e.y,a=i.y-r.y,f=e.x-n.x,l=r.x-i.x,c=n.x*e.y-e.x*n.y,h=i.x*r.y-r.x*i.y,p=u*l-a*f;if(0===p)return null;if(o.x=(f*h-l*c)/p,o.y=(a*c-u*h)/p,s){var d=(i.y-r.y)*(n.x-e.x)-(i.x-r.x)*(n.y-e.y),v=((i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x))/d,m=((n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x))/d;return v>=0&&1>=v&&m>=0&&1>=m?o:null}return o},t.Line.intersects=function(e,n,r,i){return t.Line.intersectsPoints(e.start,e.end,n.start,n.end,r,i)},t.Ellipse=function(e,n,r,i){this.type=t.ELLIPSE,e=e||0,n=n||0,r=r||0,i=i||0,this.x=e,this.y=n,this.width=r,this.height=i},t.Ellipse.prototype={setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},clone:function(e){return"undefined"==typeof e?e=new t.Ellipse(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e},contains:function(e,n){return t.Ellipse.contains(this,e,n)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},t.Ellipse.prototype.constructor=t.Ellipse,Object.defineProperty(t.Ellipse.prototype,"left",{get:function(){return this.x},set:function(e){this.x=e}}),Object.defineProperty(t.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<this.x?0:this.x+e}}),Object.defineProperty(t.Ellipse.prototype,"top",{get:function(){return this.y},set:function(e){this.y=e}}),Object.defineProperty(t.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<this.y?0:this.y+e}}),Object.defineProperty(t.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),t.Ellipse.contains=function(e,t,n){if(e.width<=0||e.height<=0)return!1;var r=(t-e.x)/e.width-.5,i=(n-e.y)/e.height-.5;return r*=r,i*=i,.25>r+i},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Ellipse=t.Ellipse,t.Polygon=function(e){if(this.type=t.POLYGON,e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var n=[],r=0,i=e.length;i>r;r+=2)n.push(new t.Point(e[r],e[r+1]));e=n}this._points=e},t.Polygon.prototype={clone:function(){for(var e=[],n=0;n<this.points.length;n++)e.push(this.points[n].clone());return new t.Polygon(e)},contains:function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var s=this.points[r].x,o=this.points[r].y,u=this.points[i].x,a=this.points[i].y,f=o>t!=a>t&&(u-s)*(t-o)/(a-o)+s>e;f&&(n=!n)}return n}},t.Polygon.prototype.constructor=t.Polygon,Object.defineProperty(t.Polygon.prototype,"points",{get:function(){return this._points},set:function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var n=[],r=0,i=e.length;i>r;r+=2)n.push(new t.Point(e[r],e[r+1]));e=n}this._points=e}}),Object.defineProperty(t.Polygon.prototype,"area",{get:function(){var e,t,n,r,i,s=Number.MAX_VALUE,o=0;for(i=0;i<this.points.length;i++)this.points[i].y<s&&(s=this.points[i].y);for(i=0;i<this.points.length;i++)e=this.points[i],t=i===this.points.length-1?this.points[0]:this.points[i+1],n=(e.y-s+(t.y-s))/2,r=e.x-t.x,o+=n*r;return o}}),PIXI.Polygon=t.Polygon,t.Camera=function(e,n,r,i,s,o){this.game=e,this.world=e.world,this.id=0,this.view=new t.Rectangle(r,i,s,o),this.screenView=new t.Rectangle(r,i,s,o),this.bounds=new t.Rectangle(r,i,s,o),this.deadzone=null,this.visible=!0,this.atLimit={x:!1,y:!1},this.target=null,this._edge=0,this.displayObject=null,this.scale=null},t.Camera.FOLLOW_LOCKON=0,t.Camera.FOLLOW_PLATFORMER=1,t.Camera.FOLLOW_TOPDOWN=2,t.Camera.FOLLOW_TOPDOWN_TIGHT=3,t.Camera.prototype={follow:function(e,n){"undefined"==typeof n&&(n=t.Camera.FOLLOW_LOCKON),this.target=e;var r;switch(n){case t.Camera.FOLLOW_PLATFORMER:var i=this.width/8,s=this.height/3;this.deadzone=new t.Rectangle((this.width-i)/2,(this.height-s)/2-.25*s,i,s);break;case t.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4,this.deadzone=new t.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case t.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8,this.deadzone=new t.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case t.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(e){this.setPosition(Math.round(e.x-this.view.halfWidth),Math.round(e.y-this.view.halfHeight))},focusOnXY:function(e,t){this.setPosition(Math.round(e-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateTarget:function(){this.deadzone?(this._edge=this.target.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.target.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this.target.x-this.deadzone.right),this._edge=this.target.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.target.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this.target.y-this.deadzone.bottom)):(this.view.x=this.target.x-this.view.halfWidth,this.view.y=this.target.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x),this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width),this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top),this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height),this.view.floor()},setPosition:function(e,t){this.view.x=e,this.view.y=t,this.bounds&&this.checkBounds()},setSize:function(e,t){this.view.width=e,this.view.height=t},reset:function(){this.target=null,this.view.x=0,this.view.y=0}},t.Camera.prototype.constructor=t.Camera,Object.defineProperty(t.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(t.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(t.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}}),Object.defineProperty(t.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}}),t.State=function(){this.game=null,this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},t.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}},t.State.prototype.constructor=t.State,t.StateManager=function(e,t){this.game=e,this.states={},this._pendingState=null,"undefined"!=typeof t&&null!==t&&(this._pendingState=t),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},t.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),this.game.load.onLoadComplete.add(this.loadComplete,this),null!==this._pendingState&&("string"==typeof this._pendingState?this.start(this._pendingState,!1,!1):this.add("default",this._pendingState,!0))},add:function(e,n,r){"undefined"==typeof r&&(r=!1);var i;return n instanceof t.State?i=n:"object"==typeof n?(i=n,i.game=this.game):"function"==typeof n&&(i=new n(this.game)),this.states[e]=i,r&&(this.game.isBooted?this.start(e):this._pendingState=e),i},remove:function(e){this.current===e&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[e]},start:function(e,t,n){"undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=!1),this.checkState(e)&&(this._pendingState=e,this._clearWorld=t,this._clearCache=n,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!1),this._pendingState=this.current,this._clearWorld=e,this._clearCache=t,arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy())),this.setCurrentState(this._pendingState),this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete(),this.current===this._pendingState&&(this._pendingState=null))},checkState:function(e){if(this.states[e]){var t=!1;return this.states[e].preload&&(t=!0),this.states[e].create&&(t=!0),this.states[e].update&&(t=!0),this.states[e].render&&(t=!0),t===!1?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+e),!1},link:function(e){this.states[e].game=this.game,this.states[e].add=this.game.add,this.states[e].make=this.game.make,this.states[e].camera=this.game.camera,this.states[e].cache=this.game.cache,this.states[e].input=this.game.input,this.states[e].load=this.game.load,this.states[e].math=this.game.math,this.states[e].sound=this.game.sound,this.states[e].scale=this.game.scale,this.states[e].state=this,this.states[e].stage=this.game.stage,this.states[e].time=this.game.time,this.states[e].tweens=this.game.tweens,this.states[e].world=this.game.world,this.states[e].particles=this.game.particles,this.states[e].rnd=this.game.rnd,this.states[e].physics=this.game.physics},setCurrentState:function(e){this.callbackContext=this.states[e],this.link(e),this.onInitCallback=this.states[e].init||this.dummy,this.onPreloadCallback=this.states[e].preload||null,this.onLoadRenderCallback=this.states[e].loadRender||null,this.onLoadUpdateCallback=this.states[e].loadUpdate||null,this.onCreateCallback=this.states[e].create||null,this.onUpdateCallback=this.states[e].update||null,this.onPreRenderCallback=this.states[e].preRender||null,this.onRenderCallback=this.states[e].render||null,this.onPausedCallback=this.states[e].paused||null,this.onResumedCallback=this.states[e].resumed||null,this.onPauseUpdateCallback=this.states[e].pauseUpdate||null,this.onShutDownCallback=this.states[e].shutdown||this.dummy,this.current=e,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),this._args=[]},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},render:function(){this._created&&this.onRenderCallback?(this.game.renderType===t.CANVAS&&(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0)),this.onRenderCallback.call(this.callbackContext,this.game),this.game.renderType===t.CANVAS&&this.game.context.restore()):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null}},t.StateManager.prototype.constructor=t.StateManager,t.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},t.LinkedList.prototype={add:function(e){return 0===this.total&&null===this.first&&null===this.last?(this.first=e,this.last=e,this.next=e,e.prev=this,this.total++,e):(this.last.next=e,e.prev=this.last,this.last=e,this.total++,e)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(e){return 1===this.total?(this.reset(),void (e.next=e.prev=null)):(e===this.first?this.first=this.first.next:e===this.last&&(this.last=this.last.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.next=e.prev=null,null===this.first&&(this.last=null),void (this.total--))},callAll:function(e){if(this.first&&this.last){var t=this.first;do t&&t[e]&&t[e].call(t),t=t.next;while(t!=this.last.next)}}},t.LinkedList.prototype.constructor=t.LinkedList,t.ArrayList=function(){this.total=0,this.position=0,this.list=[]},t.ArrayList.prototype={add:function(e){return this.exists(e)||(this.list.push(e),this.total++),e},getIndex:function(e){return this.list.indexOf(e)},exists:function(e){return this.list.indexOf(e)>-1},reset:function(){this.list.length=0,this.total=0},remove:function(e){var t=this.list.indexOf(e);return t>-1?(this.list.splice(t,1),this.total--,e):void 0},setAll:function(e,t){for(var n=this.list.length;n--;)this.list[n]&&this.list[n][e]&&(this.list[n][e]=t)},callAll:function(e){for(var t=Array.prototype.splice.call(arguments,1),n=this.list.length;n--;)this.list[n]&&this.list[n][e]&&this.list[n][e].apply(this.list[n],t)}},Object.defineProperty(t.ArrayList.prototype,"first",{get:function(){return this.position=0,this.total>0?this.list[0]:null}}),Object.defineProperty(t.ArrayList.prototype,"next",{get:function(){return this.position<this.total?(this.position++,this.list[this.position]):null}}),t.ArrayList.prototype.constructor=t.ArrayList,t.Signal=function(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){t.Signal.prototype.dispatch.apply(e,arguments)}},t.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(e,n,r,i){var s,o=this._indexOfListener(e,r);if(-1!==o){if(s=this._bindings[o],s.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else s=new t.SignalBinding(this,e,n,r,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do t--;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if(n=this._bindings[r],n._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return this.validateListener(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){this.validateListener(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(e){"undefined"==typeof e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var e,t=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=t),n){e=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(e[n]&&this._shouldPropagate&&e[n].execute(t)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},t.Signal.prototype.constructor=t.Signal,t.SignalBinding=function(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0},t.SignalBinding.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},t.SignalBinding.prototype.constructor=t.SignalBinding,t.Filter=function(e,n,r){this.game=e,this.type=t.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}},this.fragmentSrc=r||[]},t.Filter.prototype={init:function(){},setResolution:function(e,t){this.uniforms.resolution.value.x=e,this.uniforms.resolution.value.y=t},update:function(e){"undefined"!=typeof e&&(e.x>0&&(this.uniforms.mouse.x=e.x.toFixed(2)),e.y>0&&(this.uniforms.mouse.y=e.y.toFixed(2))),this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}},t.Filter.prototype.constructor=t.Filter,Object.defineProperty(t.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(e){this.uniforms.resolution.value.x=e}}),Object.defineProperty(t.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(e){this.uniforms.resolution.value.y=e}}),t.Plugin=function(e,t){"undefined"==typeof t&&(t=null),this.game=e,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},t.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},t.Plugin.prototype.constructor=t.Plugin,t.PluginManager=function(e){this.game=e,this.plugins=[],this._len=0,this._i=0},t.PluginManager.prototype={add:function(e){var t=Array.prototype.splice.call(arguments,1),n=!1;return"function"==typeof e?e=new e(this.game,this):(e.game=this.game,e.parent=this),"function"==typeof e.preUpdate&&(e.hasPreUpdate=!0,n=!0),"function"==typeof e.update&&(e.hasUpdate=!0,n=!0),"function"==typeof e.postUpdate&&(e.hasPostUpdate=!0,n=!0),"function"==typeof e.render&&(e.hasRender=!0,n=!0),"function"==typeof e.postRender&&(e.hasPostRender=!0,n=!0),n?((e.hasPreUpdate||e.hasUpdate||e.hasPostUpdate)&&(e.active=!0),(e.hasRender||e.hasPostRender)&&(e.visible=!0),this._len=this.plugins.push(e),"function"==typeof e.init&&e.init.apply(e,t),e):null},remove:function(e){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===e)return e.destroy(),this.plugins.splice(this._i,1),void (this._len--)},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},t.PluginManager.prototype.constructor=t.PluginManager,t.Stage=function(e,n,r){this.game=e,this.offset=new t.Point,this.bounds=new t.Rectangle(0,0,n,r),PIXI.Stage.call(this,0),this.name="_stage_root",this.interactive=!1,this.disableVisibilityChange=!1,this.checkOffsetInterval=2500,this.exists=!0,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._nextOffsetCheck=0,this._backgroundColor=0,e.config&&this.parseConfig(e.config)},t.Stage.prototype=Object.create(PIXI.Stage.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var e=this.children.length,t=0;e>t;t++)this.children[t].preUpdate()},t.Stage.prototype.update=function(){for(var e=this.children.length;e--;)this.children[e].update()},t.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate(),this.game.world.camera.update();for(var e=this.children.length;e--;)this.children[e]!==this.game.world.camera.target&&this.children[e].postUpdate()}else{this.game.world.camera.update();for(var e=this.children.length;e--;)this.children[e].postUpdate()}this.checkOffsetInterval!==!1&&this.game.time.now>this._nextOffsetCheck&&(t.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.x=this.offset.x,this.bounds.y=this.offset.y,this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval)},t.Stage.prototype.parseConfig=function(e){e.checkOffsetInterval&&(this.checkOffsetInterval=e.checkOffsetInterval),e.disableVisibilityChange&&(this.disableVisibilityChange=e.disableVisibilityChange),e.fullScreenScaleMode&&(this.fullScreenScaleMode=e.fullScreenScaleMode),e.scaleMode&&(this.scaleMode=e.scaleMode),e.backgroundColor&&(this.backgroundColor=e.backgroundColor)},t.Stage.prototype.boot=function(){t.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.game.width,this.game.height);var e=this;this._onChange=function(t){return e.visibilityChange(t)},t.Canvas.setUserSelect(this.game.canvas,"none"),t.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},t.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null,this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.onblur=this._onChange,window.onfocus=this._onChange},t.Stage.prototype.visibilityChange=function(e){return"pagehide"===e.type||"blur"===e.type||"pageshow"===e.type||"focus"===e.type?void ("pagehide"===e.type||"blur"===e.type?this.game.focusLoss(e):("pageshow"===e.type||"focus"===e.type)&&this.game.focusGain(e)):void (this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden?this.game.gamePaused(e):this.game.gameResumed(e)))},t.Stage.prototype.setBackgroundColor=function(e){if("string"==typeof e){var n=t.Color.hexToColor(e);this._backgroundColor=t.Color.getColor(n.r,n.g,n.b)}else{var n=t.Color.getRGB(e);this._backgroundColor=e}this.backgroundColorSplit=[n.r/255,n.g/255,n.b/255],this.backgroundColorString=t.Color.RGBtoString(n.r,n.g,n.b,255,"#")},Object.defineProperty(t.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this.game.transparent||this.setBackgroundColor(e)}}),Object.defineProperty(t.Stage.prototype,"smoothed",{get:function(){return!PIXI.scaleModes.LINEAR},set:function(e){PIXI.scaleModes.LINEAR=e?0:1}}),t.Group=function(e,n,r,i,s,o){"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=!1),"undefined"==typeof o&&(o=t.Physics.ARCADE),this.game=e,"undefined"==typeof n&&(n=e.world),this.name=r||"group",PIXI.DisplayObjectContainer.call(this),i?this.game.stage.addChild(this):n&&n.addChild(this),this.z=0,this.type=t.GROUP,this.alive=!0,this.exists=!0,this.classType=t.Sprite,this.scale=new t.Point(1,1),this.cursor=null,this.cameraOffset=new t.Point,this.enableBody=s,this.enableBodyDebug=!1,this.physicsBodyType=o,this._sortProperty="z",this._cache=[0,0,0,0,1,0,1,0,0,0]},t.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),t.Group.prototype.constructor=t.Group,t.Group.RETURN_NONE=0,t.Group.RETURN_TOTAL=1,t.Group.RETURN_CHILD=2,t.Group.SORT_ASCENDING=-1,t.Group.SORT_DESCENDING=1,t.Group.prototype.add=function(e,t){return"undefined"==typeof t&&(t=!1),e.parent!==this&&(this.enableBody&&this.game.physics.enable(e,this.physicsBodyType),this.addChild(e),e.z=this.children.length,!t&&e.events&&e.events.onAddedToGroup.dispatch(e,this),null===this.cursor&&(this.cursor=e)),e},t.Group.prototype.addAt=function(e,t,n){return"undefined"==typeof n&&(n=!1),e.parent!==this&&(this.enableBody&&this.game.physics.enable(e,this.physicsBodyType),this.addChildAt(e,t),this.updateZ(),!n&&e.events&&e.events.onAddedToGroup.dispatch(e,this),null===this.cursor&&(this.cursor=e)),e},t.Group.prototype.getAt=function(e){return 0>e||e>=this.children.length?-1:this.getChildAt(e)},t.Group.prototype.create=function(e,t,n,r,i){"undefined"==typeof i&&(i=!0);var s=new this.classType(this.game,e,t,n,r);return this.enableBody&&this.game.physics.enable(s,this.physicsBodyType,this.enableBodyDebug),s.exists=i,s.visible=i,s.alive=i,this.addChild(s),s.z=this.children.length,s.events&&s.events.onAddedToGroup.dispatch(s,this),null===this.cursor&&(this.cursor=s),s},t.Group.prototype.createMultiple=function(e,t,n,r){"undefined"==typeof r&&(r=!1);for(var i=0;e>i;i++)this.create(0,0,t,n,r)},t.Group.prototype.updateZ=function(){for(var e=this.children.length;e--;)this.children[e].z=e},t.Group.prototype.resetCursor=function(e){return"undefined"==typeof e&&(e=0),e>this.children.length-1&&(e=0),this.cursor?(this._cache[8]=e,this.cursor=this.children[this._cache[8]],this.cursor):void 0},t.Group.prototype.next=function(){return this.cursor?(this._cache[8]>=this.children.length-1?this._cache[8]=0:this._cache[8]++,this.cursor=this.children[this._cache[8]],this.cursor):void 0},t.Group.prototype.previous=function(){return this.cursor?(0===this._cache[8]?this._cache[8]=this.children.length-1:this._cache[8]--,this.cursor=this.children[this._cache[8]],this.cursor):void 0},t.Group.prototype.swap=function(e,t){var n=this.swapChildren(e,t);return n&&this.updateZ(),n},t.Group.prototype.bringToTop=function(e){return e.parent===this&&this.getIndex(e)<this.children.length&&(this.remove(e,!1,!0),this.add(e,!0)),e},t.Group.prototype.sendToBack=function(e){return e.parent===this&&this.getIndex(e)>0&&(this.remove(e,!1,!0),this.addAt(e,0,!0)),e},t.Group.prototype.moveUp=function(e){if(e.parent===this&&this.getIndex(e)<this.children.length-1){var t=this.getIndex(e),n=this.getAt(t+1);n&&this.swap(e,n)}return e},t.Group.prototype.moveDown=function(e){if(e.parent===this&&this.getIndex(e)>0){var t=this.getIndex(e),n=this.getAt(t-1);n&&this.swap(e,n)}return e},t.Group.prototype.xy=function(e,t,n){return 0>e||e>this.children.length?-1:(this.getChildAt(e).x=t,void (this.getChildAt(e).y=n))},t.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},t.Group.prototype.getIndex=function(e){return this.children.indexOf(e)},t.Group.prototype.replace=function(e,n){var r=this.getIndex(e);if(-1!==r){void 0!==n.parent&&(n.events.onRemovedFromGroup.dispatch(n,this),n.parent.removeChild(n),n.parent instanceof t.Group&&n.parent.updateZ());var i=e;return this.remove(i),this.addAt(n,r),i}},t.Group.prototype.hasProperty=function(e,t){var n=t.length;return 1===n&&t[0]in e?!0:2===n&&t[0]in e&&t[1]in e[t[0]]?!0:3===n&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]?!0:4===n&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]&&t[3]in e[t[0]][t[1]][t[2]]?!0:!1},t.Group.prototype.setProperty=function(e,t,n,r,i){if("undefined"==typeof i&&(i=!1),r=r||0,!this.hasProperty(e,t)&&(!i||r>0))return!1;var s=t.length;return 1===s?0===r?e[t[0]]=n:1==r?e[t[0]]+=n:2==r?e[t[0]]-=n:3==r?e[t[0]]*=n:4==r&&(e[t[0]]/=n):2===s?0===r?e[t[0]][t[1]]=n:1==r?e[t[0]][t[1]]+=n:2==r?e[t[0]][t[1]]-=n:3==r?e[t[0]][t[1]]*=n:4==r&&(e[t[0]][t[1]]/=n):3===s?0===r?e[t[0]][t[1]][t[2]]=n:1==r?e[t[0]][t[1]][t[2]]+=n:2==r?e[t[0]][t[1]][t[2]]-=n:3==r?e[t[0]][t[1]][t[2]]*=n:4==r&&(e[t[0]][t[1]][t[2]]/=n):4===s&&(0===r?e[t[0]][t[1]][t[2]][t[3]]=n:1==r?e[t[0]][t[1]][t[2]][t[3]]+=n:2==r?e[t[0]][t[1]][t[2]][t[3]]-=n:3==r?e[t[0]][t[1]][t[2]][t[3]]*=n:4==r&&(e[t[0]][t[1]][t[2]][t[3]]/=n)),!0},t.Group.prototype.checkProperty=function(e,n,r,i){return"undefined"==typeof i&&(i=!1),!t.Utils.getProperty(e,n)&&i?!1:t.Utils.getProperty(e,n)!==r?!1:!0},t.Group.prototype.set=function(e,t,n,r,i,s,o){return"undefined"==typeof o&&(o=!1),t=t.split("."),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1),(r===!1||r&&e.alive)&&(i===!1||i&&e.visible)?this.setProperty(e,t,n,s,o):void 0},t.Group.prototype.setAll=function(e,t,n,r,i,s){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof s&&(s=!1),e=e.split("."),i=i||0;for(var o=0,u=this.children.length;u>o;o++)(!n||n&&this.children[o].alive)&&(!r||r&&this.children[o].visible)&&this.setProperty(this.children[o],e,t,i,s)},t.Group.prototype.setAllChildren=function(e,n,r,i,s,o){"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof o&&(o=!1),s=s||0;for(var u=0,a=this.children.length;a>u;u++)(!r||r&&this.children[u].alive)&&(!i||i&&this.children[u].visible)&&(this.children[u]instanceof t.Group?this.children[u].setAllChildren(e,n,r,i,s,o):this.setProperty(this.children[u],e.split("."),n,s,o))},t.Group.prototype.checkAll=function(e,t,n,r,i){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1);for(var s=0,o=this.children.length;o>s;s++)if((!n||n&&this.children[s].alive)&&(!r||r&&this.children[s].visible)&&!this.checkProperty(this.children[s],e,t,i))return!1;return!0},t.Group.prototype.addAll=function(e,t,n,r){this.setAll(e,t,n,r,1)},t.Group.prototype.subAll=function(e,t,n,r){this.setAll(e,t,n,r,2)},t.Group.prototype.multiplyAll=function(e,t,n,r){this.setAll(e,t,n,r,3)},t.Group.prototype.divideAll=function(e,t,n,r){this.setAll(e,t,n,r,4)},t.Group.prototype.callAllExists=function(e,t){for(var n=Array.prototype.splice.call(arguments,2),r=0,i=this.children.length;i>r;r++)this.children[r].exists===t&&this.children[r][e]&&this.children[r][e].apply(this.children[r],n)},t.Group.prototype.callbackFromArray=function(e,t,n){if(1==n){if(e[t[0]])return e[t[0]]}else if(2==n){if(e[t[0]][t[1]])return e[t[0]][t[1]]}else if(3==n){if(e[t[0]][t[1]][t[2]])return e[t[0]][t[1]][t[2]]}else if(4==n){if(e[t[0]][t[1]][t[2]][t[3]])return e[t[0]][t[1]][t[2]][t[3]]}else if(e[t])return e[t];return!1},t.Group.prototype.callAll=function(e,t){if("undefined"!=typeof e){e=e.split(".");var n=e.length;if("undefined"==typeof t||null===t||""===t)t=null;else if("string"==typeof t){t=t.split(".");var r=t.length}for(var i=Array.prototype.splice.call(arguments,2),s=null,o=null,u=0,a=this.children.length;a>u;u++)s=this.callbackFromArray(this.children[u],e,n),t&&s?(o=this.callbackFromArray(this.children[u],t,r),s&&s.apply(o,i)):s&&s.apply(this.children[u],i)}},t.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var e=this.children.length;e--;)this.children[e].preUpdate();return!0},t.Group.prototype.update=function(){for(var e=this.children.length;e--;)this.children[e].update()},t.Group.prototype.postUpdate=function(){1===this._cache[7]&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var e=this.children.length;e--;)this.children[e].postUpdate()},t.Group.prototype.forEach=function(e,t,n){"undefined"==typeof n&&(n=!1);var r=Array.prototype.splice.call(arguments,3);r.unshift(null);for(var i=0,s=this.children.length;s>i;i++)(!n||n&&this.children[i].exists)&&(r[0]=this.children[i],e.apply(t,r))},t.Group.prototype.forEachExists=function(e,n){var r=Array.prototype.splice.call(arguments,2);r.unshift(null),this.iterate("exists",!0,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.forEachAlive=function(e,n){var r=Array.prototype.splice.call(arguments,2);r.unshift(null),this.iterate("alive",!0,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.forEachDead=function(e,n){var r=Array.prototype.splice.call(arguments,2);r.unshift(null),this.iterate("alive",!1,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.sort=function(e,n){this.children.length<2||("undefined"==typeof e&&(e="z"),"undefined"==typeof n&&(n=t.Group.SORT_ASCENDING),this._sortProperty=e,this.children.sort(n===t.Group.SORT_ASCENDING?this.ascendingSortHandler.bind(this):this.descendingSortHandler.bind(this)),this.updateZ())},t.Group.prototype.customSort=function(e,t){this.children.length<2||(this.children.sort(e.bind(t)),this.updateZ())},t.Group.prototype.ascendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?-1:e[this._sortProperty]>t[this._sortProperty]?1:e.z<t.z?-1:1},t.Group.prototype.descendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?1:e[this._sortProperty]>t[this._sortProperty]?-1:0},t.Group.prototype.iterate=function(e,n,r,i,s,o){if(r===t.Group.RETURN_TOTAL&&0===this.children.length)return 0;"undefined"==typeof i&&(i=!1);for(var u=0,a=0,f=this.children.length;f>a;a++)if(this.children[a][e]===n&&(u++,i&&(o[0]=this.children[a],i.apply(s,o)),r===t.Group.RETURN_CHILD))return this.children[a];return r===t.Group.RETURN_TOTAL?u:r===t.Group.RETURN_CHILD?null:void 0},t.Group.prototype.getFirstExists=function(e){return"boolean"!=typeof e&&(e=!0),this.iterate("exists",e,t.Group.RETURN_CHILD)},t.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,t.Group.RETURN_CHILD)},t.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,t.Group.RETURN_CHILD)},t.Group.prototype.getTop=function(){return this.children.length>0?this.children[this.children.length-1]:void 0},t.Group.prototype.getBottom=function(){return this.children.length>0?this.children[0]:void 0},t.Group.prototype.countLiving=function(){return this.iterate("alive",!0,t.Group.RETURN_TOTAL)},t.Group.prototype.countDead=function(){return this.iterate("alive",!1,t.Group.RETURN_TOTAL)},t.Group.prototype.getRandom=function(e,t){return 0===this.children.length?null:(e=e||0,t=t||this.children.length,this.game.math.getRandom(this.children,e,t))},t.Group.prototype.remove=function(e,t,n){if("undefined"==typeof t&&(t=!1),"undefined"==typeof n&&(n=!1),0===this.children.length||-1===this.children.indexOf(e))return!1;n||!e.events||e.destroyPhase||e.events.onRemovedFromGroup.dispatch(e,this);var r=this.removeChild(e);return this.updateZ(),this.cursor===e&&this.next(),t&&r&&r.destroy(!0),!0},t.Group.prototype.removeAll=function(e,t){if("undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1),0!==this.children.length){do{!t&&this.children[0].events&&this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this);var n=this.removeChild(this.children[0]);e&&n&&n.destroy(!0)}while(this.children.length>0);this.cursor=null}},t.Group.prototype.removeBetween=function(e,t,n,r){if("undefined"==typeof t&&(t=this.children.length),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),0!==this.children.length){if(e>t||0>e||t>this.children.length)return!1;for(var i=t;i>=e;){!r&&this.children[i].events&&this.children[i].events.onRemovedFromGroup.dispatch(this.children[i],this);var s=this.removeChild(this.children[i]);n&&s&&s.destroy(!0),this.cursor===this.children[i]&&(this.cursor=null),i--}this.updateZ()}},t.Group.prototype.destroy=function(e,t){null!==this.game&&("undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!1),this.removeAll(e),this.cursor=null,this.filters=null,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(t.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,t.Group.RETURN_TOTAL)}}),Object.defineProperty(t.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(t.Group.prototype,"angle",{get:function(){return t.Math.radToDeg(this.rotation)},set:function(e){this.rotation=t.Math.degToRad(e)}}),Object.defineProperty(t.Group.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),t.World=function(e){t.Group.call(this,e,null,"__world",!1),this.bounds=new t.Rectangle(0,0,e.width,e.height),this.camera=null},t.World.prototype=Object.create(t.Group.prototype),t.World.prototype.constructor=t.World,t.World.prototype.boot=function(){this.camera=new t.Camera(this.game,0,0,0,this.game.width,this.game.height),this.camera.displayObject=this,this.camera.scale=this.scale,this.game.camera=this.camera,this.game.stage.addChild(this)},t.World.prototype.setBounds=function(e,t,n,r){n<this.game.width&&(n=this.game.width),r<this.game.height&&(r=this.game.height),this.bounds.setTo(e,t,n,r),this.camera.bounds&&this.camera.bounds.setTo(e,t,n,r),this.game.physics.setBoundsToWorld()},t.World.prototype.shutdown=function(){this.destroy(!0,!0)},t.World.prototype.wrap=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=!0),n?(e.getBounds(),r&&(e.x+e._currentBounds.width<this.bounds.x?e.x=this.bounds.right:e.x>this.bounds.right&&(e.x=this.bounds.left)),i&&(e.y+e._currentBounds.height<this.bounds.top?e.y=this.bounds.bottom:e.y>this.bounds.bottom&&(e.y=this.bounds.top))):(r&&e.x+t<this.bounds.x?e.x=this.bounds.right+t:r&&e.x-t>this.bounds.right&&(e.x=this.bounds.left-t),i&&e.y+t<this.bounds.top?e.y=this.bounds.bottom+t:i&&e.y-t>this.bounds.bottom&&(e.y=this.bounds.top-t))},Object.defineProperty(t.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){this.bounds.width=e}}),Object.defineProperty(t.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){this.bounds.height=e}}),Object.defineProperty(t.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(t.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(t.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}),Object.defineProperty(t.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}),t.ScaleManager=function(e,n,r){this.game=e,this.width=n,this.height=r,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this.pageAlignHorizontally=!1,this.pageAlignVertically=!1,this.maxIterations=5,this.orientationSprite=null,this.enterLandscape=new t.Signal,this.enterPortrait=new t.Signal,this.enterIncorrectOrientation=new t.Signal,this.leaveIncorrectOrientation=new t.Signal,this.hasResized=new t.Signal,this.fullScreenTarget=this.game.canvas,this.enterFullScreen=new t.Signal,this.leaveFullScreen=new t.Signal,this.orientation=0,window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight&&(this.orientation=90),this.scaleFactor=new t.Point(1,1),this.scaleFactorInversed=new t.Point(1,1),this.margin=new t.Point(0,0),this.bounds=new t.Rectangle(0,0,n,r),this.aspectRatio=0,this.sourceAspectRatio=n/r,this.event=null,this.scaleMode=t.ScaleManager.NO_SCALE,this.fullScreenScaleMode=t.ScaleManager.NO_SCALE,this._startHeight=0,this._width=0,this._height=0,this._check=null;var i=this;window.addEventListener("orientationchange",function(e){return i.checkOrientation(e)},!1),window.addEventListener("resize",function(e){return i.checkResize(e)},!1),this.game.device.cocoonJS||(document.addEventListener("webkitfullscreenchange",function(e){return i.fullScreenChange(e)},!1),document.addEventListener("mozfullscreenchange",function(e){return i.fullScreenChange(e)},!1),document.addEventListener("fullscreenchange",function(e){return i.fullScreenChange(e)},!1))},t.ScaleManager.EXACT_FIT=0,t.ScaleManager.NO_SCALE=1,t.ScaleManager.SHOW_ALL=2,t.ScaleManager.prototype={startFullScreen:function(e){!this.isFullScreen&&this.game.device.fullscreen&&("undefined"!=typeof e&&this.game.renderType===t.CANVAS&&(this.game.stage.smoothed=e),this._width=this.width,this._height=this.height,this.game.device.fullscreenKeyboard?this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):this.fullScreenTarget[this.game.device.requestFullscreen]())},stopFullScreen:function(){document[this.game.device.cancelFullscreen]()},fullScreenChange:function(e){this.event=e,this.isFullScreen?(this.fullScreenScaleMode===t.ScaleManager.EXACT_FIT?(this.fullScreenTarget.style.width="100%",this.fullScreenTarget.style.height="100%",this.width=window.outerWidth,this.height=window.outerHeight,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.checkResize()):this.fullScreenScaleMode===t.ScaleManager.SHOW_ALL&&(this.setShowAll(),this.refresh()),this.enterFullScreen.dispatch(this.width,this.height)):(this.fullScreenTarget.style.width=this.game.width+"px",this.fullScreenTarget.style.height=this.game.height+"px",this.width=this._width,this.height=this._height,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.leaveFullScreen.dispatch(this.width,this.height))},forceOrientation:function(e,n,r){"undefined"==typeof n&&(n=!1),this.forceLandscape=e,this.forcePortrait=n,"undefined"!=typeof r&&((null===r||this.game.cache.checkImageKey(r)===!1)&&(r="__default"),this.orientationSprite=new t.Image(this.game,this.game.width/2,this.game.height/2,r),this.orientationSprite.anchor.set(.5),this.checkOrientationState(),this.incorrectOrientation?(this.orientationSprite.visible=!0,this.game.world.visible=!1):(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.game.stage.addChild(this.orientationSprite))},checkOrientationState:function(){this.incorrectOrientation?(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)&&(this.incorrectOrientation=!1,this.leaveIncorrectOrientation.dispatch(),this.orientationSprite&&(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.scaleMode!==t.ScaleManager.NO_SCALE&&this.refresh()):(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)&&(this.incorrectOrientation=!0,this.enterIncorrectOrientation.dispatch(),this.orientationSprite&&this.orientationSprite.visible===!1&&(this.orientationSprite.visible=!0,this.game.world.visible=!1),this.scaleMode!==t.ScaleManager.NO_SCALE&&this.refresh())},checkOrientation:function(e){this.event=e,this.orientation=window.orientation,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.scaleMode!==t.ScaleManager.NO_SCALE&&this.refresh()},checkResize:function(e){this.event=e,this.orientation=window.outerWidth>window.outerHeight?90:0,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.scaleMode!==t.ScaleManager.NO_SCALE&&this.refresh(),this.checkOrientationState()},refresh:function(){if(this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),null===this._check&&this.maxIterations>0){this._iterations=this.maxIterations;var e=this;this._check=window.setInterval(function(){return e.setScreenSize()},10),this.setScreenSize()}},setScreenSize:function(e){"undefined"==typeof e&&(e=!1),this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),this._iterations--,(e||window.innerHeight>this._startHeight||this._iterations<0)&&(document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation?this.setMaximum():this.isFullScreen?this.fullScreenScaleMode===t.ScaleManager.EXACT_FIT?this.setExactFit():this.fullScreenScaleMode===t.ScaleManager.SHOW_ALL&&this.setShowAll():this.scaleMode===t.ScaleManager.EXACT_FIT?this.setExactFit():this.scaleMode===t.ScaleManager.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null)},setSize:function(){this.incorrectOrientation||(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight)),this.game.canvas.style.width=this.width+"px",this.game.canvas.style.height=this.height+"px",this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.pageAlignHorizontally&&(this.width<window.innerWidth&&!this.incorrectOrientation?(this.margin.x=Math.round((window.innerWidth-this.width)/2),this.game.canvas.style.marginLeft=this.margin.x+"px"):(this.margin.x=0,this.game.canvas.style.marginLeft="0px")),this.pageAlignVertically&&(this.height<window.innerHeight&&!this.incorrectOrientation?(this.margin.y=Math.round((window.innerHeight-this.height)/2),this.game.canvas.style.marginTop=this.margin.y+"px"):(this.margin.y=0,this.game.canvas.style.marginTop="0px")),t.Canvas.getOffset(this.game.canvas,this.game.stage.offset),this.bounds.setTo(this.game.stage.offset.x,this.game.stage.offset.y,this.width,this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.hasResized.dispatch(this.width,this.height),this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth,this.height=window.innerHeight},setShowAll:function(){var e=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*e),this.height=Math.round(this.game.height*e)},setExactFit:function(){var e=window.innerWidth,t=window.innerHeight;this.width=this.maxWidth&&e>this.maxWidth?this.maxWidth:e,this.height=this.maxHeight&&t>this.maxHeight?this.maxHeight:t}},t.ScaleManager.prototype.constructor=t.ScaleManager,Object.defineProperty(t.ScaleManager.prototype,"isFullScreen",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(t.ScaleManager.prototype,"isPortrait",{get:function(){return 0===this.orientation||180===this.orientation}}),Object.defineProperty(t.ScaleManager.prototype,"isLandscape",{get:function(){return 90===this.orientation||-90===this.orientation}}),t.Game=function(e,n,r,i,s,o,u,a){this.id=t.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=t.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.rnd=null,this.device=null,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof e&&(this.width=e),"undefined"!=typeof n&&(this.height=n),"undefined"!=typeof r&&(this.renderer=r,this.renderType=r),"undefined"!=typeof i&&(this.parent=i),"undefined"!=typeof o&&(this.transparent=o),"undefined"!=typeof u&&(this.antialias=u),this.rnd=new t.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new t.StateManager(this,s));var f=this;return this._onBoot=function(){return f.boot()},"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(this._onBoot,0):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this},t.Game.prototype={parseConfig:function(e){this.config=e,e.width&&(this.width=t.Utils.parseDimension(e.width,0)),e.height&&(this.height=t.Utils.parseDimension(e.height,1)),e.renderer&&(this.renderer=e.renderer,this.renderType=e.renderer),e.parent&&(this.parent=e.parent),e.transparent&&(this.transparent=e.transparent),e.antialias&&(this.antialias=e.antialias),e.preserveDrawingBuffer&&(this.preserveDrawingBuffer=e.preserveDrawingBuffer),e.physicsConfig&&(this.physicsConfig=e.physicsConfig);var n=[(Date.now()*Math.random()).toString()];e.seed&&(n=e.seed),this.rnd=new t.RandomDataGenerator(n);var r=null;e.state&&(r=e.state),this.state=new t.StateManager(this,r)},boot:function(){this.isBooted||(document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new t.Signal,this.onResume=new t.Signal,this.onBlur=new t.Signal,this.onFocus=new t.Signal,this.isBooted=!0,this.device=new t.Device(this),this.math=t.Math,this.stage=new t.Stage(this,this.width,this.height),this.setUpRenderer(),this.scale=new t.ScaleManager(this,this.width,this.height),this.device.checkFullScreenSupport(),this.world=new t.World(this),this.add=new t.GameObjectFactory(this),this.make=new t.GameObjectCreator(this),this.cache=new t.Cache(this),this.load=new t.Loader(this),this.time=new t.Time(this),this.tweens=new t.TweenManager(this),this.input=new t.Input(this),this.sound=new t.SoundManager(this),this.physics=new t.Physics(this,this.physicsConfig),this.particles=new t.Particles(this),this.plugins=new t.PluginManager(this),this.net=new t.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug&&(this.debug=new t.Utils.Debug(this),this.debug.boot()),this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new t.RequestAnimationFrame(this,this.config.forceSetTimeOut):new t.RequestAnimationFrame(this,!1),this.raf.start()):window.setTimeout(this._onBoot,20))},showDebugHeader:function(){var e=t.VERSION,n="Canvas",r="HTML Audio",i=1;if(this.renderType===t.WEBGL?(n="WebGL",i++):this.renderType==t.HEADLESS&&(n="Headless"),this.device.webAudio&&(r="WebAudio",i++),this.device.chrome){for(var s=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+n+" | "+r+"  %c %c  http://phaser.io  %c %c ♥%c♥%c♥ ","background: #0cf300","background: #00bc17","color: #ffffff; background: #00711f;","background: #00bc17","background: #0cf300","background: #00bc17"],o=0;3>o;o++)s.push(i>o?"color: #ff2424; background: #fff":"color: #959595; background: #fff");console.log.apply(console,s)}else window.console&&console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+n+" | "+r+" | http://phaser.io")},setUpRenderer:function(){if(this.device.trident&&(this.renderType=t.CANVAS),this.canvas=this.config.canvasID?t.Canvas.create(this.width,this.height,this.config.canvasID):t.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=!0),this.renderType===t.HEADLESS||this.renderType===t.CANVAS||this.renderType===t.AUTO&&this.device.webGL===!1){if(!this.device.canvas)throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===t.AUTO&&(this.renderType=t.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.canvas,this.transparent),this.context=this.renderer.context}else this.renderType=t.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias,this.preserveDrawingBuffer),this.context=null;this.renderType!==t.HEADLESS&&(this.stage.smoothed=this.antialias,t.Canvas.addToDOM(this.canvas,this.parent,!1),t.Canvas.setTouchAction(this.canvas))},update:function(e){this.time.update(e),this._paused||this.pendingStep?(this.state.pauseUpdate(),this.config.enableDebug&&this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.config.enableDebug&&this.debug.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(),this.plugins.preUpdate(),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.renderType!=t.HEADLESS&&(this.state.preRender(),this.renderer.render(this.stage),this.plugins.render(),this.state.render(),this.plugins.postRender(),this.device.cocoonJS&&this.renderType===t.CANVAS&&1===this.stage.currentRenderOrderID&&this.context.fillRect(0,0,0,0))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.input.destroy(),this.state.destroy(),this.physics.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1},gamePaused:function(e){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(e))},gameResumed:function(e){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(e))},focusLoss:function(e){this.onBlur.dispatch(e),this.stage.disableVisibilityChange||this.gamePaused(e)},focusGain:function(e){this.onFocus.dispatch(e),this.stage.disableVisibilityChange||this.gameResumed(e)}},t.Game.prototype.constructor=t.Game,Object.defineProperty(t.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){e===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),t.Input=function(e){this.game=e,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.moveCallback=null,this.moveCallbackContext=this,this.pollRate=0,this.disabled=!1,this.multiInputOverride=t.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=10,this.currentPointers=0,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new t.ArrayList,this._localPoint=new t.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},t.Input.MOUSE_OVERRIDES_TOUCH=0,t.Input.TOUCH_OVERRIDES_MOUSE=1,t.Input.MOUSE_TOUCH_COMBINE=2,t.Input.prototype={boot:function(){this.mousePointer=new t.Pointer(this.game,0),this.pointer1=new t.Pointer(this.game,1),this.pointer2=new t.Pointer(this.game,2),this.mouse=new t.Mouse(this.game),this.keyboard=new t.Keyboard(this.game),this.touch=new t.Touch(this.game),this.mspointer=new t.MSPointer(this.game),this.gamepad=new t.Gamepad(this.game),this.onDown=new t.Signal,this.onUp=new t.Signal,this.onTap=new t.Signal,this.onHold=new t.Signal,this.scale=new t.Point(1,1),this.speed=new t.Point,this.position=new t.Point,this._oldPosition=new t.Point,this.circle=new t.Circle(0,0,44),this.activePointer=this.mousePointer,this.currentPointers=0,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.keyboard.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0},destroy:function(){this.mouse.stop(),this.keyboard.stop(),this.touch.stop(),this.mspointer.stop(),this.gamepad.stop(),this.moveCallbacks=[],this.moveCallback=null},setMoveCallback:function(e,t){this.moveCallback=e,this.moveCallbackContext=t},addMoveCallback:function(e,t){return this.moveCallbacks.push({callback:e,context:t})-1},deleteMoveCallback:function(e){this.moveCallbacks[e]&&this.moveCallbacks.splice(e,1)},addPointer:function(){for(var e=0,n=10;n>0;n--)null===this["pointer"+n]&&(e=n);return 0===e?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+e]=new t.Pointer(this.game,e),this["pointer"+e])},update:function(){return this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate?void (this._pollCounter++):(this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad.active&&this.gamepad.update(),this.pointer1.update(),this.pointer2.update(),this.pointer3&&this.pointer3.update(),this.pointer4&&this.pointer4.update(),this.pointer5&&this.pointer5.update(),this.pointer6&&this.pointer6.update(),this.pointer7&&this.pointer7.update(),this.pointer8&&this.pointer8.update(),this.pointer9&&this.pointer9.update(),this.pointer10&&this.pointer10.update(),void (this._pollCounter=0))},reset:function(e){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof e&&(e=!1),this.keyboard.reset(e),this.mousePointer.reset(),this.gamepad.reset();for(var n=1;10>=n;n++)this["pointer"+n]&&this["pointer"+n].reset();this.currentPointers=0,"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),e&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new t.Signal,this.onUp=new t.Signal,this.onTap=new t.Signal,this.onHold=new t.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(e,t){this._oldPosition.setTo(e,t),this.speed.setTo(0,0)},startPointer:function(e){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active===!1)return this.pointer1.start(e);if(this.pointer2.active===!1)return this.pointer2.start(e);for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].active===!1)return this["pointer"+t].start(e);return null},updatePointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier)return this.pointer1.move(e);if(this.pointer2.active&&this.pointer2.identifier==e.identifier)return this.pointer2.move(e);for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==e.identifier)return this["pointer"+t].move(e);return null},stopPointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier)return this.pointer1.stop(e);if(this.pointer2.active&&this.pointer2.identifier==e.identifier)return this.pointer2.stop(e);for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==e.identifier)return this["pointer"+t].stop(e);return null},getPointer:function(e){if(e=e||!1,this.pointer1.active==e)return this.pointer1;if(this.pointer2.active==e)return this.pointer2;for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].active==e)return this["pointer"+t];return null},getPointerFromIdentifier:function(e){if(this.pointer1.identifier===e)return this.pointer1;if(this.pointer2.identifier===e)return this.pointer2;for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].identifier===e)return this["pointer"+t];return null},getPointerFromId:function(e){if(this.pointer1.pointerId===e)return this.pointer1;if(this.pointer2.pointerId===e)return this.pointer2;for(var t=3;10>=t;t++)if(this["pointer"+t]&&this["pointer"+t].pointerId===e)return this["pointer"+t];return null},getLocalPosition:function(e,n,r){"undefined"==typeof r&&(r=new t.Point);var i=e.worldTransform,s=1/(i.a*i.d+i.b*-i.c);return r.setTo(i.d*s*n.x+ -i.b*s*n.y+(i.ty*i.b-i.tx*i.d)*s,i.a*s*n.y+ -i.c*s*n.x+(-i.ty*i.a+i.tx*i.c)*s)},hitTest:function(e,n,r){if(!e.worldVisible)return!1;if(this.getLocalPosition(e,n,this._localPoint),r.copyFrom(this._localPoint),e.hitArea&&e.hitArea.contains)return e.hitArea.contains(this._localPoint.x,this._localPoint.y)?!0:!1;if(e instanceof t.TileSprite){var i=e.width,s=e.height,o=-i*e.anchor.x;if(this._localPoint.x>o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>u&&this._localPoint.y<u+s)return!0}}else if(e instanceof PIXI.Sprite){var i=e.texture.frame.width,s=e.texture.frame.height,o=-i*e.anchor.x;if(this._localPoint.x>o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>u&&this._localPoint.y<u+s)return!0}}for(var a=0,f=e.children.length;f>a;a++)if(this.hitTest(e.children[a],n,r))return!0;return!1}},t.Input.prototype.constructor=t.Input,Object.defineProperty(t.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=Math.floor(e)}}),Object.defineProperty(t.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=Math.floor(e)}}),Object.defineProperty(t.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(t.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}}),Object.defineProperty(t.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var e=1;10>=e;e++)this["pointer"+e]&&this["pointer"+e].active&&this.currentPointers++;return this.currentPointers}}),Object.defineProperty(t.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(t.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),t.Key=function(e,n){this.game=e,this.enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=n,this.onDown=new t.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new t.Signal},t.Key.prototype={update:function(){this.enabled&&this.isDown&&(this.duration=this.game.time.now-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(e){this.enabled&&(this.event=e,this.isDown||(this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.onDown.dispatch(this)))},processKeyUp:function(e){this.enabled&&(this.event=e,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=this.game.time.now-this.timeDown,this.onUp.dispatch(this)))},reset:function(e){"undefined"==typeof e&&(e=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=0,this.enabled=!0,e&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},justPressed:function(e){return"undefined"==typeof e&&(e=50),this.isDown&&this.duration<e},justReleased:function(e){return"undefined"==typeof e&&(e=50),!this.isDown&&this.game.time.now-this.timeUp<e}},t.Key.prototype.constructor=t.Key,t.Keyboard=function(e){this.game=e,this.disabled=!1,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},t.Keyboard.prototype={addCallbacks:function(e,t,n,r){this.callbackContext=e,"undefined"!=typeof t&&(this.onDownCallback=t),"undefined"!=typeof n&&(this.onUpCallback=n),"undefined"!=typeof r&&(this.onPressCallback=r)},addKey:function(e){return this._keys[e]||(this._keys[e]=new t.Key(this.game,e),this.addKeyCapture(e)),this._keys[e]},removeKey:function(e){this._keys[e]&&(this._keys[e]=null,this.removeKeyCapture(e))},createCursorKeys:function(){return{up:this.addKey(t.Keyboard.UP),down:this.addKey(t.Keyboard.DOWN),left:this.addKey(t.Keyboard.LEFT),right:this.addKey(t.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var e=this;this._onKeyDown=function(t){return e.processKeyDown(t)},this._onKeyUp=function(t){return e.processKeyUp(t)},this._onKeyPress=function(t){return e.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(e){if("object"==typeof e)for(var t in e)this._capture[e[t]]=!0;else this._capture[e]=!0},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(e){this.event=e,this.game.input.disabled||this.disabled||(this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new t.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyDown(e),this._k=e.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e))},processKeyPress:function(e){this.pressEvent=e,this.game.input.disabled||this.disabled||this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(e.charCode),e)},processKeyUp:function(e){this.event=e,this.game.input.disabled||this.disabled||(this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new t.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyUp(e),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e))},reset:function(e){"undefined"==typeof e&&(e=!0),this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(e)},justPressed:function(e,t){return"undefined"==typeof t&&(t=50),this._keys[e]?this._keys[e].justPressed(t):!1},justReleased:function(e,t){return"undefined"==typeof t&&(t=50),this._keys[e]?this._keys[e].justReleased(t):!1},isDown:function(e){return this._keys[e]?this._keys[e].isDown:!1}},Object.defineProperty(t.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(t.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),t.Keyboard.prototype.constructor=t.Keyboard,t.Keyboard.A="A".charCodeAt(0),t.Keyboard.B="B".charCodeAt(0),t.Keyboard.C="C".charCodeAt(0),t.Keyboard.D="D".charCodeAt(0),t.Keyboard.E="E".charCodeAt(0),t.Keyboard.F="F".charCodeAt(0),t.Keyboard.G="G".charCodeAt(0),t.Keyboard.H="H".charCodeAt(0),t.Keyboard.I="I".charCodeAt(0),t.Keyboard.J="J".charCodeAt(0),t.Keyboard.K="K".charCodeAt(0),t.Keyboard.L="L".charCodeAt(0),t.Keyboard.M="M".charCodeAt(0),t.Keyboard.N="N".charCodeAt(0),t.Keyboard.O="O".charCodeAt(0),t.Keyboard.P="P".charCodeAt(0),t.Keyboard.Q="Q".charCodeAt(0),t.Keyboard.R="R".charCodeAt(0),t.Keyboard.S="S".charCodeAt(0),t.Keyboard.T="T".charCodeAt(0),t.Keyboard.U="U".charCodeAt(0),t.Keyboard.V="V".charCodeAt(0),t.Keyboard.W="W".charCodeAt(0),t.Keyboard.X="X".charCodeAt(0),t.Keyboard.Y="Y".charCodeAt(0),t.Keyboard.Z="Z".charCodeAt(0),t.Keyboard.ZERO="0".charCodeAt(0),t.Keyboard.ONE="1".charCodeAt(0),t.Keyboard.TWO="2".charCodeAt(0),t.Keyboard.THREE="3".charCodeAt(0),t.Keyboard.FOUR="4".charCodeAt(0),t.Keyboard.FIVE="5".charCodeAt(0),t.Keyboard.SIX="6".charCodeAt(0),t.Keyboard.SEVEN="7".charCodeAt(0),t.Keyboard.EIGHT="8".charCodeAt(0),t.Keyboard.NINE="9".charCodeAt(0),t.Keyboard.NUMPAD_0=96,t.Keyboard.NUMPAD_1=97,t.Keyboard.NUMPAD_2=98,t.Keyboard.NUMPAD_3=99,t.Keyboard.NUMPAD_4=100,t.Keyboard.NUMPAD_5=101,t.Keyboard.NUMPAD_6=102,t.Keyboard.NUMPAD_7=103,t.Keyboard.NUMPAD_8=104,t.Keyboard.NUMPAD_9=105,t.Keyboard.NUMPAD_MULTIPLY=106,t.Keyboard.NUMPAD_ADD=107,t.Keyboard.NUMPAD_ENTER=108,t.Keyboard.NUMPAD_SUBTRACT=109,t.Keyboard.NUMPAD_DECIMAL=110,t.Keyboard.NUMPAD_DIVIDE=111,t.Keyboard.F1=112,t.Keyboard.F2=113,t.Keyboard.F3=114,t.Keyboard.F4=115,t.Keyboard.F5=116,t.Keyboard.F6=117,t.Keyboard.F7=118,t.Keyboard.F8=119,t.Keyboard.F9=120,t.Keyboard.F10=121,t.Keyboard.F11=122,t.Keyboard.F12=123,t.Keyboard.F13=124,t.Keyboard.F14=125,t.Keyboard.F15=126,t.Keyboard.COLON=186,t.Keyboard.EQUALS=187,t.Keyboard.UNDERSCORE=189,t.Keyboard.QUESTION_MARK=191,t.Keyboard.TILDE=192,t.Keyboard.OPEN_BRACKET=219,t.Keyboard.BACKWARD_SLASH=220,t.Keyboard.CLOSED_BRACKET=221,t.Keyboard.QUOTES=222,t.Keyboard.BACKSPACE=8,t.Keyboard.TAB=9,t.Keyboard.CLEAR=12,t.Keyboard.ENTER=13,t.Keyboard.SHIFT=16,t.Keyboard.CONTROL=17,t.Keyboard.ALT=18,t.Keyboard.CAPS_LOCK=20,t.Keyboard.ESC=27,t.Keyboard.SPACEBAR=32,t.Keyboard.PAGE_UP=33,t.Keyboard.PAGE_DOWN=34,t.Keyboard.END=35,t.Keyboard.HOME=36,t.Keyboard.LEFT=37,t.Keyboard.UP=38,t.Keyboard.RIGHT=39,t.Keyboard.DOWN=40,t.Keyboard.INSERT=45,t.Keyboard.DELETE=46,t.Keyboard.HELP=47,t.Keyboard.NUM_LOCK=144,t.Mouse=function(e){this.game=e,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.disabled=!1,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new t.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null},t.Mouse.NO_BUTTON=-1,t.Mouse.LEFT_BUTTON=0,t.Mouse.MIDDLE_BUTTON=1,t.Mouse.RIGHT_BUTTON=2,t.Mouse.WHEEL_UP=1,t.Mouse.WHEEL_DOWN=-1,t.Mouse.prototype={start:function(){if((!this.game.device.android||this.game.device.chrome!==!1)&&null===this._onMouseDown){var e=this;this._onMouseDown=function(t){return e.onMouseDown(t)},this._onMouseMove=function(t){return e.onMouseMove(t)},this._onMouseUp=function(t){return e.onMouseUp(t)},this._onMouseOut=function(t){return e.onMouseOut(t)},this._onMouseOver=function(t){return e.onMouseOver(t)},this._onMouseWheel=function(t){return e.onMouseWheel(t)},this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.addEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel,!0),this.game.device.cocoonJS||(this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0))}},onMouseDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=e.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||(e.identifier=0,this.game.input.mousePointer.start(e))},onMouseMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||(e.identifier=0,this.game.input.mousePointer.move(e))},onMouseUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=t.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||(e.identifier=0,this.game.input.mousePointer.stop(e))},onMouseOut:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||(this.game.input.mousePointer.withinGame=!1,this.stopOnGameOut&&(e.identifier=0,this.game.input.mousePointer.stop(e)))},onMouseWheel:function(e){this.event=e,this.capture&&e.preventDefault(),this.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,e)},onMouseOver:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||(this.game.input.mousePointer.withinGame=!0)},requestPointerLock:function(){if(this.game.device.pointerLock){var e=this.game.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock();var t=this;this._pointerLockChange=function(e){return t.pointerLockChange(e)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(e){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,e)):(this.locked=!1,this.pointerLock.dispatch(!1,e))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0),this.game.canvas.removeEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.removeEventListener("DOMMouseScroll",this._onMouseWheel,!0)}},t.Mouse.prototype.constructor=t.Mouse,t.MSPointer=function(e){this.game=e,this.callbackContext=this.game,this.disabled=!1,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null},t.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var e=this;this.game.device.mspointer===!0&&(this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.renderer.view.style["-ms-content-zooming"]="none",this.game.renderer.view.style["-ms-touch-action"]="none")}},onPointerDown:function(e){this.game.input.disabled||this.disabled||(e.preventDefault(),e.identifier=e.pointerId,this.game.input.startPointer(e))},onPointerMove:function(e){this.game.input.disabled||this.disabled||(e.preventDefault(),e.identifier=e.pointerId,this.game.input.updatePointer(e))},onPointerUp:function(e){this.game.input.disabled||this.disabled||(e.preventDefault(),e.identifier=e.pointerId,this.game.input.stopPointer(e))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp),this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}},t.MSPointer.prototype.constructor=t.MSPointer,t.Pointer=function(e,n){this.game=e,this.id=n,this.type=t.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.target=null,this.button=null,this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=!1,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.active=!1,this.position=new t.Point,this.positionDown=new t.Point,this.positionUp=new t.Point,this.circle=new t.Circle(0,0,44),0===n&&(this.isMouse=!0)},t.Pointer.prototype={start:function(e){return e.pointerId&&(this.pointerId=e.pointerId),this.identifier=e.identifier,this.target=e.target,"undefined"!=typeof e.button&&(this.button=e.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(e,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,e),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==t.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==t.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==t.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(e,n){if(!this.game.input.pollLocked){if("undefined"==typeof n&&(n=!1),"undefined"!=typeof e.button&&(this.button=e.button),this.clientX=e.clientX,this.clientY=e.clientY,this.pageX=e.pageX,this.pageY=e.pageY,this.screenX=e.screenX,this.screenY=e.screenY,this.isMouse&&this.game.input.mouse.locked&&!n&&(this.rawMovementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,this.rawMovementY=e.movementY||e.mozMovementY||e.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;this.game.input.moveCallback&&this.game.input.moveCallback.call(this.game.input.moveCallbackContext,this,this.x,this.y);for(var r=this.game.input.moveCallbacks.length;r--;)this.game.input.moveCallbacks[r].callback.call(this.game.input.moveCallbacks[r].context,this,this.x,this.y);return null!==this.targetObject&&this.targetObject.isDragged===!0?(this.targetObject.update(this)===!1&&(this.targetObject=null),this):(this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(n),this)}},processInteractiveObjects:function(e){this.game.input.interactiveItems.setAll("checked",!1),this._highestRenderOrderID=Number.MAX_SAFE_INTEGER,this._highestRenderObject=null,this._highestInputPriorityID=-1;var t=this.game.input.interactiveItems.first;do t&&t.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!1)&&(t.checked=!0,(e&&t.checkPointerDown(this,!0)||!e&&t.checkPointerOver(this,!0))&&(this._highestRenderOrderID=t.sprite._cache[3],this._highestInputPriorityID=t.priorityID,this._highestRenderObject=t)),t=this.game.input.interactiveItems.next;while(null!==t);var t=this.game.input.interactiveItems.first;do t&&!t.checked&&t.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!0)&&(e&&t.checkPointerDown(this,!1)||!e&&t.checkPointerOver(this,!1))&&(this._highestRenderOrderID=t.sprite._cache[3],this._highestInputPriorityID=t.priorityID,this._highestRenderObject=t),t=this.game.input.interactiveItems.next;while(null!==t);null===this._highestRenderObject?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject===this._highestRenderObject?this._highestRenderObject.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this))},leave:function(e){this.withinGame=!1,this.move(e,!1)},stop:function(e){return this._stateReset?void e.preventDefault():(this.timeUp=this.game.time.now,(this.game.input.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,e),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this.targetObject=null,this)},justPressed:function(e){return e=e||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+e>this.game.time.now},justReleased:function(e){return e=e||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+e>this.game.time.now},reset:function(){this.isMouse===!1&&(this.active=!1),this.pointerId=null,this.identifier=null,this.isDown=!1,this.isUp=!0,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},t.Pointer.prototype.constructor=t.Pointer,Object.defineProperty(t.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}}),Object.defineProperty(t.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(t.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),t.Touch=function(e){this.game=e,this.disabled=!1,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},t.Touch.prototype={start:function(){if(null===this._onTouchStart){var e=this;this.game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(e){if(this.event=e,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,e),!this.game.input.disabled&&!this.disabled){this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.startPointer(e.changedTouches[t])}},onTouchCancel:function(e){if(this.event=e,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,e),!this.game.input.disabled&&!this.disabled){this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])}},onTouchEnter:function(e){this.event=e,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,e),this.game.input.disabled||this.disabled||this.preventDefault&&e.preventDefault()},onTouchLeave:function(e){this.event=e,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault()},onTouchMove:function(e){this.event=e,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.updatePointer(e.changedTouches[t])},onTouchEnd:function(e){this.event=e,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},t.Touch.prototype.constructor=t.Touch,t.Gamepad=function(e){this.game=e,this._gamepads=[new t.SinglePad(e,this),new t.SinglePad(e,this),new t.SinglePad(e,this),new t.SinglePad(e,this)],this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.disabled=!1,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null},t.Gamepad.prototype={addCallbacks:function(e,t){"undefined"!=typeof t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback)},start:function(){if(!this._active){this._active=!0;var e=this;this._ongamepadconnected=function(t){var n=t.gamepad;e._rawPads.push(n),e._gamepads[n.index].connect(n)},window.addEventListener("gamepadconnected",this._ongamepadconnected,!1),this._ongamepaddisconnected=function(t){var n=t.gamepad;for(var r in e._rawPads)e._rawPads[r].index===n.index&&e._rawPads.splice(r,1);e._gamepads[n.index].disconnect()},window.addEventListener("gamepaddisconnected",this._ongamepaddisconnected,!1)}},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var e=navigator.getGamepads();else if(navigator.webkitGetGamepads)var e=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var e=navigator.webkitGamepads();if(e){this._rawPads=[];for(var t=!1,n=0;n<e.length&&(typeof e[n]!==this._prevRawGamepadTypes[n]&&(t=!0,this._prevRawGamepadTypes[n]=typeof e[n]),e[n]&&this._rawPads.push(e[n]),3!==n);n++);if(t){for(var r,i={rawIndices:{},padIndices:{}},s=0;s<this._gamepads.length;s++)if(r=this._gamepads[s],r.connected)for(var o=0;o<this._rawPads.length;o++)this._rawPads[o].index===r.index&&(i.rawIndices[r.index]=!0,i.padIndices[s]=!0);for(var u=0;u<this._gamepads.length;u++)if(r=this._gamepads[u],!i.padIndices[u]){this._rawPads.length<1&&r.disconnect();for(var a=0;a<this._rawPads.length&&!i.padIndices[u];a++){var f=this._rawPads[a];if(f){if(i.rawIndices[f.index]){r.disconnect();continue}r.connect(f),i.rawIndices[f.index]=!0,i.padIndices[u]=!0}else r.disconnect()}}}}},setDeadZones:function(e){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=e},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._ongamepadconnected),window.removeEventListener("gamepaddisconnected",this._ongamepaddisconnected)},reset:function(){this.update();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].reset()},justPressed:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justPressed(e,t)===!0)return!0;return!1},justReleased:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justReleased(e,t)===!0)return!0;return!1},isDown:function(e){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(e)===!0)return!0;return!1}},t.Gamepad.prototype.constructor=t.Gamepad,Object.defineProperty(t.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(t.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(t.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(t.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(t.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(t.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(t.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),t.Gamepad.BUTTON_0=0,t.Gamepad.BUTTON_1=1,t.Gamepad.BUTTON_2=2,t.Gamepad.BUTTON_3=3,t.Gamepad.BUTTON_4=4,t.Gamepad.BUTTON_5=5,t.Gamepad.BUTTON_6=6,t.Gamepad.BUTTON_7=7,t.Gamepad.BUTTON_8=8,t.Gamepad.BUTTON_9=9,t.Gamepad.BUTTON_10=10,t.Gamepad.BUTTON_11=11,t.Gamepad.BUTTON_12=12,t.Gamepad.BUTTON_13=13,t.Gamepad.BUTTON_14=14,t.Gamepad.BUTTON_15=15,t.Gamepad.AXIS_0=0,t.Gamepad.AXIS_1=1,t.Gamepad.AXIS_2=2,t.Gamepad.AXIS_3=3,t.Gamepad.AXIS_4=4,t.Gamepad.AXIS_5=5,t.Gamepad.AXIS_6=6,t.Gamepad.AXIS_7=7,t.Gamepad.AXIS_8=8,t.Gamepad.AXIS_9=9,t.Gamepad.XBOX360_A=0,t.Gamepad.XBOX360_B=1,t.Gamepad.XBOX360_X=2,t.Gamepad.XBOX360_Y=3,t.Gamepad.XBOX360_LEFT_BUMPER=4,t.Gamepad.XBOX360_RIGHT_BUMPER=5,t.Gamepad.XBOX360_LEFT_TRIGGER=6,t.Gamepad.XBOX360_RIGHT_TRIGGER=7,t.Gamepad.XBOX360_BACK=8,t.Gamepad.XBOX360_START=9,t.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,t.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,t.Gamepad.XBOX360_DPAD_LEFT=14,t.Gamepad.XBOX360_DPAD_RIGHT=15,t.Gamepad.XBOX360_DPAD_UP=12,t.Gamepad.XBOX360_DPAD_DOWN=13,t.Gamepad.XBOX360_STICK_LEFT_X=0,t.Gamepad.XBOX360_STICK_LEFT_Y=1,t.Gamepad.XBOX360_STICK_RIGHT_X=2,t.Gamepad.XBOX360_STICK_RIGHT_Y=3,t.Gamepad.PS3XC_X=0,t.Gamepad.PS3XC_CIRCLE=1,t.Gamepad.PS3XC_SQUARE=2,t.Gamepad.PS3XC_TRIANGLE=3,t.Gamepad.PS3XC_L1=4,t.Gamepad.PS3XC_R1=5,t.Gamepad.PS3XC_L2=6,t.Gamepad.PS3XC_R2=7,t.Gamepad.PS3XC_SELECT=8,t.Gamepad.PS3XC_START=9,t.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,t.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,t.Gamepad.PS3XC_DPAD_UP=12,t.Gamepad.PS3XC_DPAD_DOWN=13,t.Gamepad.PS3XC_DPAD_LEFT=14,t.Gamepad.PS3XC_DPAD_RIGHT=15,t.Gamepad.PS3XC_STICK_LEFT_X=0,t.Gamepad.PS3XC_STICK_LEFT_Y=1,t.Gamepad.PS3XC_STICK_RIGHT_X=2,t.Gamepad.PS3XC_STICK_RIGHT_Y=3,t.SinglePad=function(e,t){this.game=e,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=t,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},t.SinglePad.prototype={addCallbacks:function(e,t){"undefined"!=typeof t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback)},addButton:function(e){return this.getButton(e)},getButton:function(e){return this._buttons[e]?this._buttons[e]:null},pollStatus:function(){if(!(!this.connected||this.game.input.disabled||this.game.input.gamepad.disabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp)){for(var e=0;e<this._buttonsLen;e++){var t=isNaN(this._rawPad.buttons[e])?this._rawPad.buttons[e].value:this._rawPad.buttons[e];t!==this._buttons[e].value&&(1===t?this.processButtonDown(e,t):0===t?this.processButtonUp(e,t):this.processButtonFloat(e,t))}for(var n=0;n<this._axesLen;n++){var r=this._rawPad.axes[n];this.processAxisChange(r>0&&r>this.deadZone||0>r&&r<-this.deadZone?{axis:n,value:r}:{axis:n,value:0})}this._prevTimestamp=this._rawPad.timestamp}},connect:function(e){var n=!this.connected;this.connected=!0,this.index=e.index,this._rawPad=e,this._buttons=[],this._buttonsLen=e.buttons.length,this._axes=e.axes,this._axesLen=e.axes.length;for(var r in e.buttons)r=parseInt(r,10),this._buttons[r]=new t.GamepadButton(this,r);n&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),n&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var e=this.connected,t=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,e&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,t),e&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},processAxisChange:function(e){this._axes[e.axis]!==e.value&&(this._axes[e.axis]=e.value,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,e,this.index),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,e))},processButtonDown:function(e,t){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,e,t,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonDown(t)},processButtonUp:function(e,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,e,t,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonUp(t)},processButtonFloat:function(e,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,e,t,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonFloat(t)},axis:function(e){return this._axes[e]?this._axes[e]:!1},isDown:function(e){return this._buttons[e]?this._buttons[e].isDown:!1},isUp:function(e){return this._buttons[e]?this._buttons[e].isUp:!1},justReleased:function(e,t){return this._buttons[e]?this._buttons[e].justReleased(t):void 0},justPressed:function(e,t){return this._buttons[e]?this._buttons[e].justPressed(t):void 0},buttonValue:function(e){return this._buttons[e]?this._buttons[e].value:null},reset:function(){for(var e=0;e<this._axes.length;e++)this._axes[e]=0}},t.SinglePad.prototype.constructor=t.SinglePad,t.GamepadButton=function(e,n){this.pad=e,this.game=e.game,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.duration=0,this.timeUp=0,this.repeats=0,this.value=0,this.buttonCode=n,this.onDown=new t.Signal,this.onUp=new t.Signal,this.onFloat=new t.Signal},t.GamepadButton.prototype={processButtonDown:function(e){this.isDown?(this.duration=this.game.time.now-this.timeDown,this.repeats++):(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.value=e,this.onDown.dispatch(this,e))},processButtonUp:function(e){this.isDown&&(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.value=e,this.onUp.dispatch(this,e))},processButtonFloat:function(e){this.value=e,this.onFloat.dispatch(this,e)},justPressed:function(e){return"undefined"==typeof e&&(e=250),this.isDown&&this.duration<e},justReleased:function(e){return"undefined"==typeof e&&(e=250),this.isDown===!1&&this.game.time.now-this.timeUp<e},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.pad=null,this.game=null}},t.GamepadButton.prototype.constructor=t.GamepadButton,t.InputHandler=function(e){this.sprite=e,this.game=e.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.consumePointerEvent=!1,this._dragPhase=!1,this._wasEnabled=!1,this._tempPoint=new t.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},t.InputHandler.prototype={start:function(e,n){if(e=e||0,"undefined"==typeof n&&(n=!1),this.enabled===!1){this.game.input.interactiveItems.add(this),this.useHandCursor=n,this.priorityID=e;for(var r=0;10>r;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new t.Point,this.enabled=!0,this._wasEnabled=!0,this.sprite.events&&null===this.sprite.events.onInputOver&&(this.sprite.events.onInputOver=new t.Signal,this.sprite.events.onInputOut=new t.Signal,this.sprite.events.onInputDown=new t.Signal,this.sprite.events.onInputUp=new t.Signal,this.sprite.events.onDragStart=new t.Signal,this.sprite.events.onDragStop=new t.Signal)}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1,this.flagged=!1;for(var e=0;10>e;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(e,t,n){return"undefined"==typeof n&&(n=!0),0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:(n||!this.pixelPerfectClick&&!this.pixelPerfectOver)&&(this.priorityID>e||this.priorityID===e&&this.sprite._cache[3]<t)?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(e){return e=e||0,this._pointerData[e].x},pointerY:function(e){return e=e||0,this._pointerData[e].y},pointerDown:function(e){return e=e||0,this._pointerData[e].isDown},pointerUp:function(e){return e=e||0,this._pointerData[e].isUp},pointerTimeDown:function(e){return e=e||0,this._pointerData[e].timeDown},pointerTimeUp:function(e){return e=e||0,this._pointerData[e].timeUp},pointerOver:function(e){if(this.enabled){if("undefined"!=typeof e)return this._pointerData[e].isOver;for(var t=0;10>t;t++)if(this._pointerData[t].isOver)return!0}return!1},pointerOut:function(e){if(this.enabled){if("undefined"!=typeof e)return this._pointerData[e].isOut;for(var t=0;10>t;t++)if(this._pointerData[t].isOut)return!0}return!1},pointerTimeOver:function(e){return e=e||0,this._pointerData[e].timeOver},pointerTimeOut:function(e){return e=e||0,this._pointerData[e].timeOut},pointerDragged:function(e){return e=e||0,this._pointerData[e].isDragged},checkPointerDown:function(e,t){return e.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,e,this._tempPoint)?("undefined"==typeof t&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(e,t){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,e,this._tempPoint)?("undefined"==typeof t&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(e,t,n){if(this.sprite.texture.baseTexture.source){if(this.game.input.hitContext.clearRect(0,0,1,1),null===e&&null===t){this.game.input.getLocalPosition(this.sprite,n,this._tempPoint);var e=this._tempPoint.x,t=this._tempPoint.y}0!==this.sprite.anchor.x&&(e-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),e+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,e,t,1,1,0,0,1,1);var r=this.game.input.hitContext.getImageData(0,0,1,1);if(r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(e){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID==e.id?this.updateDrag(e):this._pointerData[e.id].isOver===!0?this.checkPointerOver(e)?(this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,!0):(this._pointerOutHandler(e),!1):void 0:(this._pointerOutHandler(e),!1):void 0},_pointerOverHandler:function(e){null!==this.sprite&&this._pointerData[e.id].isOver===!1&&(this._pointerData[e.id].isOver=!0,this._pointerData[e.id].isOut=!1,this._pointerData[e.id].timeOver=this.game.time.now,this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,this.useHandCursor&&this._pointerData[e.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver.dispatch(this.sprite,e))},_pointerOutHandler:function(e){null!==this.sprite&&(this._pointerData[e.id].isOver=!1,this._pointerData[e.id].isOut=!0,this._pointerData[e.id].timeOut=this.game.time.now,this.useHandCursor&&this._pointerData[e.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut.dispatch(this.sprite,e))},_touchedHandler:function(e){if(null!==this.sprite){if(this._pointerData[e.id].isDown===!1&&this._pointerData[e.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,e))return;this._pointerData[e.id].isDown=!0,this._pointerData[e.id].isUp=!1,this._pointerData[e.id].timeDown=this.game.time.now,this.sprite&&this.sprite.events&&this.sprite.events.onInputDown.dispatch(this.sprite,e),this.draggable&&this.isDragged===!1&&this.startDrag(e),this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(e){null!==this.sprite&&this._pointerData[e.id].isDown&&e.isUp&&(this._pointerData[e.id].isDown=!1,this._pointerData[e.id].isUp=!0,this._pointerData[e.id].timeUp=this.game.time.now,this._pointerData[e.id].downDuration=this._pointerData[e.id].timeUp-this._pointerData[e.id].timeDown,this.checkPointerOver(e)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,e,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,e,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),this.draggable&&this.isDragged&&this._draggedPointerID===e.id&&this.stopDrag(e))},updateDrag:function(e){return e.isUp?(this.stopDrag(e),!1):(this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=e.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=e.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=e.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.y=e.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0)},justOver:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOver&&this.overDuration(e)<t},justOut:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOut&&this.game.time.now-this._pointerData[e].timeOut<t},justPressed:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isDown&&this.downDuration(e)<t},justReleased:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isUp&&this.game.time.now-this._pointerData[e].timeUp<t},overDuration:function(e){return e=e||0,this._pointerData[e].isOver?this.game.time.now-this._pointerData[e].timeOver:-1},downDuration:function(e){return e=e||0,this._pointerData[e].isDown?this.game.time.now-this._pointerData[e].timeDown:-1},enableDrag:function(e,n,r,i,s,o){"undefined"==typeof e&&(e=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s=null),"undefined"==typeof o&&(o=null),this._dragPoint=new t.Point,this.draggable=!0,this.bringToTop=n,this.dragOffset=new t.Point,this.dragFromCenter=e,this.pixelPerfectClick=r,this.pixelPerfectAlpha=i,s&&(this.boundsRect=s),o&&(this.boundsSprite=o)},disableDrag:function(){if(this._pointerData)for(var e=0;10>e;e++)this._pointerData[e].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(e){if(this.isDragged=!0,this._draggedPointerID=e.id,this._pointerData[e.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(e.x,e.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y);else if(this.dragFromCenter){var t=this.sprite.getBounds();this.sprite.x=e.x+(this.sprite.x-t.centerX),this.sprite.y=e.y+(this.sprite.y-t.centerY),this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y)}else this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y);this.updateDrag(e),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.sprite.events.onDragStart.dispatch(this.sprite,e)},stopDrag:function(e){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[e.id].isDragged=!1,this._dragPhase=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop.dispatch(this.sprite,e),this.checkPointerOver(e)===!1&&this._pointerOutHandler(e)},setDragLock:function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0),this.allowHorizontalDrag=e,this.allowVerticalDrag=t},enableSnap:function(e,t,n,r,i,s){"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),this.snapX=e,this.snapY=t,this.snapOffsetX=i,this.snapOffsetY=s,this.snapOnDrag=n,this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.camerOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.camerOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height))}},t.InputHandler.prototype.constructor=t.InputHandler,t.Events=function(e){this.parent=e,this.onAddedToGroup=new t.Signal,this.onRemovedFromGroup=new t.Signal,this.onKilled=new t.Signal,this.onRevived=new t.Signal,this.onOutOfBounds=new t.Signal,this.onEnterBounds=new t.Signal,this.onInputOver=null,this.onInputOut=null,this.onInputDown=null,this.onInputUp=null,this.onDragStart=null,this.onDragStop=null,this.onAnimationStart=null,this.onAnimationComplete=null,this.onAnimationLoop=null},t.Events.prototype={destroy:function(){this.parent=null,this.onAddedToGroup.dispose(),this.onRemovedFromGroup.dispose(),this.onKilled.dispose(),this.onRevived.dispose(),this.onOutOfBounds.dispose(),this.onInputOver&&(this.onInputOver.dispose(),this.onInputOut.dispose(),this.onInputDown.dispose(),this.onInputUp.dispose(),this.onDragStart.dispose(),this.onDragStop.dispose()),this.onAnimationStart&&(this.onAnimationStart.dispose(),this.onAnimationComplete.dispose(),this.onAnimationLoop.dispose())}},t.Events.prototype.constructor=t.Events,t.GameObjectFactory=function(e){this.game=e,this.world=this.game.world},t.GameObjectFactory.prototype={existing:function(e){return this.world.add(e)},image:function(e,n,r,i,s){return"undefined"==typeof s&&(s=this.world),s.add(new t.Image(this.game,e,n,r,i))},sprite:function(e,t,n,r,i){return"undefined"==typeof i&&(i=this.world),i.create(e,t,n,r)},tween:function(e){return this.game.tweens.create(e)},group:function(e,n,r,i,s){return new t.Group(this.game,e,n,r,i,s)},physicsGroup:function(e,n,r,i){return new t.Group(this.game,n,r,i,!0,e)},spriteBatch:function(e,n,r){return"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n="group"),"undefined"==typeof r&&(r=!1),new t.SpriteBatch(this.game,e,n,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},tileSprite:function(e,n,r,i,s,o,u){return"undefined"==typeof u&&(u=this.world),u.add(new t.TileSprite(this.game,e,n,r,i,s,o))},text:function(e,n,r,i,s){return"undefined"==typeof s&&(s=this.world),s.add(new t.Text(this.game,e,n,r,i))},button:function(e,n,r,i,s,o,u,a,f,l){return"undefined"==typeof l&&(l=this.world),l.add(new t.Button(this.game,e,n,r,i,s,o,u,a,f))},graphics:function(e,n,r){return"undefined"==typeof r&&(r=this.world),r.add(new t.Graphics(this.game,e,n))},emitter:function(e,n,r){return this.game.particles.add(new t.Particles.Arcade.Emitter(this.game,e,n,r))},retroFont:function(e,n,r,i,s,o,u,a,f){return new t.RetroFont(this.game,e,n,r,i,s,o,u,a,f)},bitmapText:function(e,n,r,i,s,o){return"undefined"==typeof o&&(o=this.world),o.add(new t.BitmapText(this.game,e,n,r,i,s))},tilemap:function(e,n,r,i,s){return new t.Tilemap(this.game,e,n,r,i,s)},renderTexture:function(e,n,r,i){("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid()),"undefined"==typeof i&&(i=!1);var s=new t.RenderTexture(this.game,e,n,r);return i&&this.game.cache.addRenderTexture(r,s),s},bitmapData:function(e,n,r,i){"undefined"==typeof i&&(i=!1),("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid());var s=new t.BitmapData(this.game,r,e,n);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var n=Array.prototype.splice.call(arguments,1),e=new t.Filter[e](this.game);return e.init.apply(e,n),e},plugin:function(e){return this.game.plugins.add(e)}},t.GameObjectFactory.prototype.constructor=t.GameObjectFactory,t.GameObjectCreator=function(e){this.game=e,this.world=this.game.world},t.GameObjectCreator.prototype={image:function(e,n,r,i){return new t.Image(this.game,e,n,r,i)},sprite:function(e,n,r,i){return new t.Sprite(this.game,e,n,r,i)},tween:function(e){return new t.Tween(e,this.game)},group:function(e,n,r,i,s){return new t.Group(this.game,null,n,r,i,s)},spriteBatch:function(e,n,r){return"undefined"==typeof n&&(n="group"),"undefined"==typeof r&&(r=!1),new t.SpriteBatch(this.game,e,n,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},tileSprite:function(e,n,r,i,s,o){return new t.TileSprite(this.game,e,n,r,i,s,o)},text:function(e,n,r,i){return new t.Text(this.game,e,n,r,i)},button:function(e,n,r,i,s,o,u,a,f){return new t.Button(this.game,e,n,r,i,s,o,u,a,f)},graphics:function(e,n){return new t.Graphics(this.game,e,n)},emitter:function(e,n,r){return new t.Particles.Arcade.Emitter(this.game,e,n,r)},retroFont:function(e,n,r,i,s,o,u,a,f){return new t.RetroFont(this.game,e,n,r,i,s,o,u,a,f)},bitmapText:function(e,n,r,i,s){return new t.BitmapText(this.game,e,n,r,i,s)},tilemap:function(e,n,r,i,s){return new t.Tilemap(this.game,e,n,r,i,s)},renderTexture:function(e,n,r,i){("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid()),"undefined"==typeof i&&(i=!1);var s=new t.RenderTexture(this.game,e,n,r);return i&&this.game.cache.addRenderTexture(r,s),s},bitmapData:function(e,n,r,i){"undefined"==typeof i&&(i=!1),("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid());var s=new t.BitmapData(this.game,r,e,n);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var n=Array.prototype.splice.call(arguments,1),e=new t.Filter[e](this.game);return e.init.apply(e,n),e}},t.GameObjectCreator.prototype.constructor=t.GameObjectCreator,t.BitmapData=function(e,n,r,i){"undefined"==typeof r&&(r=100),"undefined"==typeof i&&(i=100),this.game=e,this.key=n,this.width=r,this.height=i,this.canvas=t.Canvas.create(r,i,"",!0),this.context=this.canvas.getContext("2d"),this.ctx=this.context,this.imageData=this.context.getImageData(0,0,r,i),this.data=this.imageData.data,this.pixels=null,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new t.Frame(0,0,0,r,i,"bitmapData",e.rnd.uuid()),this.texture.frame=this.textureFrame,this.type=t.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this.update=this.refreshBuffer,this._tempR=0,this._tempG=0,this._tempB=0},t.BitmapData.prototype={add:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].loadTexture&&e[t].loadTexture(this);else e.loadTexture(this)},load:function(e){"string"==typeof e&&(e=this.game.cache.getImage(e)),this.resize(e.width,e.height),this.cls(),e instanceof t.Image||e instanceof t.Sprite?this.drawSprite(e,0,0):this.draw(e,0,0),this.update()},clear:function(){this.context.clearRect(0,0,this.width,this.height),this.dirty=!0},fill:function(e,t,n,r){"undefined"==typeof r&&(r=1),this.context.fillStyle="rgba("+e+","+t+","+n+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0},resize:function(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.baseTexture.width=e,this.baseTexture.height=t,this.textureFrame.width=e,this.textureFrame.height=t,this.texture.width=e,this.texture.height=t,this.texture.crop.width=e,this.texture.crop.height=t,this.refreshBuffer(),this.dirty=!0)},refreshBuffer:function(e,t,n,r){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.width),"undefined"==typeof r&&(r=this.height),this.imageData=this.context.getImageData(e,t,n,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data},processPixelRGB:function(e,n,r,i,s,o){"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=this.width),"undefined"==typeof o&&(o=this.height);for(var u=r+s,a=i+o,f=t.Color.createColor(),l={r:0,g:0,b:0,a:0},c=!1,h=i;a>h;h++)for(var p=r;u>p;p++)t.Color.unpackPixel(this.getPixel32(p,h),f),l=e.call(n,f,p,h),l!==!1&&null!==l&&void 0!==l&&(this.setPixel32(p,h,l.r,l.g,l.b,l.a,!1),c=!0);c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)},processPixel:function(e,t,n,r,i,s){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=this.width),"undefined"==typeof s&&(s=this.height);for(var o=n+i,u=r+s,a=0,f=0,l=!1,c=r;u>c;c++)for(var h=n;o>h;h++)a=this.getPixel32(h,c),f=e.call(t,a,h,c),f!==a&&(this.pixels[c*this.width+h]=f,l=!0);l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)},replaceRGB:function(e,n,r,i,s,o,u,a,f){var l=0,c=0,h=this.width,p=this.height,d=t.Color.packPixel(e,n,r,i);void 0!==f&&f instanceof t.Rectangle&&(l=f.x,c=f.y,h=f.width,p=f.height);for(var v=0;p>v;v++)for(var m=0;h>m;m++)this.getPixel32(l+m,c+v)===d&&this.setPixel32(l+m,c+v,s,o,u,a,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0},setHSL:function(e,n,r,i){if(("undefined"==typeof e||null===e)&&(e=!1),("undefined"==typeof n||null===n)&&(n=!1),("undefined"==typeof r||null===r)&&(r=!1),e||n||r){"undefined"==typeof i&&(i=new t.Rectangle(0,0,this.width,this.height));for(var s=t.Color.createColor(),o=i.y;o<i.bottom;o++)for(var u=i.x;u<i.right;u++)t.Color.unpackPixel(this.getPixel32(u,o),s,!0),e&&(s.h=e),n&&(s.s=n),r&&(s.l=r),t.Color.HSLtoRGB(s.h,s.s,s.l,s),this.setPixel32(u,o,s.r,s.g,s.b,s.a,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0}},shiftHSL:function(e,n,r,i){if(("undefined"==typeof e||null===e)&&(e=!1),("undefined"==typeof n||null===n)&&(n=!1),("undefined"==typeof r||null===r)&&(r=!1),e||n||r){"undefined"==typeof i&&(i=new t.Rectangle(0,0,this.width,this.height));for(var s=t.Color.createColor(),o=i.y;o<i.bottom;o++)for(var u=i.x;u<i.right;u++)t.Color.unpackPixel(this.getPixel32(u,o),s,!0),e&&(s.h=this.game.math.wrap(s.h+e,0,1)),n&&(s.s=this.game.math.limitValue(s.s+n,0,1)),r&&(s.l=this.game.math.limitValue(s.l+r,0,1)),t.Color.HSLtoRGB(s.h,s.s,s.l,s),this.setPixel32(u,o,s.r,s.g,s.b,s.a,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0}},setPixel32:function(e,n,r,i,s,o,u){"undefined"==typeof u&&(u=!0),e>=0&&e<=this.width&&n>=0&&n<=this.height&&(this.pixels[n*this.width+e]=t.Device.LITTLE_ENDIAN?o<<24|s<<16|i<<8|r:r<<24|i<<16|s<<8|o,u&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0))},setPixel:function(e,t,n,r,i,s){this.setPixel32(e,t,n,r,i,255,s)},getPixel:function(e,n,r){r||(r=t.Color.createColor());var i=~~(e+n*this.width);return i*=4,r.r=this.data[i],r.g=this.data[++i],r.b=this.data[++i],r.a=this.data[++i],r},getPixel32:function(e,t){return e>=0&&e<=this.width&&t>=0&&t<=this.height?this.pixels[t*this.width+e]:void 0},getPixelRGB:function(e,n,r,i,s){return t.Color.unpackPixel(this.getPixel32(e,n),r,i,s)},getPixels:function(e){return this.context.getImageData(e.x,e.y,e.width,e.height)},addToWorld:function(e,t){return this.game.add.image(e,t,this)},copyPixels:function(e,n,r,i){"string"==typeof e&&(e=this.game.cache.getImage(e));var s=e,o=0,u=0;if(e instanceof t.Image||e instanceof t.Sprite){s=e.texture.baseTexture.source;var a=e.texture.frame;o=a.x,u=a.y}else e instanceof t.BitmapData&&(s=e.canvas);this.context.drawImage(s,o+n.x,u+n.y,n.width,n.height,r,i,n.width,n.height),this.dirty=!0},draw:function(e,n,r,i,s){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),"string"==typeof e&&(e=this.game.cache.getImage(e));var o=e,u=0,a=0,f=0,l=0;if(e instanceof t.Image||e instanceof t.Sprite){o=e.texture.baseTexture.source;var c=e.texture.frame;u=c.x,a=c.y,f=c.width,l=c.height}else e instanceof t.BitmapData&&(o=e.canvas),f=e.width,l=e.height;"undefined"==typeof i&&(i=f),"undefined"==typeof s&&(s=l),this.context.drawImage(o,u,a,f,l,n,r,i,s),this.dirty=!0},drawSprite:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),this.draw(e,t,n)},alphaMask:function(e,t,n,r){("undefined"==typeof t||null===t)&&(t=this);var i=this.context.globalCompositeOperation;"undefined"==typeof r||null===r?this.draw(t):this.draw(t,r.x,r.y,r.width,r.height),this.context.globalCompositeOperation="source-atop","undefined"==typeof n||null===n?this.draw(e):this.draw(e,n.x,n.y,n.width,n.height),this.context.globalCompositeOperation=i,this.update(),this.dirty=!0},extract:function(e,t,n,r,i,s,o,u,a){return"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s=!1),"undefined"==typeof o&&(o=t),"undefined"==typeof u&&(u=n),"undefined"==typeof a&&(a=r),s&&e.resize(this.width,this.height),this.processPixelRGB(function(s,f,l){return s.r===t&&s.g===n&&s.b===r&&e.setPixel32(f,l,o,u,a,i,!1),!1},this),e.context.putImageData(e.imageData,0,0),e.dirty=!0,e},rect:function(e,t,n,r,i){"undefined"!=typeof i&&(this.context.fillStyle=i),this.context.fillRect(e,t,n,r)},circle:function(e,t,n,r){"undefined"!=typeof r&&(this.context.fillStyle=r),this.context.beginPath(),this.context.arc(e,t,n,0,2*Math.PI,!1),this.context.closePath(),this.context.fill()},render:function(){!this.disableTextureUpload&&this.game.renderType===t.WEBGL&&this.dirty&&(PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1)}},t.BitmapData.prototype.constructor=t.BitmapData,t.Sprite=function(e,n,r,i,s){n=n||0,r=r||0,i=i||null,s=s||null,this.game=e,this.name="",this.type=t.SPRITE,this.z=0,this.events=new t.Events(this),this.animations=new t.AnimationManager(this),this.key=i,PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.position.set(n,r),this.world=new t.Point(n,r),this.autoCull=!1,this.input=null,this.body=null,this.alive=!0,this.health=1,this.lifespan=0,this.checkWorldBounds=!1,this.outOfBoundsKill=!1,this.debug=!1,this.cameraOffset=new t.Point,this.cropRect=null,this._cache=[0,0,0,0,1,0,1,0],this._crop=null,this._frame=null,this._bounds=new t.Rectangle,this.loadTexture(i,s)},t.Sprite.prototype=Object.create(PIXI.Sprite.prototype),t.Sprite.prototype.constructor=t.Sprite,t.Sprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;if(this.lifespan>0&&(this.lifespan-=this.game.time.elapsed,this.lifespan<=0))return this.kill(),!1;if((this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds)if(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds))this._cache[5]=0,this.events.onEnterBounds.dispatch(this);else if(0===this._cache[5]&&!this.game.world.bounds.intersects(this._bounds)&&(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this),this.outOfBoundsKill))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),this.body&&this.body.preUpdate();for(var e=0,t=this.children.length;t>e;e++)this.children[e].preUpdate();return!0},t.Sprite.prototype.update=function(){},t.Sprite.prototype.postUpdate=function(){this.key instanceof t.BitmapData&&this.key.render(),this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var e=0,n=this.children.length;n>e;e++)this.children[e].postUpdate()},t.Sprite.prototype.loadTexture=function(e,n,r){n=n||0,(r||"undefined"==typeof r)&&this.animations.stop(),this.key=e;var i=!0,s=this.smoothed;e instanceof t.RenderTexture?(this.key=e.key,this.setTexture(e)):e instanceof t.BitmapData?this.setTexture(e.texture):e instanceof PIXI.Texture?this.setTexture(e):null===e||"undefined"==typeof e?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof e||this.game.cache.checkImageKey(e)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[e])),i=!this.animations.loadFrameData(this.game.cache.getFrameData(e),n)):(console.warn("Texture with key '"+e+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),i&&(this._frame=t.Rectangle.clone(this.texture.frame)),s||(this.smoothed=!1)},t.Sprite.prototype.setFrame=function(e){this._frame=e,this.texture.frame.x=e.x,this.texture.frame.y=e.y,this.texture.frame.width=e.width,this.texture.frame.height=e.height,this.texture.crop.x=e.x,this.texture.crop.y=e.y,this.texture.crop.width=e.width,this.texture.crop.height=e.height,e.trimmed&&(this.texture.trim?(this.texture.trim.x=e.spriteSourceSizeX,this.texture.trim.y=e.spriteSourceSizeY,this.texture.trim.width=e.sourceSizeW,this.texture.trim.height=e.sourceSizeH):this.texture.trim={x:e.spriteSourceSizeX,y:e.spriteSourceSizeY,width:e.sourceSizeW,height:e.sourceSizeH},this.texture.width=e.sourceSizeW,this.texture.height=e.sourceSizeH,this.texture.frame.width=e.sourceSizeW,this.texture.frame.height=e.sourceSizeH),this.cropRect?this.updateCrop():this.game.renderType===t.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)},t.Sprite.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)},t.Sprite.prototype.crop=function(e,n){"undefined"==typeof n&&(n=!1),e?(n&&null!==this.cropRect?this.cropRect.setTo(e.x,e.y,e.width,e.height):this.cropRect=n&&null===this.cropRect?new t.Rectangle(e.x,e.y,e.width,e.height):e,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},t.Sprite.prototype.updateCrop=function(){if(this.cropRect){this._crop=t.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var e=Math.max(this._frame.x,this._crop.x),n=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-e,i=Math.min(this._frame.bottom,this._crop.bottom)-n;this.texture.crop.x=e,this.texture.crop.y=n,this.texture.crop.width=r,this.texture.crop.height=i,this.texture.frame.width=Math.min(r,this.cropRect.width),this.texture.frame.height=Math.min(i,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.game.renderType===t.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)}},t.Sprite.prototype.revive=function(e){return"undefined"==typeof e&&(e=1),this.alive=!0,this.exists=!0,this.visible=!0,this.health=e,this.events&&this.events.onRevived.dispatch(this),this},t.Sprite.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},t.Sprite.prototype.destroy=function(e){if(null!==this.game&&1!==this._cache[8]){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy();var n=this.children.length;if(e)for(;n--;)this.children[n].destroy(e);else for(;n--;)this.removeChild(this.children[n]);this._crop&&(this._crop=null),this._frame&&(this._frame=null),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},t.Sprite.prototype.damage=function(e){return this.alive&&(this.health-=e,this.health<=0&&this.kill()),this},t.Sprite.prototype.reset=function(e,t,n){return"undefined"==typeof n&&(n=1),this.world.setTo(e,t),this.position.x=e,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=n,this.body&&this.body.reset(e,t,!1,!1),this._cache[4]=1,this},t.Sprite.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},t.Sprite.prototype.play=function(e,t,n,r){return this.animations?this.animations.play(e,t,n,r):void 0},t.Sprite.prototype.overlap=function(e){return t.Rectangle.intersects(this.getBounds(),e.getBounds())},Object.defineProperty(t.Sprite.prototype,"angle",{get:function(){return t.Math.wrapAngle(t.Math.radToDeg(this.rotation))},set:function(e){this.rotation=t.Math.degToRad(t.Math.wrapAngle(e))}}),Object.defineProperty(t.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(t.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(t.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(t.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(t.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(t.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}}),Object.defineProperty(t.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}}),Object.defineProperty(t.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(t.Sprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(t.Sprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(e){e?(this._cache[6]=1,this.body&&this.body.type===t.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===t.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}}),Object.defineProperty(t.Sprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.Sprite.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(e){e?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(t.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e,this.body&&this.body.type===t.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(t.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e,this.body&&this.body.type===t.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(t.Sprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.Image=function(e,n,r,i,s){n=n||0,r=r||0,i=i||null,s=s||null,this.game=e,this.exists=!0,this.name="",this.type=t.IMAGE,this.z=0,this.events=new t.Events(this),this.key=i,this._frame=0,this._frameName="",PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.loadTexture(i,s),this.position.set(n,r),this.world=new t.Point(n,r),this.autoCull=!1,this.input=null,this.cameraOffset=new t.Point,this._cache=[0,0,0,0,1,0,1,0,0]},t.Image.prototype=Object.create(PIXI.Sprite.prototype),t.Image.prototype.constructor=t.Image,t.Image.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var e=0,t=this.children.length;t>e;e++)this.children[e].preUpdate();return!0},t.Image.prototype.update=function(){},t.Image.prototype.postUpdate=function(){this.key instanceof t.BitmapData&&this.key.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var e=0,n=this.children.length;n>e;e++)this.children[e].postUpdate()},t.Image.prototype.loadTexture=function(e,n){if(n=n||0,e instanceof t.RenderTexture)return this.key=e.key,void this.setTexture(e);if(e instanceof t.BitmapData)return this.key=e,void this.setTexture(e.texture);if(e instanceof PIXI.Texture)return this.key=e,void this.setTexture(e);if(null===e||"undefined"==typeof e)return this.key="__default",void this.setTexture(PIXI.TextureCache[this.key]);if("string"==typeof e&&!this.game.cache.checkImageKey(e))return this.key="__missing",void this.setTexture(PIXI.TextureCache[this.key]);if(this.game.cache.isSpriteSheet(e)){this.key=e;var r=this.game.cache.getFrameData(e);return"string"==typeof n?(this._frame=0,this._frameName=n,void this.setTexture(PIXI.TextureCache[r.getFrameByName(n).uuid])):(this._frame=n,this._frameName="",void this.setTexture(PIXI.TextureCache[r.getFrame(n).uuid]))}return this.key=e,void this.setTexture(PIXI.TextureCache[e])},t.Image.prototype.crop=function(e){if("undefined"==typeof e||null===e)this.texture.hasOwnProperty("sourceWidth")&&this.texture.setFrame(new t.Rectangle(0,0,this.texture.sourceWidth,this.texture.sourceHeight));else if(this.texture instanceof PIXI.Texture){var n={};t.Utils.extend(!0,n,this.texture),n.sourceWidth=n.width,n.sourceHeight=n.height,n.frame=e,n.width=e.width,n.height=e.height,this.texture=n,this.texture.updateFrame=!0,PIXI.Texture.frameUpdates.push(this.texture)}else this.texture.setFrame(e)},t.Image.prototype.revive=function(){return this.alive=!0,this.exists=!0,this.visible=!0,this.events&&this.events.onRevived.dispatch(this),this},t.Image.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},t.Image.prototype.destroy=function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this)),this.events&&this.events.destroy(),this.input&&this.input.destroy();var n=this.children.length;if(e)for(;n--;)this.children[n].destroy(e);else for(;n--;)this.removeChild(this.children[n]);this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},t.Image.prototype.reset=function(e,t){return this.world.setTo(e,t),this.position.x=e,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this},t.Image.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},Object.defineProperty(t.Image.prototype,"angle",{get:function(){return t.Math.wrapAngle(t.Math.radToDeg(this.rotation))},set:function(e){this.rotation=t.Math.degToRad(t.Math.wrapAngle(e))}}),Object.defineProperty(t.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(t.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(t.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(t.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(t.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(t.Image.prototype,"frame",{get:function(){return this._frame},set:function(e){if(e!==this.frame&&this.game.cache.isSpriteSheet(this.key)){var t=this.game.cache.getFrameData(this.key);t&&e<t.total&&t.getFrame(e)&&(this.setTexture(PIXI.TextureCache[t.getFrame(e).uuid]),this._frame=e)}}}),Object.defineProperty(t.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(e){if(e!==this.frameName&&this.game.cache.isSpriteSheet(this.key)){var t=this.game.cache.getFrameData(this.key);t&&t.getFrameByName(e)&&(this.setTexture(PIXI.TextureCache[t.getFrameByName(e).uuid]),this._frameName=e)}}}),Object.defineProperty(t.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(t.Image.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(t.Image.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.Image.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(e){e?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(t.Image.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.TileSprite=function(e,n,r,i,s,o,u){n=n||0,r=r||0,i=i||256,s=s||256,o=o||null,u=u||null,this.game=e,this.name="",this.type=t.TILESPRITE,this.z=0,this.events=new t.Events(this),this.animations=new t.AnimationManager(this),this.key=o,this._frame=0,this._frameName="",this._scroll=new t.Point,PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,i,s),this.position.set(n,r),this.input=null,this.world=new t.Point(n,r),this.autoCull=!1,this.checkWorldBounds=!1,this.cameraOffset=new t.Point,this.body=null,this._cache=[0,0,0,0,1,0,1,0,0],this.loadTexture(o,u)},t.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),t.TileSprite.prototype.constructor=t.TileSprite,t.TileSprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds&&(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):0!==this._cache[5]||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this))),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.body&&this.body.preUpdate();for(var e=0,t=this.children.length;t>e;e++)this.children[e].preUpdate();return!0},t.TileSprite.prototype.update=function(){},t.TileSprite.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var e=0,t=this.children.length;t>e;e++)this.children[e].postUpdate()},t.TileSprite.prototype.autoScroll=function(e,t){this._scroll.set(e,t)},t.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},t.TileSprite.prototype.loadTexture=function(e,n){n=n||0,this.key=e,e instanceof t.RenderTexture?(this.key=e.key,this.setTexture(e)):e instanceof t.BitmapData?this.setTexture(e.texture):e instanceof PIXI.Texture?this.setTexture(e):null===e||"undefined"==typeof e?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof e||this.game.cache.checkImageKey(e)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[e])),this.animations.loadFrameData(this.game.cache.getFrameData(e),n)):(console.warn("Texture with key '"+e+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]))},t.TileSprite.prototype.setFrame=function(e){this.texture.frame.x=e.x,this.texture.frame.y=e.y,this.texture.frame.width=e.width,this.texture.frame.height=e.height,this.texture.crop.x=e.x,this.texture.crop.y=e.y,this.texture.crop.width=e.width,this.texture.crop.height=e.height,e.trimmed&&(this.texture.trim?(this.texture.trim.x=e.spriteSourceSizeX,this.texture.trim.y=e.spriteSourceSizeY,this.texture.trim.width=e.sourceSizeW,this.texture.trim.height=e.sourceSizeH):this.texture.trim={x:e.spriteSourceSizeX,y:e.spriteSourceSizeY,width:e.sourceSizeW,height:e.sourceSizeH},this.texture.width=e.sourceSizeW,this.texture.height=e.sourceSizeH,this.texture.frame.width=e.sourceSizeW,this.texture.frame.height=e.sourceSizeH),this.game.renderType===t.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)},t.TileSprite.prototype.destroy=function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.filters&&(this.filters=null),this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this)),this.animations.destroy(),this.events.destroy();var n=this.children.length;if(e)for(;n--;)this.children[n].destroy(e);else for(;n--;)this.removeChild(this.children[n]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},t.TileSprite.prototype.play=function(e,t,n,r){return this.animations.play(e,t,n,r)},t.TileSprite.prototype.reset=function(e,t){return this.world.setTo(e,t),this.position.x=e,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(e,t,!1,!1),this._cache[4]=1,this},Object.defineProperty(t.TileSprite.prototype,"angle",{get:function(){return t.Math.wrapAngle(t.Math.radToDeg(this.rotation))},set:function(e){this.rotation=t.Math.degToRad(t.Math.wrapAngle(e))}}),Object.defineProperty(t.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(e){e!==this.animations.frame&&(this.animations.frame=e)}}),Object.defineProperty(t.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(e){e!==this.animations.frameName&&(this.animations.frameName=e)}}),Object.defineProperty(t.TileSprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.TileSprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(e){e?(this._cache[6]=1,this.body&&this.body.type===t.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===t.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}}),Object.defineProperty(t.TileSprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(t.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e,this.body&&this.body.type===t.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(t.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e,this.body&&this.body.type===t.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(t.TileSprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.Text=function(e,n,r,i,s){n=n||0,r=r||0,i=i||" ",s=s||{},i=0===i.length?" ":i.toString(),this.game=e,this.exists=!0,this.name="",this.type=t.TEXT,this.z=0,this.world=new t.Point(n,r),this._text=i,this._font="",this._fontSize=32,this._fontWeight="normal",this._lineSpacing=0,this.events=new t.Events(this),this.input=null,this.cameraOffset=new t.Point,this.setStyle(s),PIXI.Text.call(this,i,this.style),this.position.set(n,r),this._cache=[0,0,0,0,1,0,1,0,0]},t.Text.prototype=Object.create(PIXI.Text.prototype),t.Text.prototype.constructor=t.Text,t.Text.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var e=0,t=this.children.length;t>e;e++)this.children[e].preUpdate();return!0},t.Text.prototype.update=function(){},t.Text.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var e=0,t=this.children.length;t>e;e++)this.children[e].postUpdate()},t.Text.prototype.destroy=function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this)),this.texture.destroy(),this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);var n=this.children.length;if(e)for(;n--;)this.children[n].destroy(e);else for(;n--;)this.removeChild(this.children[n]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},t.Text.prototype.setShadow=function(e,t,n,r){this.style.shadowOffsetX=e||0,this.style.shadowOffsetY=t||0,this.style.shadowColor=n||"rgba(0,0,0,0)",this.style.shadowBlur=r||0,this.dirty=!0},t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.shadowOffsetX=e.shadowOffsetX||0,e.shadowOffsetY=e.shadowOffsetY||0,e.shadowColor=e.shadowColor||"rgba(0,0,0,0)",e.shadowBlur=e.shadowBlur||0,this.style=e,this.dirty=!0},t.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.runWordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,i=0;i<t.length;i++){var s=this.context.measureText(t[i]).width;n[i]=s,r=Math.max(r,s)}this.canvas.width=r+this.style.strokeThickness;var o=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness+this._lineSpacing+this.style.shadowOffsetY;for(this.canvas.height=o*t.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.textBaseline="top",this.context.lineCap="round",this.context.lineJoin="round",i=0;i<t.length;i++){var u=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+i*o);"right"===this.style.align?u.x+=r-n[i]:"center"===this.style.align&&(u.x+=(r-n[i])/2),u.y+=this._lineSpacing,this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[i],u.x,u.y),this.style.fill&&this.context.fillText(t[i],u.x,u.y)}this.updateTexture()},t.Text.prototype.runWordWrap=function(e){for(var t="",n=e.split("\n"),r=0;r<n.length;r++){for(var i=this.style.wordWrapWidth,s=n[r].split(" "),o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;a>i?(o>0&&(t+="\n"),t+=s[o]+" ",i=this.style.wordWrapWidth-u):(i-=a,t+=s[o]+" ")}r<n.length-1&&(t+="\n")}return t},Object.defineProperty(t.Text.prototype,"angle",{get:function(){return t.Math.radToDeg(this.rotation)},set:function(e){this.rotation=t.Math.degToRad(e)}}),Object.defineProperty(t.Text.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||" ",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"font",{get:function(){return this._font},set:function(e){e!==this._font&&(this._font=e.trim(),this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10),e!==this._fontSize&&(this._fontSize=e,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){e!==this._fontWeight&&(this._fontWeight=e,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(e){e!==this.style.fill&&(this.style.fill=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"align",{get:function(){return this.style.align},set:function(e){e!==this.style.align&&(this.style.align=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(e){e!==this.style.stroke&&(this.style.stroke=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(e){e!==this.style.strokeThickness&&(this.style.strokeThickness=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(e){e!==this.style.wordWrap&&(this.style.wordWrap=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(e){e!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){e!==this._lineSpacing&&(this._lineSpacing=parseFloat(e),this.dirty=!0,this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(e){e!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(e){e!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){e!==this.style.shadowColor&&(this.style.shadowColor=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(e){e!==this.style.shadowBlur&&(this.style.shadowBlur=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(t.Text.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.Text.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.BitmapText=function(e,n,r,i,s,o){n=n||0,r=r||0,i=i||"",s=s||"",o=o||32,this.game=e,this.exists=!0,this.name="",this.type=t.BITMAPTEXT,this.z=0,this.world=new t.Point(n,r),this._text=s,this._font=i,this._fontSize=o,this._align="left",this._tint=16777215,this.events=new t.Events(this),this.input=null,this.cameraOffset=new t.Point,PIXI.BitmapText.call(this,s),this.position.set(n,r),this._cache=[0,0,0,0,1,0,1,0,0]},t.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setStyle=function(){this.style={align:this._align},this.fontName=this._font,this.fontSize=this._fontSize,this.dirty=!0},t.BitmapText.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},t.BitmapText.prototype.update=function(){},t.BitmapText.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},t.BitmapText.prototype.destroy=function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this));var n=this.children.length;if(e)for(;n--;)this.children[n].destroy?this.children[n].destroy(e):this.removeChild(this.children[n]);else for(;n--;)this.removeChild(this.children[n]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},Object.defineProperty(t.BitmapText.prototype,"align",{get:function(){return this._align},set:function(e){e!==this._align&&(this._align=e,this.setStyle())}}),Object.defineProperty(t.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this.dirty=!0)}}),Object.defineProperty(t.BitmapText.prototype,"angle",{get:function(){return t.Math.radToDeg(this.rotation)},set:function(e){this.rotation=t.Math.degToRad(e)}}),Object.defineProperty(t.BitmapText.prototype,"font",{get:function(){return this._font},set:function(e){e!==this._font&&(this._font=e.trim(),this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(t.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10),e!==this._fontSize&&(this._fontSize=e,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(t.BitmapText.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||" ",this.dirty=!0)}}),Object.defineProperty(t.BitmapText.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(t.BitmapText.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.BitmapText.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.Button=function(e,n,r,i,s,o,u,a,f,l){n=n||0,r=r||0,i=i||null,s=s||null,o=o||this,t.Image.call(this,e,n,r,i,a),this.type=t.BUTTON,this._onOverFrameName=null,this._onOutFrameName=null,this._onDownFrameName=null,this._onUpFrameName=null,this._onOverFrameID=null,this._onOutFrameID=null,this._onDownFrameID=null,this._onUpFrameID=null,this.onOverMouseOnly=!1,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new t.Signal,this.onInputOut=new t.Signal,this.onInputDown=new t.Signal,this.onInputUp=new t.Signal,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.setFrames(u,a,f,l),null!==s&&this.onInputUp.add(s,o),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},t.Button.prototype=Object.create(t.Image.prototype),t.Button.prototype.constructor=t.Button,t.Button.prototype.clearFrames=function(){this._onOverFrameName=null,this._onOverFrameID=null,this._onOutFrameName=null,this._onOutFrameID=null,this._onDownFrameName=null,this._onDownFrameID=null,this._onUpFrameName=null,this._onUpFrameID=null},t.Button.prototype.setFrames=function(e,t,n,r){this.clearFrames(),null!==e&&("string"==typeof e?(this._onOverFrameName=e,this.input.pointerOver()&&(this.frameName=e)):(this._onOverFrameID=e,this.input.pointerOver()&&(this.frame=e))),null!==t&&("string"==typeof t?(this._onOutFrameName=t,this.input.pointerOver()===!1&&(this.frameName=t)):(this._onOutFrameID=t,this.input.pointerOver()===!1&&(this.frame=t))),null!==n&&("string"==typeof n?(this._onDownFrameName=n,this.input.pointerDown()&&(this.frameName=n)):(this._onDownFrameID=n,this.input.pointerDown()&&(this.frame=n))),null!==r&&("string"==typeof r?(this._onUpFrameName=r,this.input.pointerUp()&&(this.frameName=r)):(this._onUpFrameID=r,this.input.pointerUp()&&(this.frame=r)))},t.Button.prototype.setSounds=function(e,t,n,r,i,s,o,u){this.setOverSound(e,t),this.setOutSound(i,s),this.setDownSound(n,r),this.setUpSound(o,u)},t.Button.prototype.setOverSound=function(e,n){this.onOverSound=null,this.onOverSoundMarker="",e instanceof t.Sound&&(this.onOverSound=e),"string"==typeof n&&(this.onOverSoundMarker=n)},t.Button.prototype.setOutSound=function(e,n){this.onOutSound=null,this.onOutSoundMarker="",e instanceof t.Sound&&(this.onOutSound=e),"string"==typeof n&&(this.onOutSoundMarker=n)},t.Button.prototype.setDownSound=function(e,n){this.onDownSound=null,this.onDownSoundMarker="",e instanceof t.Sound&&(this.onDownSound=e),"string"==typeof n&&(this.onDownSoundMarker=n)},t.Button.prototype.setUpSound=function(e,n){this.onUpSound=null,this.onUpSoundMarker="",e instanceof t.Sound&&(this.onUpSound=e),"string"==typeof n&&(this.onUpSoundMarker=n)},t.Button.prototype.onInputOverHandler=function(e,t){this.freezeFrames===!1&&this.setState(1),(!this.onOverMouseOnly||t.isMouse)&&(this.onOverSound&&this.onOverSound.play(this.onOverSoundMarker),this.onInputOver&&this.onInputOver.dispatch(this,t))},t.Button.prototype.onInputOutHandler=function(e,t){this.freezeFrames===!1&&this.setState(2),this.onOutSound&&this.onOutSound.play(this.onOutSoundMarker),this.onInputOut&&this.onInputOut.dispatch(this,t)},t.Button.prototype.onInputDownHandler=function(e,t){this.freezeFrames===!1&&this.setState(3),this.onDownSound&&this.onDownSound.play(this.onDownSoundMarker),this.onInputDown&&this.onInputDown.dispatch(this,t)},t.Button.prototype.onInputUpHandler=function(e,t,n){this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&this.onInputUp.dispatch(this,t,n),this.freezeFrames||this.setState(this.forceOut?2:null!==this._onUpFrameName||null!==this._onUpFrameID?4:n?1:2)},t.Button.prototype.setState=function(e){1===e?null!=this._onOverFrameName?this.frameName=this._onOverFrameName:null!=this._onOverFrameID&&(this.frame=this._onOverFrameID):2===e?null!=this._onOutFrameName?this.frameName=this._onOutFrameName:null!=this._onOutFrameID&&(this.frame=this._onOutFrameID):3===e?null!=this._onDownFrameName?this.frameName=this._onDownFrameName:null!=this._onDownFrameID&&(this.frame=this._onDownFrameID):4===e&&(null!=this._onUpFrameName?this.frameName=this._onUpFrameName:null!=this._onUpFrameID&&(this.frame=this._onUpFrameID))},t.Graphics=function(e,n,r){n=n||0,r=r||0,this.game=e,this.exists=!0,this.name="",this.type=t.GRAPHICS,this.z=0,this.world=new t.Point(n,r),this.cameraOffset=new t.Point,PIXI.Graphics.call(this),this.position.set(n,r),this._cache=[0,0,0,0,1,0,1,0,0]},t.Graphics.prototype=Object.create(PIXI.Graphics.prototype),t.Graphics.prototype.constructor=t.Graphics,t.Graphics.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},t.Graphics.prototype.update=function(){},t.Graphics.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},t.Graphics.prototype.destroy=function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this._cache[8]=1,this.clear(),this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this));var n=this.children.length;if(e)for(;n--;)this.children[n].destroy(e);else for(;n--;)this.removeChild(this.children[n]);this.exists=!1,this.visible=!1,this.game=null,this._cache[8]=0}},t.Graphics.prototype.drawPolygon=function(e){this.moveTo(e.points[0].x,e.points[0].y);for(var t=1;t<e.points.length;t+=1)this.lineTo(e.points[t].x,e.points[t].y);this.lineTo(e.points[0].x,e.points[0].y)},t.Graphics.prototype.drawTriangle=function(e,n){"undefined"==typeof n&&(n=!1);var r=new t.Polygon(e);if(n){var i=new t.Point(this.game.camera.x-e[0].x,this.game.camera.y-e[0].y),s=new t.Point(e[1].x-e[0].x,e[1].y-e[0].y),o=new t.Point(e[1].x-e[2].x,e[1].y-e[2].y),u=o.cross(s);i.dot(u)>0&&this.drawPolygon(r)}else this.drawPolygon(r)},t.Graphics.prototype.drawTriangles=function(e,n,r){"undefined"==typeof r&&(r=!1);var i,s=new t.Point,o=new t.Point,u=new t.Point,a=[];if(n)if(e[0]instanceof t.Point)for(i=0;i<n.length/3;i++)a.push(e[n[3*i]]),a.push(e[n[3*i+1]]),a.push(e[n[3*i+2]]),3===a.length&&(this.drawTriangle(a,r),a=[]);else for(i=0;i<n.length;i++)s.x=e[2*n[i]],s.y=e[2*n[i]+1],a.push(s.copyTo({})),3===a.length&&(this.drawTriangle(a,r),a=[]);else if(e[0]instanceof t.Point)for(i=0;i<e.length/3;i++)this.drawTriangle([e[3*i],e[3*i+1],e[3*i+2]],r);else for(i=0;i<e.length/6;i++)s.x=e[6*i+0],s.y=e[6*i+1],o.x=e[6*i+2],o.y=e[6*i+3],u.x=e[6*i+4],u.y=e[6*i+5],this.drawTriangle([s,o,u],r)},Object.defineProperty(t.Graphics.prototype,"angle",{get:function(){return t.Math.radToDeg(this.rotation)},set:function(e){this.rotation=t.Math.degToRad(e)}}),Object.defineProperty(t.Graphics.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(e){e?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(t.Graphics.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),t.RenderTexture=function(e,n,r,i,s){"undefined"==typeof i&&(i=""),"undefined"==typeof s&&(s=t.scaleModes.DEFAULT),this.game=e,this.key=i,this.type=t.RENDERTEXTURE,this._temp=new t.Point,PIXI.RenderTexture.call(this,n,r,this.game.renderer,s)},t.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.renderXY=function(e,t,n,r){this._temp.set(t,n),this.render(e,this._temp,r)},t.SpriteBatch=function(e,n,r,i){("undefined"==typeof n||null===n)&&(n=e.world),PIXI.SpriteBatch.call(this),t.Group.call(this,e,n,r,i),this.type=t.SPRITEBATCH},t.SpriteBatch.prototype=t.Utils.extend(!0,t.SpriteBatch.prototype,t.Group.prototype,PIXI.SpriteBatch.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.RetroFont=function(e,n,r,i,s,o,u,a,f,l){if(!e.cache.checkImageKey(n))return!1;("undefined"==typeof o||null===o)&&(o=e.cache.getImage(n).width/r),this.characterWidth=r,this.characterHeight=i,this.characterSpacingX=u||0,this.characterSpacingY=a||0,this.characterPerRow=o,this.offsetX=f||0,this.offsetY=l||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=e.cache.getImage(n),this._text="",this.grabData=[];for(var c=this.offsetX,h=this.offsetY,p=0,d=new t.FrameData,v=0;v<s.length;v++){var m=e.rnd.uuid(),g=d.addFrame(new t.Frame(v,c,h,this.characterWidth,this.characterHeight,"",m));this.grabData[s.charCodeAt(v)]=g.index,PIXI.TextureCache[m]=new PIXI.Texture(PIXI.BaseTextureCache[n],{x:c,y:h,width:this.characterWidth,height:this.characterHeight}),p++,p==this.characterPerRow?(p=0,c=this.offsetX,h+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX}e.cache.updateFrameData(n,d),this.stamp=new t.Image(e,0,0,n,0),t.RenderTexture.call(this,e,100,100,"",t.scaleModes.NEAREST),this.type=t.RETROFONT},t.RetroFont.prototype=Object.create(t.RenderTexture.prototype),t.RetroFont.prototype.constructor=t.RetroFont,t.RetroFont.ALIGN_LEFT="left",t.RetroFont.ALIGN_RIGHT="right",t.RetroFont.ALIGN_CENTER="center",t.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",t.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",t.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",t.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",t.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",t.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",t.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",t.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",t.RetroFont.prototype.setFixedWidth=function(e,t){"undefined"==typeof t&&(t="left"),this.fixedWidth=e,this.align=t},t.RetroFont.prototype.setText=function(e,t,n,r,i,s){this.multiLine=t||!1,this.customSpacingX=n||0,this.customSpacingY=r||0,this.align=i||"left",this.autoUpperCase=s?!1:!0,e.length>0&&(this.text=e)},t.RetroFont.prototype.buildRetroFontText=function(){var e=0,n=0;if(this.clear(),this.multiLine){var r=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var i=0;i<r.length;i++){switch(this.align){case t.RetroFont.ALIGN_LEFT:e=0;break;case t.RetroFont.ALIGN_RIGHT:e=this.width-r[i].length*(this.characterWidth+this.customSpacingX);break;case t.RetroFont.ALIGN_CENTER:e=this.width/2-r[i].length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2}0>e&&(e=0),this.pasteLine(r[i],e,n,this.customSpacingX),n+=this.characterHeight+this.customSpacingY}}else{switch(this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case t.RetroFont.ALIGN_LEFT:e=0;break;case t.RetroFont.ALIGN_RIGHT:e=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case t.RetroFont.ALIGN_CENTER:e=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2}this.textureBuffer.clear(),this.pasteLine(this._text,e,0,this.customSpacingX)}},t.RetroFont.prototype.pasteLine=function(e,n,r,i){for(var s=new t.Point,o=0;o<e.length;o++)if(" "==e.charAt(o))n+=this.characterWidth+i;else if(this.grabData[e.charCodeAt(o)]>=0&&(this.stamp.frame=this.grabData[e.charCodeAt(o)],s.set(n,r),this.render(this.stamp,s,!1),n+=this.characterWidth+i,n>this.width))break},t.RetroFont.prototype.getLongestLine=function(){var e=0;if(this._text.length>0)for(var t=this._text.split("\n"),n=0;n<t.length;n++)t[n].length>e&&(e=t[n].length);return e},t.RetroFont.prototype.removeUnsupportedCharacters=function(e){for(var t="",n=0;n<this._text.length;n++){var r=this._text[n],i=r.charCodeAt(0);(this.grabData[i]>=0||!e&&"\n"===r)&&(t=t.concat(r))}return t},t.RetroFont.prototype.updateOffset=function(e,t){if(this.offsetX!==e||this.offsetY!==t){for(var n=e-this.offsetX,r=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),s=i.length;s--;)i[s].x+=n,i[s].y+=r,PIXI.TextureCache[i[s].uuid].frame.x=i[s].x,PIXI.TextureCache[i[s].uuid].frame.y=i[s].y;this.buildRetroFontText()}},Object.defineProperty(t.RetroFont.prototype,"text",{get:function(){return this._text},set:function(e){var t;t=this.autoUpperCase?e.toUpperCase():e,t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(t.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(e){this.stamp.smoothed=e,this.buildRetroFontText()}}),t.Particle=function(e,n,r,i,s){t.Sprite.call(this,e,n,r,i,s),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},t.Particle.prototype=Object.create(t.Sprite.prototype),t.Particle.prototype.constructor=t.Particle,t.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},t.Particle.prototype.onEmit=function(){},t.Particle.prototype.setAlphaData=function(e){this.alphaData=e,this._a=e.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},t.Particle.prototype.setScaleData=function(e){this.scaleData=e,this._s=e.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},t.Particle.prototype.reset=function(e,t,n){return"undefined"==typeof n&&(n=1),this.world.setTo(e,t),this.position.x=e,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=n,this.body&&this.body.reset(e,t,!1,!1),this._cache[4]=1,this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},t.Canvas={create:function(e,t,n,r){"undefined"==typeof r&&(r=!1),e=e||256,t=t||256;var i=document.createElement("canvas");return"string"==typeof n&&""!==n&&(i.id=n),i.width=e,i.height=t,i.style.display="block",i},getOffset:function(e,n){n=n||new t.Point;var r=e.getBoundingClientRect(),i=e.clientTop||document.body.clientTop||0,s=e.clientLeft||document.body.clientLeft||0,o=0,u=0;return"CSS1Compat"===document.compatMode?(o=window.pageYOffset||document.documentElement.scrollTop||e.scrollTop||0,u=window.pageXOffset||document.documentElement.scrollLeft||e.scrollLeft||0):(o=window.pageYOffset||document.body.scrollTop||e.scrollTop||0,u=window.pageXOffset||document.body.scrollLeft||e.scrollLeft||0),n.x=r.left+u-s,n.y=r.top+o-i,n},getAspectRatio:function(e){return e.width/e.height},setBackgroundColor:function(e,t){return t=t||"rgb(0,0,0)",e.style.backgroundColor=t,e},setTouchAction:function(e,t){return t=t||"none",e.style.msTouchAction=t,e.style["ms-touch-action"]=t,e.style["touch-action"]=t,e},setUserSelect:function(e,t){return t=t||"none",e.style["-webkit-touch-callout"]=t,e.style["-webkit-user-select"]=t,e.style["-khtml-user-select"]=t,e.style["-moz-user-select"]=t,e.style["-ms-user-select"]=t,e.style["user-select"]=t,e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",e},addToDOM:function(e,t,n){var r;return"undefined"==typeof n&&(n=!0),t&&("string"==typeof t?r=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(r=t)),r||(r=document.body),n&&r.style&&(r.style.overflow="hidden"),r.appendChild(e),e},setTransform:function(e,t,n,r,i,s,o){return e.setTransform(r,s,o,i,t,n),e},setSmoothingEnabled:function(e,t){return e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.oImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t,e},setImageRenderingCrisp:function(e){return e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style.msInterpolationMode="nearest-neighbor",e},setImageRenderingBicubic:function(e){return e.style["image-rendering"]="auto",e.style.msInterpolationMode="bicubic",e}},t.Device=function(e){this.game=e,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.touch=!1,this.mspointer=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!1,this.quirksMode=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1,this._checkOS(),this._checkAudio(),this._checkBrowser(),this._checkCSS3D(),this._checkDevice(),this._checkFeatures()},t.Device.LITTLE_ENDIAN=!1,t.Device.prototype={_checkOS:function(){var e=navigator.userAgent;/Android/.test(e)?this.android=!0:/CrOS/.test(e)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?this.iOS=!0:/Linux/.test(e)?this.linux=!0:/Mac OS/.test(e)?this.macOS=!0:/Windows/.test(e)&&(this.windows=!0,/Windows Phone/i.test(e)&&(this.windowsPhone=!0)),(this.windows||this.macOS||this.linux&&this.silk===!1)&&(this.desktop=!0),(this.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(this.desktop=!1)},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(e){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.webGL=function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),this.webGL=null===this.webGL||this.webGL===!1?!1:!0,this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)&&(this.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(this.mspointer=!0),this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.quirksMode="CSS1Compat"===document.compatMode?!1:!0,this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){for(var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],t=0;t<e.length;t++)if(this.game.canvas[e[t]]){this.fullscreen=!0,this.requestFullscreen=e[t];break}var n=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(this.fullscreen)for(var t=0;t<n.length;t++)if(document[n[t]]){this.cancelFullscreen=n[t];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.fullscreenKeyboard=!0)},_checkBrowser:function(){var e=navigator.userAgent;/Arora/.test(e)?this.arora=!0:/Chrome/.test(e)?this.chrome=!0:/Epiphany/.test(e)?this.epiphany=!0:/Firefox/.test(e)?this.firefox=!0:/AppleWebKit/.test(e)&&this.iOS?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(e)?this.midori=!0:/Opera/.test(e)?this.opera=!0:/Safari/.test(e)?this.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)&&(this.ie=!0,this.trident=!0,this.tridentVersion=parseInt(RegExp.$1,10),this.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(e)&&(this.silk=!0),navigator.standalone&&(this.webApp=!0),navigator.isCocoonJS&&(this.cocoonJS=!0),"undefined"!=typeof window.ejecta&&(this.ejecta=!0),/Crosswalk/.test(e)&&(this.crosswalk=!0)},_checkAudio:function(){this.audioData=!!window.Audio,this.webAudio=!!window.webkitAudioContext||!!window.AudioContext;var e=document.createElement("audio"),t=!1;try{(t=!!e.canPlayType)&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")&&(this.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0),e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0))}catch(n){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2==this.pixelRatio&&this.iPhone,this.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),this.typedArray="undefined"!=typeof Int8Array?!0:!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(this.littleEndian=this._checkIsLittleEndian(),t.Device.LITTLE_ENDIAN=this.littleEndian),this.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==this.littleEndian&&this._checkIsUint8ClampedImageData(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(this.vibration=!0)},_checkIsLittleEndian:function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,3569595041==n[0]?!0:2712847316==n[0]?!1:null},_checkIsUint8ClampedImageData:function(){if("undefined"==typeof Uint8ClampedArray)return!1;var e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return!1;var n=t.createImageData(1,1);return n.data instanceof Uint8ClampedArray},_checkCSS3D:function(){var e,t=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(t,null);for(var r in n)void 0!==t.style[r]&&(t.style[r]="translate3d(1px,1px,1px)",e=window.getComputedStyle(t).getPropertyValue(n[r]));document.body.removeChild(t),this.css3D=void 0!==e&&e.length>0&&"none"!==e},canPlayAudio:function(e){return"mp3"==e&&this.mp3?!0:"ogg"==e&&(this.ogg||this.opus)?!0:"m4a"==e&&this.m4a?!0:"wav"==e&&this.wav?!0:"webm"==e&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1}},t.Device.prototype.constructor=t.Device,t.RequestAnimationFrame=function(e,t){"undefined"==typeof t&&(t=!1),this.game=e,this.isRunning=!1,this.forceSetTimeOut=t;for(var n=["ms","moz","webkit","o"],r=0;r<n.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},t.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var e=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(){this.game.update(Date.now()),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},t.RequestAnimationFrame.prototype.constructor=t.RequestAnimationFrame,t.Math={PI2:2*Math.PI,fuzzyEqual:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),Math.abs(e-t)<n},fuzzyLessThan:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),t+n>e},fuzzyGreaterThan:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),e>t-n},fuzzyCeil:function(e,t){return"undefined"==typeof t&&(t=1e-4),Math.ceil(e-t)},fuzzyFloor:function(e,t){return"undefined"==typeof t&&(t=1e-4),Math.floor(e+t)},average:function(){for(var e=[],t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];for(var n=0,r=0;r<e.length;r++)n+=e[r];return n/e.length},truncate:function(e){return e>0?Math.floor(e):Math.ceil(e)},shear:function(e){return e%1},snapTo:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.round(e/t),n+e)},snapToFloor:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.floor(e/t),n+e)},snapToCeil:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.ceil(e/t),n+e)},snapToInArray:function(e,t,n){if("undefined"==typeof n&&(n=!0),n&&t.sort(),e<t[0])return t[0];for(var r=1;t[r]<e;)r++;var i=t[r-1],s=r<t.length?t[r]:Number.POSITIVE_INFINITY;return e-i>=s-e?s:i},roundTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.round(e*r)/r},floorTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.floor(e*r)/r},ceilTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.ceil(e*r)/r},interpolateFloat:function(e,t,n){return(t-e)*n+e},angleBetween:function(e,t,n,r){return Math.atan2(r-t,n-e)},angleBetweenPoints:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},reverseAngle:function(e){return this.normalizeAngle(e+Math.PI,!0)},normalizeAngle:function(e){return e%=2*Math.PI,e>=0?e:e+2*Math.PI},normalizeLatitude:function(e){return Math.max(-90,Math.min(90,e))},normalizeLongitude:function(e){return e%360==180?180:(e%=360,-180>e?e+360:e>180?e-360:e)},chanceRoll:function(e){return"undefined"==typeof e&&(e=50),0>=e?!1:e>=100?!0:100*Math.random()>=e?!1:!0},numberArray:function(e,t){for(var n=[],r=e;t>=r;r++)n.push(r);return n},maxAdd:function(e,t,n){return e+=t,e>n&&(e=n),e},minSub:function(e,t,n){return e-=t,n>e&&(e=n),e},wrap:function(e,t,n){var r=n-t;if(0>=r)return 0;var i=(e-t)%r;return 0>i&&(i+=r),i+t},wrapValue:function(e,t,n){var r;return e=Math.abs(e),t=Math.abs(t),n=Math.abs(n),r=(e+t)%n},limitValue:function(e,t,n){return t>e?t:e>n?n:e},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(e){return 1&e},isEven:function(e){return 1&e?!1:!0},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;r>t;t++)e[t]<e[n]&&(n=t);return e[n]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;r>t;t++)e[t]>e[n]&&(n=t);return e[n]},minProperty:function(e){if(2===arguments.length&&"object"==typeof arguments[1])var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;i>n;n++)t[n][e]<t[r][e]&&(r=n);return t[r][e]},maxProperty:function(e){if(2===arguments.length&&"object"==typeof arguments[1])var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;i>n;n++)t[n][e]>t[r][e]&&(r=n);return t[r][e]},wrapAngle:function(e,t){var n=t?Math.PI/180:1;return this.wrap(e,-180*n,180*n)},angleLimit:function(e,t,n){var r=e;return e>n?r=n:t>e&&(r=t),r},linearInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return 0>t?this.linear(e[0],e[1],r):t>1?this.linear(e[n],e[n-1],n-r):this.linear(e[i],e[i+1>n?n:i+1],r-i)},bezierInterpolation:function(e,t){for(var n=0,r=e.length-1,i=0;r>=i;i++)n+=Math.pow(1-t,r-i)*Math.pow(t,i)*e[i]*this.bernstein(r,i);return n},catmullRomInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return e[0]===e[n]?(0>t&&(i=Math.floor(r=n*(1+t))),this.catmullRom(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):0>t?e[0]-(this.catmullRom(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(this.catmullRom(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):this.catmullRom(e[i?i-1:0],e[i],e[i+1>n?n:i+1],e[i+2>n?n:i+2],r-i)},linear:function(e,t,n){return(t-e)*n+e},bernstein:function(e,t){return this.factorial(e)/this.factorial(t)/this.factorial(e-t)},factorial:function(e){if(0===e)return 1;for(var t=e;--e;)t*=e;return t},catmullRom:function(e,t,n,r,i){var s=.5*(n-e),o=.5*(r-t),u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t},difference:function(e,t){return Math.abs(e-t)},getRandom:function(e,t,n){if("undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),null!=e){var r=n;if((0===r||r>e.length-t)&&(r=e.length-t),r>0)return e[t+Math.floor(Math.random()*r)]}return null},removeRandom:function(e,t,n){if("undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),null!=e){var r=n;if((0===r||r>e.length-t)&&(r=e.length-t),r>0){var i=t+Math.floor(Math.random()*r),s=e.splice(i,1);return s[0]}}return null},floor:function(e){var t=0|e;return e>0?t:t!=e?t-1:t},ceil:function(e){var t=0|e;return e>0&&t!=e?t+1:t},sinCosGenerator:function(e,t,n,r){"undefined"==typeof t&&(t=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1);for(var i=t,s=n,o=r*Math.PI/e,u=[],a=[],f=0;e>f;f++)s-=i*o,i+=s*o,u[f]=s,a[f]=i;return{sin:a,cos:u,length:e}},shift:function(e){var t=e.shift();return e.push(t),t},shuffleArray:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},distance:function(e,t,n,r){var i=e-n,s=t-r;return Math.sqrt(i*i+s*s)},distancePow:function(e,t,n,r,i){return"undefined"==typeof i&&(i=2),Math.sqrt(Math.pow(n-e,i)+Math.pow(r-t,i))},distanceRounded:function(e,n,r,i){return Math.round(t.Math.distance(e,n,r,i))},clamp:function(e,t,n){return t>e?t:e>n?n:e},clampBottom:function(e,t){return t>e?t:e},within:function(e,t,n){return Math.abs(e-t)<=n},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*(3-2*e)},smootherstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*e*(e*(6*e-15)+10)},sign:function(e){return 0>e?-1:e>0?1:0},percent:function(e,t,n){return"undefined"==typeof n&&(n=0),e>t||n>t?1:n>e||n>e?0:(e-n)/t},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},t.RandomDataGenerator=function(e){"undefined"==typeof e&&(e=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,this.sow(e)},t.RandomDataGenerator.prototype={rnd:function(){var e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|e,this.s0=this.s1,this.s1=this.s2,this.s2=e-this.c,this.s2},sow:function(e){"undefined"==typeof e&&(e=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1;for(var t,n=0;t=e[n++];)this.s0-=this.hash(t),this.s0+=~~(this.s0<0),this.s1-=this.hash(t),this.s1+=~~(this.s1<0),this.s2-=this.hash(t),this.s2+=~~(this.s2<0)},hash:function(e){var t,n,r;for(r=4022871197,e=e.toString(),n=0;n<e.length;n++)r+=e.charCodeAt(n),t=.02519603282416938*r,r=t>>>0,t-=r,t*=r,r=t>>>0,t-=r,r+=4294967296*t;return 2.3283064365386963e-10*(r>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(e,t){return Math.floor(this.realInRange(0,t-e+1)+e)},between:function(e,t){return this.integerInRange(e,t)},realInRange:function(e,t){return this.frac()*(t-e)+e},normal:function(){return 1-2*this.frac()},uuid:function(){var e="",t="";for(t=e="";e++<36;t+=~e%5|3*e&4?(15^e?8^this.frac()*(20^e?16:4):4).toString(16):"-");return t},pick:function(e){return e[this.integerInRange(0,e.length-1)]},weightedPick:function(e){return e[~~(Math.pow(this.frac(),2)*(e.length-1))]},timestamp:function(e,t){return this.realInRange(e||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},t.RandomDataGenerator.prototype.constructor=t.RandomDataGenerator,t.QuadTree=function(e,t,n,r,i,s,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(e,t,n,r,i,s,o)},t.QuadTree.prototype={reset:function(e,t,n,r,i,s,o){this.maxObjects=i||10,this.maxLevels=s||4,this.level=o||0,this.bounds={x:Math.round(e),y:Math.round(t),width:n,height:r,subWidth:Math.floor(n/2),subHeight:Math.floor(r/2),right:Math.round(e)+Math.floor(n/2),bottom:Math.round(t)+Math.floor(r/2)},this.objects.length=0,this.nodes.length=0},populate:function(e){e.forEach(this.populateHandler,this,!0)},populateHandler:function(e){e.body&&e.exists&&this.insert(e.body)},split:function(){this.nodes[0]=new t.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new t.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new t.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new t.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(e){var t,n=0;if(null!=this.nodes[0]&&(t=this.getIndex(e),-1!==t))return void this.nodes[t].insert(e);if(this.objects.push(e),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();n<this.objects.length;)t=this.getIndex(this.objects[n]),-1!==t?this.nodes[t].insert(this.objects.splice(n,1)[0]):n++},getIndex:function(e){var t=-1;return e.x<this.bounds.right&&e.right<this.bounds.right?e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=1:e.y>this.bounds.bottom&&(t=2):e.x>this.bounds.right&&(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=0:e.y>this.bounds.bottom&&(t=3)),t},retrieve:function(e){if(e instanceof t.Rectangle)var n=this.objects,r=this.getIndex(e);else{if(!e.body)return this._empty;var n=this.objects,r=this.getIndex(e.body)}return this.nodes[0]&&(-1!==r?n=n.concat(this.nodes[r].retrieve(e)):(n=n.concat(this.nodes[0].retrieve(e)),n=n.concat(this.nodes[1].retrieve(e)),n=n.concat(this.nodes[2].retrieve(e)),n=n.concat(this.nodes[3].retrieve(e)))),n},clear:function(){this.objects.length=0;for(var e=this.nodes.length;e--;)this.nodes[e].clear(),this.nodes.splice(e,1);this.nodes.length=0}},t.QuadTree.prototype.constructor=t.QuadTree,t.Net=function(e){this.game=e},t.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(e){return-1!==window.location.hostname.indexOf(e)},updateQueryString:function(e,t,n,r){"undefined"==typeof n&&(n=!1),("undefined"==typeof r||""===r)&&(r=window.location.href);var i="",s=new RegExp("([?|&])"+e+"=.*?(&|#|$)(.*)","gi");if(s.test(r))i="undefined"!=typeof t&&null!==t?r.replace(s,"$1"+e+"="+t+"$2$3"):r.replace(s,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof t&&null!==t){var o=-1!==r.indexOf("?")?"&":"?",u=r.split("#");r=u[0]+o+e+"="+t,u[1]&&(r+="#"+u[1]),i=r}else i=r;return n?void (window.location.href=i):i},getQueryString:function(e){"undefined"==typeof e&&(e="");var t={},n=location.search.substring(1).split("&");for(var r in n){var i=n[r].split("=");if(i.length>1){if(e&&e==this.decodeURI(i[0]))return this.decodeURI(i[1]);t[this.decodeURI(i[0])]=this.decodeURI(i[1])}}return t},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},t.Net.prototype.constructor=t.Net,t.TweenManager=function(e){this.game=e,this._tweens=[],this._add=[],this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},t.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].pendingDelete=!0;this._add=[]},add:function(e){e._manager=this,this._add.push(e)},create:function(e){return new t.Tween(e,this.game,this)},remove:function(e){var t=this._tweens.indexOf(e);-1!==t?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(e),-1!==t&&(this._add[t].pendingDelete=!0))},update:function(){var e=this._add.length,t=this._tweens.length;if(0===t&&0===e)return!1;for(var n=0;t>n;)this._tweens[n].update(this.game.time.now)?n++:(this._tweens.splice(n,1),t--);return e>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(e){return this._tweens.some(function(t){return t._object===e})},_pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._pause()},_resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._resume()},pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].pause()},resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].resume(!0)}},t.TweenManager.prototype.constructor=t.TweenManager,t.Tween=function(e,n,r){this._object=e,this.game=n,this._manager=r,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=t.Easing.Linear.None,this._interpolationFunction=t.Math.linearInterpolation,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._paused=!1,this._pausedTime=0,this._codePaused=!1,this.pendingDelete=!1,this.onStart=new t.Signal,this.onLoop=new t.Signal,this.onComplete=new t.Signal,this.isRunning=!1},t.Tween.prototype={to:function(e,t,n,r,i,s,o){t=t||1e3,n=n||null,r=r||!1,i=i||0,s=s||0,o=o||!1,o&&0===s&&(s=1);var u;return this._parent?(u=this._manager.create(this._object),this._lastChild.chain(u),this._lastChild=u):(u=this,this._parent=this,this._lastChild=this),u._repeat=s,u._duration=t,u._valuesEnd=e,null!==n&&(u._easingFunction=n),i>0&&(u._delayTime=i),u._yoyo=o,r?this.start():this},from:function(e,t,n,r,i,s,o){var u={};for(var a in e)u[a]=this._object[a],this._object[a]=e[a];return this.to(u,t,n,r,i,s,o)},start:function(){if(null!==this.game&&null!==this._object){this._manager.add(this),this.isRunning=!0,this._onStartCallbackFired=!1,this._startTime=this.game.time.now+this._delayTime;for(var e in this._valuesEnd){if(Array.isArray(this._valuesEnd[e])){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],Array.isArray(this._valuesStart[e])||(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}},generateData:function(e,t){if(null===this.game||null===this._object)return null;this._startTime=0;for(var n in this._valuesEnd){if(Array.isArray(this._valuesEnd[n])){if(0===this._valuesEnd[n].length)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}this._valuesStart[n]=this._object[n],Array.isArray(this._valuesStart[n])||(this._valuesStart[n]*=1),this._valuesStartRepeat[n]=this._valuesStart[n]||0}for(var r=0,i=Math.floor(e*(this._duration/1e3)),s=this._duration/i,o=[];i--;){var n,u=(r-this._startTime)/this._duration;u=u>1?1:u;var a=this._easingFunction(u),f={};for(n in this._valuesEnd){var l=this._valuesStart[n]||0,c=this._valuesEnd[n];c instanceof Array?f[n]=this._interpolationFunction(c,a):("string"==typeof c&&(c=l+parseFloat(c,10)),"number"==typeof c&&(f[n]=l+(c-l)*a))}o.push(f),r+=s}if(this._yoyo){var h=o.slice();h.reverse(),o=o.concat(h)}return"undefined"!=typeof t?t=t.concat(o):o},stop:function(){return this.isRunning=!1,this._onUpdateCallback=null,this._manager.remove(this),this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},yoyo:function(e){return this._yoyo=e,e&&0===this._repeat&&(this._repeat=1),this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._lastChild.chain(this),this},onUpdateCallback:function(e,t){return this._onUpdateCallback=e,this._onUpdateCallbackContext=t,this},pause:function(){this._codePaused=!0,this._paused=!0,this._pausedTime=this.game.time.now},_pause:function(){this._codePaused||(this._paused=!0,this._pausedTime=this.game.time.now)},resume:function(){this._paused&&(this._paused=!1,this._codePaused=!1,this._startTime+=this.game.time.now-this._pausedTime)},_resume:function(){this._codePaused||(this._startTime+=this.game.time.pauseDuration,this._paused=!1)},update:function(e){if(this.pendingDelete)return!1;if(this._paused||e<this._startTime)return!0;var t;if(e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this.onStart.dispatch(this._object),this._onStartCallbackFired=!0);var n=(e-this._startTime)/this._duration;n=n>1?1:n;var r=this._easingFunction(n);for(t in this._valuesEnd){var i=this._valuesStart[t]||0,s=this._valuesEnd[t];s instanceof Array?this._object[t]=this._interpolationFunction(s,r):("string"==typeof s&&(s=i+parseFloat(s,10)),"number"==typeof s&&(this._object[t]=i+(s-i)*r))}if(null!==this._onUpdateCallback&&(this._onUpdateCallback.call(this._onUpdateCallbackContext,this,r),!this.isRunning))return!1;if(1==n){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10)),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=e+this._delayTime,this.onLoop.dispatch(this._object),!0}this.isRunning=!1,this.onComplete.dispatch(this._object);for(var u=0,a=this._chainedTweens.length;a>u;u++)this._chainedTweens[u].start(e);return!1}return!0}},t.Tween.prototype.constructor=t.Tween,t.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)))},Out:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/r)+1)},InOut:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-t.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*t.Easing.Bounce.In(2*e):.5*t.Easing.Bounce.Out(2*e-1)+.5}}},t.Time=function(e){this.game=e,this.time=0,this.now=0,this.elapsed=0,this.pausedTime=0,this.advancedTiming=!1,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.physicsElapsed=0,this.deltaCap=0,this.timeCap=1e3,this.frames=0,this.pauseDuration=0,this.timeToCall=0,this.lastTime=0,this.events=new t.Timer(this.game,!1),this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[],this._len=0,this._i=0},t.Time.prototype={boot:function(){this._started=Date.now(),this.events.start()},add:function(e){return this._timers.push(e),e},create:function(e){"undefined"==typeof e&&(e=!0);var n=new t.Timer(this.game,e);return this._timers.push(n),n},removeAll:function(){for(var e=0;e<this._timers.length;e++)this._timers[e].destroy();this._timers=[],this.events.removeAll()},update:function(e){if(this.now=e,this.timeToCall=this.game.math.max(0,16-(e-this.lastTime)),this.elapsed=this.now-this.time,this.elapsed>this.timeCap&&(this.elapsed=1/60),this.physicsElapsed=this.elapsed/1e3||1/60,this.deltaCap>0&&this.physicsElapsed>this.deltaCap&&(this.physicsElapsed=this.deltaCap),this.advancedTiming&&(this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),this.time=this.now,this.lastTime=e+this.timeToCall,!this.game.paused)for(this.events.update(this.now),this._i=0,this._len=this._timers.length;this._i<this._len;)this._timers[this._i].update(this.now)?this._i++:(this._timers.splice(this._i,1),this._len--)},gamePaused:function(){this._pauseStarted=this.now,this.events.pause();for(var e=this._timers.length;e--;)this._timers[e]._pause()},gameResumed:function(){this.time=this.now=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var e=this._timers.length;e--;)this._timers[e]._resume()},totalElapsedSeconds:function(){return.001*(this.now-this._started)},elapsedSince:function(e){return this.now-e},elapsedSecondsSince:function(e){return.001*(this.now-e)},reset:function(){this._started=this.now,this.removeAll()}},t.Time.prototype.constructor=t.Time,t.Timer=function(e,n){"undefined"==typeof n&&(n=!0),this.game=e,this.running=!1,this.autoDestroy=n,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new t.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},t.Timer.MINUTE=6e4,t.Timer.SECOND=1e3,t.Timer.HALF=500,t.Timer.QUARTER=250,t.Timer.prototype={create:function(e,n,r,i,s,o){var u=e;u+=0===this._now?this.game.time.now:this._now;var a=new t.TimerEvent(this,e,u,r,n,i,s,o);return this.events.push(a),this.order(),this.expired=!1,a},add:function(e,t,n){return this.create(e,!1,0,t,n,Array.prototype.splice.call(arguments,3))},repeat:function(e,t,n,r){return this.create(e,!1,t,n,r,Array.prototype.splice.call(arguments,4))},loop:function(e,t,n){return this.create(e,!0,0,t,n,Array.prototype.splice.call(arguments,3))},start:function(e){if(!this.running){this._started=this.game.time.now+(e||0),this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(e){this.running=!1,"undefined"==typeof e&&(e=!0),e&&(this.events.length=0)},remove:function(e){for(var t=0;t<this.events.length;t++)if(this.events[t]===e)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(e,t){return e.tick<t.tick?-1:e.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(e){if(this.paused)return!0;if(this.elapsed=e-this._now,this._now=e,this.elapsed>this.timeCap&&this.adjustEvents(e-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.now,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.now,this.paused=!0)},adjustEvents:function(e){for(var t=0;t<this.events.length;t++)if(!this.events[t].pendingDelete){var n=this.events[t].tick-e;0>n&&(n=0),this.events[t].tick=this._now+n}var r=this.nextTick-e;this.nextTick=0>r?this._now:this._now+r},resume:function(){if(this.paused){var e=this.game.time.now;this._pauseTotal+=e-this._now,this._now=e,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(t.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(t.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(t.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(t.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(t.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),t.Timer.prototype.constructor=t.Timer,t.TimerEvent=function(e,t,n,r,i,s,o,u){this.timer=e,this.delay=t,this.tick=n,this.repeatCount=r-1,this.loop=i,this.callback=s,this.callbackContext=o,this.args=u,this.pendingDelete=!1},t.TimerEvent.prototype.constructor=t.TimerEvent,t.AnimationManager=function(e){this.sprite=e,this.game=e.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},t.AnimationManager.prototype={loadFrameData:function(e,t){if(this.isLoaded)for(var n in this._anims)this._anims[n].updateFrameData(e);return this._frameData=e,"undefined"==typeof t||null===t?this.frame=0:"string"==typeof t?this.frameName=t:this.frame=t,this.isLoaded=!0,this._frameData?!0:!1},add:function(e,n,r,i,s){return null===this._frameData?void console.warn("No FrameData available for Phaser.Animation "+e):(n=n||[],r=r||60,"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=n&&"number"==typeof n[0]?!0:!1),null===this.sprite.events.onAnimationStart&&(this.sprite.events.onAnimationStart=new t.Signal,this.sprite.events.onAnimationComplete=new t.Signal,this.sprite.events.onAnimationLoop=new t.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(n,s,this._outputFrames),this._anims[e]=new t.Animation(this.game,this.sprite,e,this._frameData,this._outputFrames,r,i),this.currentAnim=this._anims[e],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[e])},validateFrames:function(e,t){"undefined"==typeof t&&(t=!0);for(var n=0;n<e.length;n++)if(t===!0){if(e[n]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(e[n])===!1)return!1;return!0},play:function(e,t,n,r){return this._anims[e]?this.currentAnim===this._anims[e]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,n,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[e],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,n,r)):void 0},stop:function(e,t){"undefined"==typeof t&&(t=!1),"string"==typeof e?this._anims[e]&&(this.currentAnim=this._anims[e],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()===!0?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(e){this.currentAnim&&(this.currentAnim.next(e),this.currentFrame=this.currentAnim.currentFrame)},previous:function(e){this.currentAnim&&(this.currentAnim.previous(e),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(e){return"string"==typeof e&&this._anims[e]?this._anims[e]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var e=null;for(var e in this._anims)this._anims.hasOwnProperty(e)&&this._anims[e].destroy();this._anims={},this._frameData=null,this._frameIndex=0,this.currentAnim=null,this.currentFrame=null}},t.AnimationManager.prototype.constructor=t.AnimationManager,Object.defineProperty(t.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(t.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData?this._frameData.total:-1}}),Object.defineProperty(t.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(e){this.currentAnim.paused=e}}),Object.defineProperty(t.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this._frameIndex:void 0},set:function(e){"number"==typeof e&&this._frameData&&null!==this._frameData.getFrame(e)&&(this.currentFrame=this._frameData.getFrame(e),this.currentFrame&&(this._frameIndex=e,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(t.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(e){"string"==typeof e&&this._frameData&&null!==this._frameData.getFrameByName(e)?(this.currentFrame=this._frameData.getFrameByName(e),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+e)}}),t.Animation=function(e,n,r,i,s,o,u){this.game=e,this._parent=n,this._frameData=i,this.name=r,this._frames=[],this._frames=this._frames.concat(s),this.delay=1e3/o,this.loop=u,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new t.Signal,this.onComplete=new t.Signal,this.onLoop=new t.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},t.Animation.prototype={play:function(e,t,n){return"number"==typeof e&&(this.delay=1e3/e),"boolean"==typeof t&&(this.loop=t),"undefined"!=typeof n&&(this.killOnComplete=n),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this._parent.events.onAnimationStart.dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this.onStart.dispatch(this._parent,this)},setFrame:function(e,t){var n;if("undefined"==typeof t&&(t=!1),"string"==typeof e)for(var r=0;r<this._frames.length;r++)this._frameData.getFrame(this._frames[r]).name===e&&(n=r);else if("number"==typeof e)if(t)n=e;else for(var r=0;r<this._frames.length;r++)this.frames[r]===n&&(n=r);n&&(this._frameIndex=n-1,this._timeNextFrame=this.game.time.now,this.update())},stop:function(e,t){"undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,e&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t&&(this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.now)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.now+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.now>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.now-this._timeNextFrame,this._timeLastFrame=this.game.time.now,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length&&(this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop.dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this)):this.complete()),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),!0):!1},next:function(e){"undefined"==typeof e&&(e=1);var t=this._frameIndex+e;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)))},previous:function(e){"undefined"==typeof e&&(e=1);var t=this._frameIndex-e;0>t&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)))},updateFrameData:function(e){this._frameData=e,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose()},complete:function(){this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},t.Animation.prototype.constructor=t.Animation,Object.defineProperty(t.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(e){this.isPaused=e,e?this._pauseStartTime=this.game.time.now:this.isPlaying&&(this._timeNextFrame=this.game.time.now+this.delay)}}),Object.defineProperty(t.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(t.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(e){this.currentFrame=this._frameData.getFrame(this._frames[e]),null!==this.currentFrame&&(this._frameIndex=e,this._parent.setFrame(this.currentFrame))}}),Object.defineProperty(t.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(e){e>=1&&(this.delay=1e3/e)}}),t.Animation.generateFrameNames=function(e,n,r,i,s){"undefined"==typeof i&&(i="");var o=[],u="";if(r>n)for(var a=n;r>=a;a++)u="number"==typeof s?t.Utils.pad(a.toString(),s,"0",1):a.toString(),u=e+u+i,o.push(u);else for(var a=n;a>=r;a--)u="number"==typeof s?t.Utils.pad(a.toString(),s,"0",1):a.toString(),u=e+u+i,o.push(u);return o},t.Frame=function(e,n,r,i,s,o,u){this.index=e,this.x=n,this.y=r,this.width=i,this.height=s,this.name=o,this.uuid=u,this.centerX=Math.floor(i/2),this.centerY=Math.floor(s/2),this.distance=t.Math.distance(0,0,i,s),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=i,this.sourceSizeH=s,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},t.Frame.prototype={setTrim:function(e,t,n,r,i,s,o){this.trimmed=e,e&&(this.sourceSizeW=t,this.sourceSizeH=n,this.centerX=Math.floor(t/2),this.centerY=Math.floor(n/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)},getRect:function(e){return"undefined"==typeof e?e=new t.Rectangle(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e}},t.Frame.prototype.constructor=t.Frame,t.FrameData=function(){this._frames=[],this._frameNames=[]},t.FrameData.prototype={addFrame:function(e){return e.index=this._frames.length,this._frames.push(e),""!==e.name&&(this._frameNames[e.name]=e.index),e},getFrame:function(e){return e>this._frames.length&&(e=0),this._frames[e]},getFrameByName:function(e){return"number"==typeof this._frameNames[e]?this._frames[this._frameNames[e]]:null},checkFrameName:function(e){return null==this._frameNames[e]?!1:!0},getFrameRange:function(e,t,n){"undefined"==typeof n&&(n=[]);for(var r=e;t>=r;r++)n.push(this._frames[r]);return n},getFrames:function(e,t,n){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=[]),"undefined"==typeof e||0===e.length)for(var r=0;r<this._frames.length;r++)n.push(this._frames[r]);else for(var r=0,i=e.length;i>r;r++)n.push(t?this.getFrame(e[r]):this.getFrameByName(e[r]));return n},getFrameIndexes:function(e,t,n){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=[]),"undefined"==typeof e||0===e.length)for(var r=0,i=this._frames.length;i>r;r++)n.push(this._frames[r].index);else for(var r=0,i=e.length;i>r;r++)t?n.push(e[r]):this.getFrameByName(e[r])&&n.push(this.getFrameByName(e[r]).index);return n}},t.FrameData.prototype.constructor=t.FrameData,Object.defineProperty(t.FrameData.prototype,"total",{get:function(){return this._frames.length}}),t.AnimationParser={spriteSheet:function(e,n,r,i,s,o,u){var a=e.cache.getImage(n);if(null==a)return null;var f=a.width,l=a.height;0>=r&&(r=Math.floor(-f/Math.min(-1,r))),0>=i&&(i=Math.floor(-l/Math.min(-1,i)));var c=Math.floor((f-o)/(r+u)),h=Math.floor((l-o)/(i+u)),p=c*h;if(-1!==s&&(p=s),0===f||0===l||r>f||i>l||0===p)return console.warn("Phaser.AnimationParser.spriteSheet: '"+n+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var d=new t.FrameData,v=o,m=o,g=0;p>g;g++){var y=e.rnd.uuid();d.addFrame(new t.Frame(g,v,m,r,i,"",y)),PIXI.TextureCache[y]=new PIXI.Texture(PIXI.BaseTextureCache[n],{x:v,y:m,width:r,height:i}),v+=r+u,v+r>f&&(v=o,m+=i+u)}return d},JSONData:function(e,n,r){if(!n.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(n);for(var i,s=new t.FrameData,o=n.frames,u=0;u<o.length;u++){var a=e.rnd.uuid();i=s.addFrame(new t.Frame(u,o[u].frame.x,o[u].frame.y,o[u].frame.w,o[u].frame.h,o[u].filename,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:o[u].frame.x,y:o[u].frame.y,width:o[u].frame.w,height:o[u].frame.h}),o[u].trimmed&&i.setTrim(o[u].trimmed,o[u].sourceSize.w,o[u].sourceSize.h,o[u].spriteSourceSize.x,o[u].spriteSourceSize.y,o[u].spriteSourceSize.w,o[u].spriteSourceSize.h)}return s},JSONDataHash:function(e,n,r){if(!n.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(n);var i,s=new t.FrameData,o=n.frames,u=0;for(var a in o){var f=e.rnd.uuid();i=s.addFrame(new t.Frame(u,o[a].frame.x,o[a].frame.y,o[a].frame.w,o[a].frame.h,a,f)),PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:o[a].frame.x,y:o[a].frame.y,width:o[a].frame.w,height:o[a].frame.h}),o[a].trimmed&&i.setTrim(o[a].trimmed,o[a].sourceSize.w,o[a].sourceSize.h,o[a].spriteSourceSize.x,o[a].spriteSourceSize.y,o[a].spriteSourceSize.w,o[a].spriteSourceSize.h),u++}return s},XMLData:function(e,n,r){if(!n.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var i,s,o,u,a,f,l,c,h,p,d,v,m=new t.FrameData,g=n.getElementsByTagName("SubTexture"),y=0;y<g.length;y++)s=e.rnd.uuid(),u=g[y].attributes,o=u.name.nodeValue,a=parseInt(u.x.nodeValue,10),f=parseInt(u.y.nodeValue,10),l=parseInt(u.width.nodeValue,10),c=parseInt(u.height.nodeValue,10),h=null,p=null,u.frameX&&(h=Math.abs(parseInt(u.frameX.nodeValue,10)),p=Math.abs(parseInt(u.frameY.nodeValue,10)),d=parseInt(u.frameWidth.nodeValue,10),v=parseInt(u.frameHeight.nodeValue,10)),i=m.addFrame(new t.Frame(y,a,f,l,c,o,s)),PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:a,y:f,width:l,height:c}),(null!==h||null!==p)&&i.setTrim(!0,l,c,h,p,d,v);return m}},t.Cache=function(e){this.game=e,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._json={},this._physics={},this._tilemaps={},this._binary={},this._bitmapDatas={},this._bitmapFont={},this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new t.Signal,this._cacheMap=[],this._cacheMap[t.Cache.CANVAS]=this._canvases,this._cacheMap[t.Cache.IMAGE]=this._images,this._cacheMap[t.Cache.TEXTURE]=this._textures,this._cacheMap[t.Cache.SOUND]=this._sounds,this._cacheMap[t.Cache.TEXT]=this._text,this._cacheMap[t.Cache.PHYSICS]=this._physics,this._cacheMap[t.Cache.TILEMAP]=this._tilemaps,this._cacheMap[t.Cache.BINARY]=this._binary,this._cacheMap[t.Cache.BITMAPDATA]=this._bitmapDatas,this._cacheMap[t.Cache.BITMAPFONT]=this._bitmapFont,this._cacheMap[t.Cache.JSON]=this._json},t.Cache.CANVAS=1,t.Cache.IMAGE=2,t.Cache.TEXTURE=3,t.Cache.SOUND=4,t.Cache.TEXT=5,t.Cache.PHYSICS=6,t.Cache.TILEMAP=7,t.Cache.BINARY=8,t.Cache.BITMAPDATA=9,t.Cache.BITMAPFONT=10,t.Cache.JSON=11,t.Cache.prototype={addCanvas:function(e,t,n){this._canvases[e]={canvas:t,context:n}},addBinary:function(e,t){this._binary[e]=t},addBitmapData:function(e,t){return this._bitmapDatas[e]=t,t},addRenderTexture:function(e,n){var r=new t.Frame(0,0,0,n.width,n.height,"","");this._textures[e]={texture:n,frame:r}},addSpriteSheet:function(e,n,r,i,s,o,u,a){this._images[e]={url:n,data:r,spriteSheet:!0,frameWidth:i,frameHeight:s,margin:u,spacing:a},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),this._images[e].frameData=t.AnimationParser.spriteSheet(this.game,e,i,s,o,u,a)},addTilemap:function(e,t,n,r){this._tilemaps[e]={url:t,data:n,format:r}},addTextureAtlas:function(e,n,r,i,s){this._images[e]={url:n,data:r,spriteSheet:!0},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),s==t.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[e].frameData=t.AnimationParser.JSONData(this.game,i,e):s==t.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[e].frameData=t.AnimationParser.JSONDataHash(this.game,i,e):s==t.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[e].frameData=t.AnimationParser.XMLData(this.game,i,e))},addBitmapFont:function(e,n,r,i,s,o){this._images[e]={url:n,data:r,spriteSheet:!0},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),t.LoaderParser.bitmapFont(this.game,i,e,s,o)},addPhysicsData:function(e,t,n,r){this._physics[e]={url:t,data:n,format:r}},addDefaultImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:e,spriteSheet:!1},this._images.__default.frame=new t.Frame(0,0,0,32,32,"",""),PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(e),PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:e,spriteSheet:!1},this._images.__missing.frame=new t.Frame(0,0,0,32,32,"",""),PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(e),PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(e,t,n){this._text[e]={url:t,data:n}},addJSON:function(e,t,n){this._json[e]={url:t,data:n}},addImage:function(e,n,r){this._images[e]={url:n,data:r,spriteSheet:!1},this._images[e].frame=new t.Frame(0,0,0,r.width,r.height,e,this.game.rnd.uuid()),PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e])},addSound:function(e,t,n,r,i){r=r||!0,i=i||!1;var s=!1;i&&(s=!0),this._sounds[e]={url:t,data:n,isDecoding:!1,decoded:s,webAudio:r,audioTag:i,locked:this.game.sound.touchLocked}},reloadSound:function(e){var t=this;this._sounds[e]&&(this._sounds[e].data.src=this._sounds[e].url,this._sounds[e].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),this._sounds[e].data.load())},reloadSoundComplete:function(e){this._sounds[e]&&(this._sounds[e].locked=!1,this.onSoundUnlock.dispatch(e))},updateSound:function(e,t,n){this._sounds[e]&&(this._sounds[e][t]=n)},decodedSound:function(e,t){this._sounds[e].data=t,this._sounds[e].decoded=!0,this._sounds[e].isDecoding=!1},getCanvas:function(e){return this._canvases[e]?this._canvases[e].canvas:void console.warn('Phaser.Cache.getCanvas: Invalid key: "'+e+'"')},getBitmapData:function(e){return this._bitmapDatas[e]?this._bitmapDatas[e]:void console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+e+'"')},getBitmapFont:function(e){return this._bitmapFont[e]?this._bitmapFont[e]:void console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+e+'"')},getPhysicsData:function(e,t,n){if("undefined"==typeof t||null===t){if(this._physics[e])return this._physics[e].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+e+'"')}else if(this._physics[e]&&this._physics[e].data[t]){var r=this._physics[e].data[t];if(!r||!n)return r;for(var i in r)if(i=r[i],i.fixtureKey===n)return i;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+n+" in "+e+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+e+" / "+t+'"');return null},checkKey:function(e,t){return this._cacheMap[e][t]?!0:!1},checkCanvasKey:function(e){return this.checkKey(t.Cache.CANVAS,e)},checkImageKey:function(e){return this.checkKey(t.Cache.IMAGE,e)},checkTextureKey:function(e){return this.checkKey(t.Cache.TEXTURE,e)},checkSoundKey:function(e){return this.checkKey(t.Cache.SOUND,e)},checkTextKey:function(e){return this.checkKey(t.Cache.TEXT,e)},checkPhysicsKey:function(e){return this.checkKey(t.Cache.PHYSICS,e)},checkTilemapKey:function(e){return this.checkKey(t.Cache.TILEMAP,e)},checkBinaryKey:function(e){return this.checkKey(t.Cache.BINARY,e)},checkBitmapDataKey:function(e){return this.checkKey(t.Cache.BITMAPDATA,e)},checkBitmapFontKey:function(e){return this.checkKey(t.Cache.BITMAPFONT,e)},checkJSONKey:function(e){return this.checkKey(t.Cache.JSON,e)},getImage:function(e){return this._images[e]?this._images[e].data:void console.warn('Phaser.Cache.getImage: Invalid key: "'+e+'"')},getTilemapData:function(e){return this._tilemaps[e]?this._tilemaps[e]:void console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+e+'"')},getFrameData:function(e){return this._images[e]&&this._images[e].frameData?this._images[e].frameData:null},updateFrameData:function(e,t){this._images[e]&&(this._images[e].spriteSheet=!0,this._images[e].frameData=t)},getFrameByIndex:function(e,t){return this._images[e]&&this._images[e].frameData?this._images[e].frameData.getFrame(t):null},getFrameByName:function(e,t){return this._images[e]&&this._images[e].frameData?this._images[e].frameData.getFrameByName(t):null},getFrame:function(e){return this._images[e]&&this._images[e].spriteSheet===!1?this._images[e].frame:null},getTextureFrame:function(e){return this._textures[e]?this._textures[e].frame:null},getTexture:function(e){return this._textures[e]?this._textures[e]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+e+'"')},getSound:function(e){return this._sounds[e]?this._sounds[e]:void console.warn('Phaser.Cache.getSound: Invalid key: "'+e+'"')},getSoundData:function(e){return this._sounds[e]?this._sounds[e].data:void console.warn('Phaser.Cache.getSoundData: Invalid key: "'+e+'"')},isSoundDecoded:function(e){return this._sounds[e]?this._sounds[e].decoded:void 0},isSoundReady:function(e){return this._sounds[e]&&this._sounds[e].decoded&&this.game.sound.touchLocked===!1},isSpriteSheet:function(e){return this._images[e]?this._images[e].spriteSheet:!1},getText:function(e){return this._text[e]?this._text[e].data:void console.warn('Phaser.Cache.getText: Invalid key: "'+e+'"')},getJSON:function(e){return this._json[e]?this._json[e].data:void console.warn('Phaser.Cache.getJSON: Invalid key: "'+e+'"')},getBinary:function(e){return this._binary[e]?this._binary[e]:void console.warn('Phaser.Cache.getBinary: Invalid key: "'+e+'"')},getKeys:function(e){var n=null;switch(e){case t.Cache.CANVAS:n=this._canvases;break;case t.Cache.IMAGE:n=this._images;break;case t.Cache.TEXTURE:n=this._textures;break;case t.Cache.SOUND:n=this._sounds;break;case t.Cache.TEXT:n=this._text;break;case t.Cache.PHYSICS:n=this._physics;break;case t.Cache.TILEMAP:n=this._tilemaps;break;case t.Cache.BINARY:n=this._binary;break;case t.Cache.BITMAPDATA:n=this._bitmapDatas;break;case t.Cache.BITMAPFONT:n=this._bitmapFont;break;case t.Cache.JSON:n=this._json}if(n){var r=[];for(var i in n)"__default"!==i&&"__missing"!==i&&r.push(i);return r}},removeCanvas:function(e){delete this._canvases[e]},removeImage:function(e){delete this._images[e]},removeSound:function(e){delete this._sounds[e]},removeText:function(e){delete this._text[e]},removeJSON:function(e){delete this._json[e]},removePhysics:function(e){delete this._physics[e]},removeTilemap:function(e){delete this._tilemaps[e]},removeBinary:function(e){delete this._binary[e]},removeBitmapData:function(e){delete this._bitmapDatas[e]},removeBitmapFont:function(e){delete this._bitmapFont[e]},destroy:function(){for(var e in this._canvases)delete this._canvases[e];for(var e in this._images)"__default"!==e&&"__missing"!==e&&delete this._images[e];for(var e in this._sounds)delete this._sounds[e];for(var e in this._text)delete this._text[e];for(var e in this._json)delete this._json[e];for(var e in this._textures)delete this._textures[e];for(var e in this._physics)delete this._physics[e];for(var e in this._tilemaps)delete this._tilemaps[e];for(var e in this._binary)delete this._binary[e];for(var e in this._bitmapDatas)delete this._bitmapDatas[e];for(var e in this._bitmapFont)delete this._bitmapFont[e]}},t.Cache.prototype.constructor=t.Cache,t.Loader=function(e){this.game=e,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.progressFloat=0,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.onLoadStart=new t.Signal,this.onFileStart=new t.Signal,this.onFileComplete=new t.Signal,this.onFileError=new t.Signal,this.onLoadComplete=new t.Signal,this.onPackComplete=new t.Signal,this._packList=[],this._packIndex=0,this._fileList=[],this._fileIndex=0,this._progressChunk=0,this._xhr=new XMLHttpRequest,this._ajax=null},t.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,t.Loader.TEXTURE_ATLAS_JSON_HASH=1,t.Loader.TEXTURE_ATLAS_XML_STARLING=2,t.Loader.PHYSICS_LIME_CORONA_JSON=3,t.Loader.PHYSICS_PHASER_JSON=4,t.Loader.prototype={setPreloadSprite:function(e,n){n=n||0,this.preloadSprite={sprite:e,direction:n,width:e.width,height:e.height,rect:null},this.preloadSprite.rect=0===n?new t.Rectangle(0,0,1,e.height):new t.Rectangle(0,0,e.width,1),e.crop(this.preloadSprite.rect),e.visible=!0},checkKeyExists:function(e,t){if(this._fileList.length>0)for(var n=0;n<this._fileList.length;n++)if(this._fileList[n].type===e&&this._fileList[n].key===t)return!0;return!1},getAssetIndex:function(e,t){if(this._fileList.length>0)for(var n=0;n<this._fileList.length;n++)if(this._fileList[n].type===e&&this._fileList[n].key===t)return n;return-1},getAsset:function(e,t){if(this._fileList.length>0)for(var n=0;n<this._fileList.length;n++)if(this._fileList[n].type===e&&this._fileList[n].key===t)return{index:n,file:this._fileList[n]};return!1},reset:function(){this.preloadSprite=null,this.isLoading=!1,this._packList.length=0,this._packIndex=0,this._fileList.length=0,this._fileIndex=0},addToFileList:function(e,t,n,r){var i={type:e,key:t,url:n,data:null,error:!1,loaded:!1};if("undefined"!=typeof r)for(var s in r)i[s]=r[s];this.checkKeyExists(e,t)===!1&&this._fileList.push(i)},replaceInFileList:function(e,t,n,r){var i={type:e,key:t,url:n,data:null,error:!1,loaded:!1};if("undefined"!=typeof r)for(var s in r)i[s]=r[s];var o=this.getAssetIndex(e,t);-1===o?this._fileList.push(i):this._fileList[o]=i},pack:function(e,t,n,r){return"undefined"==typeof t&&(t=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=this),null===t&&null===n?(console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this):(n&&"string"==typeof n&&(n=JSON.parse(n)),this._packList.push({key:e,url:t,data:n,loaded:!1,error:!1,callbackContext:r}),this)},image:function(e,t,n){return"undefined"==typeof n&&(n=!1),n?this.replaceInFileList("image",e,t):this.addToFileList("image",e,t),this},text:function(e,t,n){return"undefined"==typeof n&&(n=!1),n?this.replaceInFileList("text",e,t):this.addToFileList("text",e,t),this},json:function(e,t,n){return"undefined"==typeof n&&(n=!1),n?this.replaceInFileList("json",e,t):this.addToFileList("json",e,t),this},script:function(e,t,n,r){return"undefined"==typeof n&&(n=!1),n!==!1&&"undefined"==typeof r&&(r=n),this.addToFileList("script",e,t,{callback:n,callbackContext:r}),this},binary:function(e,t,n,r){return"undefined"==typeof n&&(n=!1),n!==!1&&"undefined"==typeof r&&(r=n),this.addToFileList("binary",e,t,{callback:n,callbackContext:r}),this},spritesheet:function(e,t,n,r,i,s,o){return"undefined"==typeof i&&(i=-1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),this.addToFileList("spritesheet",e,t,{frameWidth:n,frameHeight:r,frameMax:i,margin:s,spacing:o}),this},audio:function(e,t,n){return"undefined"==typeof n&&(n=!0),this.addToFileList("audio",e,t,{buffer:null,autoDecode:n}),this},tilemap:function(e,n,r,i){if("undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=t.Tilemap.CSV),null==n&&null==r)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(r){switch(i){case t.Tilemap.CSV:break;case t.Tilemap.TILED_JSON:"string"==typeof r&&(r=JSON.parse(r))}this.game.cache.addTilemap(e,null,r,i)}else this.addToFileList("tilemap",e,n,{format:i});return this},physics:function(e,n,r,i){return"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=t.Physics.LIME_CORONA_JSON),null==n&&null==r?(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this):(r?("string"==typeof r&&(r=JSON.parse(r)),this.game.cache.addPhysicsData(e,null,r,i)):this.addToFileList("physics",e,n,{format:i}),this)},bitmapFont:function(e,t,n,r,i,s){if("undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),n)this.addToFileList("bitmapfont",e,t,{xmlURL:n,xSpacing:i,ySpacing:s});else if("string"==typeof r){var o;try{if(window.DOMParser){var u=new DOMParser;o=u.parseFromString(r,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(r)}catch(a){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",e,t,{xmlURL:null,xmlData:o,xSpacing:i,ySpacing:s})}return this},atlasJSONArray:function(e,n,r,i){return this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(e,n,r,i){return this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(e,n,r,i){return this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(e,n,r,i,s){if("undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=null),"undefined"==typeof s&&(s=t.Loader.TEXTURE_ATLAS_JSON_ARRAY),r)this.addToFileList("textureatlas",e,n,{atlasURL:r,format:s});else{switch(s){case t.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof i&&(i=JSON.parse(i));break;case t.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof i){var o;try{if(window.DOMParser){var u=new DOMParser;o=u.parseFromString(i,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(i)}catch(a){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");i=o}}this.addToFileList("textureatlas",e,n,{atlasURL:null,atlasData:i,format:s})}return this},removeFile:function(e,t){var n=this.getAsset(e,t);n!==!1&&this._fileList.splice(n.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this._packList.length>0?(this._packIndex=0,this.loadPack()):this.beginLoad())},beginLoad:function(){this.progress=0,this.progressFloat=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this.loadFile()):(this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.isLoading=!1,this.onLoadComplete.dispatch())},loadPack:function(){if(!this._packList[this._packIndex])return void console.warn("Phaser.Loader loadPackList invalid index "+this._packIndex);var e=this._packList[this._packIndex];null!==e.data?this.packLoadComplete(this._packIndex,!1):this.xhrLoad(this._packIndex,this.baseURL+e.url,"text","packLoadComplete","packLoadError")},packLoadComplete:function(e,n){if("undefined"==typeof n&&(n=!0),!this._packList[e])return void console.warn("Phaser.Loader packLoadComplete invalid index "+e);var r=this._packList[e];if(r.loaded=!0,n)var i=JSON.parse(this._xhr.responseText);else var i=this._packList[e].data;if(i[r.key])for(var s,o=0;o<i[r.key].length;o++)switch(s=i[r.key][o],s.type){case"image":this.image(s.key,s.url,s.overwrite);break;case"text":this.text(s.key,s.url,s.overwrite);break;case"json":this.json(s.key,s.url,s.overwrite);break;case"script":this.script(s.key,s.url,s.callback,r.callbackContext);break;case"binary":this.binary(s.key,s.url,s.callback,r.callbackContext);break;case"spritesheet":this.spritesheet(s.key,s.url,s.frameWidth,s.frameHeight,s.frameMax,s.margin,s.spacing);break;case"audio":this.audio(s.key,s.urls,s.autoDecode);break;case"tilemap":this.tilemap(s.key,s.url,s.data,t.Tilemap[s.format]);break;case"physics":this.physics(s.key,s.url,s.data,t.Loader[s.format]);break;case"bitmapFont":this.bitmapFont(s.key,s.textureURL,s.xmlURL,s.xmlData,s.xSpacing,s.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasXML":this.atlasXML(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlas":this.atlas(s.key,s.textureURL,s.atlasURL,s.atlasData,t.Loader[s.format])}this.nextPack(e,!0)},packError:function(e){this._packList[e].loaded=!0,this._packList[e].error=!0,this.onFileError.dispatch(this._packList[e].key,this._packList[e]),console.warn("Phaser.Loader error loading pack file: "+this._packList[e].key+" from URL "+this._packList[e].url),this.nextPack(e,!1)},nextPack:function(e,t){this.onPackComplete.dispatch(this._packList[e].key,t,this.totalLoadedPacks(),this._packList.length),this._packIndex++,this._packIndex<this._packList.length?this.loadPack():this.beginLoad()},loadFile:function(){if(!this._fileList[this._fileIndex])return void console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);var e=this._fileList[this._fileIndex],n=this;switch(this.onFileStart.dispatch(this.progress,e.key),e.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":e.data=new Image,e.data.name=e.key,e.data.onload=function(){return n.fileComplete(n._fileIndex)},e.data.onerror=function(){return n.fileError(n._fileIndex)},this.crossOrigin&&(e.data.crossOrigin=this.crossOrigin),e.data.src=this.baseURL+e.url;break;case"audio":e.url=this.getAudioURL(e.url),null!==e.url?this.game.sound.usingWebAudio?this.xhrLoad(this._fileIndex,this.baseURL+e.url,"arraybuffer","fileComplete","fileError"):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(e.data=new Audio,e.data.name=e.key,e.data.preload="auto",e.data.src=this.baseURL+e.url,this.fileComplete(this._fileIndex)):(e.data=new Audio,e.data.name=e.key,e.data.onerror=function(){return n.fileError(n._fileIndex)},e.data.preload="auto",e.data.src=this.baseURL+e.url,e.data.addEventListener("canplaythrough",t.GAMES[this.game.id].load.fileComplete(this._fileIndex),!1),e.data.load())):this.fileError(this._fileIndex);break;case"json":window.XDomainRequest?(this._ajax=new window.XDomainRequest,this._ajax.timeout=3e3,this._ajax.onerror=function(){return n.dataLoadError(n._fileIndex)},this._ajax.ontimeout=function(){return n.dataLoadError(n._fileIndex)},this._ajax.onprogress=function(){},this._ajax.onload=function(){return n.jsonLoadComplete(n._fileIndex)},this._ajax.open("GET",this.baseURL+e.url,!0),this._ajax.send()):this.xhrLoad(this._fileIndex,this.baseURL+e.url,"text","jsonLoadComplete","dataLoadError");break;case"tilemap":if(e.format===t.Tilemap.TILED_JSON)this.xhrLoad(this._fileIndex,this.baseURL+e.url,"text","jsonLoadComplete","dataLoadError");else{if(e.format!==t.Tilemap.CSV)throw new Error("Phaser.Loader. Invalid Tilemap format: "+e.format);this.xhrLoad(this._fileIndex,this.baseURL+e.url,"text","csvLoadComplete","dataLoadError")}break;case"text":case"script":case"physics":this.xhrLoad(this._fileIndex,this.baseURL+e.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(this._fileIndex,this.baseURL+e.url,"arraybuffer","fileComplete","fileError")}},xhrLoad:function(e,t,n,r,i){this._xhr.open("GET",t,!0),this._xhr.responseType=n;var s=this;this._xhr.onload=function(){return s[r](e)},this._xhr.onerror=function(){return s[i](e)},this._xhr.send()},getAudioURL:function(e){var t;"string"==typeof e&&(e=[e]);for(var n=0;n<e.length;n++)if(t=e[n].toLowerCase(),t=t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1),this.game.device.canPlayAudio(t))return e[n];return null},fileError:function(e){this._fileList[e].loaded=!0,this._fileList[e].error=!0,this.onFileError.dispatch(this._fileList[e].key,this._fileList[e]),console.warn("Phaser.Loader error loading file: "+this._fileList[e].key+" from URL "+this._fileList[e].url),this.nextFile(e,!1)},fileComplete:function(e){if(!this._fileList[e])return void console.warn("Phaser.Loader fileComplete invalid index "+e);var n=this._fileList[e];n.loaded=!0;var r=!0;switch(n.type){case"image":this.game.cache.addImage(n.key,n.url,n.data);break;case"spritesheet":this.game.cache.addSpriteSheet(n.key,n.url,n.data,n.frameWidth,n.frameHeight,n.frameMax,n.margin,n.spacing);break;case"textureatlas":if(null==n.atlasURL)this.game.cache.addTextureAtlas(n.key,n.url,n.data,n.atlasData,n.format);else if(r=!1,n.format==t.Loader.TEXTURE_ATLAS_JSON_ARRAY||n.format==t.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(this._fileIndex,this.baseURL+n.atlasURL,"text","jsonLoadComplete","dataLoadError");else{if(n.format!=t.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+n.format);this.xhrLoad(this._fileIndex,this.baseURL+n.atlasURL,"text","xmlLoadComplete","dataLoadError")}break;case"bitmapfont":null==n.xmlURL?this.game.cache.addBitmapFont(n.key,n.url,n.data,n.xmlData,n.xSpacing,n.ySpacing):(r=!1,this.xhrLoad(this._fileIndex,this.baseURL+n.xmlURL,"text","xmlLoadComplete","dataLoadError"));break;case"audio":if(this.game.sound.usingWebAudio){if(n.data=this._xhr.response,this.game.cache.addSound(n.key,n.url,n.data,!0,!1),n.autoDecode){var i=this,s=n.key;this.game.cache.updateSound(s,"isDecoding",!0),this.game.sound.context.decodeAudioData(n.data,function(e){e&&(i.game.cache.decodedSound(s,e),i.game.sound.onSoundDecode.dispatch(s,i.game.cache.getSound(s)))})}}else n.data.removeEventListener("canplaythrough",t.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(n.key,n.url,n.data,!1,!0);break;case"text":n.data=this._xhr.responseText,this.game.cache.addText(n.key,n.url,n.data);break;case"physics":var o=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(n.key,n.url,o,n.format);break;case"script":n.data=document.createElement("script"),n.data.language="javascript",n.data.type="text/javascript",n.data.defer=!1,n.data.text=this._xhr.responseText,document.head.appendChild(n.data),n.callback&&(n.data=n.callback.call(n.callbackContext,n.key,this._xhr.responseText));break;case"binary":n.data=n.callback?n.callback.call(n.callbackContext,n.key,this._xhr.response):this._xhr.response,this.game.cache.addBinary(n.key,n.data)}r&&this.nextFile(e,!0)},jsonLoadComplete:function(e){if(!this._fileList[e])return void console.warn("Phaser.Loader jsonLoadComplete invalid index "+e);var t=this._fileList[e],n=JSON.parse(this._xhr.responseText);t.loaded=!0,"tilemap"===t.type?this.game.cache.addTilemap(t.key,t.url,n,t.format):"json"===t.type?this.game.cache.addJSON(t.key,t.url,n):this.game.cache.addTextureAtlas(t.key,t.url,t.data,n,t.format),this.nextFile(e,!0)},csvLoadComplete:function(e){if(!this._fileList[e])return void console.warn("Phaser.Loader csvLoadComplete invalid index "+e);var t=this._fileList[e],n=this._xhr.responseText;t.loaded=!0,this.game.cache.addTilemap(t.key,t.url,n,t.format),this.nextFile(e,!0)},dataLoadError:function(e){var t=this._fileList[e];t.loaded=!0,t.error=!0,console.warn("Phaser.Loader dataLoadError: "+t.key),this.nextFile(e,!0)},xmlLoadComplete:function(e){var t,n=this._xhr.responseText;try{if(window.DOMParser){var r=new DOMParser;t=r.parseFromString(n,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n)}catch(i){t=void 0}if(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");var s=this._fileList[e];s.loaded=!0,"bitmapfont"==s.type?this.game.cache.addBitmapFont(s.key,s.url,s.data,t,s.xSpacing,s.ySpacing):"textureatlas"==s.type&&this.game.cache.addTextureAtlas(s.key,s.url,s.data,t,s.format),this.nextFile(e,!0)},nextFile:function(e,t){this.progressFloat+=this._progressChunk,this.progress=Math.round(this.progressFloat),this.progress>100&&(this.progress=100),null!==this.preloadSprite&&(0===this.preloadSprite.direction?(this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress),this.preloadSprite.sprite.crop(this.preloadSprite.rect)):(this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.crop(this.preloadSprite.rect))),this.onFileComplete.dispatch(this.progress,this._fileList[e].key,t,this.totalLoadedFiles(),this._fileList.length),this.totalQueuedFiles()>0?(this._fileIndex++,this.loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},totalLoadedFiles:function(){for(var e=0,t=0;t<this._fileList.length;t++)this._fileList[t].loaded&&e++;return e},totalQueuedFiles:function(){for(var e=0,t=0;t<this._fileList.length;t++)this._fileList[t].loaded===!1&&e++;return e},totalLoadedPacks:function(){for(var e=0,t=0;t<this._packList.length;t++)this._packList[t].loaded&&e++;return e},totalQueuedPacks:function(){for(var e=0,t=0;t<this._packList.length;t++)this._packList[t].loaded===!1&&e++;return e}},t.Loader.prototype.constructor=t.Loader,t.LoaderParser={bitmapFont:function(e,t,n,r,i){var s={},o=t.getElementsByTagName("info")[0],u=t.getElementsByTagName("common")[0];s.font=o.getAttribute("face"),s.size=parseInt(o.getAttribute("size"),10),s.lineHeight=parseInt(u.getAttribute("lineHeight"),10)+i,s.chars={};for(var a=t.getElementsByTagName("char"),f=0;f<a.length;f++){var l=parseInt(a[f].getAttribute("id"),10),c=new PIXI.Rectangle(parseInt(a[f].getAttribute("x"),10),parseInt(a[f].getAttribute("y"),10),parseInt(a[f].getAttribute("width"),10),parseInt(a[f].getAttribute("height"),10));s.chars[l]={xOffset:parseInt(a[f].getAttribute("xoffset"),10),yOffset:parseInt(a[f].getAttribute("yoffset"),10),xAdvance:parseInt(a[f].getAttribute("xadvance"),10)+r,kerning:{},texture:PIXI.TextureCache[n]=new PIXI.Texture(PIXI.BaseTextureCache[n],c)}}var h=t.getElementsByTagName("kerning");for(f=0;f<h.length;f++){var p=parseInt(h[f].getAttribute("first"),10),d=parseInt(h[f].getAttribute("second"),10),v=parseInt(h[f].getAttribute("amount"),10);s.chars[d].kerning[p]=v}PIXI.BitmapText.fonts[n]=s}},t.Sound=function(e,n,r,i,s){"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=e.sound.connectToMaster),this.game=e,this.name=n,this.key=n,this.loop=i,this.volume=r,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.pendingPlayback=!1,this.override=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,s&&this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(n)&&this.game.cache.isSoundReady(n)?(this._sound=this.game.cache.getSoundData(n),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this),this.onDecoded=new t.Signal,this.onPlay=new t.Signal,this.onPause=new t.Signal,this.onResume=new t.Signal,this.onLoop=new t.Signal,this.onStop=new t.Signal,this.onMute=new t.Signal,this.onMarkerComplete=new t.Signal,this._volume=r,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},t.Sound.prototype={soundHasUnlocked:function(e){e==this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(e,t,n,r,i){"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=!1),this.markers[e]={name:e,start:t,stop:t+n,volume:r,duration:n,durationMS:1e3*n,loop:i}},removeMarker:function(e){delete this.markers[e]},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.now):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(e,t,n,r,i){if("undefined"==typeof e&&(e=""),"undefined"==typeof i&&(i=!0),this.isPlaying===!0&&i===!1&&this.override===!1)return this;if(this.isPlaying&&this.override&&(this.usingWebAudio?"undefined"==typeof this._sound.stop?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=e,""!==e){if(!this.markers[e])return console.warn("Phaser.Sound.play: audio marker "+e+" doesn't exist"),this;this.position=this.markers[e].start,this.volume=this.markers[e].volume,this.loop=this.markers[e].loop,this.duration=this.markers[e].duration,this.durationMS=this.markers[e].durationMS,"undefined"!=typeof n&&(this.volume=n),"undefined"!=typeof r&&(this.loop=r),this._tempMarker=e,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else t=t||0,"undefined"==typeof n&&(n=this._volume),"undefined"==typeof r&&(r=this.loop),this.position=t,this.volume=n,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=e,this._tempPosition=t,this._tempVolume=n,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null==this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this.loop&&""===e&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(e,t,n,r){e=e||"",t=t||0,n=n||1,"undefined"==typeof r&&(r=!1),this.play(e,t,n,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.now,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var e=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,e,this.duration):this._sound.start(0,e,this.duration)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.now-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1;var t=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",this.paused||this.onStop.dispatch(this,t)},destroy:function(e){"undefined"==typeof e&&(e=!0),this.stop(),e?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},t.Sound.prototype.constructor=t.Sound,Object.defineProperty(t.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(t.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(t.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(e){e=e||null,e?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(t.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){this.usingWebAudio?(this._volume=e,this.gainNode.gain.value=e):this.usingAudioTag&&this._sound&&e>=0&&1>=e&&(this._volume=e,this._sound.volume=e)}}),t.SoundManager=function(e){this.game=e,this.onSoundDecode=new t.Signal,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this.context=null,this.usingWebAudio=!0,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32},t.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void (this.noAudio=!0);if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void (this.noAudio=!1)}if(window.AudioContext)try{this.context=new window.AudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=e,this._unlockSource.connect(this.context.destination),this._unlockSource.noteOn(0)}},stopAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].stop()},pauseAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].pause()},resumeAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].resume()},decode:function(e,t){t=t||null;var n=this.game.cache.getSoundData(e);if(n&&this.game.cache.isSoundDecoded(e)===!1){this.game.cache.updateSound(e,"isDecoding",!0);var r=this;this.context.decodeAudioData(n,function(n){r.game.cache.decodedSound(e,n),t&&r.onSoundDecode.dispatch(e,t)})}},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var e=0;e<this._sounds.length;e++)this._sounds[e].update()},add:function(e,n,r,i){"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=this.connectToMaster);var s=new t.Sound(this.game,e,n,r,i);return this._sounds.push(s),s},remove:function(e){for(var t=this._sounds.length;t--;)if(this._sounds[t]===e)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeByKey:function(e){for(var t=this._sounds.length,n=0;t--;)this._sounds[t].key===e&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),n++);return n},play:function(e,t,n){var r=this.add(e,t,n);return r.play(),r},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!1)}}},t.SoundManager.prototype.constructor=t.SoundManager,Object.defineProperty(t.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){if(e=e||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(t.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(e){if(this._volume=e,this.usingWebAudio)this.masterGain.gain.value=e;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*e)}}),t.Utils.Debug=function(e){this.game=e,this.sprite=null,this.canvas=null,this.baseTexture=null,this.texture=null,this.textureFrame=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},t.Utils.Debug.prototype={boot:function(){this.game.renderType===t.CANVAS?this.context=this.game.context:(this.canvas=t.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new t.Frame(0,0,0,this.game.width,this.game.height,"debug",this.game.rnd.uuid()),this.sprite=this.game.make.image(0,0,this.texture,this.textureFrame),this.game.stage.addChild(this.sprite))},preUpdate:function(){this.dirty&&this.sprite&&(this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},start:function(e,t,n,r){"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0),n=n||"rgb(255,255,255)","undefined"==typeof r&&(r=0),this.currentX=e,this.currentY=t,this.currentColor=n,this.currentAlpha=this.context.globalAlpha,this.columnWidth=r,this.sprite&&(this.dirty=!0),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=n,this.context.fillStyle=n,this.context.font=this.font,this.context.globalAlpha=1},stop:function(){this.context.restore(),this.context.globalAlpha=this.currentAlpha,this.sprite&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)},line:function(){for(var e=this.currentX,t=0;t<arguments.length;t++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[t],e+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[t],e,this.currentY),e+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sound: "+e.key+" Locked: "+e.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(e.key)+" Pending Playback: "+e.pendingPlayback),this.line("Decoded: "+e.isDecoded+" Decoding: "+e.isDecoding),this.line("Total Duration: "+e.totalDuration+" Playing: "+e.isPlaying),this.line("Time: "+e.currentTime),this.line("Volume: "+e.volume+" Muted: "+e.mute),this.line("WebAudio: "+e.usingWebAudio+" Audio: "+e.usingAudioTag),""!==e.currentMarker&&(this.line("Marker: "+e.currentMarker+" Duration: "+e.duration+" (ms: "+e.durationMS+")"),this.line("Start: "+e.markers[e.currentMarker].start+" Stop: "+e.markers[e.currentMarker].stop),this.line("Position: "+e.position)),this.stop()},cameraInfo:function(e,t,n,r){this.start(t,n,r),this.line("Camera ("+e.width+" x "+e.height+")"),this.line("X: "+e.x+" Y: "+e.y),this.line("Bounds x: "+e.bounds.x+" Y: "+e.bounds.y+" w: "+e.bounds.width+" h: "+e.bounds.height),this.line("View x: "+e.view.x+" Y: "+e.view.y+" w: "+e.view.width+" h: "+e.view.height),this.stop()},timer:function(e,t,n,r){this.start(t,n,r),this.line("Timer (running: "+e.running+" expired: "+e.expired+")"),this.line("Next Tick: "+e.next+" Duration: "+e.duration),this.line("Paused: "+e.paused+" Length: "+e.length),this.stop()},pointer:function(e,t,n,r,i){null!=e&&("undefined"==typeof t&&(t=!1),n=n||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",(t!==!0||e.isUp!==!0)&&(this.start(e.x,e.y-100,i),this.context.beginPath(),this.context.arc(e.x,e.y,e.circle.radius,0,2*Math.PI),this.context.fillStyle=e.active?n:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(e.positionDown.x,e.positionDown.y),this.context.lineTo(e.position.x,e.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+e.id+" Active: "+e.active),this.line("World X: "+e.worldX+" World Y: "+e.worldY),this.line("Screen X: "+e.x+" Screen Y: "+e.y),this.line("Duration: "+e.duration+" ms"),this.line("is Down: "+e.isDown+" is Up: "+e.isUp),this.stop()))},spriteInputInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite Input: ("+e.width+" x "+e.height+")"),this.line("x: "+e.input.pointerX().toFixed(1)+" y: "+e.input.pointerY().toFixed(1)),this.line("over: "+e.input.pointerOver()+" duration: "+e.input.overDuration().toFixed(0)),this.line("down: "+e.input.pointerDown()+" duration: "+e.input.downDuration().toFixed(0)),this.line("just over: "+e.input.justOver()+" just out: "+e.input.justOut()),this.stop()},key:function(e,t,n,r){this.start(t,n,r,150),this.line("Key:",e.keyCode,"isDown:",e.isDown),this.line("justPressed:",e.justPressed(),"justReleased:",e.justReleased()),this.line("Time Down:",e.timeDown.toFixed(0),"duration:",e.duration.toFixed(0)),this.stop()},inputInfo:function(e,t,n){this.start(e,t,n),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(e,t,n){var r=e.getBounds();r.x+=this.game.camera.x,r.y+=this.game.camera.y,this.rectangle(r,t,n)},spriteInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite:  ("+e.width+" x "+e.height+") anchor: "+e.anchor.x+" x "+e.anchor.y),this.line("x: "+e.x.toFixed(1)+" y: "+e.y.toFixed(1)),this.line("angle: "+e.angle.toFixed(1)+" rotation: "+e.rotation.toFixed(1)),this.line("visible: "+e.visible+" in camera: "+e.inCamera),this.stop()},spriteCoords:function(e,t,n,r){this.start(t,n,r,100),e.name&&this.line(e.name),this.line("x:",e.x.toFixed(2),"y:",e.y.toFixed(2)),this.line("pos x:",e.position.x.toFixed(2),"pos y:",e.position.y.toFixed(2)),this.line("world x:",e.world.x.toFixed(2),"world y:",e.world.y.toFixed(2)),this.stop()},lineInfo:function(e,t,n,r){this.start(t,n,r,80),this.line("start.x:",e.start.x.toFixed(2),"start.y:",e.start.y.toFixed(2)),this.line("end.x:",e.end.x.toFixed(2),"end.y:",e.end.y.toFixed(2)),this.line("length:",e.length.toFixed(2),"angle:",e.angle),this.stop()},pixel:function(e,t,n,r){r=r||2,this.start(),this.context.fillStyle=n,this.context.fillRect(e,t,r,r),this.stop()},geom:function(e,n,r,i){"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=0),n=n||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=n,this.context.strokeStyle=n,e instanceof t.Rectangle||1===i?r?this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height):this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height):e instanceof t.Circle||2===i?(this.context.beginPath(),this.context.arc(e.x-this.game.camera.x,e.y-this.game.camera.y,e.radius,0,2*Math.PI,!1),this.context.closePath(),r?this.context.fill():this.context.stroke()):e instanceof t.Point||3===i?this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,4,4):(e instanceof t.Line||4===i)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(e.start.x+.5-this.game.camera.x,e.start.y+.5-this.game.camera.y),this.context.lineTo(e.end.x+.5-this.game.camera.x,e.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(e,t,n){"undefined"==typeof n&&(n=!0),t=t||"rgba(0, 255, 0, 0.4)",this.start(),n?(this.context.fillStyle=t,this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)):(this.context.strokeStyle=t,this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)),this.stop()},text:function(e,t,n,r,i){r=r||"rgb(255,255,255)",i=i||"16px Courier",this.start(),this.context.font=i,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(e,t+1,n+1)),this.context.fillStyle=r,this.context.fillText(e,t,n),this.stop()},quadTree:function(e,t){t=t||"rgba(255,0,0,0.3)",this.start();var n=e.bounds;if(0===e.nodes.length){this.context.strokeStyle=t,this.context.strokeRect(n.x,n.y,n.width,n.height),this.text("size: "+e.objects.length,n.x+4,n.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<e.objects.length;r++)this.context.strokeRect(e.objects[r].x,e.objects[r].y,e.objects[r].width,e.objects[r].height)}else for(var r=0;r<e.nodes.length;r++)this.quadTree(e.nodes[r]);this.stop()},body:function(e,n,r){e.body&&(e.body.type===t.Physics.ARCADE?(this.start(),t.Physics.Arcade.Body.render(this.context,e.body,n,r),this.stop()):e.body.type===t.Physics.NINJA&&(this.start(),t.Physics.Ninja.Body.render(this.context,e.body,n,r),this.stop()))},bodyInfo:function(e,n,r,i){e.body&&e.body.type===t.Physics.ARCADE&&(this.start(n,r,i,210),t.Physics.Arcade.Body.renderBodyInfo(this,e.body),this.stop())}},t.Utils.Debug.prototype.constructor=t.Utils.Debug,t.Color={packPixel:function(e,n,r,i){return t.Device.LITTLE_ENDIAN?(i<<24|r<<16|n<<8|e)>>>0:(e<<24|n<<16|r<<8|i)>>>0},unpackPixel:function(e,n,r,i){return("undefined"==typeof n||null===n)&&(n=t.Color.createColor()),("undefined"==typeof r||null===r)&&(r=!1),("undefined"==typeof i||null===i)&&(i=!1),t.Device.LITTLE_ENDIAN?(n.a=(4278190080&e)>>>24,n.b=(16711680&e)>>>16,n.g=(65280&e)>>>8,n.r=255&e):(n.r=(4278190080&e)>>>24,n.g=(16711680&e)>>>16,n.b=(65280&e)>>>8,n.a=255&e),n.color=e,n.rgba="rgba("+n.r+","+n.g+","+n.b+","+n.a/255+")",r&&t.Color.RGBtoHSL(n.r,n.g,n.b,n),i&&t.Color.RGBtoHSV(n.r,n.g,n.b,n),n},fromRGBA:function(e,n){return n||(n=t.Color.createColor()),n.r=(4278190080&e)>>>24,n.g=(16711680&e)>>>16,n.b=(65280&e)>>>8,n.a=255&e,n.rgba="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",n},toRGBA:function(e,t,n,r){return e<<24|t<<16|n<<8|r},RGBtoHSL:function(e,n,r,i){i||(i=t.Color.createColor(e,n,r,1)),e/=255,n/=255,r/=255;var s=Math.min(e,n,r),o=Math.max(e,n,r);if(i.h=0,i.s=0,i.l=(o+s)/2,o!==s){var u=o-s;i.s=i.l>.5?u/(2-o-s):u/(o+s),o===e?i.h=(n-r)/u+(r>n?6:0):o===n?i.h=(r-e)/u+2:o===r&&(i.h=(e-n)/u+4),i.h/=6}return i},HSLtoRGB:function(e,n,r,i){if(i?(i.r=r,i.g=r,i.b=r):i=t.Color.createColor(r,r,r),0!==n){var s=.5>r?r*(1+n):r+n-r*n,o=2*r-s;i.r=t.Color.hueToColor(o,s,e+1/3),i.g=t.Color.hueToColor(o,s,e),i.b=t.Color.hueToColor(o,s,e-1/3)}return i.r=Math.floor(255*i.r|0),i.g=Math.floor(255*i.g|0),i.b=Math.floor(255*i.b|0),t.Color.updateColor(i),i},RGBtoHSV:function(e,n,r,i){i||(i=t.Color.createColor(e,n,r,255)),e/=255,n/=255,r/=255;var s=Math.min(e,n,r),o=Math.max(e,n,r),u=o-s;return i.h=0,i.s=0===o?0:u/o,i.v=o,o!==s&&(o===e?i.h=(n-r)/u+(r>n?6:0):o===n?i.h=(r-e)/u+2:o===r&&(i.h=(e-n)/u+4),i.h/=6),i},HSVtoRGB:function(e,n,r,i){"undefined"==typeof i&&(i=t.Color.createColor(0,0,0,1,e,n,0,r));var s,o,u,a=Math.floor(6*e),f=6*e-a,l=r*(1-n),c=r*(1-f*n),h=r*(1-(1-f)*n);switch(a%6){case 0:s=r,o=h,u=l;break;case 1:s=c,o=r,u=l;break;case 2:s=l,o=r,u=h;break;case 3:s=l,o=c,u=r;break;case 4:s=h,o=l,u=r;break;case 5:s=r,o=l,u=c}return i.r=Math.floor(255*s),i.g=Math.floor(255*o),i.b=Math.floor(255*u),t.Color.updateColor(i),i},hueToColor:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},createColor:function(e,t,n,r,i,s,o,u){var a={r:e||0,g:t||0,b:n||0,a:r||1,h:i||0,s:s||0,l:o||0,v:u||0,color:0};return a.rgba="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",a},updateColor:function(e){return e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",e},getColor32:function(e,t,n,r){return e<<24|t<<16|n<<8|r},getColor:function(e,t,n){return e<<16|t<<8|n},RGBtoString:function(e,n,r,i,s){return"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s="#"),"#"===s?"#"+((1<<24)+(e<<16)+(n<<8)+r).toString(16).slice(1):"0x"+t.Color.componentToHex(i)+t.Color.componentToHex(e)+t.Color.componentToHex(n)+t.Color.componentToHex(r)},hexToRGB:function(e){var n=t.Color.hexToColor(e);return n?t.Color.getColor32(n.a,n.r,n.g,n.b):void 0},hexToColor:function(e,n){n||(n=t.Color.createColor());var r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(r,function(e,t,n,r){return t+t+n+n+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i&&(n.r=parseInt(i[1],16),n.g=parseInt(i[2],16),n.b=parseInt(i[3],16)),n},componentToHex:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},HSVColorWheel:function(e,n){"undefined"==typeof e&&(e=1),"undefined"==typeof n&&(n=1);for(var r=[],i=0;359>=i;i++)r.push(t.Color.HSVtoRGB(i/359,e,n));return r},HSLColorWheel:function(e,n){"undefined"==typeof e&&(e=.5),"undefined"==typeof n&&(n=.5);for(var r=[],i=0;359>=i;i++)r.push(t.Color.HSLtoRGB(i/359,e,n));return r},interpolateColor:function(e,n,r,i,s){"undefined"==typeof s&&(s=255);var o=t.Color.getRGB(e),u=t.Color.getRGB(n),a=(u.red-o.red)*i/r+o.red,f=(u.green-o.green)*i/r+o.green,l=(u.blue-o.blue)*i/r+o.blue;return t.Color.getColor32(s,a,f,l)},interpolateColorWithRGB:function(e,n,r,i,s,o){var u=t.Color.getRGB(e),a=(n-u.red)*o/s+u.red,f=(r-u.green)*o/s+u.green,l=(i-u.blue)*o/s+u.blue;return t.Color.getColor(a,f,l)},interpolateRGB:function(e,n,r,i,s,o,u,a){var f=(i-e)*a/u+e,l=(s-n)*a/u+n,c=(o-r)*a/u+r;return t.Color.getColor(f,l,c)},getRandomColor:function(e,n,r){if("undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=255),"undefined"==typeof r&&(r=255),n>255||e>n)return t.Color.getColor(255,255,255);var i=e+Math.round(Math.random()*(n-e)),s=e+Math.round(Math.random()*(n-e)),o=e+Math.round(Math.random()*(n-e));return t.Color.getColor32(r,i,s,o)},getRGB:function(e){return e>16777215?{alpha:e>>>24,red:e>>16&255,green:e>>8&255,blue:255&e,a:e>>>24,r:e>>16&255,g:e>>8&255,b:255&e}:{alpha:255,red:e>>16&255,green:e>>8&255,blue:255&e,a:255,r:e>>16&255,g:e>>8&255,b:255&e}},getWebRGB:function(e){if("object"==typeof e)return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")";var n=t.Color.getRGB(e);return"rgba("+n.r.toString()+","+n.g.toString()+","+n.b.toString()+","+(n.a/255).toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return 255&e},getColorInfo:function(e){var n=t.Color.getRGB(e),r=t.Color.RGBtoHexstring(e)+"\n";return r=r.concat("Alpha: "+n.alpha+" Red: "+n.red+" Green: "+n.green+" Blue: "+n.blue)+"\n"},RGBtoHexstring:function(e){var n=t.Color.getRGB(e);return"0x"+t.Color.colorToHexstring(n.alpha)+t.Color.colorToHexstring(n.red)+t.Color.colorToHexstring(n.green)+t.Color.colorToHexstring(n.blue)},RGBtoWebstring:function(e){var n=t.Color.getRGB(e);return"#"+t.Color.colorToHexstring(n.red)+t.Color.colorToHexstring(n.green)+t.Color.colorToHexstring(n.blue)},colorToHexstring:function(e){var t="0123456789ABCDEF",n=e%16,r=(e-n)/16,i=t.charAt(r)+t.charAt(n);return i}},t.Physics=function(e,t){t=t||{},this.game=e,this.config=t,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.parseConfig()},t.Physics.ARCADE=0,t.Physics.P2JS=1,t.Physics.NINJA=2,t.Physics.BOX2D=3,t.Physics.CHIPMUNK=5,t.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&this.config.arcade!==!0||!t.Physics.hasOwnProperty("Arcade")||(this.arcade=new t.Physics.Arcade(this.game),this.game.time.deltaCap=.2),this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&t.Physics.hasOwnProperty("Ninja")&&(this.ninja=new t.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&this.config.p2===!0&&t.Physics.hasOwnProperty("P2")&&(this.p2=new t.Physics.P2(this.game,this.config))},startSystem:function(e){if(e===t.Physics.ARCADE?this.arcade=new t.Physics.Arcade(this.game):e===t.Physics.P2JS&&(this.p2=new t.Physics.P2(this.game,this.config)),e===t.Physics.NINJA)this.ninja=new t.Physics.Ninja(this.game);else{if(e===t.Physics.BOX2D&&null===this.box2d)throw new Error("The Box2D physics system has not been implemented yet.");if(e===t.Physics.CHIPMUNK&&null===this.chipmunk)throw new Error("The Chipmunk physics system has not been implemented yet.")}this.setBoundsToWorld()},enable:function(e,n,r){"undefined"==typeof n&&(n=t.Physics.ARCADE),"undefined"==typeof r&&(r=!1),n===t.Physics.ARCADE?this.arcade.enable(e):n===t.Physics.P2JS&&this.p2?this.p2.enable(e,r):n===t.Physics.NINJA&&this.ninja&&this.ninja.enableAABB(e)},preUpdate:function(){this.p2&&this.p2.preUpdate()},update:function(){this.p2&&this.p2.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear()},destroy:function(){this.p2&&this.p2.destroy(),this.arcade=null,this.ninja=null,this.p2=null}},t.Physics.prototype.constructor=t.Physics,t.Physics.Arcade=function(e){this.game=e,this.gravity=new t.Point,this.bounds=new t.Rectangle(0,0,e.world.width,e.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.TILE_BIAS=16,this.forceX=!1,this.quadTree=new t.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0},t.Physics.Arcade.prototype.constructor=t.Physics.Arcade,t.Physics.Arcade.prototype={setBounds:function(e,t,n,r){this.bounds.setTo(e,t,n,r)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(e,n){"undefined"==typeof n&&(n=!0);var r=1;if(Array.isArray(e))for(r=e.length;r--;)e[r]instanceof t.Group?this.enable(e[r].children,n):(this.enableBody(e[r]),n&&e[r].hasOwnProperty("children")&&e[r].children.length>0&&this.enable(e[r],!0));else e instanceof t.Group?this.enable(e.children,n):(this.enableBody(e),n&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,!0))},enableBody:function(e){e.hasOwnProperty("body")&&null===e.body&&(e.body=new t.Physics.Arcade.Body(e))},updateMotion:function(e){this._velocityDelta=this.computeVelocity(0,e,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity,e.angularVelocity+=this._velocityDelta,e.rotation+=e.angularVelocity*this.game.time.physicsElapsed,e.velocity.x=this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x,e.maxVelocity.x),e.velocity.y=this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y,e.maxVelocity.y)},computeVelocity:function(e,t,n,r,i,s){return s=s||1e4,1==e&&t.allowGravity?n+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:2==e&&t.allowGravity&&(n+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?n+=r*this.game.time.physicsElapsed:i&&(this._drag=i*this.game.time.physicsElapsed,n-this._drag>0?n-=this._drag:n+this._drag<0?n+=this._drag:n=0),n>s?n=s:-s>n&&(n=-s),n},overlap:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._result=!1,this._total=0,Array.isArray(t))for(var s=0,o=t.length;o>s;s++)this.collideHandler(e,t[s],n,r,i,!0);else this.collideHandler(e,t,n,r,i,!0);return this._total>0},collide:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._result=!1,this._total=0,Array.isArray(t))for(var s=0,o=t.length;o>s;s++)this.collideHandler(e,t[s],n,r,i,!1);else this.collideHandler(e,t,n,r,i,!1);return this._total>0},collideHandler:function(e,n,r,i,s,o){return"undefined"!=typeof n||e.type!==t.GROUP&&e.type!==t.EMITTER?void (e&&n&&e.exists&&n.exists&&(e.type==t.SPRITE||e.type==t.TILESPRITE?n.type==t.SPRITE||n.type==t.TILESPRITE?this.collideSpriteVsSprite(e,n,r,i,s,o):n.type==t.GROUP||n.type==t.EMITTER?this.collideSpriteVsGroup(e,n,r,i,s,o):n.type==t.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(e,n,r,i,s):e.type==t.GROUP?n.type==t.SPRITE||n.type==t.TILESPRITE?this.collideSpriteVsGroup(n,e,r,i,s,o):n.type==t.GROUP||n.type==t.EMITTER?this.collideGroupVsGroup(e,n,r,i,s,o):n.type==t.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,n,r,i,s):e.type==t.TILEMAPLAYER?n.type==t.SPRITE||n.type==t.TILESPRITE?this.collideSpriteVsTilemapLayer(n,e,r,i,s):(n.type==t.GROUP||n.type==t.EMITTER)&&this.collideGroupVsTilemapLayer(n,e,r,i,s):e.type==t.EMITTER&&(n.type==t.SPRITE||n.type==t.TILESPRITE?this.collideSpriteVsGroup(n,e,r,i,s,o):n.type==t.GROUP||n.type==t.EMITTER?this.collideGroupVsGroup(e,n,r,i,s,o):n.type==t.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,n,r,i,s)))):void this.collideGroupVsSelf(e,r,i,s,o)},collideSpriteVsSprite:function(e,t,n,r,i,s){return e.body&&t.body?(this.separate(e.body,t.body,r,i,s)&&(n&&n.call(i,e,t),this._total++),!0):!1},collideSpriteVsGroup:function(e,t,n,r,i,s){if(0!==t.length&&e.body){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(t),this._potentials=this.quadTree.retrieve(e);for(var o=0,u=this._potentials.length;u>o;o++)this.separate(e.body,this._potentials[o],r,i,s)&&(n&&n.call(i,e,this._potentials[o].sprite),this._total++)}},collideGroupVsSelf:function(e,t,n,r,i){if(0!==e.length)for(var s=e.children.length,o=0;s>o;o++)for(var u=o+1;s>=u;u++)e.children[o]&&e.children[u]&&e.children[o].exists&&e.children[u].exists&&this.collideSpriteVsSprite(e.children[o],e.children[u],t,n,r,i)},collideGroupVsGroup:function(e,t,n,r,i,s){if(0!==e.length&&0!==t.length)for(var o=0,u=e.children.length;u>o;o++)e.children[o].exists&&this.collideSpriteVsGroup(e.children[o],t,n,r,i,s)},collideSpriteVsTilemapLayer:function(e,t,n,r,i){if(e.body&&(this._mapData=t.getTiles(e.body.position.x-e.body.tilePadding.x,e.body.position.y-e.body.tilePadding.y,e.body.width+e.body.tilePadding.x,e.body.height+e.body.tilePadding.y,!1,!1),0!==this._mapData.length))for(var s=0;s<this._mapData.length;s++)r?r.call(i,e,this._mapData[s])&&this.separateTile(s,e.body,this._mapData[s])&&(this._total++,n&&n.call(i,e,this._mapData[s])):this.separateTile(s,e.body,this._mapData[s])&&(this._total++,n&&n.call(i,e,this._mapData[s]))},collideGroupVsTilemapLayer:function(e,t,n,r,i){if(0!==e.length)for(var s=0,o=e.children.length;o>s;s++)e.children[s].exists&&this.collideSpriteVsTilemapLayer(e.children[s],t,n,r,i)},separate:function(e,t,n,r,i){return e.enable&&t.enable&&this.intersects(e,t)?n&&n.call(r,e.sprite,t.sprite)===!1?!1:i?!0:(this._result=this.forceX||Math.abs(this.gravity.y+e.gravity.y)<Math.abs(this.gravity.x+e.gravity.x)?this.separateX(e,t,i)||this.separateY(e,t,i):this.separateY(e,t,i)||this.separateX(e,t,i),this._result):!1},intersects:function(e,t){return e.right<=t.position.x?!1:e.bottom<=t.position.y?!1:e.position.x>=t.right?!1:e.position.y>=t.bottom?!1:!0},separateX:function(e,t,n){return e.immovable&&t.immovable?!1:(this._overlap=0,this.intersects(e,t)&&(this._maxOverlap=e.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS,0===e.deltaX()&&0===t.deltaX()?(e.embedded=!0,t.embedded=!0):e.deltaX()>t.deltaX()?(this._overlap=e.right-t.x,this._overlap>this._maxOverlap||e.checkCollision.right===!1||t.checkCollision.left===!1?this._overlap=0:(e.touching.none=!1,e.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):e.deltaX()<t.deltaX()&&(this._overlap=e.x-t.width-t.x,-this._overlap>this._maxOverlap||e.checkCollision.left===!1||t.checkCollision.right===!1?this._overlap=0:(e.touching.none=!1,e.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),0!==this._overlap)?(e.overlapX=this._overlap,t.overlapX=this._overlap,n||e.customSeparateX||t.customSeparateX?!0:(this._velocity1=e.velocity.x,this._velocity2=t.velocity.x,e.immovable||t.immovable?e.immovable?t.immovable||(t.x+=this._overlap,t.velocity.x=this._velocity1-this._velocity2*t.bounce.x):(e.x=e.x-this._overlap,e.velocity.x=this._velocity2-this._velocity1*e.bounce.x):(this._overlap*=.5,e.x=e.x-this._overlap,t.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/e.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*e.mass/t.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,e.velocity.x=this._average+this._newVelocity1*e.bounce.x,t.velocity.x=this._average+this._newVelocity2*t.bounce.x),!0)):!1)},separateY:function(e,t,n){return e.immovable&&t.immovable?!1:(this._overlap=0,this.intersects(e,t)&&(this._maxOverlap=e.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS,0===e.deltaY()&&0===t.deltaY()?(e.embedded=!0,t.embedded=!0):e.deltaY()>t.deltaY()?(this._overlap=e.bottom-t.y,this._overlap>this._maxOverlap||e.checkCollision.down===!1||t.checkCollision.up===!1?this._overlap=0:(e.touching.none=!1,e.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):e.deltaY()<t.deltaY()&&(this._overlap=e.y-t.bottom,-this._overlap>this._maxOverlap||e.checkCollision.up===!1||t.checkCollision.down===!1?this._overlap=0:(e.touching.none=!1,e.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),0!==this._overlap)?(e.overlapY=this._overlap,t.overlapY=this._overlap,n||e.customSeparateY||t.customSeparateY?!0:(this._velocity1=e.velocity.y,this._velocity2=t.velocity.y,e.immovable||t.immovable?e.immovable?t.immovable||(t.y+=this._overlap,t.velocity.y=this._velocity1-this._velocity2*t.bounce.y,e.moves&&(t.x+=e.x-e.prev.x)):(e.y=e.y-this._overlap,e.velocity.y=this._velocity2-this._velocity1*e.bounce.y,t.moves&&(e.x+=t.x-t.prev.x)):(this._overlap*=.5,e.y=e.y-this._overlap,t.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/e.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*e.mass/t.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,e.velocity.y=this._average+this._newVelocity1*e.bounce.y,t.velocity.y=this._average+this._newVelocity2*t.bounce.y),!0)):!1)},separateTile:function(e,t,n){if(!t.enable||!n.intersects(t.position.x,t.position.y,t.right,t.bottom))return!1;if(n.collisionCallback&&!n.collisionCallback.call(n.collisionCallbackContext,t.sprite,n))return!1;if(n.layer.callbacks[n.index]&&!n.layer.callbacks[n.index].callback.call(n.layer.callbacks[n.index].callbackContext,t.sprite,n))return!1;if(!(n.faceLeft||n.faceRight||n.faceTop||n.faceBottom))return!1;var r=0,i=0,s=0,o=1;if(t.deltaAbsX()>t.deltaAbsY()?s=-1:t.deltaAbsX()<t.deltaAbsY()&&(o=-1),0!==t.deltaX()&&0!==t.deltaY()&&(n.faceLeft||n.faceRight)&&(n.faceTop||n.faceBottom)&&(s=Math.min(Math.abs(t.position.x-n.right),Math.abs(t.right-n.left)),o=Math.min(Math.abs(t.position.y-n.bottom),Math.abs(t.bottom-n.top))),o>s){if((n.faceLeft||n.faceRight)&&(r=this.tileCheckX(t,n),0!==r&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(n.faceTop||n.faceBottom)&&(i=this.tileCheckY(t,n))}else{if((n.faceTop||n.faceBottom)&&(i=this.tileCheckY(t,n),0!==i&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(n.faceLeft||n.faceRight)&&(r=this.tileCheckX(t,n))}return 0!==r||0!==i},tileCheckX:function(e,t){var n=0;return e.deltaX()<0&&!e.blocked.left&&t.collideRight&&e.checkCollision.left?t.faceRight&&e.x<t.right&&(n=e.x-t.right,n<-this.TILE_BIAS&&(n=0)):e.deltaX()>0&&!e.blocked.right&&t.collideLeft&&e.checkCollision.right&&t.faceLeft&&e.right>t.left&&(n=e.right-t.left,n>this.TILE_BIAS&&(n=0)),0!==n&&this.processTileSeparationX(e,n),n},tileCheckY:function(e,t){var n=0;return e.deltaY()<0&&!e.blocked.up&&t.collideDown&&e.checkCollision.up?t.faceBottom&&e.y<t.bottom&&(n=e.y-t.bottom,n<-this.TILE_BIAS&&(n=0)):e.deltaY()>0&&!e.blocked.down&&t.collideUp&&e.checkCollision.down&&t.faceTop&&e.bottom>t.top&&(n=e.bottom-t.top,n>this.TILE_BIAS&&(n=0)),0!==n&&this.processTileSeparationY(e,n),n},processTileSeparationX:function(e,t){0>t?e.blocked.left=!0:t>0&&(e.blocked.right=!0),e.position.x-=t,e.velocity.x=0===e.bounce.x?0:-e.velocity.x*e.bounce.x},processTileSeparationY:function(e,t){0>t?e.blocked.up=!0:t>0&&(e.blocked.down=!0),e.position.y-=t,e.velocity.y=0===e.bounce.y?0:-e.velocity.y*e.bounce.y},getObjectsUnderPointer:function(e,n,r,i){if(0!==n.length&&e.exists){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(n);var s=new t.Rectangle(e.x,e.y,1,1),o=[];this._potentials=this.quadTree.retrieve(s);for(var u=0,a=this._potentials.length;a>u;u++)this._potentials[u].hitTest(e.x,e.y)&&(r&&r.call(i,e,this._potentials[u].sprite),o.push(this._potentials[u].sprite));return o}},moveToObject:function(e,t,n,r){return"undefined"==typeof n&&(n=60),"undefined"==typeof r&&(r=0),this._angle=Math.atan2(t.y-e.y,t.x-e.x),r>0&&(n=this.distanceBetween(e,t)/(r/1e3)),e.body.velocity.x=Math.cos(this._angle)*n,e.body.velocity.y=Math.sin(this._angle)*n,this._angle},moveToPointer:function(e,t,n,r){return"undefined"==typeof t&&(t=60),n=n||this.game.input.activePointer,"undefined"==typeof r&&(r=0),this._angle=this.angleToPointer(e,n),r>0&&(t=this.distanceToPointer(e,n)/(r/1e3)),e.body.velocity.x=Math.cos(this._angle)*t,e.body.velocity.y=Math.sin(this._angle)*t,this._angle},moveToXY:function(e,t,n,r,i){return"undefined"==typeof r&&(r=60),"undefined"==typeof i&&(i=0),this._angle=Math.atan2(n-e.y,t-e.x),i>0&&(r=this.distanceToXY(e,t,n)/(i/1e3)),e.body.velocity.x=Math.cos(this._angle)*r,e.body.velocity.y=Math.sin(this._angle)*r,this._angle},velocityFromAngle:function(e,n,r){return"undefined"==typeof n&&(n=60),r=r||new t.Point,r.setTo(Math.cos(this.game.math.degToRad(e))*n,Math.sin(this.game.math.degToRad(e))*n)},velocityFromRotation:function(e,n,r){return"undefined"==typeof n&&(n=60),r=r||new t.Point,r.setTo(Math.cos(e)*n,Math.sin(e)*n)},accelerationFromRotation:function(e,n,r){return"undefined"==typeof n&&(n=60),r=r||new t.Point,r.setTo(Math.cos(e)*n,Math.sin(e)*n)},accelerateToObject:function(e,t,n,r,i){return"undefined"==typeof n&&(n=60),"undefined"==typeof r&&(r=1e3),"undefined"==typeof i&&(i=1e3),this._angle=this.angleBetween(e,t),e.body.acceleration.setTo(Math.cos(this._angle)*n,Math.sin(this._angle)*n),e.body.maxVelocity.setTo(r,i),this._angle},accelerateToPointer:function(e,t,n,r,i){return"undefined"==typeof n&&(n=60),"undefined"==typeof t&&(t=this.game.input.activePointer),"undefined"==typeof r&&(r=1e3),"undefined"==typeof i&&(i=1e3),this._angle=this.angleToPointer(e,t),e.body.acceleration.setTo(Math.cos(this._angle)*n,Math.sin(this._angle)*n),e.body.maxVelocity.setTo(r,i),this._angle},accelerateToXY:function(e,t,n,r,i,s){return"undefined"==typeof r&&(r=60),"undefined"==typeof i&&(i=1e3),"undefined"==typeof s&&(s=1e3),this._angle=this.angleToXY(e,t,n),e.body.acceleration.setTo(Math.cos(this._angle)*r,Math.sin(this._angle)*r),e.body.maxVelocity.setTo(i,s),this._angle},distanceBetween:function(e,t){return this._dx=e.x-t.x,this._dy=e.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(e,t,n){return this._dx=e.x-t,this._dy=e.y-n,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(e,t){return t=t||this.game.input.activePointer,this._dx=e.x-t.x,this._dy=e.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(e,t){return this._dx=t.x-e.x,this._dy=t.y-e.y,Math.atan2(this._dy,this._dx)},angleToXY:function(e,t,n){return this._dx=t-e.x,this._dy=n-e.y,Math.atan2(this._dy,this._dx)},angleToPointer:function(e,t){return t=t||this.game.input.activePointer,this._dx=t.worldX-e.x,this._dy=t.worldY-e.y,Math.atan2(this._dy,this._dx)}},t.Physics.Arcade.Body=function(e){this.sprite=e,this.game=e.game,this.type=t.Physics.ARCADE,this.enable=!0,this.offset=new t.Point,this.position=new t.Point(e.x,e.y),this.prev=new t.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=e.rotation,this.preRotation=e.rotation,this.sourceWidth=e.texture.frame.width,this.sourceHeight=e.texture.frame.height,this.width=e.width,this.height=e.height,this.halfWidth=Math.abs(e.width/2),this.halfHeight=Math.abs(e.height/2),this.center=new t.Point(e.x+this.halfWidth,e.y+this.halfHeight),this.velocity=new t.Point,this.newVelocity=new t.Point(0,0),this.deltaMax=new t.Point(0,0),this.acceleration=new t.Point,this.drag=new t.Point,this.allowGravity=!0,this.gravity=new t.Point(0,0),this.bounce=new t.Point,this.maxVelocity=new t.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=t.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new t.Point,this.phase=0,this._reset=!0,this._sx=e.scale.x,this._sy=e.scale.y,this._dx=0,this._dy=0},t.Physics.Arcade.Body.prototype={updateBounds:function(){var e=Math.abs(this.sprite.scale.x),t=Math.abs(this.sprite.scale.y);(e!==this._sx||t!==this._sy)&&(this.width=this.sourceWidth*e,this.height=this.sourceHeight*t,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=e,this._sy=t,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||1===this.sprite._cache[4])&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&2!==this.phase&&(this.phase=2,this.deltaX()<0?this.facing=t.LEFT:this.deltaX()>0&&(this.facing=t.RIGHT),this.deltaY()<0?this.facing=t.UP:this.deltaY()>0&&(this.facing=t.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.x+=this._dx,this.sprite.y+=this._dy),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0),this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(e,t,n,r){"undefined"==typeof n&&(n=this.offset.x),"undefined"==typeof r&&(r=this.offset.y),this.sourceWidth=e,this.sourceHeight=t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(n,r),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(e,t){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=e-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=t-this.sprite.anchor.y*this.height+this.offset.y,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(e,n){return t.Rectangle.contains(this,e,n)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}},Object.defineProperty(t.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.Physics.Arcade.Body.render=function(e,t,n,r){"undefined"==typeof r&&(r=!0),n=n||"rgba(0,255,0,0.4)",r?(e.fillStyle=n,e.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)):(e.strokeStyle=n,e.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height))},t.Physics.Arcade.Body.renderBodyInfo=function(e,t){e.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height),e.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2)),e.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2)),e.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2)),e.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down),e.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)},t.Physics.Arcade.Body.prototype.constructor=t.Physics.Arcade.Body,t.Particles=function(e){this.game=e,this.emitters={},this.ID=0},t.Particles.prototype={add:function(e){return this.emitters[e.name]=e,e},remove:function(e){delete this.emitters[e.name]},update:function(){for(var e in this.emitters)this.emitters[e].exists&&this.emitters[e].update()}},t.Particles.prototype.constructor=t.Particles,t.Particles.Arcade={},t.Particles.Arcade.Emitter=function(e,n,r,i){this.maxParticles=i||50,t.Group.call(this,e),this.name="emitter"+this.game.particles.ID++,this.type=t.EMITTER,this.area=new t.Rectangle(n,r,1,1),this.minParticleSpeed=new t.Point(-100,-100),this.maxParticleSpeed=new t.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=t.Particle,this.particleDrag=new t.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new t.Point,this.on=!1,this.particleAnchor=new t.Point(.5,.5),this.blendMode=t.blendModes.NORMAL,this.emitX=n,this.emitY=r,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new t.Point(1,1),this._maxParticleScale=new t.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._explode=!0,this._frames=null},t.Particles.Arcade.Emitter.prototype=Object.create(t.Group.prototype),t.Particles.Arcade.Emitter.prototype.constructor=t.Particles.Arcade.Emitter,t.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency);for(var e=this.children.length;e--;)this.children[e].exists&&this.children[e].update()},t.Particles.Arcade.Emitter.prototype.makeParticles=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.maxParticles),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1);var s,o=0,u=e,a=t;for(this._frames=t;n>o;)Array.isArray(e)&&(u=this.game.rnd.pick(e)),Array.isArray(t)&&(a=this.game.rnd.pick(t)),s=new this.particleClass(this.game,0,0,u,a),this.game.physics.arcade.enable(s,!1),r?(s.body.checkCollision.any=!0,s.body.checkCollision.none=!1):s.body.checkCollision.none=!0,s.body.collideWorldBounds=i,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),o++;return this},t.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1,this.alive=!1,this.exists=!1},t.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0,this.exists=!0},t.Particles.Arcade.Emitter.prototype.explode=function(e,t){this.start(!0,e,0,t,!1)},t.Particles.Arcade.Emitter.prototype.flow=function(e,t,n){this.start(!1,e,t,n,!0)},t.Particles.Arcade.Emitter.prototype.start=function(e,t,n,r,i){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=0),("undefined"==typeof n||null===n)&&(n=250),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=!1),this.revive(),this.visible=!0,this.on=!0,this._explode=e,this.lifespan=t,this.frequency=n,e||i?this._quantity=r:this._quantity+=r,this._counter=0,this._timer=this.game.time.now+n},t.Particles.Arcade.Emitter.prototype.emitParticle=function(){var e=this.getFirstExists(!1);null!==e&&(this.width>1||this.height>1?e.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):e.reset(this.emitX,this.emitY),e.angle=0,e.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(e):this.particleSendToBack&&this.sendToBack(e),this.autoScale?e.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?e.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&e.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),e.frame=Array.isArray("object"===this._frames)?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?e.setAlphaData(this.alphaData):e.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),e.blendMode=this.blendMode,e.body.updateBounds(),e.body.bounce.setTo(this.bounce.x,this.bounce.y),e.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),e.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),e.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation),e.body.gravity.y=this.gravity,e.body.drag.x=this.particleDrag.x,e.body.drag.y=this.particleDrag.y,e.body.angularDrag=this.angularDrag,e.onEmit())},t.Particles.Arcade.Emitter.prototype.setSize=function(e,t){this.area.width=e,this.area.height=t},t.Particles.Arcade.Emitter.prototype.setXSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.x=e,this.maxParticleSpeed.x=t},t.Particles.Arcade.Emitter.prototype.setYSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.y=e,this.maxParticleSpeed.y=t},t.Particles.Arcade.Emitter.prototype.setRotation=function(e,t){e=e||0,t=t||0,this.minRotation=e,this.maxRotation=t},t.Particles.Arcade.Emitter.prototype.setAlpha=function(e,n,r,i,s){if("undefined"==typeof e&&(e=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=t.Easing.Linear.None),"undefined"==typeof s&&(s=!1),this.minParticleAlpha=e,this.maxParticleAlpha=n,this.autoAlpha=!1,r>0&&e!==n){var o={v:e},u=this.game.make.tween(o).to({v:n},r,i);u.yoyo(s),this.alphaData=u.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}},t.Particles.Arcade.Emitter.prototype.setScale=function(e,n,r,i,s,o,u){if("undefined"==typeof e&&(e=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=t.Easing.Linear.None),"undefined"==typeof u&&(u=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(e,r),this._maxParticleScale.set(n,i),this.autoScale=!1,s>0&&e!==n||r!==i){var a={x:e,y:r},f=this.game.make.tween(a).to({x:n,y:i},s,o);f.yoyo(u),this.scaleData=f.generateData(60),this.scaleData.reverse(),this.autoScale=!0}},t.Particles.Arcade.Emitter.prototype.at=function(e){e.center?(this.emitX=e.center.x,this.emitY=e.center.y):(this.emitX=e.world.x+e.anchor.x*e.width,this.emitY=e.world.y+e.anchor.y*e.height)},Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(e){this.area.width=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(e){this.area.height=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),t.Tile=function(e,t,n,r,i,s){this.layer=e,this.index=t,this.x=n,this.y=r,this.worldX=n*i,this.worldY=r*s,this.width=i,this.height=s,this.centerX=Math.abs(i/2),this.centerY=Math.abs(s/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},t.Tile.prototype={containsPoint:function(e,t){return!(e<this.worldX||t<this.worldY||e>this.right||t>this.bottom)},intersects:function(e,t,n,r){return n<=this.worldX?!1:r<=this.worldY?!1:e>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(e,t){this.collisionCallback=e,this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(e,t,n,r){this.collideLeft=e,this.collideRight=t,this.collideUp=n,this.collideDown=r},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(e,t){return e&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(e){this.index=e.index,this.alpha=e.alpha,this.properties=e.properties,this.collideUp=e.collideUp,this.collideDown=e.collideDown,this.collideLeft=e.collideLeft,this.collideRight=e.collideRight,this.collisionCallback=e.collisionCallback,this.collisionCallbackContext=e.collisionCallbackContext}},t.Tile.prototype.constructor=t.Tile,Object.defineProperty(t.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(t.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(t.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(t.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(t.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(t.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),t.Tilemap=function(e,n,r,i,s,o){this.game=e,this.key=n;var u=t.TilemapParser.parse(this.game,n,r,i,s,o);null!==u&&(this.width=u.width,this.height=u.height,this.tileWidth=u.tileWidth,this.tileHeight=u.tileHeight,this.orientation=u.orientation,this.format=u.format,this.version=u.version,this.properties=u.properties,this.widthInPixels=u.widthInPixels,this.heightInPixels=u.heightInPixels,this.layers=u.layers,this.tilesets=u.tilesets,this.tiles=u.tiles,this.objects=u.objects,this.collideIndexes=[],this.collision=u.collision,this.images=u.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},t.Tilemap.CSV=0,t.Tilemap.TILED_JSON=1,t.Tilemap.NORTH=0,t.Tilemap.EAST=1,t.Tilemap.SOUTH=2,t.Tilemap.WEST=3,t.Tilemap.prototype={create:function(e,t,n,r,i,s){return"undefined"==typeof s&&(s=this.game.world),this.width=t,this.height=n,this.setTileSize(r,i),this.layers.length=0,this.createBlankLayer(e,t,n,r,i,s)},setTileSize:function(e,t){this.tileWidth=e,this.tileHeight=t,this.widthInPixels=this.width*e,this.heightInPixels=this.height*t},addTilesetImage:function(e,n,r,i,s,o,u){if("undefined"==typeof r&&(r=this.tileWidth),"undefined"==typeof i&&(i=this.tileHeight),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),"undefined"==typeof u&&(u=0),0===r&&(r=32),0===i&&(i=32),"undefined"==typeof n){if("string"!=typeof e)return null;if(n=e,!this.game.cache.checkImageKey(n))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+n+'"'),null}if("string"==typeof e&&(e=this.getTilesetIndex(e),null===e&&this.format===t.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+n+'"'),null;if(this.tilesets[e])return this.tilesets[e].setImage(this.game.cache.getImage(n)),this.tilesets[e];var a=new t.Tileset(n,u,r,i,s,o,{});a.setImage(this.game.cache.getImage(n)),this.tilesets.push(a);for(var f=this.tilesets.length-1,l=s,c=s,h=0,p=0,d=0,v=u;v<u+a.total&&(this.tiles[v]=[l,c,f],l+=r+o,h++,h!==a.total)&&(p++,p!==a.columns||(l=s,c+=i+o,p=0,d++,d!==a.rows));v++);return a},createFromObjects:function(e,n,r,i,s,o,u,a,f){if("undefined"==typeof s&&(s=!0),"undefined"==typeof o&&(o=!1),"undefined"==typeof u&&(u=this.game.world),"undefined"==typeof a&&(a=t.Sprite),"undefined"==typeof f&&(f=!0),!this.objects[e])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+e);for(var l,c=0,h=this.objects[e].length;h>c;c++)if(this.objects[e][c].gid===n){l=new a(this.game,this.objects[e][c].x,this.objects[e][c].y,r,i),l.name=this.objects[e][c].name,l.visible=this.objects[e][c].visible,l.autoCull=o,l.exists=s,f&&(l.y-=l.height),u.add(l);for(var p in this.objects[e][c].properties)u.set(l,p,this.objects[e][c].properties[p],!1,!1,0,!0)}},createLayer:function(e,n,r,i){"undefined"==typeof n&&(n=this.game.width),"undefined"==typeof r&&(r=this.game.height),"undefined"==typeof i&&(i=this.game.world);var s=e;return"string"==typeof e&&(s=this.getLayerIndex(e)),null===s||s>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+s):i.add(new t.TilemapLayer(this.game,this,s,n,r))},createBlankLayer:function(e,n,r,i,s,o){if("undefined"==typeof o&&(o=this.game.world),null!==this.getLayerIndex(e))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var u,a={name:e,x:0,y:0,width:n,height:r,widthInPixels:n*i,heightInPixels:r*s,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},f=[],l=0;r>l;l++){u=[];for(var c=0;n>c;c++)u.push(new t.Tile(a,-1,c,l,i,s));f.push(u)}a.data=f,this.layers.push(a),this.currentLayer=this.layers.length-1;var h=a.widthInPixels,p=a.heightInPixels;h>this.game.width&&(h=this.game.width),p>this.game.height&&(p=this.game.height);var f=new t.TilemapLayer(this.game,this,this.layers.length-1,h,p);return f.name=e,o.add(f)},getIndex:function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return n;return null},getLayerIndex:function(e){return this.getIndex(this.layers,e)},getTilesetIndex:function(e){return this.getIndex(this.tilesets,e)},getImageIndex:function(e){return this.getIndex(this.images,e)},getObjectIndex:function(e){return this.getIndex(this.objects,e)},setTileIndexCallback:function(e,t,n,r){if(r=this.getLayer(r),"number"==typeof e)this.layers[r].callbacks[e]={callback:t,callbackContext:n};else for(var i=0,s=e.length;s>i;i++)this.layers[r].callbacks[e[i]]={callback:t,callbackContext:n}},setTileLocationCallback:function(e,t,n,r,i,s,o){if(o=this.getLayer(o),this.copy(e,t,n,r,o),!(this._results.length<2))for(var u=1;u<this._results.length;u++)this._results[u].setCollisionCallback(i,s)},setCollision:function(e,t,n,r){if("undefined"==typeof t&&(t=!0),"undefined"==typeof r&&(r=!0),n=this.getLayer(n),"number"==typeof e)return this.setCollisionByIndex(e,t,n,!0);for(var i=0,s=e.length;s>i;i++)this.setCollisionByIndex(e[i],t,n,!1);r&&this.calculateFaces(n)},setCollisionBetween:function(e,t,n,r,i){if("undefined"==typeof n&&(n=!0),"undefined"==typeof i&&(i=!0),r=this.getLayer(r),!(e>t)){for(var s=e;t>=s;s++)this.setCollisionByIndex(s,n,r,!1);i&&this.calculateFaces(r)}},setCollisionByExclusion:function(e,t,n,r){"undefined"==typeof t&&(t=!0),"undefined"==typeof r&&(r=!0),n=this.getLayer(n);for(var i=0,s=this.tiles.length;s>i;i++)-1===e.indexOf(i)&&this.setCollisionByIndex(i,t,n,!1);r&&this.calculateFaces(n)},setCollisionByIndex:function(e,t,n,r){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=this.currentLayer),"undefined"==typeof r&&(r=!0),t)this.collideIndexes.push(e);else{var i=this.collideIndexes.indexOf(e);i>-1&&this.collideIndexes.splice(i,1)}for(var s=0;s<this.layers[n].height;s++)for(var o=0;o<this.layers[n].width;o++){var u=this.layers[n].data[s][o];u&&u.index===e&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t)}return r&&this.calculateFaces(n),n},getLayer:function(e){return"undefined"==typeof e?e=this.currentLayer:"string"==typeof e?e=this.getLayerIndex(e):e instanceof t.TilemapLayer&&(e=e.index),e},setPreventRecalculate:function(e){if(e===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),e===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(e){if(this.preventingRecalculate===!0)return void (this.needToRecalculate[e]=!0);for(var t=null,n=null,r=null,i=null,s=0,o=this.layers[e].height;o>s;s++)for(var u=0,a=this.layers[e].width;a>u;u++){var f=this.layers[e].data[s][u];f&&(t=this.getTileAbove(e,u,s),n=this.getTileBelow(e,u,s),r=this.getTileLeft(e,u,s),i=this.getTileRight(e,u,s),f.collides&&(f.faceTop=!0,f.faceBottom=!0,f.faceLeft=!0,f.faceRight=!0),t&&t.collides&&(f.faceTop=!1),n&&n.collides&&(f.faceBottom=!1),r&&r.collides&&(f.faceLeft=!1),i&&i.collides&&(f.faceRight=!1))}},getTileAbove:function(e,t,n){return n>0?this.layers[e].data[n-1][t]:null},getTileBelow:function(e,t,n){return n<this.layers[e].height-1?this.layers[e].data[n+1][t]:null},getTileLeft:function(e,t,n){return t>0?this.layers[e].data[n][t-1]:null},getTileRight:function(e,t,n){return t<this.layers[e].width-1?this.layers[e].data[n][t+1]:null},setLayer:function(e){e=this.getLayer(e),this.layers[e]&&(this.currentLayer=e)},hasTile:function(e,t,n){return n=this.getLayer(n),null!==this.layers[n].data[t]&&null!==this.layers[n].data[t][e]},removeTile:function(e,n,r){if(r=this.getLayer(r),e>=0&&e<this.layers[r].width&&n>=0&&n<this.layers[r].height&&this.hasTile(e,n,r)){var i=this.layers[r].data[n][e];return this.layers[r].data[n][e]=new t.Tile(this.layers[r],-1,e,n,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),i}},removeTileWorldXY:function(e,t,n,r,i){return i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(e,t,i)},putTile:function(e,n,r,i){if(null===e)return this.removeTile(n,r,i);if(i=this.getLayer(i),n>=0&&n<this.layers[i].width&&r>=0&&r<this.layers[i].height){var s;return e instanceof t.Tile?(s=e.index,this.hasTile(n,r,i)?this.layers[i].data[r][n].copy(e):this.layers[i].data[r][n]=new t.Tile(i,s,n,r,e.width,e.height)):(s=e,this.hasTile(n,r,i)?this.layers[i].data[r][n].index=s:this.layers[i].data[r][n]=new t.Tile(this.layers[i],s,n,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(s)>-1?this.layers[i].data[r][n].setCollision(!0,!0,!0,!0):this.layers[i].data[r][n].resetCollision(),this.layers[i].dirty=!0,this.calculateFaces(i),this.layers[i].data[r][n]}return null},putTileWorldXY:function(e,t,n,r,i,s){return s=this.getLayer(s),t=this.game.math.snapToFloor(t,r)/r,n=this.game.math.snapToFloor(n,i)/i,this.putTile(e,t,n,s)},searchTileIndex:function(e,t,n,r){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=!1),r=this.getLayer(r);var i=0;if(n){for(var s=this.layers[r].height-1;s>=0;s--)for(var o=this.layers[r].width-1;o>=0;o--)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}}else for(var s=0;s<this.layers[r].height;s++)for(var o=0;o<this.layers[r].width;o++)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}return null},getTile:function(e,t,n,r){return"undefined"==typeof r&&(r=!1),n=this.getLayer(n),e>=0&&e<this.layers[n].width&&t>=0&&t<this.layers[n].height?-1===this.layers[n].data[t][e].index?r?this.layers[n].data[t][e]:null:this.layers[n].data[t][e]:null},getTileWorldXY:function(e,t,n,r,i){return"undefined"==typeof n&&(n=this.tileWidth),"undefined"==typeof r&&(r=this.tileHeight),i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.getTile(e,t,i)},copy:function(e,t,n,r,i){if(i=this.getLayer(i),!this.layers[i])return void (this._results.length=0);"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.layers[i].width),"undefined"==typeof r&&(r=this.layers[i].height),0>e&&(e=0),0>t&&(t=0),n>this.layers[i].width&&(n=this.layers[i].width),r>this.layers[i].height&&(r=this.layers[i].height),this._results.length=0,this._results.push({x:e,y:t,width:n,height:r,layer:i});for(var s=t;t+r>s;s++)for(var o=e;e+n>o;o++)this._results.push(this.layers[i].data[s][o]);return this._results},paste:function(e,t,n,r){if("undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),r=this.getLayer(r),n&&!(n.length<2)){for(var i=n[1].x-e,s=n[1].y-t,o=1;o<n.length;o++)this.layers[r].data[s+n[o].y][i+n[o].x].copy(n[o]);this.layers[r].dirty=!0,this.calculateFaces(r)}},swap:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o),this._results.length<2||(this._tempA=e,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(n,r,this._results,o))},swapHandler:function(e){e.index===this._tempA?e.index=this._tempB:e.index===this._tempB&&(e.index=this._tempA)},forEach:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o),this._results.length<2||(this._results.forEach(e,t),this.paste(n,r,this._results,o))},replace:function(e,t,n,r,i,s,o){if(o=this.getLayer(o),this.copy(n,r,i,s,o),!(this._results.length<2)){for(var u=1;u<this._results.length;u++)this._results[u].index===e&&(this._results[u].index=t);this.paste(n,r,this._results,o)}},random:function(e,t,n,r,i){if(i=this.getLayer(i),this.copy(e,t,n,r,i),!(this._results.length<2)){for(var s=[],o=1;o<this._results.length;o++)if(this._results[o].index){var u=this._results[o].index;-1===s.indexOf(u)&&s.push(u)}for(var a=1;a<this._results.length;a++)this._results[a].index=this.game.rnd.pick(s);this.paste(e,t,this._results,i)}},shuffle:function(e,n,r,i,s){if(s=this.getLayer(s),this.copy(e,n,r,i,s),!(this._results.length<2)){for(var o=[],u=1;u<this._results.length;u++)this._results[u].index&&o.push(this._results[u].index);t.Utils.shuffle(o);for(var a=1;a<this._results.length;a++)this._results[a].index=o[a-1];this.paste(e,n,this._results,s)}},fill:function(e,t,n,r,i,s){if(s=this.getLayer(s),this.copy(t,n,r,i,s),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index=e;this.paste(t,n,this._results,s)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var e="",t=[""],n=0;n<this.layers[this.currentLayer].height;n++){for(var r=0;r<this.layers[this.currentLayer].width;r++)e+="%c  ",t.push(this.layers[this.currentLayer].data[n][r]>1?this.debugMap[this.layers[this.currentLayer].data[n][r]]?"background: "+this.debugMap[this.layers[this.currentLayer].data[n][r]]:"background: #ffffff":"background: rgb(0, 0, 0)");e+="\n"}t[0]=e,console.log.apply(console,t)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},t.Tilemap.prototype.constructor=t.Tilemap,Object.defineProperty(t.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(e){e!==this.currentLayer&&this.setLayer(e)}}),t.TilemapLayer=function(e,n,r,i,s){this.game=e,this.map=n,this.index=r,this.layer=n.layers[r],this.canvas=t.Canvas.create(i,s,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new t.Frame(0,0,0,i,s,"tilemapLayer",e.rnd.uuid()),t.Image.call(this,this.game,0,0,this.texture,this.textureFrame),this.name="",this.type=t.TILEMAPLAYER,this.fixedToCamera=!0,this.cameraOffset=new t.Point(0,0),this.tileColor="rgb(255, 255, 255)",this.debug=!1,this.debugAlpha=.5,this.debugColor="rgba(0, 255, 0, 1)",this.debugFill=!1,this.debugFillColor="rgba(0, 255, 0, 0.2)",this.debugCallbackColor="rgba(255, 0, 0, 1)",this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this.wrap=!1,this._mc={cw:n.tileWidth,ch:n.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0},this._results=[],this.updateMax()},t.TilemapLayer.prototype=Object.create(t.Image.prototype),t.TilemapLayer.prototype.constructor=t.TilemapLayer,t.TilemapLayer.prototype.postUpdate=function(){t.Image.prototype.postUpdate.call(this),this.scrollX=this.game.camera.x*this.scrollFactorX,this.scrollY=this.game.camera.y*this.scrollFactorY,this.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},t.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)},t.TilemapLayer.prototype._fixX=function(e){return 0>e&&(e=0),1===this.scrollFactorX?e:this._mc.x+(e-this._mc.x/this.scrollFactorX)},t.TilemapLayer.prototype._unfixX=function(e){return 1===this.scrollFactorX?e:this._mc.x/this.scrollFactorX+(e-this._mc.x)},t.TilemapLayer.prototype._fixY=function(e){return 0>e&&(e=0),1===this.scrollFactorY?e:this._mc.y+(e-this._mc.y/this.scrollFactorY)},t.TilemapLayer.prototype._unfixY=function(e){return 1===this.scrollFactorY?e:this._mc.y/this.scrollFactorY+(e-this._mc.y)},t.TilemapLayer.prototype.getTileX=function(e){return this.game.math.snapToFloor(this._fixX(e),this.map.tileWidth)/this.map.tileWidth},t.TilemapLayer.prototype.getTileY=function(e){return this.game.math.snapToFloor(this._fixY(e),this.map.tileHeight)/this.map.tileHeight},t.TilemapLayer.prototype.getTileXY=function(e,t,n){return n.x=this.getTileX(e),n.y=this.getTileY(t),n},t.TilemapLayer.prototype.getRayCastTiles=function(e,t,n,r){("undefined"==typeof t||null===t)&&(t=this.rayStepRate),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1);var i=this.getTiles(e.x,e.y,e.width,e.height,n,r);if(0===i.length)return[];for(var s=e.coordinatesOnLine(t),o=s.length,u=[],a=0;a<i.length;a++)for(var f=0;o>f;f++)if(i[a].containsPoint(s[f][0],s[f][1])){u.push(i[a]);break}return u},t.TilemapLayer.prototype.getTiles=function(e,t,n,r,i,s){"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=!1),e=this._fixX(e),t=this._fixY(t),n>this.layer.widthInPixels&&(n=this.layer.widthInPixels),r>this.layer.heightInPixels&&(r=this.layer.heightInPixels),this._mc.tx=this.game.math.snapToFloor(e,this._mc.cw)/this._mc.cw,this._mc.ty=this.game.math.snapToFloor(t,this._mc.ch)/this._mc.ch,this._mc.tw=(this.game.math.snapToCeil(n,this._mc.cw)+this._mc.cw)/this._mc.cw,this._mc.th=(this.game.math.snapToCeil(r,this._mc.ch)+this._mc.ch)/this._mc.ch,this._results.length=0;for(var o=this._mc.ty;o<this._mc.ty+this._mc.th;o++)for(var u=this._mc.tx;u<this._mc.tx+this._mc.tw;u++)this.layer.data[o]&&this.layer.data[o][u]&&(!i&&!s||this.layer.data[o][u].isInteresting(i,s))&&this._results.push(this.layer.data[o][u]);return this._results},t.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1,this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1,this.dirty=!0},t.TilemapLayer.prototype.render=function(){if(this.layer.dirty&&(this.dirty=!0),this.dirty&&this.visible){this._mc.prevX=this._mc.dx,this._mc.prevY=this._mc.dy,this._mc.dx=-(this._mc.x-this._mc.startX*this.map.tileWidth),this._mc.dy=-(this._mc.y-this._mc.startY*this.map.tileHeight),this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.tileColor;var e,n;this.debug&&(this.context.globalAlpha=this.debugAlpha);for(var r=this._mc.startY,i=this._mc.startY+this._mc.maxY;i>r;r++){if(this._column=null,0>r&&this.wrap?this._column=this.layer.data[r+this.map.height]:r>=this.map.height&&this.wrap?this._column=this.layer.data[r-this.map.height]:this.layer.data[r]&&(this._column=this.layer.data[r]),this._column)for(var s=this._mc.startX,o=this._mc.startX+this._mc.maxX;o>s;s++){var e=null;0>s&&this.wrap?e=this._column[s+this.map.width]:s>=this.map.width&&this.wrap?e=this._column[s-this.map.width]:this._column[s]&&(e=this._column[s]),e&&e.index>-1&&(n=this.map.tilesets[this.map.tiles[e.index][2]],this.debug===!1&&e.alpha!==this.context.globalAlpha&&(this.context.globalAlpha=e.alpha),n.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),e.index),e.debug&&(this.context.fillStyle="rgba(0, 255, 0, 0.4)",this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight))),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}return this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.game.renderType===t.WEBGL&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1,this.layer.dirty=!1,!0}},t.TilemapLayer.prototype.renderDebug=function(){this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.strokeStyle=this.debugColor,this.context.fillStyle=this.debugFillColor;for(var e=this._mc.startY,t=this._mc.startY+this._mc.maxY;t>e;e++){if(this._column=null,0>e&&this.wrap?this._column=this.layer.data[e+this.map.height]:e>=this.map.height&&this.wrap?this._column=this.layer.data[e-this.map.height]:this.layer.data[e]&&(this._column=this.layer.data[e]),this._column)for(var n=this._mc.startX,r=this._mc.startX+this._mc.maxX;r>n;n++){var i=null;0>n&&this.wrap?i=this._column[n+this.map.width]:n>=this.map.width&&this.wrap?i=this._column[n-this.map.width]:this._column[n]&&(i=this._column[n]),i&&(i.faceTop||i.faceBottom||i.faceLeft||i.faceRight)&&(this._mc.tx=Math.floor(this._mc.tx),this.debugFill&&this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch),this.context.beginPath(),i.faceTop&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)),i.faceBottom&&(this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),i.faceLeft&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)),i.faceRight&&(this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),this.context.stroke()),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}},Object.defineProperty(t.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(e){e!==this._mc.x&&(this._mc.x=e,this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth),this.dirty=!0)}}),Object.defineProperty(t.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(e){e!==this._mc.y&&(this._mc.y=e,this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight),this.dirty=!0)}}),Object.defineProperty(t.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(e){this._mc.cw=e,this.dirty=!0}}),Object.defineProperty(t.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(e){this._mc.ch=e,this.dirty=!0}}),t.TilemapParser={parse:function(e,n,r,i,s,o){if("undefined"==typeof r&&(r=32),"undefined"==typeof i&&(i=32),"undefined"==typeof s&&(s=10),"undefined"==typeof o&&(o=10),"undefined"==typeof n)return this.getEmptyData();if(null===n)return this.getEmptyData(r,i,s,o);var u=e.cache.getTilemapData(n);if(u){if(u.format===t.Tilemap.CSV)return this.parseCSV(n,u.data,r,i);if(!u.format||u.format===t.Tilemap.TILED_JSON)return this.parseTiledJSON(u.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+n)},parseCSV:function(e,n,r,i){var s=this.getEmptyData();n=n.trim();for(var o=[],u=n.split("\n"),a=u.length,f=0,l=0;l<u.length;l++){o[l]=[];for(var c=u[l].split(","),h=0;h<c.length;h++)o[l][h]=new t.Tile(s.layers[0],parseInt(c[h],10),h,l,r,i);0===f&&(f=c.length)}return s.format=t.Tilemap.CSV,s.name=e,s.width=f,s.height=a,s.tileWidth=r,s.tileHeight=i,s.widthInPixels=f*r,s.heightInPixels=a*i,s.layers[0].width=f,s.layers[0].height=a,s.layers[0].widthInPixels=s.widthInPixels,s.layers[0].heightInPixels=s.heightInPixels,s.layers[0].data=o,s},getEmptyData:function(e,t,n,r){var i={};i.width=0,i.height=0,i.tileWidth=0,i.tileHeight=0,"undefined"!=typeof e&&null!==e&&(i.tileWidth=e),"undefined"!=typeof t&&null!==t&&(i.tileHeight=t),"undefined"!=typeof n&&null!==n&&(i.width=n),"undefined"!=typeof r&&null!==r&&(i.height=r),i.orientation="orthogonal",i.version="1",i.properties={},i.widthInPixels=0,i.heightInPixels=0;var s=[],o={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],data:[]};return s.push(o),i.layers=s,i.images=[],i.objects={},i.collision={},i.tilesets=[],i.tiles=[],i},parseTiledJSON:function(e){function n(e,t){var n={};for(var r in t){var i=t[r];n[i]=e[i]}return n}if("orthogonal"!==e.orientation)return console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser"),null;var r={};r.width=e.width,r.height=e.height,r.tileWidth=e.tilewidth,r.tileHeight=e.tileheight,r.orientation=e.orientation,r.format=t.Tilemap.TILED_JSON,r.version=e.version,r.properties=e.properties,r.widthInPixels=r.width*r.tileWidth,r.heightInPixels=r.height*r.tileHeight;for(var i=[],s=0;s<e.layers.length;s++)if("tilelayer"===e.layers[s].type){var o={name:e.layers[s].name,x:e.layers[s].x,y:e.layers[s].y,width:e.layers[s].width,height:e.layers[s].height,widthInPixels:e.layers[s].width*e.tilewidth,heightInPixels:e.layers[s].height*e.tileheight,alpha:e.layers[s].opacity,visible:e.layers[s].visible,properties:{},indexes:[],callbacks:[],bodies:[]};e.layers[s].properties&&(o.properties=e.layers[s].properties);for(var u=0,a=[],f=[],l=0,c=e.layers[s].data.length;c>l;l++)a.push(e.layers[s].data[l]>0?new t.Tile(o,e.layers[s].data[l],u,f.length,e.tilewidth,e.tileheight):new t.Tile(o,-1,u,f.length,e.tilewidth,e.tileheight)),u++,u===e.layers[s].width&&(f.push(a),u=0,a=[]);o.data=f,i.push(o)}r.layers=i;for(var h=[],s=0;s<e.layers.length;s++)if("imagelayer"===e.layers[s].type){var p={name:e.layers[s].name,image:e.layers[s].image,x:e.layers[s].x,y:e.layers[s].y,alpha:e.layers[s].opacity,visible:e.layers[s].visible,properties:{}};e.layers[s].properties&&(p.properties=e.layers[s].properties),h.push(p)}r.images=h;for(var d=[],s=0;s<e.tilesets.length;s++){var v=e.tilesets[s],m=new t.Tileset(v.name,v.firstgid,v.tilewidth,v.tileheight,v.margin,v.spacing,v.properties);v.tileproperties&&(m.tileProperties=v.tileproperties),m.rows=Math.round((v.imageheight-v.margin)/(v.tileheight+v.spacing)),m.columns=Math.round((v.imagewidth-v.margin)/(v.tilewidth+v.spacing)),m.total=m.rows*m.columns,m.rows%1!==0||m.columns%1!==0?console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height."):d.push(m)}r.tilesets=d;for(var g={},y={},s=0;s<e.layers.length;s++)if("objectgroup"===e.layers[s].type){g[e.layers[s].name]=[],y[e.layers[s].name]=[];for(var w=0,c=e.layers[s].objects.length;c>w;w++)if(e.layers[s].objects[w].gid){var E={gid:e.layers[s].objects[w].gid,name:e.layers[s].objects[w].name,x:e.layers[s].objects[w].x,y:e.layers[s].objects[w].y,visible:e.layers[s].objects[w].visible,properties:e.layers[s].objects[w].properties};g[e.layers[s].name].push(E)}else if(e.layers[s].objects[w].polyline){var E={name:e.layers[s].objects[w].name,x:e.layers[s].objects[w].x,y:e.layers[s].objects[w].y,width:e.layers[s].objects[w].width,height:e.layers[s].objects[w].height,visible:e.layers[s].objects[w].visible,properties:e.layers[s].objects[w].properties};E.polyline=[];for(var S=0;S<e.layers[s].objects[w].polyline.length;S++)E.polyline.push([e.layers[s].objects[w].polyline[S].x,e.layers[s].objects[w].polyline[S].y]);y[e.layers[s].name].push(E)}else if(e.layers[s].objects[w].polygon){var E=n(e.layers[s].objects[w],["name","x","y","visible","properties"]);E.polygon=[];for(var S=0;S<e.layers[s].objects[w].polygon.length;S++)E.polygon.push([e.layers[s].objects[w].polygon[S].x,e.layers[s].objects[w].polygon[S].y]);g[e.layers[s].name].push(E)}else if(e.layers[s].objects[w].ellipse){var E=n(e.layers[s].objects[w],["name","ellipse","x","y","width","height","visible","properties"]);g[e.layers[s].name].push(E)}else{var E=n(e.layers[s].objects[w],["name","x","y","width","height","visible","properties"]);E.rectangle=!0,g[e.layers[s].name].push(E)}}r.objects=g,r.collision=y,r.tiles=[];for(var s=0;s<r.tilesets.length;s++)for(var v=r.tilesets[s],u=v.tileMargin,x=v.tileMargin,T=0,N=0,C=0,l=v.firstgid;l<v.firstgid+v.total&&(r.tiles[l]=[u,x,s],u+=v.tileWidth+v.tileSpacing,T++,T!==v.total)&&(N++,N!==v.columns||(u=v.tileMargin,x+=v.tileHeight+v.tileSpacing,N=0,C++,C!==v.rows));l++);return r}},t.Tileset=function(e,t,n,r,i,s,o){("undefined"==typeof n||0>=n)&&(n=32),("undefined"==typeof r||0>=r)&&(r=32),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),this.name=e,this.firstgid=t,this.tileWidth=n,this.tileHeight=r,this.tileMargin=i,this.tileSpacing=s,this.properties=o,this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},t.Tileset.prototype={draw:function(e,t,n,r){this.image&&this.drawCoords[r]&&e.drawImage(this.image,this.drawCoords[r][0],this.drawCoords[r][1],this.tileWidth,this.tileHeight,t,n,this.tileWidth,this.tileHeight)},setImage:function(e){this.image=e,this.rows=Math.round((e.height-this.tileMargin)/(this.tileHeight+this.tileSpacing)),this.columns=Math.round((e.width-this.tileMargin)/(this.tileWidth+this.tileSpacing)),this.total=this.rows*this.columns,this.drawCoords.length=0;for(var t=this.tileMargin,n=this.tileMargin,r=this.firstgid,i=0;i<this.rows;i++){for(var s=0;s<this.columns;s++)this.drawCoords[r]=[t,n],t+=this.tileWidth+this.tileSpacing,r++;t=this.tileMargin,n+=this.tileHeight+this.tileSpacing}},setSpacing:function(e,t){this.tileMargin=e,this.tileSpacing=t,this.setImage(this.image)}},t.Tileset.prototype.constructor=t.Tileset,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.Phaser=t):"undefined"!=typeof define&&define.amd?define("Phaser",function(){return e.Phaser=t}()):e.Phaser=t}.call(this),Phaser.Physics.Ninja=function(e){this.game=e,this.time=this.game.time,this.gravity=.2,this.bounds=new Phaser.Rectangle(0,0,e.world.width,e.world.height),this.maxObjects=10,this.maxLevels=4,this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)},Phaser.Physics.Ninja.prototype.constructor=Phaser.Physics.Ninja,Phaser.Physics.Ninja.prototype={enableAABB:function(e,t){this.enable(e,1,0,0,t)},enableCircle:function(e,t,n){this.enable(e,2,0,t,n)},enableTile:function(e,t,n){this.enable(e,3,t,0,n)},enable:function(e,t,n,r,i){if("undefined"==typeof t&&(t=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=!0),Array.isArray(e))for(var s=e.length;s--;)e[s]instanceof Phaser.Group?this.enable(e[s].children,t,n,r,i):(this.enableBody(e[s],t,n,r),i&&e[s].hasOwnProperty("children")&&e[s].children.length>0&&this.enable(e[s],t,n,r,!0));else e instanceof Phaser.Group?this.enable(e.children,t,n,r,i):(this.enableBody(e,t,n,r),i&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,t,n,r,!0))},enableBody:function(e,t,n,r){e.hasOwnProperty("body")&&null===e.body&&(e.body=new Phaser.Physics.Ninja.Body(this,e,t,n,r),e.anchor.set(.5))},setBounds:function(e,t,n,r){this.bounds.setTo(e,t,n,r)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},clearTilemapLayerBodies:function(e,t){t=e.getLayer(t);for(var n=e.layers[t].bodies.length;n--;)e.layers[t].bodies[n].destroy();e.layers[t].bodies.length=[]},convertTilemap:function(e,t,n){t=e.getLayer(t),this.clearTilemapLayerBodies(e,t);for(var r=0,i=e.layers[t].height;i>r;r++)for(var s=0,o=e.layers[t].width;o>s;s++){var u=e.layers[t].data[r][s];if(u&&n.hasOwnProperty(u.index)){var a=new Phaser.Physics.Ninja.Body(this,null,3,n[u.index],0,u.worldX+u.centerX,u.worldY+u.centerY,u.width,u.height);e.layers[t].bodies.push(a)}}return e.layers[t].bodies},overlap:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._result=!1,this._total=0,Array.isArray(t))for(var s=0,o=t.length;o>s;s++)this.collideHandler(e,t[s],n,r,i,!0);else this.collideHandler(e,t,n,r,i,!0);return this._total>0},collide:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._result=!1,this._total=0,Array.isArray(t))for(var s=0,o=t.length;o>s;s++)this.collideHandler(e,t[s],n,r,i,!1);else this.collideHandler(e,t,n,r,i,!1);return this._total>0},collideHandler:function(e,t,n,r,i,s){return"undefined"!=typeof t||e.type!==Phaser.GROUP&&e.type!==Phaser.EMITTER?void (e&&t&&e.exists&&t.exists&&(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE?t.type==Phaser.SPRITE||t.type==Phaser.TILESPRITE?this.collideSpriteVsSprite(e,t,n,r,i,s):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideSpriteVsGroup(e,t,n,r,i,s):t.type==Phaser.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(e,t,n,r,i):e.type==Phaser.GROUP?t.type==Phaser.SPRITE||t.type==Phaser.TILESPRITE?this.collideSpriteVsGroup(t,e,n,r,i,s):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideGroupVsGroup(e,t,n,r,i,s):t.type==Phaser.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,t,n,r,i):e.type==Phaser.TILEMAPLAYER?t.type==Phaser.SPRITE||t.type==Phaser.TILESPRITE?this.collideSpriteVsTilemapLayer(t,e,n,r,i):(t.type==Phaser.GROUP||t.type==Phaser.EMITTER)&&this.collideGroupVsTilemapLayer(t,e,n,r,i):e.type==Phaser.EMITTER&&(t.type==Phaser.SPRITE||t.type==Phaser.TILESPRITE?this.collideSpriteVsGroup(t,e,n,r,i,s):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideGroupVsGroup(e,t,n,r,i,s):t.type==Phaser.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,t,n,r,i)))):void this.collideGroupVsSelf(e,n,r,i,s)},collideSpriteVsSprite:function(e,t,n,r,i,s){this.separate(e.body,t.body,r,i,s)&&(n&&n.call(i,e,t),this._total++)},collideSpriteVsGroup:function(e,t,n,r,i,s){if(0!==t.length)for(var o=0,u=t.children.length;u>o;o++)t.children[o].exists&&t.children[o].body&&this.separate(e.body,t.children[o].body,r,i,s)&&(n&&n.call(i,e,t.children[o]),this._total++)},collideGroupVsSelf:function(e,t,n,r,i){if(0!==e.length)for(var s=e.children.length,o=0;s>o;o++)for(var u=o+1;s>=u;u++)e.children[o]&&e.children[u]&&e.children[o].exists&&e.children[u].exists&&this.collideSpriteVsSprite(e.children[o],e.children[u],t,n,r,i)},collideGroupVsGroup:function(e,t,n,r,i,s){if(0!==e.length&&0!==t.length)for(var o=0,u=e.children.length;u>o;o++)e.children[o].exists&&this.collideSpriteVsGroup(e.children[o],t,n,r,i,s)},separate:function(e,t){return e.type!==Phaser.Physics.NINJA||t.type!==Phaser.Physics.NINJA?!1:e.aabb&&t.aabb?e.aabb.collideAABBVsAABB(t.aabb):e.aabb&&t.tile?e.aabb.collideAABBVsTile(t.tile):e.tile&&t.aabb?t.aabb.collideAABBVsTile(e.tile):e.circle&&t.tile?e.circle.collideCircleVsTile(t.tile):e.tile&&t.circle?t.circle.collideCircleVsTile(e.tile):void 0}},Phaser.Physics.Ninja.Body=function(e,t,n,r,i,s,o,u,a){t=t||null,"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=16),this.sprite=t,this.game=e.game,this.type=Phaser.Physics.NINJA,this.system=e,this.aabb=null,this.tile=null,this.circle=null,this.shape=null,this.drag=1,this.friction=.05,this.gravityScale=1,this.bounce=.3,this.velocity=new Phaser.Point,this.facing=Phaser.NONE,this.immovable=!1,this.collideWorldBounds=!0,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.maxSpeed=8,t&&(s=t.x,o=t.y,u=t.width,a=t.height,0===t.anchor.x&&(s+=.5*t.width),0===t.anchor.y&&(o+=.5*t.height)),1===n?(this.aabb=new Phaser.Physics.Ninja.AABB(this,s,o,u,a),this.shape=this.aabb):2===n?(this.circle=new Phaser.Physics.Ninja.Circle(this,s,o,i),this.shape=this.circle):3===n&&(this.tile=new Phaser.Physics.Ninja.Tile(this,s,o,u,a,r),this.shape=this.tile)},Phaser.Physics.Ninja.Body.prototype={preUpdate:function(){this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.shape.integrate(),this.collideWorldBounds&&this.shape.collideWorldBounds()},postUpdate:function(){this.sprite&&(this.sprite.type===Phaser.TILESPRITE?(this.sprite.x=this.shape.pos.x-this.shape.xw,this.sprite.y=this.shape.pos.y-this.shape.yw):(this.sprite.x=this.shape.pos.x,this.sprite.y=this.shape.pos.y)),this.velocity.x<0?this.facing=Phaser.LEFT:this.velocity.x>0&&(this.facing=Phaser.RIGHT),this.velocity.y<0?this.facing=Phaser.UP:this.velocity.y>0&&(this.facing=Phaser.DOWN)},setZeroVelocity:function(){this.shape.oldpos.x=this.shape.pos.x,this.shape.oldpos.y=this.shape.pos.y},moveTo:function(e,t){var n=e*this.game.time.physicsElapsed,t=this.game.math.degToRad(t);this.shape.pos.x=this.shape.oldpos.x+n*Math.cos(t),this.shape.pos.y=this.shape.oldpos.y+n*Math.sin(t)},moveFrom:function(e,t){var n=-e*this.game.time.physicsElapsed,t=this.game.math.degToRad(t);this.shape.pos.x=this.shape.oldpos.x+n*Math.cos(t),this.shape.pos.y=this.shape.oldpos.y+n*Math.sin(t)},moveLeft:function(e){var t=-e*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+t))},moveRight:function(e){var t=e*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+t))},moveUp:function(e){var t=-e*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+t))},moveDown:function(e){var t=e*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+t))},reset:function(){this.velocity.set(0),this.shape.pos.x=this.sprite.x,this.shape.pos.y=this.sprite.y,this.shape.oldpos.copyFrom(this.shape.pos)},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.shape.pos.x-this.shape.oldpos.x},deltaY:function(){return this.shape.pos.y-this.shape.oldpos.y},destroy:function(){this.sprite=null,this.system=null,this.aabb=null,this.tile=null,this.circle=null,this.shape.destroy(),this.shape=null}},Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"x",{get:function(){return this.shape.pos.x},set:function(e){this.shape.pos.x=e}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"y",{get:function(){return this.shape.pos.y},set:function(e){this.shape.pos.y=e}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"width",{get:function(){return this.shape.width}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"height",{get:function(){return this.shape.height}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"bottom",{get:function(){return this.shape.pos.y+this.shape.yw}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"right",{get:function(){return this.shape.pos.x+this.shape.xw}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"speed",{get:function(){return Math.sqrt(this.shape.velocity.x*this.shape.velocity.x+this.shape.velocity.y*this.shape.velocity.y)}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"angle",{get:function(){return Math.atan2(this.shape.velocity.y,this.shape.velocity.x)}}),Phaser.Physics.Ninja.Body.render=function(e,t,n,r){n=n||"rgba(0,255,0,0.4)","undefined"==typeof r&&(r=!0),(t.aabb||t.circle)&&t.shape.render(e,t.game.camera.x,t.game.camera.y,n,r)},Phaser.Physics.Ninja.AABB=function(e,t,n,r,i){this.body=e,this.system=e.system,this.pos=new Phaser.Point(t,n),this.oldpos=new Phaser.Point(t,n),this.xw=Math.abs(r/2),this.yw=Math.abs(i/2),this.width=r,this.height=i,this.oH=0,this.oV=0,this.velocity=new Phaser.Point,this.aabbTileProjections={},this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projAABB_Full,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projAABB_45Deg,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projAABB_Concave,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projAABB_Convex,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projAABB_22DegS,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projAABB_22DegB,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projAABB_67DegS,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projAABB_67DegB,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projAABB_Half},Phaser.Physics.Ninja.AABB.prototype.constructor=Phaser.Physics.Ninja.AABB,Phaser.Physics.Ninja.AABB.COL_NONE=0,Phaser.Physics.Ninja.AABB.COL_AXIS=1,Phaser.Physics.Ninja.AABB.COL_OTHER=2,Phaser.Physics.Ninja.AABB.prototype={integrate:function(){var e=this.pos.x,t=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-e,this.pos.y-t),this.oldpos.set(e,t)},reportCollisionVsWorld:function(e,t,n,r){var i,s,o,u,a,f=this.pos,l=this.oldpos,c=f.x-l.x,h=f.y-l.y,p=c*n+h*r,d=p*n,v=p*r,m=c-d,g=h-v;0>p?(u=m*this.body.friction,a=g*this.body.friction,i=1+this.body.bounce,s=d*i,o=v*i,1===n?this.body.touching.left=!0:-1===n&&(this.body.touching.right=!0),1===r?this.body.touching.up=!0:-1===r&&(this.body.touching.down=!0)):s=o=u=a=0,f.x+=e,f.y+=t,l.x+=e+s+u,l.y+=t+o+a},reverse:function(){var e=this.pos.x-this.oldpos.x,t=this.pos.y-this.oldpos.y;this.oldpos.x<this.pos.x?this.oldpos.x=this.pos.x+e:this.oldpos.x>this.pos.x&&(this.oldpos.x=this.pos.x-e),this.oldpos.y<this.pos.y?this.oldpos.y=this.pos.y+t:this.oldpos.y>this.pos.y&&(this.oldpos.y=this.pos.y-t)},reportCollisionVsBody:function(e,t,n,r,i){var s=this.pos.x-this.oldpos.x,o=this.pos.y-this.oldpos.y,u=s*n+o*r;return this.body.immovable&&i.body.immovable?(e*=.5,t*=.5,this.pos.add(e,t),this.oldpos.set(this.pos.x,this.pos.y),i.pos.subtract(e,t),void i.oldpos.set(i.pos.x,i.pos.y)):void (this.body.immovable||i.body.immovable?this.body.immovable?i.body.immovable||(i.pos.subtract(e,t),0>u&&i.reverse()):(this.pos.subtract(e,t),0>u&&this.reverse()):(e*=.5,t*=.5,this.pos.add(e,t),i.pos.subtract(e,t),0>u&&(this.reverse(),i.reverse())))},collideWorldBounds:function(){var e=this.system.bounds.x-(this.pos.x-this.xw);e>0?this.reportCollisionVsWorld(e,0,1,0,null):(e=this.pos.x+this.xw-this.system.bounds.right,e>0&&this.reportCollisionVsWorld(-e,0,-1,0,null));var t=this.system.bounds.y-(this.pos.y-this.yw);t>0?this.reportCollisionVsWorld(0,t,0,1,null):(t=this.pos.y+this.yw-this.system.bounds.bottom,t>0&&this.reportCollisionVsWorld(0,-t,0,-1,null))},collideAABBVsAABB:function(e){var t=this.pos,n=e,r=n.pos.x,i=n.pos.y,s=n.xw,o=n.yw,u=t.x-r,a=s+this.xw-Math.abs(u);if(a>0){var f=t.y-i,l=o+this.yw-Math.abs(f);if(l>0){l>a?0>u?(a*=-1,l=0):l=0:0>f?(a=0,l*=-1):a=0;var c=Math.sqrt(a*a+l*l);return this.reportCollisionVsBody(a,l,a/c,l/c,n),Phaser.Physics.Ninja.AABB.COL_AXIS}}return!1},collideAABBVsTile:function(e){var t=this.pos.x-e.pos.x,n=e.xw+this.xw-Math.abs(t);if(n>0){var r=this.pos.y-e.pos.y,i=e.yw+this.yw-Math.abs(r);if(i>0)return i>n?0>t?(n*=-1,i=0):i=0:0>r?(n=0,i*=-1):n=0,this.resolveTile(n,i,this,e)}return!1},resolveTile:function(e,t,n,r){return 0<r.id?this.aabbTileProjections[r.type](e,t,n,r):!1},projAABB_Full:function(e,t,n,r){var i=Math.sqrt(e*e+t*t);return n.reportCollisionVsWorld(e,t,e/i,t/i,r),Phaser.Physics.Ninja.AABB.COL_AXIS},projAABB_Half:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw-r.pos.x,u=n.pos.y-s*n.yw-r.pos.y,a=o*i+u*s;if(0>a){i*=-a,s*=-a;var f=Math.sqrt(i*i+s*s),l=Math.sqrt(e*e+t*t);return f>l?(n.reportCollisionVsWorld(e,t,e/l,t/l,r),Phaser.Physics.Ninja.AABB.COL_AXIS):(n.reportCollisionVsWorld(i,s,r.signx,r.signy,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_45Deg:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw-r.pos.x,u=n.pos.y-s*n.yw-r.pos.y,a=r.sx,f=r.sy,l=o*a+u*f;if(0>l){a*=-l,f*=-l;var c=Math.sqrt(a*a+f*f),h=Math.sqrt(e*e+t*t);return c>h?(n.reportCollisionVsWorld(e,t,e/h,t/h,r),Phaser.Physics.Ninja.AABB.COL_AXIS):(n.reportCollisionVsWorld(a,f,r.sx,r.sy),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegS:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.y-s*n.yw,u=r.pos.y-o;if(u*s>0){var a=n.pos.x-i*n.xw-(r.pos.x+i*r.xw),f=n.pos.y-s*n.yw-(r.pos.y-s*r.yw),l=r.sx,c=r.sy,h=a*l+f*c;if(0>h){l*=-h,c*=-h;var p=Math.sqrt(l*l+c*c),d=Math.sqrt(e*e+t*t),v=Math.abs(u);return p>d?d>v?(n.reportCollisionVsWorld(0,u,0,u/v,r),Phaser.Physics.Ninja.AABB.COL_OTHER):(n.reportCollisionVsWorld(e,t,e/d,t/d,r),Phaser.Physics.Ninja.AABB.COL_AXIS):p>v?(n.reportCollisionVsWorld(0,u,0,u/v,r),Phaser.Physics.Ninja.AABB.COL_OTHER):(n.reportCollisionVsWorld(l,c,r.sx,r.sy,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegB:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw-(r.pos.x-i*r.xw),u=n.pos.y-s*n.yw-(r.pos.y+s*r.yw),a=r.sx,f=r.sy,l=o*a+u*f;if(0>l){a*=-l,f*=-l;var c=Math.sqrt(a*a+f*f),h=Math.sqrt(e*e+t*t);return c>h?(n.reportCollisionVsWorld(e,t,e/h,t/h,r),Phaser.Physics.Ninja.AABB.COL_AXIS):(n.reportCollisionVsWorld(a,f,r.sx,r.sy,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegS:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw,u=r.pos.x-o;if(u*i>0){var a=n.pos.x-i*n.xw-(r.pos.x-i*r.xw),f=n.pos.y-s*n.yw-(r.pos.y+s*r.yw),l=r.sx,c=r.sy,h=a*l+f*c;if(0>h){l*=-h,c*=-h;var p=Math.sqrt(l*l+c*c),d=Math.sqrt(e*e+t*t),v=Math.abs(u);return p>d?d>v?(n.reportCollisionVsWorld(u,0,u/v,0,r),Phaser.Physics.Ninja.AABB.COL_OTHER):(n.reportCollisionVsWorld(e,t,e/d,t/d,r),Phaser.Physics.Ninja.AABB.COL_AXIS):p>v?(n.reportCollisionVsWorld(u,0,u/v,0,r),Phaser.Physics.Ninja.AABB.COL_OTHER):(n.reportCollisionVsWorld(l,c,r.sx,r.sy,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegB:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw-(r.pos.x+i*r.xw),u=n.pos.y-s*n.yw-(r.pos.y-s*r.yw),a=r.sx,f=r.sy,l=o*a+u*f;if(0>l){a*=-l,f*=-l;var c=Math.sqrt(a*a+f*f),h=Math.sqrt(e*e+t*t);return c>h?(n.reportCollisionVsWorld(e,t,e/h,t/h,r),Phaser.Physics.Ninja.AABB.COL_AXIS):(n.reportCollisionVsWorld(a,f,r.sx,r.sy,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Convex:function(e,t,n,r){var i=r.signx,s=r.signy,o=n.pos.x-i*n.xw-(r.pos.x-i*r.xw),u=n.pos.y-s*n.yw-(r.pos.y-s*r.yw),a=Math.sqrt(o*o+u*u),f=2*r.xw,l=Math.sqrt(f*f+0),c=l-a;if(0>i*o||0>s*u){var h=Math.sqrt(e*e+t*t);return n.reportCollisionVsWorld(e,t,e/h,t/h,r),Phaser.Physics.Ninja.AABB.COL_AXIS}return c>0?(o/=a,u/=a,n.reportCollisionVsWorld(o*c,u*c,o,u,r),Phaser.Physics.Ninja.AABB.COL_OTHER):Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Concave:function(e,t,n,r){var i=r.signx,s=r.signy,o=r.pos.x+i*r.xw-(n.pos.x-i*n.xw),u=r.pos.y+s*r.yw-(n.pos.y-s*n.yw),a=2*r.xw,f=Math.sqrt(a*a+0),l=Math.sqrt(o*o+u*u),c=l-f;if(c>0){var h=Math.sqrt(e*e+t*t);return c>h?(n.reportCollisionVsWorld(e,t,e/h,t/h,r),Phaser.Physics.Ninja.AABB.COL_AXIS):(o/=l,u/=l,n.reportCollisionVsWorld(o*c,u*c,o,u,r),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},destroy:function(){this.body=null,this.system=null},render:function(e,t,n,r,i){var s=this.pos.x-this.xw-t,o=this.pos.y-this.yw-n;i?(e.fillStyle=r,e.fillRect(s,o,this.width,this.height)):(e.strokeStyle=r,e.strokeRect(s,o,this.width,this.height))}},Phaser.Physics.Ninja.Tile=function(e,t,n,r,i,s){"undefined"==typeof s&&(s=Phaser.Physics.Ninja.Tile.EMPTY),this.body=e,this.system=e.system,this.id=s,this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY,this.pos=new Phaser.Point(t,n),this.oldpos=new Phaser.Point(t,n),this.id>1&&this.id<30&&(i=r),this.xw=Math.abs(r/2),this.yw=Math.abs(i/2),this.width=r,this.height=i,this.velocity=new Phaser.Point,this.signx=0,this.signy=0,this.sx=0,this.sy=0,this.body.gravityScale=0,this.body.collideWorldBounds=!1,this.id>0&&this.setType(this.id)},Phaser.Physics.Ninja.Tile.prototype.constructor=Phaser.Physics.Ninja.Tile,Phaser.Physics.Ninja.Tile.prototype={integrate:function(){var e=this.pos.x,t=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-e,this.pos.y-t),this.oldpos.set(e,t)},collideWorldBounds:function(){var e=this.system.bounds.x-(this.pos.x-this.xw);e>0?this.reportCollisionVsWorld(e,0,1,0,null):(e=this.pos.x+this.xw-this.system.bounds.right,e>0&&this.reportCollisionVsWorld(-e,0,-1,0,null));var t=this.system.bounds.y-(this.pos.y-this.yw);t>0?this.reportCollisionVsWorld(0,t,0,1,null):(t=this.pos.y+this.yw-this.system.bounds.bottom,t>0&&this.reportCollisionVsWorld(0,-t,0,-1,null))},reportCollisionVsWorld:function(e,t,n,r){var i,s,o,u,a,f=this.pos,l=this.oldpos,c=f.x-l.x,h=f.y-l.y,p=c*n+h*r,d=p*n,v=p*r,m=c-d,g=h-v;0>p?(u=m*this.body.friction,a=g*this.body.friction,i=1+this.body.bounce,s=d*i,o=v*i,1===n?this.body.touching.left=!0:-1===n&&(this.body.touching.right=!0),1===r?this.body.touching.up=!0:-1===r&&(this.body.touching.down=!0)):s=o=u=a=0,f.x+=e,f.y+=t,l.x+=e+s+u,l.y+=t+o+a},setType:function(e){return e===Phaser.Physics.Ninja.Tile.EMPTY?this.clear():(this.id=e,this.updateType()),this},clear:function(){this.id=Phaser.Physics.Ninja.Tile.EMPTY,this.updateType()},destroy:function(){this.body=null,this.system=null},updateType:function(){if(0===this.id)return this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY,this.signx=0,this.signy=0,this.sx=0,this.sy=0,!0;if(this.id<Phaser.Physics.Ninja.Tile.TYPE_45DEG)this.type=Phaser.Physics.Ninja.Tile.TYPE_FULL,this.signx=0,this.signy=0,this.sx=0,this.sy=0;else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONCAVE)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_45DEG,this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn)this.signx=1,this.signy=-1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn)this.signx=-1,this.signy=-1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp)this.signx=-1,this.signy=1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp)return!1;this.signx=1,this.signy=1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONVEX)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_CONCAVE,this.id==Phaser.Physics.Ninja.Tile.CONCAVEpn)this.signx=1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnn)this.signx=-1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnp)this.signx=-1,this.signy=1,this.sx=0,this.sy=0;else{if(this.id!=Phaser.Physics.Ninja.Tile.CONCAVEpp)return!1;this.signx=1,this.signy=1,this.sx=0,this.sy=0}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGs)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_CONVEX,this.id==Phaser.Physics.Ninja.Tile.CONVEXpn)this.signx=1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnn)this.signx=-1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnp)this.signx=-1,this.signy=1,this.sx=0,this.sy=0;else{if(this.id!=Phaser.Physics.Ninja.Tile.CONVEXpp)return!1;this.signx=1,this.signy=1,this.sx=0,this.sy=0}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGb)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGs,this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS){this.signx=1,this.signy=-1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS){this.signx=-1,this.signy=-1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS){this.signx=-1,this.signy=1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS)return!1;this.signx=1,this.signy=1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGs)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGb,this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB){this.signx=1,this.signy=-1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB){this.signx=-1,this.signy=-1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB){this.signx=-1,this.signy=1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB)return!1;this.signx=1,this.signy=1;var e=Math.sqrt(5);this.sx=1*this.signx/e,this.sy=2*this.signy/e}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGb)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGs,this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS){this.signx=1,this.signy=-1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS){this.signx=-1,this.signy=-1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS){this.signx=-1,this.signy=1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS)return!1;this.signx=1,this.signy=1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_HALF)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGb,this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB){this.signx=1,this.signy=-1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB){this.signx=-1,this.signy=-1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB){this.signx=-1,this.signy=1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB)return!1;this.signx=1,this.signy=1;var e=Math.sqrt(5);this.sx=2*this.signx/e,this.sy=1*this.signy/e}else if(this.type=Phaser.Physics.Ninja.Tile.TYPE_HALF,this.id==Phaser.Physics.Ninja.Tile.HALFd)this.signx=0,this.signy=-1,this.sx=this.signx,this.sy=this.signy;else if(this.id==Phaser.Physics.Ninja.Tile.HALFu)this.signx=0,this.signy=1,this.sx=this.signx,this.sy=this.signy;else if(this.id==Phaser.Physics.Ninja.Tile.HALFl)this.signx=1,this.signy=0,this.sx=this.signx,this.sy=this.signy;else{if(this.id!=Phaser.Physics.Ninja.Tile.HALFr)return!1;this.signx=-1,this.signy=0,this.sx=this.signx,this.sy=this.signy}}},Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"x",{get:function(){return this.pos.x-this.xw},set:function(e){this.pos.x=e}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"y",{get:function(){return this.pos.y-this.yw},set:function(e){this.pos.y=e}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"bottom",{get:function(){return this.pos.y+this.yw}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"right",{get:function(){return this.pos.x+this.xw}}),Phaser.Physics.Ninja.Tile.EMPTY=0,Phaser.Physics.Ninja.Tile.FULL=1,Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn=2,Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn=3,Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp=4,Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp=5,Phaser.Physics.Ninja.Tile.CONCAVEpn=6,Phaser.Physics.Ninja.Tile.CONCAVEnn=7,Phaser.Physics.Ninja.Tile.CONCAVEnp=8,Phaser.Physics.Ninja.Tile.CONCAVEpp=9,Phaser.Physics.Ninja.Tile.CONVEXpn=10,Phaser.Physics.Ninja.Tile.CONVEXnn=11,Phaser.Physics.Ninja.Tile.CONVEXnp=12,Phaser.Physics.Ninja.Tile.CONVEXpp=13,Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS=14,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS=15,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS=16,Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS=17,Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB=18,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB=19,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB=20,Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB=21,Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS=22,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS=23,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS=24,Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS=25,Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB=26,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB=27,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB=28,Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB=29,Phaser.Physics.Ninja.Tile.HALFd=30,Phaser.Physics.Ninja.Tile.HALFr=31,Phaser.Physics.Ninja.Tile.HALFu=32,Phaser.Physics.Ninja.Tile.HALFl=33,Phaser.Physics.Ninja.Tile.TYPE_EMPTY=0,Phaser.Physics.Ninja.Tile.TYPE_FULL=1,Phaser.Physics.Ninja.Tile.TYPE_45DEG=2,Phaser.Physics.Ninja.Tile.TYPE_CONCAVE=6,Phaser.Physics.Ninja.Tile.TYPE_CONVEX=10,Phaser.Physics.Ninja.Tile.TYPE_22DEGs=14,Phaser.Physics.Ninja.Tile.TYPE_22DEGb=18,Phaser.Physics.Ninja.Tile.TYPE_67DEGs=22,Phaser.Physics.Ninja.Tile.TYPE_67DEGb=26,Phaser.Physics.Ninja.Tile.TYPE_HALF=30,Phaser.Physics.Ninja.Circle=function(e,t,n,r){this.body=e,this.system=e.system,this.pos=new Phaser.Point(t,n),this.oldpos=new Phaser.Point(t,n),this.radius=r,this.xw=r,this.yw=r,this.width=2*r,this.height=2*r,this.oH=0,this.oV=0,this.velocity=new Phaser.Point,this.circleTileProjections={},this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projCircle_Full,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projCircle_45Deg,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projCircle_Concave,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projCircle_Convex,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projCircle_22DegS,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projCircle_22DegB,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projCircle_67DegS,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projCircle_67DegB,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projCircle_Half},Phaser.Physics.Ninja.Circle.prototype.constructor=Phaser.Physics.Ninja.Circle,Phaser.Physics.Ninja.Circle.COL_NONE=0,Phaser.Physics.Ninja.Circle.COL_AXIS=1,Phaser.Physics.Ninja.Circle.COL_OTHER=2,Phaser.Physics.Ninja.Circle.prototype={integrate:function(){var e=this.pos.x,t=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-e,this.pos.y-t),this.oldpos.set(e,t)},reportCollisionVsWorld:function(e,t,n,r){var i,s,o,u,a,f=this.pos,l=this.oldpos,c=f.x-l.x,h=f.y-l.y,p=c*n+h*r,d=p*n,v=p*r,m=c-d,g=h-v;0>p?(u=m*this.body.friction,a=g*this.body.friction,i=1+this.body.bounce,s=d*i,o=v*i,1===n?this.body.touching.left=!0:-1===n&&(this.body.touching.right=!0),1===r?this.body.touching.up=!0:-1===r&&(this.body.touching.down=!0)):s=o=u=a=0,f.x+=e,f.y+=t,l.x+=e+s+u,l.y+=t+o+a},collideWorldBounds:function(){var e=this.system.bounds.x-(this.pos.x-this.radius);e>0?this.reportCollisionVsWorld(e,0,1,0,null):(e=this.pos.x+this.radius-this.system.bounds.right,e>0&&this.reportCollisionVsWorld(-e,0,-1,0,null));var t=this.system.bounds.y-(this.pos.y-this.radius);t>0?this.reportCollisionVsWorld(0,t,0,1,null):(t=this.pos.y+this.radius-this.system.bounds.bottom,t>0&&this.reportCollisionVsWorld(0,-t,0,-1,null))},collideCircleVsTile:function(e){var t=this.pos,n=this.radius,r=e,i=r.pos.x,s=r.pos.y,o=r.xw,u=r.yw,a=t.x-i,f=o+n-Math.abs(a);if(f>0){var l=t.y-s,c=u+n-Math.abs(l);if(c>0)return this.oH=0,this.oV=0,-o>a?this.oH=-1:a>o&&(this.oH=1),-u>l?this.oV=-1:l>u&&(this.oV=1),this.resolveCircleTile(f,c,this.oH,this.oV,this,r)}},resolveCircleTile:function(e,t,n,r,i,s){return 0<s.id?this.circleTileProjections[s.type](e,t,n,r,i,s):!1},projCircle_Full:function(e,t,n,r,i,s){if(0===n){if(0===r){if(t>e){var o=i.pos.x-s.pos.x;return 0>o?(i.reportCollisionVsWorld(-e,0,-1,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(e,0,1,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS)}var u=i.pos.y-s.pos.y;return 0>u?(i.reportCollisionVsWorld(0,-t,0,-1,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(0,t,0,1,s),Phaser.Physics.Ninja.Circle.COL_AXIS)}return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS}if(0===r)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var a=s.pos.x+n*s.xw,f=s.pos.y+r*s.yw,o=i.pos.x-a,u=i.pos.y-f,l=Math.sqrt(o*o+u*u),c=i.radius-l;return c>0?(0===l?(o=n/Math.SQRT2,u=r/Math.SQRT2):(o/=l,u/=l),i.reportCollisionVsWorld(o*c,u*c,o,u,s),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_45Deg:function(e,t,n,r,i,s){var o,u=s.signx,a=s.signy;if(0===n)if(0===r){var f=s.sx,l=s.sy,c=i.pos.x-f*i.radius-s.pos.x,h=i.pos.y-l*i.radius-s.pos.y,p=c*f+h*l;if(0>p){f*=-p,l*=-p,t>e?(o=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(o=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1));var d=Math.sqrt(f*f+l*l);return d>o?(i.reportCollisionVsWorld(e,t,e/o,t/o,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(f,l,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>a*r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,c=i.pos.x-(s.pos.x-u*s.xw),h=i.pos.y-(s.pos.y+r*s.yw),v=c*-l+h*f;if(v*u*a>0){var m=Math.sqrt(c*c+h*h),g=i.radius-m;if(g>0)return c/=m,h/=m,i.reportCollisionVsWorld(c*g,h*g,c,h,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var p=c*f+h*l,g=i.radius-Math.abs(p);if(g>0)return i.reportCollisionVsWorld(f*g,l*g,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===r){if(0>u*n)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,c=i.pos.x-(s.pos.x+n*s.xw),h=i.pos.y-(s.pos.y-a*s.yw),v=c*-l+h*f;if(0>v*u*a){var m=Math.sqrt(c*c+h*h),g=i.radius-m;if(g>0)return c/=m,h/=m,i.reportCollisionVsWorld(c*g,h*g,c,h,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var p=c*f+h*l,g=i.radius-Math.abs(p);if(g>0)return i.reportCollisionVsWorld(f*g,l*g,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(u*n+a*r>0)return Phaser.Physics.Ninja.Circle.COL_NONE;var y=s.pos.x+n*s.xw,b=s.pos.y+r*s.yw,w=i.pos.x-y,E=i.pos.y-b,m=Math.sqrt(w*w+E*E),g=i.radius-m;if(g>0)return 0===m?(w=n/Math.SQRT2,E=r/Math.SQRT2):(w/=m,E/=m),i.reportCollisionVsWorld(w*g,E*g,w,E,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Concave:function(e,t,n,r,i,s){var o,u=s.signx,a=s.signy;if(0===n){if(0===r){var f=s.pos.x+u*s.xw-i.pos.x,l=s.pos.y+a*s.yw-i.pos.y,c=2*s.xw,h=Math.sqrt(c*c+0),p=Math.sqrt(f*f+l*l),d=p+i.radius-h;return d>0?(t>e?(o=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(o=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),d>o?(i.reportCollisionVsWorld(e,t,e/o,t/o,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(f/=p,l/=p,i.reportCollisionVsWorld(f*d,l*d,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER)):Phaser.Physics.Ninja.Circle.COL_NONE}if(0>a*r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var v=s.pos.x-u*s.xw,m=s.pos.y+r*s.yw,g=i.pos.x-v,y=i.pos.y-m,p=Math.sqrt(g*g+y*y),d=i.radius-p;if(d>0)return 0===p?(g=0,y=r):(g/=p,y/=p),i.reportCollisionVsWorld(g*d,y*d,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===r){if(0>u*n)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var v=s.pos.x+n*s.xw,m=s.pos.y-a*s.yw,g=i.pos.x-v,y=i.pos.y-m,p=Math.sqrt(g*g+y*y),d=i.radius-p;if(d>0)return 0===p?(g=n,y=0):(g/=p,y/=p),i.reportCollisionVsWorld(g*d,y*d,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{if(u*n+a*r>0)return Phaser.Physics.Ninja.Circle.COL_NONE;var v=s.pos.x+n*s.xw,m=s.pos.y+r*s.yw,g=i.pos.x-v,y=i.pos.y-m,p=Math.sqrt(g*g+y*y),d=i.radius-p;if(d>0)return 0===p?(g=n/Math.SQRT2,y=r/Math.SQRT2):(g/=p,y/=p),i.reportCollisionVsWorld(g*d,y*d,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Convex:function(e,t,n,r,i,s){var o,u=s.signx,a=s.signy;if(0===n)if(0===r){var f=i.pos.x-(s.pos.x-u*s.xw),l=i.pos.y-(s.pos.y-a*s.yw),c=2*s.xw,h=Math.sqrt(c*c+0),p=Math.sqrt(f*f+l*l),d=h+i.radius-p;if(d>0)return t>e?(o=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(o=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),d>o?(i.reportCollisionVsWorld(e,t,e/o,t/o,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(f/=p,l/=p,i.reportCollisionVsWorld(f*d,l*d,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}else{if(0>a*r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=i.pos.x-(s.pos.x-u*s.xw),l=i.pos.y-(s.pos.y-a*s.yw),c=2*s.xw,h=Math.sqrt(c*c+0),p=Math.sqrt(f*f+l*l),d=h+i.radius-p;if(d>0)return f/=p,l/=p,i.reportCollisionVsWorld(f*d,l*d,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===r){if(0>u*n)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=i.pos.x-(s.pos.x-u*s.xw),l=i.pos.y-(s.pos.y-a*s.yw),c=2*s.xw,h=Math.sqrt(c*c+0),p=Math.sqrt(f*f+l*l),d=h+i.radius-p;if(d>0)return f/=p,l/=p,i.reportCollisionVsWorld(f*d,l*d,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(u*n+a*r>0){var f=i.pos.x-(s.pos.x-u*s.xw),l=i.pos.y-(s.pos.y-a*s.yw),c=2*s.xw,h=Math.sqrt(c*c+0),p=Math.sqrt(f*f+l*l),d=h+i.radius-p;if(d>0)return f/=p,l/=p,i.reportCollisionVsWorld(f*d,l*d,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var v=s.pos.x+n*s.xw,m=s.pos.y+r*s.yw,g=i.pos.x-v,y=i.pos.y-m,p=Math.sqrt(g*g+y*y),d=i.radius-p;if(d>0)return 0===p?(g=n/Math.SQRT2,y=r/Math.SQRT2):(g/=p,y/=p),i.reportCollisionVsWorld(g*d,y*d,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Half:function(e,t,n,r,i,s){var o=s.signx,u=s.signy,a=n*o+r*u;if(a>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===n)if(0===r){var f=i.radius,l=i.pos.x-o*f-s.pos.x,c=i.pos.y-u*f-s.pos.y,h=o,p=u,d=l*h+c*p;if(0>d){h*=-d,p*=-d;var v=Math.sqrt(h*h+p*p),m=Math.sqrt(e*e+t*t);return v>m?(i.reportCollisionVsWorld(e,t,e/m,t/m,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(h,p,s.signx,s.signy),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0!==a)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var g=i.pos.x-s.pos.x;if(0>g*o)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var y=i.pos.y-(s.pos.y+r*s.yw),b=Math.sqrt(g*g+y*y),w=i.radius-b;if(w>0)return 0===b?(g=o/Math.SQRT2,y=r/Math.SQRT2):(g/=b,y/=b),i.reportCollisionVsWorld(g*w,y*w,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===r){if(0!==a)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var y=i.pos.y-s.pos.y;if(0>y*u)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var g=i.pos.x-(s.pos.x+n*s.xw),b=Math.sqrt(g*g+y*y),w=i.radius-b;if(w>0)return 0===b?(g=o/Math.SQRT2,y=r/Math.SQRT2):(g/=b,y/=b),i.reportCollisionVsWorld(g*w,y*w,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var E=s.pos.x+n*s.xw,S=s.pos.y+r*s.yw,g=i.pos.x-E,y=i.pos.y-S,b=Math.sqrt(g*g+y*y),w=i.radius-b;if(w>0)return 0===b?(g=n/Math.SQRT2,y=r/Math.SQRT2):(g/=b,y/=b),i.reportCollisionVsWorld(g*w,y*w,g,y,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegS:function(e,t,n,r,i,s){var o,u=s.signx,a=s.signy;if(a*r>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===n){if(0!==r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,c=i.radius,h=i.pos.x-(s.pos.x-u*s.xw),p=i.pos.y-s.pos.y,d=h*-l+p*f;if(d*u*a>0){var v=Math.sqrt(h*h+p*p),m=c-v;if(m>0)return h/=v,p/=v,i.reportCollisionVsWorld(h*m,p*m,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{h-=c*f,p-=c*l;var g=h*f+p*l;if(0>g){f*=-g,l*=-g;var y=Math.sqrt(f*f+l*l);return t>e?(o=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(o=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),y>o?(i.reportCollisionVsWorld(e,t,e/o,t/o,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(f,l,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}}}else if(0===r)if(0>u*n){var b=s.pos.x-u*s.xw,w=s.pos.y,E=i.pos.x-b,S=i.pos.y-w;if(0>S*a)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var v=Math.sqrt(E*E+S*S),m=i.radius-v;if(m>0)return 0===v?(E=n/Math.SQRT2,S=r/Math.SQRT2):(E/=v,S/=v),i.reportCollisionVsWorld(E*m,S*m,E,S,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var f=s.sx,l=s.sy,h=i.pos.x-(s.pos.x+n*s.xw),p=i.pos.y-(s.pos.y-a*s.yw),d=h*-l+p*f;if(0>d*u*a){var v=Math.sqrt(h*h+p*p),m=i.radius-v;if(m>0)return h/=v,p/=v,i.reportCollisionVsWorld(h*m,p*m,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var g=h*f+p*l,m=i.radius-Math.abs(g);if(m>0)return i.reportCollisionVsWorld(f*m,l*m,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var b=s.pos.x+n*s.xw,w=s.pos.y+r*s.yw,E=i.pos.x-b,S=i.pos.y-w,v=Math.sqrt(E*E+S*S),m=i.radius-v;if(m>0)return 0===v?(E=n/Math.SQRT2,S=r/Math.SQRT2):(E/=v,S/=v),i.reportCollisionVsWorld(E*m,S*m,E,S,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegB:function(e,t,n,r,i,s){var o,u=s.signx,a=s.signy;if(0===n)if(0===r){var f=s.sx,l=s.sy,c=i.radius,h=i.pos.x-f*c-(s.pos.x-u*s.xw),p=i.pos.y-l*c-(s.pos.y+a*s.yw),d=h*f+p*l;if(0>d){f*=-d,l*=-d;var v=Math.sqrt(f*f+l*l);return t>e?(o=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(o=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),v>o?(i.reportCollisionVsWorld(e,t,e/o,t/o,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(f,l,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>a*r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,h=i.pos.x-(s.pos.x-u*s.xw),p=i.pos.y-(s.pos.y+a*s.yw),m=h*-l+p*f;if(m*u*a>0){var g=Math.sqrt(h*h+p*p),y=i.radius-g;if(y>0)return h/=g,p/=g,i.reportCollisionVsWorld(h*y,p*y,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var d=h*f+p*l,y=i.radius-Math.abs(d);if(y>0)return i.reportCollisionVsWorld(f*y,l*y,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===r){if(0>u*n)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var h=i.pos.x-(s.pos.x+u*s.xw),p=i.pos.y-s.pos.y;if(0>p*a)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,m=h*-l+p*f;if(0>m*u*a){var g=Math.sqrt(h*h+p*p),y=i.radius-g;if(y>0)return h/=g,p/=g,i.reportCollisionVsWorld(h*y,p*y,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var d=h*f+p*l,y=i.radius-Math.abs(d);if(y>0)return i.reportCollisionVsWorld(f*y,l*y,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(u*n+a*r>0){var b=Math.sqrt(5),f=1*u/b,l=2*a/b,c=i.radius,h=i.pos.x-f*c-(s.pos.x-u*s.xw),p=i.pos.y-l*c-(s.pos.y+a*s.yw),d=h*f+p*l;return 0>d?(i.reportCollisionVsWorld(-f*d,-l*d,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE}var w=s.pos.x+n*s.xw,E=s.pos.y+r*s.yw,S=i.pos.x-w,x=i.pos.y-E,g=Math.sqrt(S*S+x*x),y=i.radius-g;if(y>0)return 0===g?(S=n/Math.SQRT2,x=r/Math.SQRT2):(S/=g,x/=g),i.reportCollisionVsWorld(S*y,x*y,S,x,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegS:function(e,t,n,r,i,s){var o=s.signx,u=s.signy;if(o*n>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===n)if(0===r){var a,f=s.sx,l=s.sy,c=i.radius,h=i.pos.x-s.pos.x,p=i.pos.y-(s.pos.y-u*s.yw),d=h*-l+p*f;if(0>d*o*u){var v=Math.sqrt(h*h+p*p),m=c-v;if(m>0)return h/=v,p/=v,i.reportCollisionVsWorld(h*m,p*m,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{h-=c*f,p-=c*l;var g=h*f+p*l;if(0>g){f*=-g,l*=-g;var y=Math.sqrt(f*f+l*l);return t>e?(a=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(a=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),y>a?(i.reportCollisionVsWorld(e,t,e/a,t/a,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(f,l,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}}}else if(0>u*r){var b=s.pos.x,w=s.pos.y-u*s.yw,E=i.pos.x-b,S=i.pos.y-w;if(0>E*o)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var v=Math.sqrt(E*E+S*S),m=i.radius-v;if(m>0)return 0===v?(E=n/Math.SQRT2,S=r/Math.SQRT2):(E/=v,S/=v),i.reportCollisionVsWorld(E*m,S*m,E,S,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var f=s.sx,l=s.sy,h=i.pos.x-(s.pos.x-o*s.xw),p=i.pos.y-(s.pos.y+r*s.yw),d=h*-l+p*f;if(d*o*u>0){var v=Math.sqrt(h*h+p*p),m=i.radius-v;if(m>0)return h/=v,p/=v,i.reportCollisionVsWorld(h*m,p*m,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var g=h*f+p*l,m=i.radius-Math.abs(g);if(m>0)return i.reportCollisionVsWorld(f*m,l*m,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(0===r)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var b=s.pos.x+n*s.xw,w=s.pos.y+r*s.yw,E=i.pos.x-b,S=i.pos.y-w,v=Math.sqrt(E*E+S*S),m=i.radius-v;if(m>0)return 0===v?(E=n/Math.SQRT2,S=r/Math.SQRT2):(E/=v,S/=v),i.reportCollisionVsWorld(E*m,S*m,E,S,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegB:function(e,t,n,r,i,s){var o=s.signx,u=s.signy;if(0===n)if(0===r){var a,f=s.sx,l=s.sy,c=i.radius,h=i.pos.x-f*c-(s.pos.x+o*s.xw),p=i.pos.y-l*c-(s.pos.y-u*s.yw),d=h*f+p*l;if(0>d){f*=-d,l*=-d;var v=Math.sqrt(f*f+l*l);return t>e?(a=e,t=0,i.pos.x-s.pos.x<0&&(e*=-1)):(a=t,e=0,i.pos.y-s.pos.y<0&&(t*=-1)),v>a?(i.reportCollisionVsWorld(e,t,e/a,t/a,s),Phaser.Physics.Ninja.Circle.COL_AXIS):(i.reportCollisionVsWorld(f,l,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>u*r)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var h=i.pos.x-s.pos.x,p=i.pos.y-(s.pos.y+u*s.yw);if(0>h*o)return i.reportCollisionVsWorld(0,t*r,0,r,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var f=s.sx,l=s.sy,m=h*-l+p*f;if(m*o*u>0){var g=Math.sqrt(h*h+p*p),y=i.radius-g;if(y>0)return h/=g,p/=g,i.reportCollisionVsWorld(h*y,p*y,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var d=h*f+p*l,y=i.radius-Math.abs(d);if(y>0)return i.reportCollisionVsWorld(f*y,l*y,f,l,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===r){if(0>o*n)return i.reportCollisionVsWorld(e*n,0,n,0,s),Phaser.Physics.Ninja.Circle.COL_AXIS;var b=Math.sqrt(5),f=2*o/b,l=1*u/b,h=i.pos.x-(s.pos.x+o*s.xw),p=i.pos.y-(s.pos.y-u*s.yw),m=h*-l+p*f;if(0>m*o*u){var g=Math.sqrt(h*h+p*p),y=i.radius-g;if(y>0)return h/=g,p/=g,i.reportCollisionVsWorld(h*y,p*y,h,p,s),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var d=h*f+p*l,y=i.radius-Math.abs(d);if(y>0)return i.reportCollisionVsWorld(f*y,l*y,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(o*n+u*r>0){var f=s.sx,l=s.sy,c=i.radius,h=i.pos.x-f*c-(s.pos.x+o*s.xw),p=i.pos.y-l*c-(s.pos.y-u*s.yw),d=h*f+p*l;return 0>d?(i.reportCollisionVsWorld(-f*d,-l*d,s.sx,s.sy,s),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE}var w=s.pos.x+n*s.xw,E=s.pos.y+r*s.yw,S=i.pos.x-w,x=i.pos.y-E,g=Math.sqrt(S*S+x*x),y=i.radius-g;if(y>0)return 0===g?(S=n/Math.SQRT2,x=r/Math.SQRT2):(S/=g,x/=g),i.reportCollisionVsWorld(S*y,x*y,S,x,s),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},destroy:function(){this.body=null,this.system=null},render:function(e,t,n,r,i){var s=this.pos.x-t,o=this.pos.y-n;e.beginPath(),e.arc(s,o,this.radius,0,2*Math.PI,!1),i?(e.fillStyle=r,e.fill()):(e.strokeStyle=r,e.stroke())}},!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("p2",function(){return this.p2=e()}()):"undefined"!=typeof window?window.p2=e():"undefined"!=typeof global?self.p2=e():"undefined"!=typeof self&&(self.p2=e())}(function(){return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){if(!r)var r=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;var s={};s.setMatrixArrayType=function(e){i=e},"undefined"!=typeof n&&(n.glMatrix=s);var o={};o.create=function(){var e=new i(2);return e[0]=0,e[1]=0,e},o.clone=function(e){var t=new i(2);return t[0]=e[0],t[1]=e[1],t},o.fromValues=function(e,t){var n=new i(2);return n[0]=e,n[1]=t,n},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,n){return e[0]=t,e[1]=n,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},o.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},o.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,f;for(n||(n=2),r||(r=0),f=i?Math.min(i*n+r,t.length):t.length,u=r;f>u;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!=typeof n&&(n.vec2=o)},{}],2:[function(e,t){function n(){}var r=e("./Scalar");t.exports=n,n.lineInt=function(e,t,n){n=n||0;var i,s,o,u,a,f,l,c=[0,0];return i=e[1][1]-e[0][1],s=e[0][0]-e[1][0],o=i*e[0][0]+s*e[0][1],u=t[1][1]-t[0][1],a=t[0][0]-t[1][0],f=u*t[0][0]+a*t[0][1],l=i*a-u*s,r.eq(l,0,n)||(c[0]=(a*o-s*f)/l,c[1]=(i*f-u*o)/l),c},n.segmentsIntersect=function(e,t,n,r){var i=t[0]-e[0],s=t[1]-e[1],o=r[0]-n[0],u=r[1]-n[1];if(o*s-u*i==0)return!1;var a=(i*(n[1]-e[1])+s*(e[0]-n[0]))/(o*s-u*i),f=(o*(e[1]-n[1])+u*(n[0]-e[0]))/(u*i-o*s);return a>=0&&1>=a&&f>=0&&1>=f}},{"./Scalar":5}],3:[function(e,t){function n(){}t.exports=n,n.area=function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])},n.left=function(e,t,r){return n.area(e,t,r)>0},n.leftOn=function(e,t,r){return n.area(e,t,r)>=0},n.right=function(e,t,r){return n.area(e,t,r)<0},n.rightOn=function(e,t,r){return n.area(e,t,r)<=0};var r=[],i=[];n.collinear=function(e,t,s,o){if(o){var u=r,a=i;u[0]=t[0]-e[0],u[1]=t[1]-e[1],a[0]=s[0]-t[0],a[1]=s[1]-t[1];var f=u[0]*a[0]+u[1]*a[1],l=Math.sqrt(u[0]*u[0]+u[1]*u[1]),h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),p=Math.acos(f/(l*h));return o>p}return 0==n.area(e,t,s)},n.sqdist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}},{}],4:[function(e,t){function n(){this.vertices=[]}function r(e,t,n,r,i){i=i||0;var s=t[1]-e[1],u=e[0]-t[0],a=s*e[0]+u*e[1],f=r[1]-n[1],l=n[0]-r[0],c=f*n[0]+l*n[1],h=s*l-f*u;return o.eq(h,0,i)?[0,0]:[(l*a-u*c)/h,(s*c-f*a)/h]}var i=e("./Line"),s=e("./Point"),o=e("./Scalar");t.exports=n,n.prototype.at=function(e){var t=this.vertices,n=t.length;return t[0>e?e%n+n:e%n]},n.prototype.first=function(){return this.vertices[0]},n.prototype.last=function(){return this.vertices[this.vertices.length-1]},n.prototype.clear=function(){this.vertices.length=0},n.prototype.append=function(e,t,n){if("undefined"==typeof t)throw new Error("From is not given!");if("undefined"==typeof n)throw new Error("To is not given!");if(t>n-1)throw new Error("lol1");if(n>e.vertices.length)throw new Error("lol2");if(0>t)throw new Error("lol3");for(var r=t;n>r;r++)this.vertices.push(e.vertices[r])},n.prototype.makeCCW=function(){for(var e=0,t=this.vertices,n=1;n<this.vertices.length;++n)(t[n][1]<t[e][1]||t[n][1]==t[e][1]&&t[n][0]>t[e][0])&&(e=n);s.left(this.at(e-1),this.at(e),this.at(e+1))||this.reverse()},n.prototype.reverse=function(){for(var e=[],t=0,n=this.vertices.length;t!==n;t++)e.push(this.vertices.pop());this.vertices=e},n.prototype.isReflex=function(e){return s.right(this.at(e-1),this.at(e),this.at(e+1))};var u=[],a=[];n.prototype.canSee=function(e,t){var n,r,o=u,l=a;if(s.leftOn(this.at(e+1),this.at(e),this.at(t))&&s.rightOn(this.at(e-1),this.at(e),this.at(t)))return!1;r=s.sqdist(this.at(e),this.at(t));for(var c=0;c!==this.vertices.length;++c)if((c+1)%this.vertices.length!==e&&c!==e&&s.leftOn(this.at(e),this.at(t),this.at(c+1))&&s.rightOn(this.at(e),this.at(t),this.at(c))&&(o[0]=this.at(e),o[1]=this.at(t),l[0]=this.at(c),l[1]=this.at(c+1),n=i.lineInt(o,l),s.sqdist(this.at(e),n)<r))return!1;return!0},n.prototype.copy=function(e,t,r){var i=r||new n;if(i.clear(),t>e)for(var s=e;t>=s;s++)i.vertices.push(this.vertices[s]);else{for(var s=0;t>=s;s++)i.vertices.push(this.vertices[s]);for(var s=e;s<this.vertices.length;s++)i.vertices.push(this.vertices[s])}return i},n.prototype.getCutEdges=function(){for(var e=[],t=[],r=[],i=new n,s=Number.MAX_VALUE,o=0;o<this.vertices.length;++o)if(this.isReflex(o))for(var u=0;u<this.vertices.length;++u)if(this.canSee(o,u)){t=this.copy(o,u,i).getCutEdges(),r=this.copy(u,o,i).getCutEdges();for(var a=0;a<r.length;a++)t.push(r[a]);t.length<s&&(e=t,s=t.length,e.push([this.at(o),this.at(u)]))}return e},n.prototype.decomp=function(){var e=this.getCutEdges();return e.length>0?this.slice(e):[this]},n.prototype.slice=function(e){if(0==e.length)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2==e[0].length&&e[0][0]instanceof Array){for(var t=[this],n=0;n<e.length;n++)for(var r=e[n],i=0;i<t.length;i++){var s=t[i],o=s.slice(r);if(o){t.splice(i,1),t.push(o[0],o[1]);break}}return t}var r=e,n=this.vertices.indexOf(r[0]),i=this.vertices.indexOf(r[1]);return-1!=n&&-1!=i?[this.copy(n,i),this.copy(i,n)]:!1},n.prototype.isSimple=function(){for(var e=this.vertices,t=0;t<e.length-1;t++)for(var n=0;t-1>n;n++)if(i.segmentsIntersect(e[t],e[t+1],e[n],e[n+1]))return!1;for(var t=1;t<e.length-2;t++)if(i.segmentsIntersect(e[0],e[e.length-1],e[t],e[t+1]))return!1;return!0},n.prototype.quickDecomp=function(e,t,i,o,u,a){u=u||100,a=a||0,o=o||25,e="undefined"!=typeof e?e:[],t=t||[],i=i||[];var l=[0,0],h=[0,0],p=[0,0],v=0,m=0,g=0,y=0,b=0,w=0,E=0,S=new n,x=new n,T=this,N=this.vertices;if(N.length<3)return e;if(a++,a>u)return console.warn("quickDecomp: max level ("+u+") reached."),e;for(var C=0;C<this.vertices.length;++C)if(T.isReflex(C)){t.push(T.vertices[C]),v=m=Number.MAX_VALUE;for(var k=0;k<this.vertices.length;++k)s.left(T.at(C-1),T.at(C),T.at(k))&&s.rightOn(T.at(C-1),T.at(C),T.at(k-1))&&(p=r(T.at(C-1),T.at(C),T.at(k),T.at(k-1)),s.right(T.at(C+1),T.at(C),p)&&(g=s.sqdist(T.vertices[C],p),m>g&&(m=g,h=p,w=k))),s.left(T.at(C+1),T.at(C),T.at(k+1))&&s.rightOn(T.at(C+1),T.at(C),T.at(k))&&(p=r(T.at(C+1),T.at(C),T.at(k),T.at(k+1)),s.left(T.at(C-1),T.at(C),p)&&(g=s.sqdist(T.vertices[C],p),v>g&&(v=g,l=p,b=k)));if(w==(b+1)%this.vertices.length)p[0]=(h[0]+l[0])/2,p[1]=(h[1]+l[1])/2,i.push(p),b>C?(S.append(T,C,b+1),S.vertices.push(p),x.vertices.push(p),0!=w&&x.append(T,w,T.vertices.length),x.append(T,0,C+1)):(0!=C&&S.append(T,C,T.vertices.length),S.append(T,0,b+1),S.vertices.push(p),x.vertices.push(p),x.append(T,w,C+1));else{if(w>b&&(b+=this.vertices.length),y=Number.MAX_VALUE,w>b)return e;for(var k=w;b>=k;++k)s.leftOn(T.at(C-1),T.at(C),T.at(k))&&s.rightOn(T.at(C+1),T.at(C),T.at(k))&&(g=s.sqdist(T.at(C),T.at(k)),y>g&&(y=g,E=k%this.vertices.length));E>C?(S.append(T,C,E+1),0!=E&&x.append(T,E,N.length),x.append(T,0,C+1)):(0!=C&&S.append(T,C,N.length),S.append(T,0,E+1),x.append(T,E,C+1))}return S.vertices.length<x.vertices.length?(S.quickDecomp(e,t,i,o,u,a),x.quickDecomp(e,t,i,o,u,a)):(x.quickDecomp(e,t,i,o,u,a),S.quickDecomp(e,t,i,o,u,a)),e}return e.push(this),e},n.prototype.removeCollinearPoints=function(e){for(var t=0,n=this.vertices.length-1;this.vertices.length>3&&n>=0;--n)s.collinear(this.at(n-1),this.at(n),this.at(n+1),e)&&(this.vertices.splice(n%this.vertices.length,1),n--,t++);return t}},{"./Line":2,"./Point":3,"./Scalar":5}],5:[function(e,t){function n(){}t.exports=n,n.eq=function(e,t,n){return n=n||0,Math.abs(e-t)<n}},{}],6:[function(e,t){t.exports={Polygon:e("./Polygon"),Point:e("./Point")}},{"./Point":3,"./Polygon":4}],7:[function(e,t){t.exports={name:"p2",version:"0.5.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","z-schema":"~2.4.6"},dependencies:{"poly-decomp":"0.1.0","gl-matrix":"2.1.0"}}},{}],8:[function(e,t){function n(e){this.lowerBound=r.create(),e&&e.lowerBound&&r.copy(this.lowerBound,e.lowerBound),this.upperBound=r.create(),e&&e.upperBound&&r.copy(this.upperBound,e.upperBound)}var r=e("../math/vec2");e("../utils/Utils"),t.exports=n;var i=r.create();n.prototype.setFromPoints=function(e,t,n){var s=this.lowerBound,o=this.upperBound;r.set(s,Number.MAX_VALUE,Number.MAX_VALUE),r.set(o,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var u=0;u<e.length;u++){var a=e[u];"number"==typeof n&&(r.rotate(i,a,n),a=i);for(var f=0;2>f;f++)a[f]>o[f]&&(o[f]=a[f]),a[f]<s[f]&&(s[f]=a[f])}t&&(r.add(this.lowerBound,this.lowerBound,t),r.add(this.upperBound,this.upperBound,t))},n.prototype.copy=function(e){r.copy(this.lowerBound,e.lowerBound),r.copy(this.upperBound,e.upperBound)},n.prototype.extend=function(e){for(var t=0;2>t;t++)e.lowerBound[t]<this.lowerBound[t]&&(this.lowerBound[t]=e.lowerBound[t]),e.upperBound[t]>this.upperBound[t]&&(this.upperBound[t]=e.upperBound[t])},n.prototype.overlaps=function(e){var t=this.lowerBound,n=this.upperBound,r=e.lowerBound,i=e.upperBound;return(r[0]<=n[0]&&n[0]<=i[0]||t[0]<=i[0]&&i[0]<=n[0])&&(r[1]<=n[1]&&n[1]<=i[1]||t[1]<=i[1]&&i[1]<=n[1])}},{"../math/vec2":30,"../utils/Utils":47}],9:[function(e,t){function n(e){this.type=e,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var r=e("../math/vec2"),i=e("../objects/Body");t.exports=n,n.AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(e){this.world=e},n.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var s=r.create();n.boundingRadiusCheck=function(e,t){r.sub(s,e.position,t.position);var n=r.squaredLength(s),i=e.boundingRadius+t.boundingRadius;return i*i>=n},n.aabbCheck=function(e,t){return e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)},n.prototype.boundingVolumeCheck=function(e,t){var r;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:r=n.boundingRadiusCheck(e,t);break;case n.AABB:r=n.aabbCheck(e,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return r},n.canCollide=function(e,t){return e.motionState===i.STATIC&&t.motionState===i.STATIC?!1:e.motionState===i.KINEMATIC&&t.motionState===i.STATIC||e.motionState===i.STATIC&&t.motionState===i.KINEMATIC?!1:e.motionState===i.KINEMATIC&&t.motionState===i.KINEMATIC?!1:e.sleepState===i.SLEEPING&&t.sleepState===i.SLEEPING?!1:e.sleepState===i.SLEEPING&&t.motionState===i.STATIC||t.sleepState===i.SLEEPING&&e.motionState===i.STATIC?!1:!0},n.NAIVE=1,n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],10:[function(e,t){function n(e){r.apply(this),e=i.defaults(e,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=e.xmin,this.ymin=e.ymin,this.xmax=e.xmax,this.ymax=e.ymax,this.nx=e.nx,this.ny=e.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var r=(e("../shapes/Circle"),e("../shapes/Plane"),e("../shapes/Particle"),e("../collision/Broadphase")),i=(e("../math/vec2"),e("../utils/Utils"));t.exports=n,n.prototype=new r,n.prototype.getCollisionPairs=function(e){for(var t=[],n=e.bodies,i=n.length,s=(this.binsizeX,this.binsizeY,this.nx),o=this.ny,u=this.xmin,a=this.ymin,f=this.xmax,l=this.ymax,c=[],h=s*o,p=0;h>p;p++)c.push([]);for(var v=s/(f-u),m=o/(l-a),p=0;p!==i;p++)for(var g=n[p],y=g.aabb,b=Math.max(y.lowerBound[0],u),w=Math.max(y.lowerBound[1],a),E=Math.min(y.upperBound[0],f),S=Math.min(y.upperBound[1],l),x=Math.floor(v*(b-u)),T=Math.floor(m*(w-a)),N=Math.floor(v*(E-u)),C=Math.floor(m*(S-a)),k=x;N>=k;k++)for(var L=T;C>=L;L++){var A=k,O=L,M=A*(o-1)+O;M>=0&&h>M&&c[M].push(g)}for(var p=0;p!==h;p++)for(var _=c[p],k=0,D=_.length;k!==D;k++)for(var g=_[k],L=0;L!==k;L++){var P=_[L];r.canCollide(g,P)&&this.boundingVolumeCheck(g,P)&&t.push(g,P)}return t}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../utils/Utils":47}],11:[function(e,t){function n(){r.call(this,r.NAIVE)}var r=(e("../shapes/Circle"),e("../shapes/Plane"),e("../shapes/Shape"),e("../shapes/Particle"),e("../collision/Broadphase"));e("../math/vec2"),t.exports=n,n.prototype=new r,n.prototype.getCollisionPairs=function(e){var t=e.bodies,n=this.result;n.length=0;for(var i=0,s=t.length;i!==s;i++)for(var o=t[i],u=0;i>u;u++){var a=t[u];r.canCollide(o,a)&&this.boundingVolumeCheck(o,a)&&n.push(o,a)}return n}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42}],12:[function(e,t){function n(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=c.DEFAULT_STIFFNESS,this.relaxation=c.DEFAULT_RELAXATION,this.frictionStiffness=c.DEFAULT_STIFFNESS,this.frictionRelaxation=c.DEFAULT_RELAXATION,this.collidingBodiesLastStep=new l}function r(e,t){s.set(e.vertices[0],.5*-t.length,-t.radius),s.set(e.vertices[1],.5*t.length,-t.radius),s.set(e.vertices[2],.5*t.length,t.radius),s.set(e.vertices[3],.5*-t.length,t.radius)}function i(e,t,n,r){for(var i=z,a=W,f=X,l=V,c=e,h=t.vertices,p=null,d=0;d!==h.length+1;d++){var v=h[d%h.length],m=h[(d+1)%h.length];s.rotate(i,v,r),s.rotate(a,m,r),u(i,i,n),u(a,a,n),o(f,i,c),o(l,a,c);var g=s.crossLength(f,l);if(null===p&&(p=g),0>=g*p)return!1;p=g}return!0}var s=e("../math/vec2"),o=s.sub,u=s.add,a=s.dot,f=e("../utils/Utils"),l=e("../utils/TupleDictionary"),c=e("../equations/Equation"),h=e("../equations/ContactEquation"),p=e("../equations/FrictionEquation"),d=e("../shapes/Circle"),v=e("../shapes/Convex"),m=e("../shapes/Shape"),g=(e("../objects/Body"),e("../shapes/Rectangle"));t.exports=n;var y=s.fromValues(0,1),b=s.fromValues(0,0),w=s.fromValues(0,0),E=s.fromValues(0,0),S=s.fromValues(0,0),x=s.fromValues(0,0),T=s.fromValues(0,0),N=s.fromValues(0,0),C=s.fromValues(0,0),k=s.fromValues(0,0),L=s.fromValues(0,0),A=s.fromValues(0,0),O=s.fromValues(0,0),M=s.fromValues(0,0),_=s.fromValues(0,0),D=s.fromValues(0,0),P=s.fromValues(0,0),H=s.fromValues(0,0),B=s.fromValues(0,0),j=[];n.prototype.collidedLastStep=function(e,t){var n=0|e.id,r=0|t.id;return!!this.collidingBodiesLastStep.get(n,r)},n.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var e=0;e!==this.contactEquations.length;e++){var t=this.contactEquations[e],n=0|t.bodyA.id,r=0|t.bodyB.id;this.collidingBodiesLastStep.set(n,r,!0)}if(this.reuseObjects){var i=this.contactEquations,s=this.frictionEquations,o=this.reusableFrictionEquations,u=this.reusableContactEquations;f.appendArray(u,i),f.appendArray(o,s)}this.contactEquations.length=this.frictionEquations.length=0},n.prototype.createContactEquation=function(e,t,n,r){var i=this.reusableContactEquations.length?this.reusableContactEquations.pop():new h(e,t);return i.bodyA=e,i.bodyB=t,i.shapeA=n,i.shapeB=r,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(e,t),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=!0,i},n.prototype.createFrictionEquation=function(e,t,n,r){var i=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new p(e,t);return i.bodyA=e,i.bodyB=t,i.shapeA=n,i.shapeB=r,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=!0,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i},n.prototype.createFrictionFromContact=function(e){var t=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB);return s.copy(t.contactPointA,e.contactPointA),s.copy(t.contactPointB,e.contactPointB),s.rotate90cw(t.t,e.normalA),t.contactEquation=e,t},n.prototype[m.LINE|m.CONVEX]=n.prototype.convexLine=function(e,t,n,r,i,s,o,u,a){return a?!1:0},n.prototype[m.LINE|m.RECTANGLE]=n.prototype.lineRectangle=function(e,t,n,r,i,s,o,u,a){return a?!1:0};var F=new g(1,1),I=s.create();n.prototype[m.CAPSULE|m.CONVEX]=n.prototype[m.CAPSULE|m.RECTANGLE]=n.prototype.convexCapsule=function(e,t,n,i,o,u,a,f,l){var c=I;s.set(c,u.length/2,0),s.rotate(c,c,f),s.add(c,c,a);var h=this.circleConvex(o,u,c,f,e,t,n,i,l,u.radius);s.set(c,-u.length/2,0),s.rotate(c,c,f),s.add(c,c,a);var p=this.circleConvex(o,u,c,f,e,t,n,i,l,u.radius);if(l&&(h||p))return!0;var d=F;r(d,u);var v=this.convexConvex(e,t,n,i,o,d,a,f,l);return v+h+p},n.prototype[m.CAPSULE|m.LINE]=n.prototype.lineCapsule=function(e,t,n,r,i,s,o,u,a){return a?!1:0};var q=s.create(),R=s.create(),U=new g(1,1);n.prototype[m.CAPSULE|m.CAPSULE]=n.prototype.capsuleCapsule=function(e,t,n,i,o,u,a,f,l){for(var c=q,h=R,p=0,d=0;2>d;d++){s.set(c,(0==d?-1:1)*t.length/2,0),s.rotate(c,c,i),s.add(c,c,n);for(var v=0;2>v;v++){s.set(h,(0==v?-1:1)*u.length/2,0),s.rotate(h,h,f),s.add(h,h,a);var m=this.circleCircle(e,t,c,i,o,u,h,f,l,t.radius,u.radius);if(l&&m)return!0;p+=m}}var g=U;r(g,t);var y=this.convexCapsule(e,g,n,i,o,u,a,f,l);if(l&&y)return!0;p+=y,r(g,u);var b=this.convexCapsule(o,g,a,f,e,t,n,i,l);return l&&b?!0:p+=b},n.prototype[m.LINE|m.LINE]=n.prototype.lineLine=function(e,t,n,r,i,s,o,u,a){return a?!1:0},n.prototype[m.PLANE|m.LINE]=n.prototype.planeLine=function(e,t,n,r,i,f,l,c,h){var p=b,d=w,v=E,m=S,g=x,L=T,A=N,O=C,M=k,_=j;numContacts=0,s.set(p,-f.length/2,0),s.set(d,f.length/2,0),s.rotate(v,p,c),s.rotate(m,d,c),u(v,v,l),u(m,m,l),s.copy(p,v),s.copy(d,m),o(g,d,p),s.normalize(L,g),s.rotate90cw(M,L),s.rotate(O,y,r),_[0]=p,_[1]=d;for(var D=0;D<_.length;D++){var P=_[D];o(A,P,n);var H=a(A,O);if(0>H){if(h)return!0;var B=this.createContactEquation(e,i,t,f);numContacts++,s.copy(B.normalA,O),s.normalize(B.normalA,B.normalA),s.scale(A,O,H),o(B.contactPointA,P,A),o(B.contactPointA,B.contactPointA,e.position),o(B.contactPointB,P,l),u(B.contactPointB,B.contactPointB,l),o(B.contactPointB,B.contactPointB,i.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B))}}return numContacts},n.prototype[m.PARTICLE|m.CAPSULE]=n.prototype.particleCapsule=function(e,t,n,r,i,s,o,u,a){return this.circleLine(e,t,n,r,i,s,o,u,a,s.radius,0)},n.prototype[m.CIRCLE|m.LINE]=n.prototype.circleLine=function(e,t,n,r,i,f,l,c,h,p,d){var v=f,m=c,g=i,y=l,D=n,P=e,H=t,p=p||0,d="undefined"!=typeof d?d:H.radius,B=b,F=w,I=E,q=S,R=x,U=T,z=N,W=C,X=k,V=L,$=A,J=O,K=M,Q=_,G=j;s.set(W,-v.length/2,0),s.set(X,v.length/2,0),s.rotate(V,W,m),s.rotate($,X,m),u(V,V,y),u($,$,y),s.copy(W,V),s.copy(X,$),o(U,X,W),s.normalize(z,U),s.rotate90cw(R,z),o(J,D,W);var Y=a(J,R);if(o(q,W,y),o(K,D,y),Math.abs(Y)<d+p){s.scale(B,R,Y),o(I,D,B),s.scale(F,R,a(R,K)),s.normalize(F,F),s.scale(F,F,p),u(I,I,F);var Z=a(z,I),et=a(z,W),tt=a(z,X);if(Z>et&&tt>Z){if(h)return!0;var nt=this.createContactEquation(P,g,t,f);return s.scale(nt.normalA,B,-1),s.normalize(nt.normalA,nt.normalA),s.scale(nt.contactPointA,nt.normalA,d),u(nt.contactPointA,nt.contactPointA,D),o(nt.contactPointA,nt.contactPointA,P.position),o(nt.contactPointB,I,y),u(nt.contactPointB,nt.contactPointB,y),o(nt.contactPointB,nt.contactPointB,g.position),this.contactEquations.push(nt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(nt)),1}}G[0]=W,G[1]=X;for(var rt=0;rt<G.length;rt++){var it=G[rt];if(o(J,it,D),s.squaredLength(J)<(d+p)*(d+p)){if(h)return!0;var nt=this.createContactEquation(P,g,t,f);return s.copy(nt.normalA,J),s.normalize(nt.normalA,nt.normalA),s.scale(nt.contactPointA,nt.normalA,d),u(nt.contactPointA,nt.contactPointA,D),o(nt.contactPointA,nt.contactPointA,P.position),o(nt.contactPointB,it,y),s.scale(Q,nt.normalA,-p),u(nt.contactPointB,nt.contactPointB,Q),u(nt.contactPointB,nt.contactPointB,y),o(nt.contactPointB,nt.contactPointB,g.position),this.contactEquations.push(nt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(nt)),1}}return 0},n.prototype[m.CIRCLE|m.CAPSULE]=n.prototype.circleCapsule=function(e,t,n,r,i,s,o,u,a){return this.circleLine(e,t,n,r,i,s,o,u,a,s.radius)},n.prototype[m.CIRCLE|m.CONVEX]=n.prototype[m.CIRCLE|m.RECTANGLE]=n.prototype.circleConvex=function(e,t,n,r,a,f,l,c,h,p){var d=f,v=c,m=a,g=l,y=n,T=e,N=t,p="number"==typeof p?p:N.radius,C=b,k=w,O=E,H=S,B=x,j=L,F=A,I=M,q=_,R=D,U=P,z=!1,W=Number.MAX_VALUE;verts=d.vertices;for(var X=0;X!==verts.length+1;X++){var V=verts[X%verts.length],$=verts[(X+1)%verts.length];if(s.rotate(C,V,v),s.rotate(k,$,v),u(C,C,g),u(k,k,g),o(O,k,C),s.normalize(H,O),s.rotate90cw(B,H),s.scale(q,B,-N.radius),u(q,q,y),i(q,d,g,v)){s.sub(R,C,q);var J=Math.abs(s.dot(R,B));W>J&&(s.copy(U,q),W=J,s.scale(I,B,J),s.add(I,I,q),z=!0)}}if(z){if(h)return!0;var K=this.createContactEquation(T,m,t,f);return s.sub(K.normalA,U,y),s.normalize(K.normalA,K.normalA),s.scale(K.contactPointA,K.normalA,p),u(K.contactPointA,K.contactPointA,y),o(K.contactPointA,K.contactPointA,T.position),o(K.contactPointB,I,g),u(K.contactPointB,K.contactPointB,g),o(K.contactPointB,K.contactPointB,m.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}if(p>0)for(var X=0;X<verts.length;X++){var Q=verts[X];if(s.rotate(F,Q,v),u(F,F,g),o(j,F,y),s.squaredLength(j)<p*p){if(h)return!0;var K=this.createContactEquation(T,m,t,f);return s.copy(K.normalA,j),s.normalize(K.normalA,K.normalA),s.scale(K.contactPointA,K.normalA,p),u(K.contactPointA,K.contactPointA,y),o(K.contactPointA,K.contactPointA,T.position),o(K.contactPointB,F,g),u(K.contactPointB,K.contactPointB,g),o(K.contactPointB,K.contactPointB,m.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}}return 0};var z=s.create(),W=s.create(),X=s.create(),V=s.create();n.prototype[m.PARTICLE|m.CONVEX]=n.prototype[m.PARTICLE|m.RECTANGLE]=n.prototype.particleConvex=function(e,t,n,r,f,l,c,h,p){var d=l,v=h,m=f,g=c,y=n,C=e,k=b,A=w,O=E,_=S,D=x,P=T,j=N,F=L,I=M,q=H,R=B,U=Number.MAX_VALUE,z=!1,W=d.vertices;if(!i(y,d,g,v))return 0;if(p)return!0;for(var X=0;X!==W.length+1;X++){var V=W[X%W.length],$=W[(X+1)%W.length];s.rotate(k,V,v),s.rotate(A,$,v),u(k,k,g),u(A,A,g),o(O,A,k),s.normalize(_,O),s.rotate90cw(D,_),o(F,y,k),a(F,D),o(P,k,g),o(j,y,g),s.sub(q,k,y);var J=Math.abs(s.dot(q,D));U>J&&(U=J,s.scale(I,D,J),s.add(I,I,y),s.copy(R,D),z=!0)}if(z){var K=this.createContactEquation(C,m,t,l);return s.scale(K.normalA,R,-1),s.normalize(K.normalA,K.normalA),s.set(K.contactPointA,0,0),u(K.contactPointA,K.contactPointA,y),o(K.contactPointA,K.contactPointA,C.position),o(K.contactPointB,I,g),u(K.contactPointB,K.contactPointB,g),o(K.contactPointB,K.contactPointB,m.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}return 0},n.prototype[m.CIRCLE]=n.prototype.circleCircle=function(e,t,n,r,i,a,f,l,c,h,p){var d=e,v=t,m=n,g=i,y=a,w=f,E=b,h=h||v.radius,p=p||y.radius;o(E,n,f);var S=h+p;if(s.squaredLength(E)>S*S)return 0;if(c)return!0;var x=this.createContactEquation(d,g,t,a);return o(x.normalA,w,m),s.normalize(x.normalA,x.normalA),s.scale(x.contactPointA,x.normalA,h),s.scale(x.contactPointB,x.normalA,-p),u(x.contactPointA,x.contactPointA,m),o(x.contactPointA,x.contactPointA,d.position),u(x.contactPointB,x.contactPointB,w),o(x.contactPointB,x.contactPointB,g.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1},n.prototype[m.PLANE|m.CONVEX]=n.prototype[m.PLANE|m.RECTANGLE]=n.prototype.planeConvex=function(e,t,r,i,f,l,c,h,p){var d=f,v=c,m=l,g=h,S=e,x=t,T=r,N=i,C=b,k=w,L=E,A=0;s.rotate(k,y,N);for(var O=0;O<m.vertices.length;O++){var M=m.vertices[O];if(s.rotate(C,M,g),u(C,C,v),o(L,C,T),a(L,k)<=n.convexPrecision){if(p)return!0;A++;var _=this.createContactEquation(S,d,x,m);o(L,C,T),s.copy(_.normalA,k);var D=a(L,_.normalA);s.scale(L,_.normalA,D),o(_.contactPointB,C,d.position),o(_.contactPointA,C,L),o(_.contactPointA,_.contactPointA,S.position),this.contactEquations.push(_),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(_))}}return A},n.prototype.convexPlane=function(e,t,n,r,i,s,o,u,a){return console.warn("Narrowphase.prototype.convexPlane is deprecated. Use planeConvex instead!"),this.planeConvex(i,s,o,u,e,t,n,r,a)},n.prototype[m.PARTICLE|m.PLANE]=n.prototype.particlePlane=function(e,t,n,r,i,u,f,l,c){var h=e,p=n,d=i,v=f,m=l,g=b,E=w;m=m||0,o(g,p,v),s.rotate(E,y,m);var S=a(g,E);if(S>0)return 0;if(c)return!0;var x=this.createContactEquation(d,h,u,t);return s.copy(x.normalA,E),s.scale(g,x.normalA,S),o(x.contactPointA,p,g),o(x.contactPointA,x.contactPointA,d.position),o(x.contactPointB,p,h.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1},n.prototype[m.CIRCLE|m.PARTICLE]=n.prototype.circleParticle=function(e,t,n,r,i,a,f,l,c){var h=e,p=t,d=n,v=i,m=f,g=b;if(o(g,m,d),s.squaredLength(g)>p.radius*p.radius)return 0;if(c)return!0;var y=this.createContactEquation(h,v,t,a);return s.copy(y.normalA,g),s.normalize(y.normalA,y.normalA),s.scale(y.contactPointA,y.normalA,p.radius),u(y.contactPointA,y.contactPointA,d),o(y.contactPointA,y.contactPointA,h.position),o(y.contactPointB,m,v.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1};var $=new d(1),J=s.create(),K=s.create();s.create(),n.prototype[m.PLANE|m.CAPSULE]=n.prototype.planeCapsule=function(e,t,n,r,i,o,a,f,l){var c=J,h=K,p=$;s.set(c,-o.length/2,0),s.rotate(c,c,f),u(c,c,a),s.set(h,o.length/2,0),s.rotate(h,h,f),u(h,h,a),p.radius=o.radius;var d=this.circlePlane(i,p,c,0,e,t,n,r,l),v=this.circlePlane(i,p,h,0,e,t,n,r,l);return l?d||v:d+v},n.prototype.capsulePlane=function(e,t,n,r,i,s,o,u,a){return console.warn("Narrowphase.prototype.capsulePlane() is deprecated. Use .planeCapsule() instead!"),this.planeCapsule(i,s,o,u,e,t,n,r,a)},n.prototype[m.CIRCLE|m.PLANE]=n.prototype.circlePlane=function(e,t,n,r,i,f,l,c,h){var p=e,d=t,v=n,m=i,g=l,S=c;S=S||0;var x=b,T=w,N=E;o(x,v,g),s.rotate(T,y,S);var C=a(T,x);if(C>d.radius)return 0;if(h)return!0;var k=this.createContactEquation(m,p,f,t);return s.copy(k.normalA,T),s.scale(k.contactPointB,k.normalA,-d.radius),u(k.contactPointB,k.contactPointB,v),o(k.contactPointB,k.contactPointB,p.position),s.scale(N,k.normalA,C),o(k.contactPointA,x,N),u(k.contactPointA,k.contactPointA,g),o(k.contactPointA,k.contactPointA,m.position),this.contactEquations.push(k),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(k)),1},n.convexPrecision=1e-7,n.prototype[m.CONVEX]=n.prototype[m.CONVEX|m.RECTANGLE]=n.prototype[m.RECTANGLE]=n.prototype.convexConvex=function(e,t,r,i,f,l,c,h,p,d){var v=b,m=w,g=E,y=S,T=x,L=N,A=C,O=k,M=0,d=d||n.convexPrecision,_=n.findSeparatingAxis(t,r,i,l,c,h,v);if(!_)return 0;o(A,c,r),a(v,A)>0&&s.scale(v,v,-1);var D=n.getClosestEdge(t,i,v,!0),P=n.getClosestEdge(l,h,v);if(-1===D||-1===P)return 0;for(var H=0;2>H;H++){var B=D,j=P,F=t,I=l,q=r,R=c,U=i,z=h,W=e,X=f;if(0===H){var V;V=B,B=j,j=V,V=F,F=I,I=V,V=q,q=R,R=V,V=U,U=z,z=V,V=W,W=X,X=V}for(var $=j;j+2>$;$++){var J=I.vertices[($+I.vertices.length)%I.vertices.length];s.rotate(m,J,z),u(m,m,R);for(var K=0,Q=B-1;B+2>Q;Q++){var G=F.vertices[(Q+F.vertices.length)%F.vertices.length],Y=F.vertices[(Q+1+F.vertices.length)%F.vertices.length];s.rotate(g,G,U),s.rotate(y,Y,U),u(g,g,q),u(y,y,q),o(T,y,g),s.rotate90cw(O,T),s.normalize(O,O),o(A,m,g);var Z=a(O,A);d>=Z&&K++}if(K>=3){if(p)return!0;var et=this.createContactEquation(W,X,F,I);M++;var G=F.vertices[B%F.vertices.length],Y=F.vertices[(B+1)%F.vertices.length];s.rotate(g,G,U),s.rotate(y,Y,U),u(g,g,q),u(y,y,q),o(T,y,g),s.rotate90cw(et.normalA,T),s.normalize(et.normalA,et.normalA),o(A,m,g);var Z=a(et.normalA,A);s.scale(L,et.normalA,Z),o(et.contactPointA,m,q),o(et.contactPointA,et.contactPointA,L),u(et.contactPointA,et.contactPointA,q),o(et.contactPointA,et.contactPointA,W.position),o(et.contactPointB,m,R),u(et.contactPointB,et.contactPointB,R),o(et.contactPointB,et.contactPointB,X.position),this.contactEquations.push(et),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(et))}}}return M};var Q=s.fromValues(0,0);n.projectConvexOntoAxis=function(e,t,n,r,i){var o,u,f=null,l=null,c=Q;s.rotate(c,r,-n);for(var h=0;h<e.vertices.length;h++)o=e.vertices[h],u=a(o,c),(null===f||u>f)&&(f=u),(null===l||l>u)&&(l=u);if(l>f){var p=l;l=f,f=p}var d=a(t,r);s.set(i,l+d,f+d)};var G=s.fromValues(0,0),Y=s.fromValues(0,0),Z=s.fromValues(0,0),et=s.fromValues(0,0),tt=s.fromValues(0,0),nt=s.fromValues(0,0);n.findSeparatingAxis=function(e,t,r,i,u,a,f){for(var l=null,c=!1,h=!1,p=G,d=Y,v=Z,m=et,g=tt,y=nt,b=0;2!==b;b++){var w=e,E=r;1===b&&(w=i,E=a);for(var S=0;S!==w.vertices.length;S++){s.rotate(d,w.vertices[S],E),s.rotate(v,w.vertices[(S+1)%w.vertices.length],E),o(p,v,d),s.rotate90cw(m,p),s.normalize(m,m),n.projectConvexOntoAxis(e,t,r,m,g),n.projectConvexOntoAxis(i,u,a,m,y);var x=g,T=y,N=!1;g[0]>y[0]&&(T=g,x=y,N=!0);var C=T[0]-x[1];c=C<=n.convexPrecision,(null===l||C>l)&&(s.copy(f,m),l=C,h=c)}}return h};var rt=s.fromValues(0,0),it=s.fromValues(0,0),st=s.fromValues(0,0);n.getClosestEdge=function(e,t,n,r){var i=rt,u=it,f=st;s.rotate(i,n,-t),r&&s.scale(i,i,-1);for(var l=-1,c=e.vertices.length,h=0;h!==c;h++){o(u,e.vertices[(h+1)%c],e.vertices[h%c]),s.rotate90cw(f,u),s.normalize(f,f);var p=a(f,i);(-1==l||p>maxDot)&&(l=h%c,maxDot=p)}return l};var ot=s.create(),ut=s.create(),at=s.create(),ft=s.create(),lt=s.create(),ct=s.create(),ht=s.create();n.prototype[m.CIRCLE|m.HEIGHTFIELD]=n.prototype.circleHeightfield=function(e,t,n,r,i,a,f,l,c,h){var p=a.data,h=h||t.radius,d=a.elementWidth,v=ut,m=ot,g=lt,y=ht,b=ct,w=at,E=ft,S=Math.floor((n[0]-h-f[0])/d),x=Math.ceil((n[0]+h-f[0])/d);0>S&&(S=0),x>=p.length&&(x=p.length-1);for(var T=p[S],N=p[x],C=S;x>C;C++)p[C]<N&&(N=p[C]),p[C]>T&&(T=p[C]);if(n[1]-h>T)return c?!1:0;n[1]+h<N;for(var k=!1,C=S;x>C;C++){s.set(w,C*d,p[C]),s.set(E,(C+1)*d,p[C+1]),s.add(w,w,f),s.add(E,E,f),s.sub(b,E,w),s.rotate(b,b,Math.PI/2),s.normalize(b,b),s.scale(m,b,-h),s.add(m,m,n),s.sub(v,m,w);var L=s.dot(v,b);if(m[0]>=w[0]&&m[0]<E[0]&&0>=L){if(c)return!0;k=!0,s.scale(v,b,-L),s.add(g,m,v),s.copy(y,b);var A=this.createContactEquation(i,e,a,t);s.copy(A.normalA,y),s.scale(A.contactPointB,A.normalA,-h),u(A.contactPointB,A.contactPointB,n),o(A.contactPointB,A.contactPointB,e.position),s.copy(A.contactPointA,g),s.sub(A.contactPointA,A.contactPointA,i.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}if(k=!1,h>0)for(var C=S;x>=C;C++)if(s.set(w,C*d,p[C]),s.add(w,w,f),s.sub(v,n,w),s.squaredLength(v)<h*h){if(c)return!0;k=!0;var A=this.createContactEquation(i,e,a,t);s.copy(A.normalA,v),s.normalize(A.normalA,A.normalA),s.scale(A.contactPointB,A.normalA,-h),u(A.contactPointB,A.contactPointB,n),o(A.contactPointB,A.contactPointB,e.position),o(A.contactPointA,w,f),u(A.contactPointA,A.contactPointA,f),o(A.contactPointA,A.contactPointA,i.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}return k?1:0};var pt=s.create(),dt=s.create(),vt=s.create(),mt=new v([s.create(),s.create(),s.create(),s.create()]);n.prototype[m.RECTANGLE|m.HEIGHTFIELD]=n.prototype[m.CONVEX|m.HEIGHTFIELD]=n.prototype.convexHeightfield=function(e,t,n,r,i,o,u,a,f){var l=o.data,c=o.elementWidth,h=pt,p=dt,d=vt,v=mt,m=Math.floor((e.aabb.lowerBound[0]-u[0])/c),g=Math.ceil((e.aabb.upperBound[0]-u[0])/c);0>m&&(m=0),g>=l.length&&(g=l.length-1);for(var y=l[m],b=l[g],w=m;g>w;w++)l[w]<b&&(b=l[w]),l[w]>y&&(y=l[w]);if(e.aabb.lowerBound[1]>y)return f?!1:0;for(var E=0,w=m;g>w;w++){s.set(h,w*c,l[w]),s.set(p,(w+1)*c,l[w+1]),s.add(h,h,u),s.add(p,p,u);var S=100;s.set(d,.5*(p[0]+h[0]),.5*(p[1]+h[1]-S)),s.sub(v.vertices[0],p,d),s.sub(v.vertices[1],h,d),s.copy(v.vertices[2],v.vertices[1]),s.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=S,v.vertices[3][1]-=S,E+=this.convexConvex(e,t,n,r,i,v,d,0,f)}return E}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Rectangle":41,"../shapes/Shape":42,"../utils/TupleDictionary":46,"../utils/Utils":47}],13:[function(e,t){function n(){i.call(this,i.SAP),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)}}var r=e("../utils/Utils"),i=e("../collision/Broadphase");t.exports=n,n.prototype=new i,n.prototype.setWorld=function(e){this.axisList.length=0,r.appendArray(this.axisList,e.bodies),e.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),e.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=e},n.sortAxisList=function(e,t){t=0|t;for(var n=1,r=e.length;r>n;n++){for(var i=e[n],s=n-1;s>=0&&!(e[s].aabb.lowerBound[t]<=i.aabb.lowerBound[t]);s--)e[s+1]=e[s];e[s+1]=i}return e},n.prototype.getCollisionPairs=function(){var e=this.axisList,t=this.result,r=this.axisIndex;t.length=0;for(var s=e.length;s--;){var o=e[s];o.aabbNeedsUpdate&&o.updateAABB()}n.sortAxisList(e,r);for(var u=0,a=0|e.length;u!==a;u++)for(var f=e[u],l=u+1;a>l;l++){var h=e[l],p=h.aabb.lowerBound[r]<=f.aabb.upperBound[r];if(!p)break;i.canCollide(f,h)&&this.boundingVolumeCheck(f,h)&&t.push(f,h)}return t}},{"../collision/Broadphase":9,"../utils/Utils":47}],14:[function(e,t){function n(e,t,n,i){this.type=n,i=r.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}t.exports=n;var r=e("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(e){for(var t=this.equations,n=0;n!==t.length;n++){var r=t[n];r.stiffness=e,r.needsUpdate=!0}},n.prototype.setRelaxation=function(e){for(var t=this.equations,n=0;n!==t.length;n++){var r=t[n];r.relaxation=e,r.needsUpdate=!0}}},{"../utils/Utils":47}],15:[function(e,t){function n(e,t,n,o){o=o||{},r.call(this,e,t,r.DISTANCE,o),this.distance=n,this.localAnchorA=s.create(),this.localAnchorB=s.create();var u,a=this.localAnchorA,l=this.localAnchorB;u="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var c=new i(e,t,-u,u);this.equations=[c];var h=s.create(),p=s.create(),v=s.create(),m=this;c.computeGq=function(){var e=this.bodyA,t=this.bodyB,n=e.position;return t.position,s.rotate(p,a,e.angle),s.rotate(v,l,t.angle),s.add(h,n,v),s.sub(h,h,p),s.sub(h,h,n),s.sub(h,t.position,e.position),s.length(h)-m.distance},this.setMaxForce(u)}var r=e("./Constraint"),i=e("../equations/Equation"),s=e("../math/vec2");t.exports=n,n.prototype=new r;var o=s.create(),u=s.create(),a=s.create();n.prototype.update=function(){var e=this.equations[0],t=this.bodyA,n=this.bodyB,r=(this.distance,t.position,n.position,e.G);s.rotate(u,this.localAnchorA,t.angle),s.rotate(a,this.localAnchorB,n.angle),s.crossLength(u,o),s.crossLength(a,o),s.sub(o,n.position,t.position),s.normalize(o,o),r[0]=-o[0],r[1]=-o[1],r[3]=o[0],r[4]=o[1]},n.prototype.setMaxForce=function(e){var t=this.equations[0];t.minForce=-e,t.maxForce=e},n.prototype.getMaxForce=function(){var e=this.equations[0];return e.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],16:[function(e,t){function n(e,t,n){n=n||{},r.call(this,e,t,r.GEAR,n),this.equations=[new i(e,t,n)],this.angle="number"==typeof n.angle?n.angle:0,this.ratio="number"==typeof n.ratio?n.ratio:1,"number"==typeof n.maxTorque&&this.setMaxTorque(n.maxTorque)}var r=e("./Constraint"),i=(e("../equations/Equation"),e("../equations/AngleLockEquation"));e("../math/vec2"),t.exports=n,n.prototype=new r,n.prototype.update=function(){var e=this.equations[0];e.ratio!==this.ratio&&e.setRatio(this.ratio),e.angle=this.angle},n.prototype.setMaxTorque=function(e){this.equations[0].setMaxTorque(e)},n.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(e,t){function n(e,t,n){n=n||{},r.call(this,e,t,r.LOCK,n);var o="undefined"==typeof n.maxForce?Number.MAX_VALUE:n.maxForce,u=n.localOffsetB||i.fromValues(0,0);u=i.fromValues(u[0],u[1]);var a=n.localAngleB||0,f=new s(e,t,-o,o),l=new s(e,t,-o,o),c=new s(e,t,-o,o),h=i.create(),p=i.create(),v=this;f.computeGq=function(){return i.rotate(h,v.localOffsetB,e.angle),i.sub(p,t.position,e.position),i.sub(p,p,h),p[0]},l.computeGq=function(){return i.rotate(h,v.localOffsetB,e.angle),i.sub(p,t.position,e.position),i.sub(p,p,h),p[1]};var m=i.create(),g=i.create();c.computeGq=function(){return i.rotate(m,v.localOffsetB,t.angle-v.localAngleB),i.scale(m,m,-1),i.sub(p,e.position,t.position),i.add(p,p,m),i.rotate(g,m,-Math.PI/2),i.normalize(g,g),i.dot(p,g)},this.localOffsetB=u,this.localAngleB=a,this.equations.push(f,l,c),this.setMaxForce(o)}var r=e("./Constraint"),i=e("../math/vec2"),s=e("../equations/Equation");t.exports=n,n.prototype=new r,n.prototype.setMaxForce=function(e){for(var t=this.equations,n=0;n<this.equations.length;n++)t[n].maxForce=e,t[n].minForce=-e},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var o=i.create(),u=i.create(),a=i.create(),f=i.fromValues(1,0),l=i.fromValues(0,1);n.prototype.update=function(){var e=this.equations[0],t=this.equations[1],n=this.equations[2],r=this.bodyA,s=this.bodyB;i.rotate(o,this.localOffsetB,r.angle),i.rotate(u,this.localOffsetB,s.angle-this.localAngleB),i.scale(u,u,-1),i.rotate(a,u,Math.PI/2),i.normalize(a,a),e.G[0]=-1,e.G[1]=0,e.G[2]=-i.crossLength(o,f),e.G[3]=1,t.G[0]=0,t.G[1]=-1,t.G[2]=-i.crossLength(o,l),t.G[4]=1,n.G[0]=-a[0],n.G[1]=-a[1],n.G[3]=a[0],n.G[4]=a[1],n.G[5]=i.crossLength(u,a)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(e,t){function n(e,t,n){n=n||{},r.call(this,e,t,r.PRISMATIC,n);var a=o.fromValues(0,0),f=o.fromValues(1,0),l=o.fromValues(0,0);n.localAnchorA&&o.copy(a,n.localAnchorA),n.localAxisA&&o.copy(f,n.localAxisA),n.localAnchorB&&o.copy(l,n.localAnchorB),this.localAnchorA=a,this.localAnchorB=l,this.localAxisA=f;var c=this.maxForce="undefined"!=typeof n.maxForce?n.maxForce:Number.MAX_VALUE,h=new s(e,t,-c,c),p=new o.create,v=new o.create,m=new o.create,y=new o.create;if(h.computeGq=function(){return o.dot(m,y)},h.updateJacobian=function(){var n=this.G,r=e.position,i=t.position;o.rotate(p,a,e.angle),o.rotate(v,l,t.angle),o.add(m,i,v),o.sub(m,m,r),o.sub(m,m,p),o.rotate(y,f,e.angle+Math.PI/2),n[0]=-y[0],n[1]=-y[1],n[2]=-o.crossLength(p,y)+o.crossLength(y,m),n[3]=y[0],n[4]=y[1],n[5]=o.crossLength(v,y)},this.equations.push(h),!n.disableRotationalLock){var b=new u(e,t,-c,c);this.equations.push(b)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof n.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof n.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof n.lowerLimit?n.lowerLimit:0,this.upperLimit="undefined"!=typeof n.upperLimit?n.upperLimit:1,this.upperLimitEquation=new i(e,t),this.lowerLimitEquation=new i(e,t),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c,this.motorEquation=new s(e,t),this.motorEnabled=!1,this.motorSpeed=0;var w=this,E=this.motorEquation;E.computeGW,E.computeGq=function(){return 0},E.computeGW=function(){var e=this.G,t=this.bodyA,n=this.bodyB,r=t.velocity,i=n.velocity,s=t.angularVelocity,o=n.angularVelocity;return this.transformedGmult(e,r,s,i,o)+w.motorSpeed}}var r=e("./Constraint"),i=e("../equations/ContactEquation"),s=e("../equations/Equation"),o=e("../math/vec2"),u=e("../equations/RotationalLockEquation");t.exports=n,n.prototype=new r;var a=o.create(),f=o.create(),l=o.create(),c=o.create(),h=o.create(),p=o.create();n.prototype.update=function(){var e=this.equations,t=e[0],n=this.upperLimit,r=this.lowerLimit,i=this.upperLimitEquation,s=this.lowerLimitEquation,u=this.bodyA,d=this.bodyB,v=this.localAxisA,y=this.localAnchorA,b=this.localAnchorB;t.updateJacobian(),o.rotate(a,v,u.angle),o.rotate(c,y,u.angle),o.add(f,c,u.position),o.rotate(h,b,d.angle),o.add(l,h,d.position);var w=this.position=o.dot(l,a)-o.dot(f,a);if(this.motorEnabled){var E=this.motorEquation.G;E[0]=a[0],E[1]=a[1],E[2]=o.crossLength(a,h),E[3]=-a[0],E[4]=-a[1],E[5]=-o.crossLength(a,c)}if(this.upperLimitEnabled&&w>n)o.scale(i.normalA,a,-1),o.sub(i.contactPointA,f,u.position),o.sub(i.contactPointB,l,d.position),o.scale(p,a,n),o.add(i.contactPointA,i.contactPointA,p),-1==e.indexOf(i)&&e.push(i);else{var S=e.indexOf(i);-1!=S&&e.splice(S,1)}if(this.lowerLimitEnabled&&r>w)o.scale(s.normalA,a,1),o.sub(s.contactPointA,f,u.position),o.sub(s.contactPointB,l,d.position),o.scale(p,a,r),o.sub(s.contactPointB,s.contactPointB,p),-1==e.indexOf(s)&&e.push(s);else{var S=e.indexOf(s);-1!=S&&e.splice(S,1)}},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(e,t){function n(e,t,n,p,v){v=v||{},r.call(this,e,n,r.REVOLUTE,v);var y=this.maxForce="undefined"!=typeof v.maxForce?v.maxForce:Number.MAX_VALUE;this.pivotA=u.fromValues(t[0],t[1]),this.pivotB=u.fromValues(p[0],p[1]);var b=this.equations=[new i(e,n,-y,y),new i(e,n,-y,y)],w=b[0],E=b[1],S=this;w.computeGq=function(){return u.rotate(a,S.pivotA,e.angle),u.rotate(f,S.pivotB,n.angle),u.add(h,n.position,f),u.sub(h,h,e.position),u.sub(h,h,a),u.dot(h,l)},E.computeGq=function(){return u.rotate(a,S.pivotA,e.angle),u.rotate(f,S.pivotB,n.angle),u.add(h,n.position,f),u.sub(h,h,e.position),u.sub(h,h,a),u.dot(h,c)},E.minForce=w.minForce=-y,E.maxForce=w.maxForce=y,this.motorEquation=new s(e,n),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new o(e,n),this.lowerLimitEquation=new o(e,n),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var r=e("./Constraint"),i=e("../equations/Equation"),s=e("../equations/RotationalVelocityEquation"),o=e("../equations/RotationalLockEquation"),u=e("../math/vec2");t.exports=n;var a=u.create(),f=u.create(),l=u.fromValues(1,0),c=u.fromValues(0,1),h=u.create();n.prototype=new r,n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.pivotA,r=this.pivotB,i=this.equations,s=(i[0],i[1],i[0]),o=i[1],h=this.upperLimit,p=this.lowerLimit,d=this.upperLimitEquation,v=this.lowerLimitEquation,m=this.angle=t.angle-e.angle;if(this.upperLimitEnabled&&m>h)d.angle=h,-1==i.indexOf(d)&&i.push(d);else{var g=i.indexOf(d);-1!=g&&i.splice(g,1)}if(this.lowerLimitEnabled&&p>m)v.angle=p,-1==i.indexOf(v)&&i.push(v);else{var g=i.indexOf(v);-1!=g&&i.splice(g,1)}u.rotate(a,n,e.angle),u.rotate(f,r,t.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-u.crossLength(a,l),s.G[3]=1,s.G[4]=0,s.G[5]=u.crossLength(f,l),o.G[0]=0,o.G[1]=-1,o.G[2]=-u.crossLength(a,c),o.G[3]=0,o.G[4]=1,o.G[5]=u.crossLength(f,c)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1}},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(e){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=e}},n.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(e,t){function n(e,t,n){n=n||{},r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio="number"==typeof n.ratio?n.ratio:1,this.setRatio(this.ratio)}var r=e("./Equation");e("../math/vec2"),t.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(e){var t=this.G;t[2]=e,t[5]=-1,this.ratio=e},n.prototype.setMaxTorque=function(e){this.maxForce=e,this.minForce=-e}},{"../math/vec2":30,"./Equation":22}],21:[function(e,t){function n(e,t){r.call(this,e,t,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=e("./Equation"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeB=function(e,t,n){var r=this.bodyA,s=this.bodyB,o=this.contactPointA,u=this.contactPointB,a=r.position,f=s.position,l=this.penetrationVec,c=this.normalA,h=this.G,p=i.crossLength(o,c),d=i.crossLength(u,c);h[0]=-c[0],h[1]=-c[1],h[2]=-p,h[3]=c[0],h[4]=c[1],h[5]=d,i.add(l,f,u),i.sub(l,l,a),i.sub(l,l,o);var v,m;this.firstImpact&&0!==this.restitution?(m=0,v=1/t*(1+this.restitution)*this.computeGW()):(m=i.dot(c,l),v=this.computeGW());var g=this.computeGiMf(),y=-m*e-v*t-n*g;return y}},{"../math/vec2":30,"./Equation":22}],22:[function(e,t){function n(e,t,r,i){this.minForce="undefined"==typeof r?-Number.MAX_VALUE:r,this.maxForce="undefined"==typeof i?Number.MAX_VALUE:i,this.bodyA=e,this.bodyB=t,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.G=new u.ARRAY_TYPE(6);for(var s=0;6>s;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}function r(e,t,n,r,i){return e[0]*t[0]+e[1]*t[1]+e[2]*n+e[3]*r[0]+e[4]*r[1]+e[5]*i}function i(e){return e.sleepState===a.SLEEPING?0:e.invMass}function s(e){return e.sleepState===a.SLEEPING?0:e.invInertia}t.exports=n;var o=e("../math/vec2"),u=e("../utils/Utils"),a=e("../objects/Body");n.prototype.constructor=n,n.DEFAULT_STIFFNESS=1e6,n.DEFAULT_RELAXATION=4,n.prototype.update=function(){var e=this.stiffness,t=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*t)),this.b=4*t/(1+4*t),this.epsilon=4/(n*n*e*(1+4*t)),this.needsUpdate=!1},n.prototype.computeB=function(e,t,n){var r=this.computeGW(),i=this.computeGq(),s=this.computeGiMf();return-i*e-r*t-s*n};var f=o.create(),l=o.create();n.prototype.computeGq=function(){var e=this.G,t=this.bodyA,n=this.bodyB,i=(t.position,n.position,t.angle),s=n.angle;return r(e,f,i,l,s)+this.offset},n.prototype.computeGW=function(){var e=this.G,t=this.bodyA,n=this.bodyB,i=t.velocity,s=n.velocity,o=t.angularVelocity,u=n.angularVelocity;return r(e,i,o,s,u)+this.relativeVelocity},n.prototype.computeGWlambda=function(){var e=this.G,t=this.bodyA,n=this.bodyB,i=t.vlambda,s=n.vlambda,o=t.wlambda,u=n.wlambda;return r(e,i,o,s,u)};var c=o.create(),h=o.create();n.prototype.computeGiMf=function(){var e=this.bodyA,t=this.bodyB,n=e.force,u=e.angularForce,a=t.force,f=t.angularForce,l=i(e),p=i(t),d=s(e),v=s(t),y=this.G;return o.scale(c,n,l),o.scale(h,a,p),r(y,c,u*d,h,f*v)},n.prototype.computeGiMGt=function(){var e=this.bodyA,t=this.bodyB,n=i(e),r=i(t),o=s(e),u=s(t),a=this.G;return a[0]*a[0]*n+a[1]*a[1]*n+a[2]*a[2]*o+a[3]*a[3]*r+a[4]*a[4]*r+a[5]*a[5]*u};var p=o.create(),d=o.create(),v=o.create();o.create(),o.create(),o.create(),n.prototype.addToWlambda=function(e){var t=this.bodyA,n=this.bodyB,r=p,u=d,a=v,f=i(t),l=i(n),c=s(t),h=s(n),m=this.G;u[0]=m[0],u[1]=m[1],a[0]=m[3],a[1]=m[4],o.scale(r,u,f*e),o.add(t.vlambda,t.vlambda,r),t.wlambda+=c*m[2]*e,o.scale(r,a,l*e),o.add(n.vlambda,n.vlambda,r),n.wlambda+=h*m[5]*e},n.prototype.computeInvC=function(e){return 1/(this.computeGiMGt()+e)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":47}],23:[function(e,t){function n(e,t,n){i.call(this,e,t,-n,n),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquation=null,this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var r=e("../math/vec2"),i=e("./Equation");e("../utils/Utils"),t.exports=n,n.prototype=new i,n.prototype.constructor=n,n.prototype.setSlipForce=function(e){this.maxForce=e,this.minForce=-e},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(e,t,n){var i=(this.bodyA,this.bodyB,this.contactPointA),s=this.contactPointB,o=this.t,u=this.G;u[0]=-o[0],u[1]=-o[1],u[2]=-r.crossLength(i,o),u[3]=o[0],u[4]=o[1],u[5]=r.crossLength(s,o);var a=this.computeGW(),f=this.computeGiMf(),l=-a*t-n*f;return l}},{"../math/vec2":30,"../utils/Utils":47,"./Equation":22}],24:[function(e,t){function n(e,t,n){n=n||{},r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var i=this.G;i[2]=1,i[5]=-1}var r=e("./Equation"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.constructor=n;var s=i.create(),o=i.create(),u=i.fromValues(1,0),a=i.fromValues(0,1);n.prototype.computeGq=function(){return i.rotate(s,u,this.bodyA.angle+this.angle),i.rotate(o,a,this.bodyB.angle),i.dot(s,o)}},{"../math/vec2":30,"./Equation":22}],25:[function(e,t){function n(e,t){r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=e("./Equation");e("../math/vec2"),t.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeB=function(e,t,n){var r=this.G;r[2]=-1,r[5]=this.ratio;var i=this.computeGiMf(),s=this.computeGW(),o=-s*t-n*i;return o}},{"../math/vec2":30,"./Equation":22}],26:[function(e,t){var n=function(){};t.exports=n,n.prototype={constructor:n,on:function(e,t,n){t.context=n||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this},has:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;if(t){if(void 0!==n[e]&&-1!==n[e].indexOf(t))return!0}else if(void 0!==n[e])return!0;return!1},off:function(e,t){if(void 0===this._listeners)return this;var n=this._listeners,r=n[e].indexOf(t);return-1!==r&&n[e].splice(r,1),this},emit:function(e){if(void 0===this._listeners)return this;var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var r=0,i=n.length;i>r;r++){var s=n[r];s.call(s.context,e)}}return this}}},{}],27:[function(e,t){function n(e,t,s){if(s=s||{},!(e instanceof r&&t instanceof r))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=e,this.materialB=t,this.friction="undefined"!=typeof s.friction?Number(s.friction):.3,this.restitution="undefined"!=typeof s.restitution?Number(s.restitution):0,this.stiffness="undefined"!=typeof s.stiffness?Number(s.stiffness):i.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof s.relaxation?Number(s.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof s.frictionStiffness?Number(s.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof s.frictionRelaxation?Number(s.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof s.surfaceVelocity?Number(s.surfaceVelocity):0}var r=e("./Material"),i=e("../equations/Equation");t.exports=n,n.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(e,t){function n(){this.id=n.idCounter++}t.exports=n,n.idCounter=0},{}],29:[function(e,t){var n={};n.GetArea=function(e){if(e.length<6)return 0;for(var t=e.length-2,n=0,r=0;t>r;r+=2)n+=(e[r+2]-e[r])*(e[r+1]+e[r+3]);return n+=(e[0]-e[t])*(e[t+1]+e[1]),.5*-n},n.Triangulate=function(e){var t=e.length>>1;if(3>t)return[];for(var r=[],i=[],s=0;t>s;s++)i.push(s);for(var s=0,o=t;o>3;){var u=i[(s+0)%o],a=i[(s+1)%o],f=i[(s+2)%o],l=e[2*u],h=e[2*u+1],p=e[2*a],d=e[2*a+1],v=e[2*f],m=e[2*f+1],g=!1;if(n._convex(l,h,p,d,v,m)){g=!0;for(var y=0;o>y;y++){var b=i[y];if(b!=u&&b!=a&&b!=f&&n._PointInTriangle(e[2*b],e[2*b+1],l,h,p,d,v,m)){g=!1;break}}}if(g)r.push(u,a,f),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o)break}return r.push(i[0],i[1],i[2]),r},n._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&1>w+E},n._convex=function(e,t,n,r,i,s){return(t-r)*(i-n)+(n-e)*(s-r)>=0},t.exports=n},{}],30:[function(e,t){var n=e("../../build/vec2").vec2;n.crossLength=function(e,t){return e[0]*t[1]-e[1]*t[0]},n.crossVZ=function(e,t,r){return n.rotate(e,t,-Math.PI/2),n.scale(e,e,r),e},n.crossZV=function(e,t,r){return n.rotate(e,r,Math.PI/2),n.scale(e,e,t),e},n.rotate=function(e,t,n){var r=Math.cos(n),i=Math.sin(n),s=t[0],o=t[1];e[0]=r*s-i*o,e[1]=i*s+r*o},n.rotate90cw=function(e,t){e[0]=t[1],e[1]=-t[0]},n.toLocalFrame=function(e,t,r,i){n.copy(e,t),n.sub(e,e,r),n.rotate(e,e,-i)},n.toGlobalFrame=function(e,t,r,i){n.copy(e,t),n.rotate(e,e,i),n.add(e,e,r)},n.centroid=function(e,t,r,i){return n.add(e,t,r),n.add(e,e,i),n.scale(e,e,1/3),e},t.exports=n},{"../../build/vec2":1}],31:[function(e,t){function n(e){e=e||{},u.call(this),this.id=++n._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=e.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.fixedRotation=!!e.fixedRotation||!1,this.position=r.fromValues(0,0),e.position&&r.copy(this.position,e.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),e.velocity&&r.copy(this.velocity,e.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=e.angle||0,this.angularVelocity=e.angularVelocity||0,this.force=r.create(),e.force&&r.copy(this.force,e.force),this.angularForce=e.angularForce||0,this.damping="number"==typeof e.damping?e.damping:.1,this.angularDamping="number"==typeof e.angularDamping?e.angularDamping:.1,this.motionState=0===this.mass?n.STATIC:n.DYNAMIC,this.boundingRadius=0,this.aabb=new o,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=n.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var r=e("../math/vec2"),i=e("poly-decomp"),s=e("../shapes/Convex"),o=e("../collision/AABB"),u=e("../events/EventEmitter");t.exports=n,n.prototype=new u,n._idCounter=0,n.prototype.setDensity=function(e){var t=this.getArea();this.mass=t*e,this.updateMassProperties()},n.prototype.getArea=function(){for(var e=0,t=0;t<this.shapes.length;t++)e+=this.shapes[t].area;return e};var a=new o,f=r.create();n.prototype.updateAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,n=this.shapeAngles,i=e.length,s=0;s!==i;s++){var o=e[s],u=f,l=n[s]+this.angle;r.rotate(u,t[s],this.angle),r.add(u,u,this.position),o.computeAABB(a,u,l),0===s?this.aabb.copy(a):this.aabb.extend(a)}this.aabbNeedsUpdate=!1},n.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,n=e.length,i=0,s=0;s!==n;s++){var o=e[s],u=r.length(t[s]),a=o.boundingRadius;u+a>i&&(i=u+a)}this.boundingRadius=i},n.prototype.addShape=function(e,t,n){n=n||0,t=t?r.fromValues(t[0],t[1]):r.fromValues(0,0),this.shapes.push(e),this.shapeOffsets.push(t),this.shapeAngles.push(n),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},n.prototype.removeShape=function(e){var t=this.shapes.indexOf(e);return-1!==t?(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeAngles.splice(t,1),this.aabbNeedsUpdate=!0,!0):!1},n.prototype.updateMassProperties=function(){if(this.motionState===n.STATIC||this.motionState===n.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var e=this.shapes,t=e.length,i=this.mass/t,s=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var o=0;t>o;o++){var u=e[o],a=r.squaredLength(this.shapeOffsets[o]),f=u.computeMomentOfInertia(i);s+=f+i*a}this.inertia=s,this.invInertia=s>0?1/s:0}this.invMass=1/this.mass}};var l=r.create();n.prototype.applyForce=function(e,t){var n=l;r.sub(n,t,this.position),r.add(this.force,this.force,e);var i=r.crossLength(n,e);this.angularForce+=i},n.prototype.toLocalFrame=function(e,t){r.toLocalFrame(e,t,this.position,this.angle)},n.prototype.toWorldFrame=function(e,t){r.toGlobalFrame(e,t,this.position,this.angle)},n.prototype.fromPolygon=function(e,t){t=t||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);var o=new i.Polygon;if(o.vertices=e,o.makeCCW(),"number"==typeof t.removeCollinearPoints&&o.removeCollinearPoints(t.removeCollinearPoints),"undefined"==typeof t.skipSimpleCheck&&!o.isSimple())return!1;this.concavePath=o.vertices.slice(0);for(var n=0;n<this.concavePath.length;n++){var u=[0,0];r.copy(u,this.concavePath[n]),this.concavePath[n]=u}var a;a=t.optimalDecomp?o.decomp():o.quickDecomp();for(var f=r.create(),n=0;n!==a.length;n++){for(var l=new s(a[n].vertices),c=0;c!==l.vertices.length;c++){var u=l.vertices[c];r.sub(u,u,l.centerOfMass)}r.scale(f,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,f)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var c=(r.fromValues(0,0),r.fromValues(0,0)),h=r.fromValues(0,0),p=r.fromValues(0,0);n.prototype.adjustCenterOfMass=function(){var e=c,t=h,n=p,i=0;r.set(t,0,0);for(var s=0;s!==this.shapes.length;s++){var o=this.shapes[s],u=this.shapeOffsets[s];r.scale(e,u,o.area),r.add(t,t,e),i+=o.area}r.scale(n,t,1/i);for(var s=0;s!==this.shapes.length;s++){var o=this.shapes[s],u=this.shapeOffsets[s];u||(u=this.shapeOffsets[s]=r.create()),r.sub(u,u,n)}r.add(this.position,this.position,n);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)r.sub(this.concavePath[s],this.concavePath[s],n);this.updateMassProperties(),this.updateBoundingRadius()},n.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},n.prototype.resetConstraintVelocity=function(){var e=this,t=e.vlambda;r.set(t,0,0),e.wlambda=0},n.prototype.addConstraintVelocity=function(){var e=this,t=e.velocity;r.add(t,t,e.vlambda),e.angularVelocity+=e.wlambda},n.prototype.applyDamping=function(e){if(this.motionState===n.DYNAMIC){e!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,e),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,e),this.lastDampingTimeStep=e);var t=this.velocity;r.scale(t,t,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},n.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=n.AWAKE,this.idleTime=0,e!==n.AWAKE&&this.emit(n.wakeUpEvent)},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(n.sleepEvent)},n.prototype.sleepTick=function(e,t,i){if(this.allowSleep&&this.motionState!==n.SLEEPING){this.wantsToSleep=!1;var s=(this.sleepState,r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),o=Math.pow(this.sleepSpeedLimit,2);s>=o?(this.idleTime=0,this.sleepState=n.AWAKE):(this.idleTime+=i,this.sleepState=n.SLEEPY),this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep())}},n.prototype.getVelocityFromPosition=function(e,t){return e=e||r.create(),r.sub(e,this.position,this.previousPosition),r.scale(e,e,1/t),e},n.prototype.getAngularVelocityFromPosition=function(e){return(this.angle-this.previousAngle)/e},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.wakeUpEvent={type:"wakeup"},n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2},{"../collision/AABB":8,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":36,"poly-decomp":6}],32:[function(e,t){function n(e,t,n){n=i.defaults(n,{restLength:1,stiffness:100,damping:1,localAnchorA:[0,0],localAnchorB:[0,0]}),this.restLength=n.restLength,this.stiffness=n.stiffness,this.damping=n.damping,this.bodyA=e,this.bodyB=t,this.localAnchorA=r.create(),r.copy(this.localAnchorA,n.localAnchorA),this.localAnchorB=r.create(),r.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}var r=e("../math/vec2"),i=e("../utils/Utils");t.exports=n,n.prototype.setWorldAnchorA=function(e){this.bodyA.toLocalFrame(this.localAnchorA,e)},n.prototype.setWorldAnchorB=function(e){this.bodyB.toLocalFrame(this.localAnchorB,e)},n.prototype.getWorldAnchorA=function(e){this.bodyA.toWorldFrame(e,this.localAnchorA)},n.prototype.getWorldAnchorB=function(e){this.bodyB.toWorldFrame(e,this.localAnchorB)};var s=r.create(),o=r.create(),u=r.create(),a=r.create(),f=r.create(),l=r.create(),c=r.create(),h=r.create(),p=r.create();n.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,v=this.bodyB,y=s,b=o,w=u,E=a,S=p,x=f,T=l,N=c,C=h;this.getWorldAnchorA(x),this.getWorldAnchorB(T),r.sub(N,x,i.position),r.sub(C,T,v.position),r.sub(y,T,x);var L=r.len(y);r.normalize(b,y),r.sub(w,v.velocity,i.velocity),r.crossZV(S,v.angularVelocity,C),r.add(w,w,S),r.crossZV(S,i.angularVelocity,N),r.sub(w,w,S),r.scale(E,b,-e*(L-n)-t*r.dot(w,b)),r.sub(i.force,i.force,E),r.add(v.force,v.force,E);var A=r.crossLength(N,E),O=r.crossLength(C,E);i.angularForce-=A,v.angularForce+=O}},{"../math/vec2":30,"../utils/Utils":47}],33:[function(e,t){t.exports={AABB:e("./collision/AABB"),AngleLockEquation:e("./equations/AngleLockEquation"),Body:e("./objects/Body"),Broadphase:e("./collision/Broadphase"),Capsule:e("./shapes/Capsule"),Circle:e("./shapes/Circle"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),ContactMaterial:e("./material/ContactMaterial"),Convex:e("./shapes/Convex"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventEmitter:e("./events/EventEmitter"),FrictionEquation:e("./equations/FrictionEquation"),GearConstraint:e("./constraints/GearConstraint"),GridBroadphase:e("./collision/GridBroadphase"),GSSolver:e("./solver/GSSolver"),Heightfield:e("./shapes/Heightfield"),Line:e("./shapes/Line"),LockConstraint:e("./constraints/LockConstraint"),Material:e("./material/Material"),Narrowphase:e("./collision/Narrowphase"),NaiveBroadphase:e("./collision/NaiveBroadphase"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),RevoluteConstraint:e("./constraints/RevoluteConstraint"),PrismaticConstraint:e("./constraints/PrismaticConstraint"),Rectangle:e("./shapes/Rectangle"),RotationalVelocityEquation:e("./equations/RotationalVelocityEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Spring:e("./objects/Spring"),Utils:e("./utils/Utils"),World:e("./world/World"),vec2:e("./math/vec2"),version:e("../package.json").version}},{"../package.json":7,"./collision/AABB":8,"./collision/Broadphase":9,"./collision/GridBroadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/Spring":32,"./shapes/Capsule":34,"./shapes/Circle":35,"./shapes/Convex":36,"./shapes/Heightfield":37,"./shapes/Line":38,"./shapes/Particle":39,"./shapes/Plane":40,"./shapes/Rectangle":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/Utils":47,"./world/World":51}],34:[function(e,t){function n(e,t){this.length=e||1,this.radius=t||1,r.call(this,r.CAPSULE)}var r=e("./Shape"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(e){var t=this.radius,n=this.length+t,r=2*t;return e*(r*r+n*n)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=i.create();n.prototype.computeAABB=function(e,t,n){var r=this.radius;i.set(s,this.length,0),i.rotate(s,s,n),i.set(e.upperBound,Math.max(s[0]+r,-s[0]+r),Math.max(s[1]+r,-s[1]+r)),i.set(e.lowerBound,Math.min(s[0]-r,-s[0]-r),Math.min(s[1]-r,-s[1]-r)),i.add(e.lowerBound,e.lowerBound,t),i.add(e.upperBound,e.upperBound,t)}},{"../math/vec2":30,"./Shape":42}],35:[function(e,t){function n(e){this.radius=e||1,r.call(this,r.CIRCLE)}var r=e("./Shape"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(e){var t=this.radius;return e*t*t/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(e,t){var n=this.radius;i.set(e.upperBound,n,n),i.set(e.lowerBound,-n,-n),t&&(i.add(e.lowerBound,e.lowerBound,t),i.add(e.upperBound,e.upperBound,t))}},{"../math/vec2":30,"./Shape":42}],36:[function(e,t){function n(e){this.vertices=[];for(var t=0;t<e.length;t++){var n=i.create();i.copy(n,e[t]),this.vertices.push(n)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,r.call(this,r.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var r=e("./Shape"),i=e("../math/vec2"),s=e("../math/polyk");e("poly-decomp"),t.exports=n,n.prototype=new r,n.prototype.updateTriangles=function(){this.triangles.length=0;for(var e=[],t=0;t<this.vertices.length;t++){var n=this.vertices[t];e.push(n[0],n[1])}for(var r=s.Triangulate(e),t=0;t<r.length;t+=3){var i=r[t],o=r[t+1],u=r[t+2];this.triangles.push([i,o,u])}};var o=i.create(),u=i.create(),a=i.create(),f=i.create(),l=i.create();i.create(),i.create(),i.create(),i.create(),n.prototype.updateCenterOfMass=function(){var e=this.triangles,t=this.vertices,r=this.centerOfMass,s=o,p=a,d=f,v=l,m=u;i.set(r,0,0);for(var y=0,b=0;b!==e.length;b++){var w=e[b],p=t[w[0]],d=t[w[1]],v=t[w[2]];i.centroid(s,p,d,v);var E=n.triangleArea(p,d,v);y+=E,i.scale(m,s,E),i.add(r,r,m)}i.scale(r,r,1/y)},n.prototype.computeMomentOfInertia=function(e){for(var t=0,n=0,r=this.vertices.length,s=r-1,o=0;r>o;s=o,o++){var u=this.vertices[s],a=this.vertices[o],f=Math.abs(i.crossLength(u,a)),l=i.dot(a,a)+i.dot(a,u)+i.dot(u,u);t+=f*l,n+=f}return e/6*(t/n)},n.prototype.updateBoundingRadius=function(){for(var e=this.vertices,t=0,n=0;n!==e.length;n++){var r=i.squaredLength(e[n]);r>t&&(t=r)}this.boundingRadius=Math.sqrt(t)},n.triangleArea=function(e,t,n){return.5*((t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]))},n.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var e=this.triangles,t=this.vertices,r=0;r!==e.length;r++){var i=e[r],s=t[i[0]],o=t[i[1]],u=t[i[2]],a=n.triangleArea(s,o,u);this.area+=a}},n.prototype.computeAABB=function(e,t,n){e.setFromPoints(this.vertices,t,n)}},{"../math/polyk":29,"../math/vec2":30,"./Shape":42,"poly-decomp":6}],37:[function(e,t){function n(e,t){if(t=i.defaults(t,{maxValue:null,minValue:null,elementWidth:.1}),null===t.minValue||null===t.maxValue){t.maxValue=e[0],t.minValue=e[0];for(var n=0;n!==e.length;n++){var s=e[n];s>t.maxValue&&(t.maxValue=s),s<t.minValue&&(t.minValue=s)}}this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementWidth=t.elementWidth,r.call(this,r.HEIGHTFIELD)}var r=e("./Shape"),i=(e("../math/vec2"),e("../utils/Utils"));t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var e=this.data,t=0,n=0;n<e.length-1;n++)t+=(e[n]+e[n+1])/2*this.elementWidth;this.area=t},n.prototype.computeAABB=function(e,t){e.upperBound[0]=this.elementWidth*this.data.length+t[0],e.upperBound[1]=this.maxValue+t[1],e.lowerBound[0]=t[0],e.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],38:[function(e,t){function n(e){this.length=e||1,r.call(this,r.LINE)}var r=e("./Shape"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(e){return e*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[i.create(),i.create()];n.prototype.computeAABB=function(e,t,n){var r=this.length;i.set(s[0],-r/2,0),i.set(s[1],r/2,0),e.setFromPoints(s,t,n)}},{"../math/vec2":30,"./Shape":42}],39:[function(e,t){function n(){r.call(this,r.PARTICLE)}var r=e("./Shape"),i=e("../math/vec2");t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(e,t){this.length,i.copy(e.lowerBound,t),i.copy(e.upperBound,t)}},{"../math/vec2":30,"./Shape":42}],40:[function(e,t){function n(){r.call(this,r.PLANE)}var r=e("./Shape"),i=e("../math/vec2");e("../utils/Utils"),t.exports=n,n.prototype=new r,n.prototype.computeMomentOfInertia=function(){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(e,t,n){var r=0,s=i.set;"number"==typeof n&&(r=n%(2*Math.PI)),0==r?(s(e.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(e.upperBound,Number.MAX_VALUE,0)):r==Math.PI/2?(s(e.lowerBound,0,-Number.MAX_VALUE),s(e.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):r==Math.PI?(s(e.lowerBound,-Number.MAX_VALUE,0),s(e.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):r==3*Math.PI/2?(s(e.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(e.upperBound,0,Number.MAX_VALUE)):(s(e.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(e.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),i.add(e.lowerBound,e.lowerBound,t),i.add(e.upperBound,e.upperBound,t)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],41:[function(e,t){function n(e,t){e=e||1,t=t||1;var n=[r.fromValues(-e/2,-t/2),r.fromValues(e/2,-t/2),r.fromValues(e/2,t/2),r.fromValues(-e/2,t/2)];this.width=e,this.height=t,s.call(this,n),this.type=i.RECTANGLE}var r=e("../math/vec2"),i=e("./Shape"),s=e("./Convex");t.exports=n,n.prototype=new s([]),n.prototype.computeMomentOfInertia=function(e){var t=this.width,n=this.height;return e*(n*n+t*t)/12},n.prototype.updateBoundingRadius=function(){var e=this.width,t=this.height;this.boundingRadius=Math.sqrt(e*e+t*t)/2},r.create(),r.create(),r.create(),r.create(),n.prototype.computeAABB=function(e,t,n){e.setFromPoints(this.vertices,t,n)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":36,"./Shape":42}],42:[function(e,t){function n(e){this.type=e,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,e&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}t.exports=n,n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.RECTANGLE=32,n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},n.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(){}},{}],43:[function(e,t){function n(e){s.call(this,e,s.GS),e=e||{},this.iterations=e.iterations||10,this.tolerance=e.tolerance||1e-10,this.arrayStep=30,this.lambda=new o.ARRAY_TYPE(this.arrayStep),this.Bs=new o.ARRAY_TYPE(this.arrayStep),this.invCs=new o.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function r(e){for(var t=e.length;t--;)e[t]=0}var i=e("../math/vec2"),s=e("./Solver"),o=e("../utils/Utils"),u=e("../equations/FrictionEquation");t.exports=n,n.prototype=new s,n.prototype.solve=function(e,t){this.sortEquations();var s=0,a=this.iterations,f=this.frictionIterations,l=this.equations,p=l.length,v=Math.pow(this.tolerance*p,2),m=t.bodies,y=t.bodies.length,b=(i.add,i.set,this.useZeroRHS),w=this.lambda;this.usedIterations=0,w.length<p&&(w=this.lambda=new o.ARRAY_TYPE(p+this.arrayStep),this.Bs=new o.ARRAY_TYPE(p+this.arrayStep),this.invCs=new o.ARRAY_TYPE(p+this.arrayStep)),r(w);for(var E=this.invCs,S=this.Bs,w=this.lambda,x=0;x!==l.length;x++){var T=l[x];(T.timeStep!==e||T.needsUpdate)&&(T.timeStep=e,T.update()),S[x]=T.computeB(T.a,T.b,e),E[x]=T.computeInvC(T.epsilon)}var T,N,x,C;if(0!==p){for(x=0;x!==y;x++)m[x].resetConstraintVelocity();if(f){for(s=0;s!==f;s++){for(N=0,C=0;C!==p;C++){T=l[C];var k=n.iterateEquation(C,T,T.epsilon,S,E,w,b,e,s);N+=Math.abs(k)}if(this.usedIterations++,v>=N*N)break}for(n.updateMultipliers(l,w,1/e),C=0;C!==p;C++){var L=l[C];if(L instanceof u){var A=L.contactEquation.multiplier*L.frictionCoefficient;L.maxForce=A,L.minForce=-A}}}for(s=0;s!==a;s++){for(N=0,C=0;C!==p;C++){T=l[C];var k=n.iterateEquation(C,T,T.epsilon,S,E,w,b,e,s);N+=Math.abs(k)}if(this.usedIterations++,v>=N*N)break}for(x=0;x!==y;x++)m[x].addConstraintVelocity();n.updateMultipliers(l,w,1/e)}},n.updateMultipliers=function(e,t,n){for(var r=e.length;r--;)e[r].multiplier=t[r]*n},n.iterateEquation=function(e,t,n,r,i,s,o,u){var a=r[e],f=i[e],l=s[e],c=t.computeGWlambda(),h=t.maxForce,p=t.minForce;o&&(a=0);var d=f*(a-c-n*l),v=l+d;return p*u>v?d=p*u-l:v>h*u&&(d=h*u-l),s[e]+=d,t.addToWlambda(d),d}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":47,"./Solver":44}],44:[function(e,t){function n(e,t){e=e||{},r.call(this),this.type=t,this.equations=[],this.equationSortFunction=e.equationSortFunction||!1}var r=(e("../utils/Utils"),e("../events/EventEmitter"));t.exports=n,n.prototype=new r,n.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var i={bodies:[]};n.prototype.solveIsland=function(e,t){this.removeAllEquations(),t.equations.length&&(this.addEquations(t.equations),i.bodies.length=0,t.getBodies(i.bodies),i.bodies.length&&this.solve(e,i))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},n.prototype.addEquations=function(e){for(var t=0,n=e.length;t!==n;t++){var r=e[t];r.enabled&&this.equations.push(r)}},n.prototype.removeEquation=function(e){var t=this.equations.indexOf(e);-1!==t&&this.equations.splice(t,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":47}],45:[function(e,t){function n(){this.overlappingLastState=new i,this.overlappingCurrentState=new i,this.recordPool=[],this.tmpDict=new i,this.tmpArray1=[]}function r(e,t,n,r){this.shapeA=t,this.shapeB=r,this.bodyA=e,this.bodyB=n}var i=e("./TupleDictionary");e("./Utils"),t.exports=n,n.prototype.tick=function(){for(var e=this.overlappingLastState,t=this.overlappingCurrentState,n=t.keys.length;n--;){var r=t.keys[n];this.recordPool.push(t.getByKey(r))}e.reset(),e.copy(t),t.reset()},n.prototype.setOverlapping=function(e,t,n,i){var s=(this.overlappingLastState,this.overlappingCurrentState);if(!s.get(t.id,i.id)){var o;o=this.recordPool.length?this.recordPool.pop():new r(e,t,n,i),s.set(t.id,i.id,o)}},n.prototype.getNewOverlaps=function(e){return this.getDiff(this.overlappingLastState,this.overlappingCurrentState,e)},n.prototype.getEndOverlaps=function(e){return this.getDiff(this.overlappingCurrentState,this.overlappingLastState,e)},n.prototype.getDiff=function(e,t,n){var n=n||[],r=e,i=t;n.length=0;for(var s=i.keys.length;s--;){var o=i.keys[s],u=i.data[o];if(!u)throw new Error("Key "+o+" had no data!");var a=r.data[o];a||n.push(u)}return n},n.prototype.isNewOverlap=function(e,t){var n=0|e.id,r=0|t.id;return!this.overlappingLastState.get(n,r)&&!!this.overlappingCurrentState.get(n,r)},n.prototype.getNewBodyOverlaps=function(e){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,e)},n.prototype.getEndBodyOverlaps=function(e){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,e)},n.prototype.getBodyDiff=function(e,t){t=t||[];for(var n=this.tmpDict,r=e.length;r--;){var i=e[r];n.set(0|i.bodyA.id,0|i.bodyB.id,i)}for(r=n.keys.length;r--;){var i=n.keys[r];t.push(i.bodyA,i.bodyB)}return n.reset(),t},r.prototype.set=function(e,t,n,i){r.call(this,e,t,n,i)}},{"./TupleDictionary":46,"./Utils":47}],46:[function(e,t){function n(){this.data=[],this.keys=[]}var r=e("./Utils");t.exports=n,n.prototype.getKey=function(e,t){return e=0|e,t=0|t,(0|e)===(0|t)?-1:0|((0|e)>(0|t)?e<<16|65535&t:t<<16|65535&e)},n.prototype.getByKey=function(e){return e=0|e,this.data[e]},n.prototype.get=function(e,t){e=0|e,t=0|t;var n=0|this.getKey(e,t);return this.data[n]},n.prototype.set=function(e,t,n){if(!n)throw new Error("No data!");e=0|e,t=0|t;var r=0|this.getKey(e,t);return this.get(e,t)||this.keys.push(r),this.data[r]=n,r},n.prototype.reset=function(){for(var e=this.data,t=this.keys,n=0|t.length;n--;){var r=0|t[n];e[r]=void 0}t.length=0},n.prototype.copy=function(e){this.reset(),r.appendArray(this.keys,e.keys);for(var t=0|e.keys.length;t--;){var n=0|e.keys[t];this.data[n]=e.data[n]}}},{"./Utils":47}],47:[function(e,t){function n(){}t.exports=n,n.appendArray=function(e,t){if(t.length<15e4)e.push.apply(e,t);else for(var n=0,r=t.length;n!==r;++n)e.push(t[n])},n.splice=function(e,t,n){n=n||1;for(var r=t,i=e.length-n;i>r;r++)e[r]=e[r+n];e.length=i},n.ARRAY_TYPE=window.Float32Array||Array,n.extend=function(e,t){for(var n in t)e[n]=t[n]},n.defaults=function(e,t){e=e||{};for(var n in t)n in e||(e[n]=t[n]);return e}},{}],48:[function(e,t){function n(){this.equations=[],this.bodies=[]}var r=e("../objects/Body");t.exports=n,n.prototype.reset=function(){this.equations.length=this.bodies.length=0};var i=[];n.prototype.getBodies=function(e){var t=e||[],n=this.equations;i.length=0;for(var r=0;r!==n.length;r++){var s=n[r];-1===i.indexOf(s.bodyA.id)&&(t.push(s.bodyA),i.push(s.bodyA.id)),-1===i.indexOf(s.bodyB.id)&&(t.push(s.bodyB),i.push(s.bodyB.id))}return t},n.prototype.wantsToSleep=function(){for(var e=0;e<this.bodies.length;e++){var t=this.bodies[e];if(t.motionState===r.DYNAMIC&&!t.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var e=0;e<this.bodies.length;e++){var t=this.bodies[e];t.sleep()}return!0}},{"../objects/Body":31}],49:[function(e,t){function n(){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var r=(e("../math/vec2"),e("./Island")),i=e("./IslandNode"),s=e("../objects/Body");t.exports=n,n.getUnvisitedNode=function(e){for(var t=e.length,n=0;n!==t;n++){var r=e[n];if(!r.visited&&r.body.motionState===s.DYNAMIC)return r}return!1},n.prototype.visit=function(e,t,n){t.push(e.body);for(var r=e.equations.length,i=0;i!==r;i++){var s=e.equations[i];-1===n.indexOf(s)&&n.push(s)}},n.prototype.bfs=function(e,t,r){var i=this.queue;for(i.length=0,i.push(e),e.visited=!0,this.visit(e,t,r);i.length;)for(var o,u=i.pop();o=n.getUnvisitedNode(u.neighbors);)o.visited=!0,this.visit(o,t,r),o.body.motionState===s.DYNAMIC&&i.push(o)},n.prototype.split=function(e){for(var t=e.bodies,s=this.nodes,o=this.equations;s.length;)this._nodePool.push(s.pop());for(var u=0;u!==t.length;u++)if(this._nodePool.length){var a=this._nodePool.pop();a.reset(),a.body=t[u],s.push(a)}else s.push(new i(t[u]));for(var f=0;f!==o.length;f++){var l=o[f],u=t.indexOf(l.bodyA),h=t.indexOf(l.bodyB),p=s[u],v=s[h];p.neighbors.push(v),v.neighbors.push(p),p.equations.push(l),v.equations.push(l)}for(var m=this.islands;m.length;){var g=m.pop();g.reset(),this._islandPool.push(g)}for(var y;y=n.getUnvisitedNode(s);){var g=this._islandPool.length?this._islandPool.pop():new r;this.bfs(y,g.bodies,g.equations),m.push(g)}return m}},{"../math/vec2":30,"../objects/Body":31,"./Island":48,"./IslandNode":50}],50:[function(e,t){function n(e){this.body=e,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=n,n.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],51:[function(e,t){function n(e){g.apply(this),e=e||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=e.solver||new o,this.narrowphase=new _(this),this.islandManager=new H,this.gravity=f.fromValues(0,-9.78),e.gravity&&f.copy(this.gravity,e.gravity),this.frictionGravity=f.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=e.doProfiling||!1,this.lastStepTime=0,this.broadphase=e.broadphase||new a,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new E,this.defaultContactMaterial=new S(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof e.islandSplit?!!e.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.enableBodySleeping=!1,this.enableIslandSleeping=!1,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new P}function r(e){return e?[e[0],e[1]]:e}function i(e,t){for(var n in t)e[n]=t[n]}function s(e){return{id:e.id,materialA:e.materialA.id,materialB:e.materialB.id,friction:e.friction,restitution:e.restitution,stiffness:e.stiffness,relaxation:e.relaxation,frictionStiffness:e.frictionStiffness,frictionRelaxation:e.frictionRelaxation}}var o=e("../solver/GSSolver"),u=e("../solver/Solver"),a=e("../collision/NaiveBroadphase"),f=e("../math/vec2"),l=e("../shapes/Circle"),c=e("../shapes/Rectangle"),h=e("../shapes/Convex"),p=e("../shapes/Line"),d=e("../shapes/Plane"),v=e("../shapes/Capsule"),m=e("../shapes/Particle"),g=e("../events/EventEmitter"),y=e("../objects/Body"),b=e("../shapes/Shape"),w=e("../objects/Spring"),E=e("../material/Material"),S=e("../material/ContactMaterial"),x=e("../constraints/DistanceConstraint"),T=e("../constraints/Constraint"),N=e("../constraints/LockConstraint"),C=e("../constraints/RevoluteConstraint"),k=e("../constraints/PrismaticConstraint"),L=e("../constraints/GearConstraint"),A=e("../../package.json"),O=e("../collision/Broadphase"),M=e("../collision/SAPBroadphase"),_=e("../collision/Narrowphase"),D=e("../utils/Utils"),P=e("../utils/OverlapKeeper"),H=e("./IslandManager");if(t.exports=n,"undefined"==typeof performance&&(performance={}),!performance.now){var B=Date.now();performance.timing&&performance.timing.navigationStart&&(B=performance.timing.navigationStart),performance.now=function(){return Date.now()-B}}n.prototype=new Object(g.prototype),n.prototype.addConstraint=function(e){this.constraints.push(e)},n.prototype.addContactMaterial=function(e){this.contactMaterials.push(e)},n.prototype.removeContactMaterial=function(e){var t=this.contactMaterials.indexOf(e);-1!==t&&D.splice(this.contactMaterials,t,1)},n.prototype.getContactMaterial=function(e,t){for(var n=this.contactMaterials,r=0,i=n.length;r!==i;r++){var s=n[r];if(s.materialA===e&&s.materialB===t||s.materialA===t&&s.materialB===e)return s}return!1},n.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t&&D.splice(this.constraints,t,1)};var j=(f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()),F=f.fromValues(0,0),I=f.fromValues(0,0),q=(f.fromValues(0,0),f.fromValues(0,0));n.prototype.step=function(e,t,n){if(n=n||10,t=t||0,0===t)this.internalStep(e),this.time+=e;else{var r=Math.floor((this.time+t)/e)-Math.floor(this.time/e);r=Math.min(r,n);for(var i=0;i!==r;i++)this.internalStep(e);this.time+=t;for(var s=this.time%e,o=s/e,u=0;u!==this.bodies.length;u++){var a=this.bodies[u];a.motionState!==y.STATIC&&a.sleepState!==y.SLEEPING?(f.sub(q,a.position,a.previousPosition),f.scale(q,q,o),f.add(a.interpolatedPosition,a.position,q),a.interpolatedAngle=a.angle+(a.angle-a.previousAngle)*o):(f.copy(a.interpolatedPosition,a.position),a.interpolatedAngle=a.angle)}}};var R=[];n.prototype.internalStep=function(e){this.stepping=!0;var t,r,i=this,s=this.doProfiling,o=this.springs.length,u=this.springs,a=this.bodies,l=this.gravity,c=this.solver,h=this.bodies.length,p=this.broadphase,d=this.narrowphase,v=this.constraints,m=j,g=(f.scale,f.add),b=(f.rotate,this.islandManager);if(this.lastTimeStep=e,s&&(t=performance.now()),this.useWorldGravityAsFrictionGravity){var w=f.length(this.gravity);0===w&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=w)}if(this.applyGravity)for(var E=0;E!==h;E++){var S=a[E],x=S.force;S.motionState===y.DYNAMIC&&S.sleepState!==y.SLEEPING&&(f.scale(m,l,S.mass*S.gravityScale),g(x,x,m))}if(this.applySpringForces)for(var E=0;E!==o;E++){var T=u[E];T.applyForce()}if(this.applyDamping)for(var E=0;E!==h;E++){var S=a[E];S.motionState===y.DYNAMIC&&S.applyDamping(e)}for(var N=p.getCollisionPairs(this),C=this.disabledBodyCollisionPairs,E=C.length-2;E>=0;E-=2)for(var k=N.length-2;k>=0;k-=2)(C[E]===N[k]&&C[E+1]===N[k+1]||C[E+1]===N[k]&&C[E]===N[k+1])&&N.splice(k,2);var L=v.length;for(E=0;E!==L;E++){var A=v[E];if(!A.collideConnected)for(var k=N.length-2;k>=0;k-=2)(A.bodyA===N[k]&&A.bodyB===N[k+1]||A.bodyB===N[k]&&A.bodyA===N[k+1])&&N.splice(k,2)}this.postBroadphaseEvent.pairs=N,this.emit(this.postBroadphaseEvent),d.reset(this);for(var E=0,O=N.length;E!==O;E+=2)for(var M=N[E],_=N[E+1],P=0,H=M.shapes.length;P!==H;P++)for(var B=M.shapes[P],F=M.shapeOffsets[P],I=M.shapeAngles[P],q=0,U=_.shapes.length;q!==U;q++){var z=_.shapes[q],W=_.shapeOffsets[q],X=_.shapeAngles[q],V=this.defaultContactMaterial;if(B.material&&z.material){var $=this.getContactMaterial(B.material,z.material);$&&(V=$)}this.runNarrowphase(d,M,B,F,I,_,z,W,X,V,this.frictionGravity)}for(var E=0;E!==h;E++){var J=a[E];J._wakeUpAfterNarrowphase&&(J.wakeUp(),J._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(R);for(var K=this.endContactEvent,q=R.length;q--;){var Q=R[q];K.shapeA=Q.shapeA,K.shapeB=Q.shapeB,K.bodyA=Q.bodyA,K.bodyB=Q.bodyA,this.emit(K)}}this.overlapKeeper.tick();var G=this.preSolveEvent;G.contactEquations=d.contactEquations,G.frictionEquations=d.frictionEquations,this.emit(G);var L=v.length;for(E=0;E!==L;E++)v[E].update();if(d.contactEquations.length||d.frictionEquations.length||v.length)if(this.islandSplit){for(b.equations.length=0,D.appendArray(b.equations,d.contactEquations),D.appendArray(b.equations,d.frictionEquations),E=0;E!==L;E++)D.appendArray(b.equations,v[E].equations);b.split(this);for(var E=0;E!==b.islands.length;E++){var Y=b.islands[E];Y.equations.length&&c.solveIsland(e,Y)}}else{for(c.addEquations(d.contactEquations),c.addEquations(d.frictionEquations),E=0;E!==L;E++)c.addEquations(v[E].equations);this.solveConstraints&&c.solve(e,this),c.removeAllEquations()}for(var E=0;E!==h;E++){var J=a[E];J.sleepState!==y.SLEEPING&&J.motionState!==y.STATIC&&n.integrateBody(J,e)}for(var E=0;E!==h;E++)a[E].setZeroForce();if(s&&(r=performance.now(),i.lastStepTime=r-t),this.emitImpactEvent&&this.has("impact"))for(var Z=this.impactEvent,E=0;E!==d.contactEquations.length;E++){var et=d.contactEquations[E];et.firstImpact&&(Z.bodyA=et.bodyA,Z.bodyB=et.bodyB,Z.shapeA=et.shapeA,Z.shapeB=et.shapeB,Z.contactEquation=et,this.emit(Z))}if(this.enableBodySleeping)for(E=0;E!==h;E++)a[E].sleepTick(this.time,!1,e);else if(this.enableIslandSleeping&&this.islandSplit){for(E=0;E!==h;E++)a[E].sleepTick(this.time,!0,e);for(var E=0;E<this.islandManager.islands.length;E++){var Y=this.islandManager.islands[E];Y.wantsToSleep()&&Y.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var E=0;E!==this.bodiesToBeRemoved.length;E++)this.removeBody(this.bodiesToBeRemoved[E]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var U=f.create(),z=f.create();n.integrateBody=function(e,t){var n=e.invMass,r=e.force,i=e.position,s=e.velocity;f.copy(e.previousPosition,e.position),e.previousAngle=e.angle,e.fixedRotation||(e.angularVelocity+=e.angularForce*e.invInertia*t,e.angle+=e.angularVelocity*t),f.scale(U,r,t*n),f.add(s,U,s),f.scale(z,s,t),f.add(i,i,z),e.aabbNeedsUpdate=!0},n.prototype.runNarrowphase=function(e,t,n,r,i,s,o,u,a,l,c){if(0!==(n.collisionGroup&o.collisionMask)&&0!==(o.collisionGroup&n.collisionMask)){f.rotate(F,r,t.angle),f.rotate(I,u,s.angle),f.add(F,F,t.position),f.add(I,I,s.position);var h=i+t.angle,p=a+s.angle;e.enableFriction=l.friction>0,e.frictionCoefficient=l.friction;var d;d=t.motionState===y.STATIC||t.motionState===y.KINEMATIC?s.mass:s.motionState===y.STATIC||s.motionState===y.KINEMATIC?t.mass:t.mass*s.mass/(t.mass+s.mass),e.slipForce=l.friction*c*d,e.restitution=l.restitution,e.surfaceVelocity=l.surfaceVelocity,e.frictionStiffness=l.frictionStiffness,e.frictionRelaxation=l.frictionRelaxation,e.stiffness=l.stiffness,e.relaxation=l.relaxation;var v=e[n.type|o.type],m=0;if(v){var g=n.sensor||o.sensor,b=e.frictionEquations.length;m=n.type<o.type?v.call(e,t,n,F,h,s,o,I,p,g):v.call(e,s,o,I,p,t,n,F,h,g);var w=e.frictionEquations.length-b;if(m){if(t.allowSleep&&t.motionState===y.DYNAMIC&&t.sleepState===y.SLEEPING&&s.sleepState===y.AWAKE&&s.motionState!==y.STATIC){var E=f.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2),S=Math.pow(s.sleepSpeedLimit,2);E>=2*S&&(t._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.motionState===y.DYNAMIC&&s.sleepState===y.SLEEPING&&t.sleepState===y.AWAKE&&t.motionState!==y.STATIC){var x=f.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),T=Math.pow(t.sleepSpeedLimit,2);x>=2*T&&(s._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(t,n,s,o),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(n,o)){var N=this.beginContactEvent;if(N.shapeA=n,N.shapeB=o,N.bodyA=t,N.bodyB=s,N.contactEquations.length=0,"number"==typeof m)for(var C=e.contactEquations.length-m;C<e.contactEquations.length;C++)N.contactEquations.push(e.contactEquations[C]);this.emit(N)}if("number"==typeof m&&w>1)for(var C=e.frictionEquations.length-w;C<e.frictionEquations.length;C++){var k=e.frictionEquations[C];k.setSlipForce(k.getSlipForce()/w)}}}}},n.prototype.addSpring=function(e){this.springs.push(e),this.addSpringEvent.spring=e,this.emit(this.addSpringEvent)},n.prototype.removeSpring=function(e){var t=this.springs.indexOf(e);-1===t&&D.splice(this.springs,t,1)},n.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(this.bodies.push(e),e.world=this,this.addBodyEvent.body=e,this.emit(this.addBodyEvent))},n.prototype.removeBody=function(e){if(this.stepping)this.bodiesToBeRemoved.push(e);else{e.world=null;var t=this.bodies.indexOf(e);-1!==t&&(D.splice(this.bodies,t,1),this.removeBodyEvent.body=e,e.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},n.prototype.getBodyById=function(e){for(var t=this.bodies,n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}return!1},n.prototype.disableBodyCollision=function(e,t){this.disabledBodyCollisionPairs.push(e,t)},n.prototype.enableBodyCollision=function(e,t){for(var n=this.disabledBodyCollisionPairs,r=0;r<n.length;r+=2)if(n[r]===e&&n[r+1]===t||n[r+1]===e&&n[r]===t)return void n.splice(r,2)},n.prototype.toJSON=function(){var e=this,t={p2:A.version,bodies:[],springs:[],solver:{},gravity:r(e.gravity),broadphase:{},distanceConstraints:[],revoluteConstraints:[],prismaticConstraints:[],lockConstraints:[],gearConstraints:[],contactMaterials:[],materials:[],defaultContactMaterial:s(e.defaultContactMaterial),islandSplit:e.islandSplit,enableIslandSleeping:e.enableIslandSleeping,enableBodySleeping:e.enableBodySleeping},n=t.solver,o=e.solver;o.type===u.GS&&(n.type="GSSolver",n.iterations=o.iterations);var a=t.broadphase,f=e.broadphase;f.type===O.NAIVE?a.type="NaiveBroadphase":f.type===O.SAP?a.type="SAPBroadphase":console.error("Broadphase not supported: "+f.type);for(var l=0;l!==e.springs.length;l++){var o=e.springs[l];t.springs.push({bodyA:e.bodies.indexOf(o.bodyA),bodyB:e.bodies.indexOf(o.bodyB),stiffness:o.stiffness,damping:o.damping,restLength:o.restLength,localAnchorA:r(o.localAnchorA),localAnchorB:r(o.localAnchorB)})}for(var l=0;l<e.constraints.length;l++){var c=e.constraints[l],h={bodyA:e.bodies.indexOf(c.bodyA),bodyB:e.bodies.indexOf(c.bodyB),collideConnected:c.collideConnected};switch(c.type){case T.DISTANCE:i(h,{distance:c.distance,maxForce:c.getMaxForce()}),t.distanceConstraints.push(h);break;case T.REVOLUTE:i(h,{pivotA:r(c.pivotA),pivotB:r(c.pivotB),maxForce:c.maxForce,motorSpeed:c.getMotorSpeed()||0,motorEnabled:!!c.getMotorSpeed(),lowerLimit:c.lowerLimit,lowerLimitEnabled:c.lowerLimitEnabled,upperLimit:c.upperLimit,upperLimitEnabled:c.upperLimitEnabled}),t.revoluteConstraints.push(h);break;case T.PRISMATIC:i(h,{localAxisA:r(c.localAxisA),localAnchorA:r(c.localAnchorA),localAnchorB:r(c.localAnchorB),maxForce:c.maxForce,upperLimitEnabled:c.upperLimitEnabled,lowerLimitEnabled:c.lowerLimitEnabled,upperLimit:c.upperLimit,lowerLimit:c.lowerLimit,motorEnabled:c.motorEnabled,motorSpeed:c.motorSpeed}),t.prismaticConstraints.push(h);break;case T.LOCK:i(h,{localOffsetB:r(c.localOffsetB),localAngleB:c.localAngleB,maxForce:c.getMaxForce()}),t.lockConstraints.push(h);break;case T.GEAR:i(h,{angle:c.angle,ratio:c.ratio,maxForce:c.maxForce||1e6}),t.gearConstraints.push(h);break;default:console.error("Constraint not supported yet: ",c.type)}}for(var l=0;l!==e.bodies.length;l++){var p=e.bodies[l],d=p.shapes,v={id:p.id,mass:p.mass,angle:p.angle,position:r(p.position),velocity:r(p.velocity),angularVelocity:p.angularVelocity,force:r(p.force),motionState:p.motionState,fixedRotation:p.fixedRotation,circleShapes:[],planeShapes:[],particleShapes:[],lineShapes:[],rectangleShapes:[],convexShapes:[],capsuleShapes:[]};p.concavePath&&(v.concavePath=p.concavePath);for(var m=0;m<d.length;m++){var o=d[m],g={};switch(g.offset=r(p.shapeOffsets[m]),g.angle=p.shapeAngles[m],g.collisionGroup=o.collisionGroup,g.collisionMask=o.collisionMask,g.material=o.material?o.material.id:null,o.type){case b.CIRCLE:i(g,{radius:o.radius}),v.circleShapes.push(g);break;case b.PLANE:v.planeShapes.push(g);break;case b.PARTICLE:v.particleShapes.push(g);break;case b.LINE:g.length=o.length,v.lineShapes.push(g);break;case b.RECTANGLE:i(g,{width:o.width,height:o.height}),v.rectangleShapes.push(g);break;case b.CONVEX:for(var y=[],w=0;w<o.vertices.length;w++)y.push(r(o.vertices[w]));i(g,{vertices:y}),v.convexShapes.push(g);break;case b.CAPSULE:i(g,{length:o.length,radius:o.radius}),v.capsuleShapes.push(g);break;default:console.error("Shape type not supported yet!")}}t.bodies.push(v)}for(var l=0;l<e.contactMaterials.length;l++){var E=e.contactMaterials[l];t.contactMaterials.push(s(E))}for(var S={},l=0;l<e.contactMaterials.length;l++){var E=e.contactMaterials[l];S[E.materialA.id+""]=E.materialA,S[E.materialB.id+""]=E.materialB}for(var x in S){var N=S[parseInt(x)];t.materials.push({id:N.id})}return t},n.prototype.fromJSON=function(e){function t(e,t,n){t.collisionMask=n.collisionMask,t.collisionGroup=n.collisionGroup,n.material&&(t.material=u[n.material+""]),e.addShape(t,n.offset,n.angle)}if(this.clear(),!e.p2)return!1;var n=this;switch(f.copy(n.gravity,e.gravity),n.islandSplit=e.islandSplit,n.enableIslandSleeping=e.enableIslandSleeping,n.enableBodySleeping=e.enableBodySleeping,e.solver.type){case"GSSolver":var r=e.solver,i=new o;n.solver=i,i.iterations=r.iterations;break;default:throw new Error("Solver type not recognized: "+e.solver.type)}switch(e.broadphase.type){case"NaiveBroadphase":n.broadphase=new a;break;case"SAPBroadphase":n.broadphase=new M}n.broadphase.setWorld(n);for(var s=n.bodies,u={},g=0;g!==e.materials.length;g++){var b=e.materials[g],T=new E;u[b.id+""]=T,T.id=b.id}n.defaultMaterial.id=e.defaultContactMaterial.materialA;for(var g=0;g!==e.bodies.length;g++){var A=e.bodies[g],O=new y({mass:A.mass,position:A.position,angle:A.angle,velocity:A.velocity,angularVelocity:A.angularVelocity,force:A.force,fixedRotation:A.fixedRotation});O.id=A.id,O.motionState=A.motionState;for(var _=0;_<A.circleShapes.length;_++){var i=A.circleShapes[_];t(O,new l(i.radius),i)}for(var _=0;_<A.planeShapes.length;_++){var i=A.planeShapes[_];t(O,new d,i)}for(var _=0;_<A.particleShapes.length;_++){var i=A.particleShapes[_];t(O,new m,i)}for(var _=0;_<A.lineShapes.length;_++){var i=A.lineShapes[_];t(O,new p(i.length),i)}for(var _=0;_<A.rectangleShapes.length;_++){var i=A.rectangleShapes[_];t(O,new c(i.width,i.height),i)}for(var _=0;_<A.convexShapes.length;_++){var i=A.convexShapes[_];t(O,new h(i.vertices),i)}for(var _=0;_<A.capsuleShapes.length;_++){var i=A.capsuleShapes[_];t(O,new v(i.length,i.radius),i)}A.concavePath&&(O.concavePath=A.concavePath),n.addBody(O)}for(var g=0;g<e.springs.length;g++){var r=e.springs[g],D=s[r.bodyA],P=s[r.bodyB];if(!D)return this.error="instance.springs["+g+"] references instance.body["+r.bodyA+"], which does not exist.",!1;if(!P)return this.error="instance.springs["+g+"] references instance.body["+r.bodyB+"], which does not exist.",!1;var i=new w(D,P,{stiffness:r.stiffness,damping:r.damping,restLength:r.restLength,localAnchorA:r.localAnchorA,localAnchorB:r.localAnchorB});n.addSpring(i)}for(var g=0;g<e.contactMaterials.length;g++){var b=e.contactMaterials[g],H=u[b.materialA+""],B=u[b.materialB+""];if(!H)return this.error="Reference to material id "+b.materialA+": material not found",!1;if(!B)return this.error="Reference to material id "+b.materialB+": material not found",!1;var j=new S(H,B,{friction:b.friction,restitution:b.restitution,stiffness:b.stiffness,relaxation:b.relaxation,frictionStiffness:b.frictionStiffness,frictionRelaxation:b.frictionRelaxation});j.id=b.id,n.addContactMaterial(j)}var b=e.defaultContactMaterial,H=n.defaultMaterial,B=n.defaultMaterial,j=new S(H,B,{friction:b.friction,restitution:b.restitution,stiffness:b.stiffness,relaxation:b.relaxation,frictionStiffness:b.frictionStiffness,frictionRelaxation:b.frictionRelaxation});j.id=b.id,n.defaultContactMaterial=j;for(var g=0;g<e.distanceConstraints.length;g++){var F=e.distanceConstraints[g];n.addConstraint(new x(s[F.bodyA],s[F.bodyB],F.distance,{maxForce:F.maxForce,collideConnected:F.collideConnected}))}for(var g=0;g<e.revoluteConstraints.length;g++){var F=e.revoluteConstraints[g],I=new C(s[F.bodyA],F.pivotA,s[F.bodyB],F.pivotB,{maxForce:F.maxForce,collideConnected:F.collideConnected});F.motorEnabled&&I.enableMotor(),I.setMotorSpeed(F.motorSpeed),I.lowerLimit=F.lowerLimit,I.upperLimit=F.upperLimit,I.lowerLimitEnabled=F.lowerLimitEnabled,I.upperLimitEnabled=F.upperLimitEnabled,n.addConstraint(I)}for(var g=0;g<e.prismaticConstraints.length;g++){var F=e.prismaticConstraints[g],q=new k(s[F.bodyA],s[F.bodyB],{maxForce:F.maxForce,localAxisA:F.localAxisA,localAnchorA:F.localAnchorA,localAnchorB:F.localAnchorB,collideConnected:F.collideConnected});q.motorSpeed=F.motorSpeed,n.addConstraint(q)}for(var g=0;g<e.lockConstraints.length;g++){var F=e.lockConstraints[g];n.addConstraint(new N(s[F.bodyA],s[F.bodyB],{maxForce:F.maxForce,localOffsetB:F.localOffsetB,localAngleB:F.localAngleB,collideConnected:F.collideConnected}))}for(var g=0;g<e.gearConstraints.length;g++){var F=e.gearConstraints[g];n.addConstraint(new L(s[F.bodyA],s[F.bodyB],{maxForce:F.maxForce,angle:F.angle,ratio:F.ratio,collideConnected:F.collideConnected}))}return!0},n.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var e=this.constraints,t=e.length-1;t>=0;t--)this.removeConstraint(e[t]);for(var r=this.bodies,t=r.length-1;t>=0;t--)this.removeBody(r[t]);for(var i=this.springs,t=i.length-1;t>=0;t--)this.removeSpring(i[t]);for(var s=this.contactMaterials,t=s.length-1;t>=0;t--)this.removeContactMaterial(s[t]);n.apply(this)},n.prototype.clone=function(){var e=new n;return e.fromJSON(this.toJSON()),e};var W=f.create(),X=f.fromValues(0,0),V=f.fromValues(0,0);n.prototype.hitTest=function(e,t,n){n=n||0;var r=new y({position:e}),i=new m,s=e,o=0,u=W,a=X,c=V;r.addShape(i);for(var p=this.narrowphase,g=[],b=0,w=t.length;b!==w;b++)for(var E=t[b],S=0,x=E.shapes.length;S!==x;S++){var T=E.shapes[S],N=E.shapeOffsets[S]||a,C=E.shapeAngles[S]||0;f.rotate(u,N,E.angle),f.add(u,u,E.position);var k=C+E.angle;(T instanceof l&&p.circleParticle(E,T,u,k,r,i,s,o,!0)||T instanceof h&&p.particleConvex(r,i,s,o,E,T,u,k,!0)||T instanceof d&&p.particlePlane(r,i,s,o,E,T,u,k,!0)||T instanceof v&&p.particleCapsule(r,i,s,o,E,T,u,k,!0)||T instanceof m&&f.squaredLength(f.sub(c,u,e))<n*n)&&g.push(E)}return g},n.prototype.setGlobalEquationParameters=function(e){e=e||{};for(var t=0;t!==this.constraints.length;t++)for(var n=this.constraints[t],r=0;r!==n.equations.length;r++){var i=n.equations[r];"undefined"!=typeof e.stiffness&&(i.stiffness=e.stiffness),"undefined"!=typeof e.relaxation&&(i.relaxation=e.relaxation),i.needsUpdate=!0}for(var t=0;t!==this.contactMaterials.length;t++){var n=this.contactMaterials[t];"undefined"!=typeof e.stiffness&&(n.stiffness=e.stiffness,n.frictionStiffness=e.stiffness),"undefined"!=typeof e.relaxation&&(n.relaxation=e.relaxation,n.frictionRelaxation=e.relaxation)}var n=this.defaultContactMaterial;"undefined"!=typeof e.stiffness&&(n.stiffness=e.stiffness,n.frictionStiffness=e.stiffness),"undefined"!=typeof e.relaxation&&(n.relaxation=e.relaxation,n.frictionRelaxation=e.relaxation)},n.prototype.setGlobalStiffness=function(e){this.setGlobalEquationParameters({stiffness:e})},n.prototype.setGlobalRelaxation=function(e){this.setGlobalEquationParameters({relaxation:e})}},{"../../package.json":7,"../collision/Broadphase":9,"../collision/NaiveBroadphase":11,"../collision/Narrowphase":12,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/Spring":32,"../shapes/Capsule":34,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Line":38,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Rectangle":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/OverlapKeeper":45,"../utils/Utils":47,"./IslandManager":49}]},{},[33])(33)}),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,Phaser.Physics.P2=function(e,t){this.game=e,"undefined"!=typeof t&&t.hasOwnProperty("gravity")&&t.hasOwnProperty("broadphase")||(t={gravity:[0,0],broadphase:new p2.SAPBroadphase}),this.world=new p2.World(t),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new Phaser.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new Phaser.Signal,this.onBodyRemoved=new Phaser.Signal,this.onSpringAdded=new Phaser.Signal,this.onSpringRemoved=new Phaser.Signal,this.onConstraintAdded=new Phaser.Signal,this.onConstraintRemoved=new Phaser.Signal,this.onContactMaterialAdded=new Phaser.Signal,this.onContactMaterialRemoved=new Phaser.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new Phaser.Signal,this.onEndContact=new Phaser.Signal,t.hasOwnProperty("mpx")&&t.hasOwnProperty("pxm")&&t.hasOwnProperty("mpxi")&&t.hasOwnProperty("pxmi")&&(this.mpx=t.mpx,this.mpxi=t.mpxi,this.pxm=t.pxm,this.pxmi=t.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},Phaser.Physics.P2.prototype={removeBodyNextStep:function(e){this._toRemove.push(e)},preUpdate:function(){for(var e=this._toRemove.length;e--;)this.removeBody(this._toRemove[e]);this._toRemove.length=0},enable:function(e,t,n){"undefined"==typeof t&&(t=!1),"undefined"==typeof n&&(n=!0);var r=1;if(Array.isArray(e))for(r=e.length;r--;)e[r]instanceof Phaser.Group?this.enable(e[r].children,t,n):(this.enableBody(e[r],t),n&&e[r].hasOwnProperty("children")&&e[r].children.length>0&&this.enable(e[r],t,!0));else e instanceof Phaser.Group?this.enable(e.children,t,n):(this.enableBody(e,t),n&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,t,!0))},enableBody:function(e,t){e.hasOwnProperty("body")&&null===e.body&&(e.body=new Phaser.Physics.P2.Body(this.game,e,e.x,e.y,1),e.body.debug=t,e.anchor.set(.5))},setImpactEvents:function(e){e?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(e,t){this.postBroadphaseCallback=e,this.callbackContext=t,null!==e?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(e){if(this.postBroadphaseCallback)for(var t=e.pairs.length;t-=2;)e.pairs[t].parent&&e.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,e.pairs[t].parent,e.pairs[t+1].parent)&&e.pairs.splice(t,2)},impactHandler:function(e){if(e.bodyA.parent&&e.bodyB.parent){var t=e.bodyA.parent,n=e.bodyB.parent;t._bodyCallbacks[e.bodyB.id]&&t._bodyCallbacks[e.bodyB.id].call(t._bodyCallbackContext[e.bodyB.id],t,n,e.shapeA,e.shapeB),n._bodyCallbacks[e.bodyA.id]&&n._bodyCallbacks[e.bodyA.id].call(n._bodyCallbackContext[e.bodyA.id],n,t,e.shapeB,e.shapeA),t._groupCallbacks[e.shapeB.collisionGroup]&&t._groupCallbacks[e.shapeB.collisionGroup].call(t._groupCallbackContext[e.shapeB.collisionGroup],t,n,e.shapeA,e.shapeB),n._groupCallbacks[e.shapeA.collisionGroup]&&n._groupCallbacks[e.shapeA.collisionGroup].call(n._groupCallbackContext[e.shapeA.collisionGroup],n,t,e.shapeB,e.shapeA)}},beginContactHandler:function(e){this.onBeginContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB,e.contactEquations),e.bodyA.parent&&e.bodyA.parent.onBeginContact.dispatch(e.bodyB.parent,e.shapeA,e.shapeB,e.contactEquations),e.bodyB.parent&&e.bodyB.parent.onBeginContact.dispatch(e.bodyA.parent,e.shapeB,e.shapeA,e.contactEquations)},endContactHandler:function(e){this.onEndContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB),e.bodyA.parent&&e.bodyA.parent.onEndContact.dispatch(e.bodyB.parent,e.shapeA,e.shapeB),e.bodyB.parent&&e.bodyB.parent.onEndContact.dispatch(e.bodyA.parent,e.shapeB,e.shapeA)},setBoundsToWorld:function(e,t,n,r,i){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,e,t,n,r,i)},setWorldMaterial:function(e,t,n,r,i){"undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=!0),t&&this.walls.left&&(this.walls.left.shapes[0].material=e),n&&this.walls.right&&(this.walls.right.shapes[0].material=e),r&&this.walls.top&&(this.walls.top.shapes[0].material=e),i&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=e)},updateBoundsCollisionGroup:function(e){var t=this.everythingCollisionGroup.mask;"undefined"==typeof e&&(t=this.boundsCollisionGroup.mask),this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t)},setBounds:function(e,t,n,r,i,s,o,u,a){"undefined"==typeof i&&(i=!0),"undefined"==typeof s&&(s=!0),"undefined"==typeof o&&(o=!0),"undefined"==typeof u&&(u=!0),"undefined"==typeof a&&(a=!0),this.walls.left&&this.world.removeBody(this.walls.left),this.walls.right&&this.world.removeBody(this.walls.right),this.walls.top&&this.world.removeBody(this.walls.top),this.walls.bottom&&this.world.removeBody(this.walls.bottom),i&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),a&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left)),s&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(e+n),this.pxmi(t)],angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),a&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right)),o&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t)],angle:-3.141592653589793}),this.walls.top.addShape(new p2.Plane),a&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top)),u&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t+r)]}),this.walls.bottom.addShape(new p2.Plane),a&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom))},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||this.world.step(this.useElapsedTime?this.game.time.physicsElapsed:this.frameRate)},clear:function(){this.world.clear(),this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this._collisionGroupID=2,this.boundsCollidesWith=[]},destroy:function(){this.clear(),this.game=null},addBody:function(e){return e.data.world?!1:(this.world.addBody(e.data),this.onBodyAdded.dispatch(e),!0)},removeBody:function(e){return e.data.world==this.world&&(this.world.removeBody(e.data),this.onBodyRemoved.dispatch(e)),e},addSpring:function(e){return this.world.addSpring(e),this.onSpringAdded.dispatch(e),e},removeSpring:function(e){return this.world.removeSpring(e),this.onSpringRemoved.dispatch(e),e},createDistanceConstraint:function(e,t,n,r){return e=this.getBody(e),t=this.getBody(t),e&&t?this.addConstraint(new Phaser.Physics.P2.DistanceConstraint(this,e,t,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(e,t,n,r){return e=this.getBody(e),t=this.getBody(t),e&&t?this.addConstraint(new Phaser.Physics.P2.GearConstraint(this,e,t,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(e,t,n,r,i){return e=this.getBody(e),n=this.getBody(n),e&&n?this.addConstraint(new Phaser.Physics.P2.RevoluteConstraint(this,e,t,n,r,i)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(e,t,n,r,i){return e=this.getBody(e),t=this.getBody(t),e&&t?this.addConstraint(new Phaser.Physics.P2.LockConstraint(this,e,t,n,r,i)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(e,t,n,r,i,s,o){return e=this.getBody(e),t=this.getBody(t),e&&t?this.addConstraint(new Phaser.Physics.P2.PrismaticConstraint(this,e,t,n,r,i,s,o)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(e){return this.world.addConstraint(e),this.onConstraintAdded.dispatch(e),e},removeConstraint:function(e){return this.world.removeConstraint(e),this.onConstraintRemoved.dispatch(e),e},addContactMaterial:function(e){return this.world.addContactMaterial(e),this.onContactMaterialAdded.dispatch(e),e},removeContactMaterial:function(e){return this.world.removeContactMaterial(e),this.onContactMaterialRemoved.dispatch(e),e},getContactMaterial:function(e,t){return this.world.getContactMaterial(e,t)},setMaterial:function(e,t){for(var n=t.length;n--;)t[n].setMaterial(e)},createMaterial:function(e,t){e=e||"";var n=new Phaser.Physics.P2.Material(e);return this.materials.push(n),"undefined"!=typeof t&&t.setMaterial(n),n},createContactMaterial:function(e,t,n){"undefined"==typeof e&&(e=this.createMaterial()),"undefined"==typeof t&&(t=this.createMaterial());var r=new Phaser.Physics.P2.ContactMaterial(e,t,n);return this.addContactMaterial(r)},getBodies:function(){for(var e=[],t=this.world.bodies.length;t--;)e.push(this.world.bodies[t].parent);return e},getBody:function(e){return e instanceof p2.Body?e:e instanceof Phaser.Physics.P2.Body?e.data:e.body&&e.body.type===Phaser.Physics.P2JS?e.body.data:null},getSprings:function(){for(var e=[],t=this.world.springs.length;t--;)e.push(this.world.springs[t].parent);return e},getConstraints:function(){for(var e=[],t=this.world.constraints.length;t--;)e.push(this.world.constraints[t].parent);return e},hitTest:function(e,t,n,r){"undefined"==typeof t&&(t=this.world.bodies),"undefined"==typeof n&&(n=5),"undefined"==typeof r&&(r=!1);for(var i=[this.pxmi(e.x),this.pxmi(e.y)],s=[],o=t.length;o--;)t[o]instanceof Phaser.Physics.P2.Body&&(!r||t[o].data.motionState!==p2.Body.STATIC)?s.push(t[o].data):t[o]instanceof p2.Body&&t[o].parent&&(!r||t[o].motionState!==p2.Body.STATIC)?s.push(t[o]):t[o]instanceof Phaser.Sprite&&t[o].hasOwnProperty("body")&&(!r||t[o].body.data.motionState!==p2.Body.STATIC)&&s.push(t[o].body.data);return this.world.hitTest(i,s,n)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(e){var t=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|t),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|t),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|t),this._collisionGroupID++;var n=new Phaser.Physics.P2.CollisionGroup(t);return this.collisionGroups.push(n),e&&this.setCollisionGroup(e,n),n},setCollisionGroup:function(e,t){if(e instanceof Phaser.Group)for(var n=0;n<e.total;n++)e.children[n].body&&e.children[n].body.type===Phaser.Physics.P2JS&&e.children[n].body.setCollisionGroup(t);else e.body.setCollisionGroup(t)},createSpring:function(e,t,n,r,i,s,o,u,a){return e=this.getBody(e),t=this.getBody(t),e&&t?this.addSpring(new Phaser.Physics.P2.Spring(this,e,t,n,r,i,s,o,u,a)):void console.warn("Cannot create Spring, invalid body objects given")},createBody:function(e,t,n,r,i,s){"undefined"==typeof r&&(r=!1);var o=new Phaser.Physics.P2.Body(this.game,null,e,t,n);if(s){var u=o.addPolygon(i,s);if(!u)return!1}return r&&this.world.addBody(o.data),o},createParticle:function(e,t,n,r,i,s){"undefined"==typeof r&&(r=!1);var o=new Phaser.Physics.P2.Body(this.game,null,e,t,n);if(s){var u=o.addPolygon(i,s);if(!u)return!1}return r&&this.world.addBody(o.data),o},convertCollisionObjects:function(e,t,n){"undefined"==typeof n&&(n=!0);for(var r=[],i=0,s=e.collision[t].length;s>i;i++){var o=e.collision[t][i],u=this.createBody(o.x,o.y,0,n,{},o.polyline);u&&r.push(u)}return r},clearTilemapLayerBodies:function(e,t){t=e.getLayer(t);for(var n=e.layers[t].bodies.length;n--;)e.layers[t].bodies[n].destroy();e.layers[t].bodies.length=0},convertTilemap:function(e,t,n,r){t=e.getLayer(t),"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!0),this.clearTilemapLayerBodies(e,t);for(var i=0,s=0,o=0,u=0,a=e.layers[t].height;a>u;u++){i=0;for(var f=0,l=e.layers[t].width;l>f;f++){var c=e.layers[t].data[u][f];if(c&&c.index>-1&&c.collides)if(r){var h=e.getTileRight(t,f,u);if(0===i&&(s=c.x*c.width,o=c.y*c.height,i=c.width),h&&h.collides)i+=c.width;else{var p=this.createBody(s,o,0,!1);p.addRectangle(i,c.height,i/2,c.height/2,0),n&&this.addBody(p),e.layers[t].bodies.push(p),i=0}}else{var p=this.createBody(c.x*c.width,c.y*c.height,0,!1);p.addRectangle(c.width,c.height,c.width/2,c.height/2,0),n&&this.addBody(p),e.layers[t].bodies.push(p)}}}return e.layers[t].bodies},mpx:function(e){return e*=20},pxm:function(e){return.05*e},mpxi:function(e){return e*=-20},pxmi:function(e){return e*-0.05}},Object.defineProperty(Phaser.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(e){this.world.defaultContactMaterial.friction=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"defaultFriction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(e){this.world.defaultContactMaterial.friction=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(e){this.world.defaultContactMaterial.restitution=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"defaultRestitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(e){this.world.defaultContactMaterial.restitution=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(e){this.world.defaultContactMaterial=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(e){this.world.applySpringForces=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(e){this.world.applyDamping=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(e){this.world.applyGravity=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(e){this.world.solveConstraints=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(Phaser.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(e){this.world.emitImpactEvent=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"enableBodySleeping",{get:function(){return this.world.enableBodySleeping},set:function(e){this.world.enableBodySleeping=e}}),Object.defineProperty(Phaser.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),Phaser.Physics.P2.FixtureList=function(e){Array.isArray(e)||(e=[e]),this.rawList=e,this.init(),this.parse(this.rawList)},Phaser.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(e,t){var n=function(t){t.collisionGroup=e};this.getFixtures(t).forEach(n)},setMask:function(e,t){var n=function(t){t.collisionMask=e};this.getFixtures(t).forEach(n)},setSensor:function(e,t){var n=function(t){t.sensor=e};this.getFixtures(t).forEach(n)},setMaterial:function(e,t){var n=function(t){t.material=e};this.getFixtures(t).forEach(n)},getFixtures:function(e){var t=[];if(e){e instanceof Array||(e=[e]);var n=this;return e.forEach(function(e){n.namedFixtures[e]&&t.push(n.namedFixtures[e])}),this.flatten(t)}return this.allFixtures},getFixtureByKey:function(e){return this.namedFixtures[e]},getGroup:function(e){return this.groupedFixtures[e]},parse:function(){var e,t,n,r;n=this.rawList,r=[];for(e in n)t=n[e],isNaN(e-0)?this.namedFixtures[e]=this.flatten(t):(this.groupedFixtures[e]=this.groupedFixtures[e]||[],this.groupedFixtures[e]=this.groupedFixtures[e].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(e){var t,n;return t=[],n=arguments.callee,e.forEach(function(e){return Array.prototype.push.apply(t,Array.isArray(e)?n(e):[e])}),t}},Phaser.Physics.P2.PointProxy=function(e,t){this.world=e,this.destination=t},Phaser.Physics.P2.PointProxy.prototype.constructor=Phaser.Physics.P2.PointProxy,Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=this.world.pxm(e)}}),Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=this.world.pxm(e)}}),Phaser.Physics.P2.InversePointProxy=function(e,t){this.world=e,this.destination=t},Phaser.Physics.P2.InversePointProxy.prototype.constructor=Phaser.Physics.P2.InversePointProxy,Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=this.world.pxm(-e)}}),Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=this.world.pxm(-e)}}),Phaser.Physics.P2.Body=function(e,t,n,r,i){t=t||null,n=n||0,r=r||0,"undefined"==typeof i&&(i=1),this.game=e,this.world=e.physics.p2,this.sprite=t,this.type=Phaser.Physics.P2JS,this.offset=new Phaser.Point,this.data=new p2.Body({position:[this.world.pxmi(n),this.world.pxmi(r)],mass:i}),this.data.parent=this,this.velocity=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new Phaser.Point,this.onBeginContact=new Phaser.Signal,this.onEndContact=new Phaser.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},t&&(this.setRectangleFromSprite(t),t.exists&&this.game.physics.p2.addBody(this))},Phaser.Physics.P2.Body.prototype={createBodyCallback:function(e,t,n){var r=-1;e.id?r=e.id:e.body&&(r=e.body.id),r>-1&&(null===t?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=n))},createGroupCallback:function(e,t,n){null===t?(delete this._groupCallbacks[e.mask],delete this._groupCallbacksContext[e.mask]):(this._groupCallbacks[e.mask]=t,this._groupCallbackContext[e.mask]=n)},getCollisionMask:function(){var e=0;this._collideWorldBounds&&(e=this.game.physics.p2.boundsCollisionGroup.mask);for(var t=0;t<this.collidesWith.length;t++)e|=this.collidesWith[t].mask;return e},updateCollisionMask:function(e){var t=this.getCollisionMask();if("undefined"==typeof e)for(var n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].collisionMask=t;else e.collisionMask=t},setCollisionGroup:function(e,t){var n=this.getCollisionMask();if("undefined"==typeof t)for(var r=this.data.shapes.length-1;r>=0;r--)this.data.shapes[r].collisionGroup=e.mask,this.data.shapes[r].collisionMask=n;else t.collisionGroup=e.mask,t.collisionMask=n},clearCollision:function(e,t,n){if("undefined"==typeof n)for(var r=this.data.shapes.length-1;r>=0;r--)e&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else e&&(n.collisionGroup=null),t&&(n.collisionMask=null);e&&(this.collidesWith.length=0)},collides:function(e,t,n,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)-1===this.collidesWith.indexOf(e[i])&&(this.collidesWith.push(e[i]),t&&this.createGroupCallback(e[i],t,n));else-1===this.collidesWith.indexOf(e)&&(this.collidesWith.push(e),t&&this.createGroupCallback(e,t,n));var s=this.getCollisionMask();if("undefined"==typeof r)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=s;else r.collisionMask=s},adjustCenterOfMass:function(){this.data.adjustCenterOfMass()},applyDamping:function(e){this.data.applyDamping(e)},applyForce:function(e,t,n){this.data.applyForce(e,[this.world.pxmi(t),this.world.pxmi(n)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(e,t){return this.data.toLocalFrame(e,t)},toWorldFrame:function(e,t){return this.data.toWorldFrame(e,t)},rotateLeft:function(e){this.data.angularVelocity=this.world.pxm(-e)},rotateRight:function(e){this.data.angularVelocity=this.world.pxm(e)},moveForward:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.velocity[0]=t*Math.cos(n),this.data.velocity[1]=t*Math.sin(n)},moveBackward:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.velocity[0]=-(t*Math.cos(n)),this.data.velocity[1]=-(t*Math.sin(n))},thrust:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.force[0]+=t*Math.cos(n),this.data.force[1]+=t*Math.sin(n)},reverse:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.force[0]-=t*Math.cos(n),this.data.force[1]-=t*Math.sin(n)},moveLeft:function(e){this.data.velocity[0]=this.world.pxmi(-e)},moveRight:function(e){this.data.velocity[0]=this.world.pxmi(e)},moveUp:function(e){this.data.velocity[1]=this.world.pxmi(-e)},moveDown:function(e){this.data.velocity[1]=this.world.pxmi(e)},preUpdate:function(){this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]),this.sprite.y=this.world.mpxi(this.data.position[1]),this.fixedRotation||(this.sprite.rotation=this.data.angle)},reset:function(e,t,n,r){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),n&&this.setZeroDamping(),r&&(this.mass=1),this.x=e,this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var e=0;e<this.game.physics.p2._toRemove.length;e++)this.game.physics.p2._toRemove[e]===this&&this.game.physics.p2._toRemove.splice(e,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(),this.debugBody=null,this.sprite=null},clearShapes:function(){for(var e=this.data.shapes.length;e--;)this.data.removeShape(this.data.shapes[e]);this.shapeChanged()},addShape:function(e,t,n,r){return"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),this.data.addShape(e,[this.world.pxmi(t),this.world.pxmi(n)],r),this.shapeChanged(),e},addCircle:function(e,t,n,r){var i=new p2.Circle(this.world.pxm(e));return this.addShape(i,t,n,r)},addRectangle:function(e,t,n,r,i){var s=new p2.Rectangle(this.world.pxm(e),this.world.pxm(t));return this.addShape(s,n,r,i)},addPlane:function(e,t,n){var r=new p2.Plane;return this.addShape(r,e,t,n)},addParticle:function(e,t,n){var r=new p2.Particle;return this.addShape(r,e,t,n)},addLine:function(e,t,n,r){var i=new p2.Line(this.world.pxm(e));return this.addShape(i,t,n,r)},addCapsule:function(e,t,n,r,i){var s=new p2.Capsule(this.world.pxm(e),t);return this.addShape(s,n,r,i)},addPolygon:function(e,t){e=e||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1));var n=[];if(1===t.length&&Array.isArray(t[0]))n=t[0].slice(0);else if(Array.isArray(t[0]))n=t[0].slice(0);else if("number"==typeof t[0])for(var r=0,i=t.length;i>r;r+=2)n.push([t[r],t[r+1]]);var s=n.length-1;n[s][0]===n[0][0]&&n[s][1]===n[0][1]&&n.pop();for(var o=0;o<n.length;o++)n[o][0]=this.world.pxmi(n[o][0]),n[o][1]=this.world.pxmi(n[o][1]);var u=this.data.fromPolygon(n,e);return this.shapeChanged(),u},removeShape:function(e){var t=this.data.removeShape(e);return this.shapeChanged(),t},setCircle:function(e,t,n,r){return this.clearShapes(),this.addCircle(e,t,n,r)},setRectangle:function(e,t,n,r,i){return"undefined"==typeof e&&(e=16),"undefined"==typeof t&&(t=16),this.clearShapes(),this.addRectangle(e,t,n,r,i)},setRectangleFromSprite:function(e){return"undefined"==typeof e&&(e=this.sprite),this.clearShapes(),this.addRectangle(e.width,e.height,0,0,e.rotation)},setMaterial:function(e,t){if("undefined"==typeof t)for(var n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].material=e;else t.material=e},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(e,t){for(var n=this.game.cache.getPhysicsData(e,t),r=[],i=0;i<n.length;i++){var s=n[i],o=this.addFixture(s);r[s.filter.group]=r[s.filter.group]||[],r[s.filter.group]=r[s.filter.group].concat(o),s.fixtureKey&&(r[s.fixtureKey]=o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),r},addFixture:function(e){var t=[];if(e.circle){var n=new p2.Circle(this.world.pxm(e.circle.radius));n.collisionGroup=e.filter.categoryBits,n.collisionMask=e.filter.maskBits,n.sensor=e.isSensor;var r=p2.vec2.create();r[0]=this.world.pxmi(e.circle.position[0]-this.sprite.width/2),r[1]=this.world.pxmi(e.circle.position[1]-this.sprite.height/2),this.data.addShape(n,r),t.push(n)}else for(var i=e.polygons,s=p2.vec2.create(),o=0;o<i.length;o++){for(var u=i[o],a=[],f=0;f<u.length;f+=2)a.push([this.world.pxmi(u[f]),this.world.pxmi(u[f+1])]);for(var n=new p2.Convex(a),l=0;l!==n.vertices.length;l++){var c=n.vertices[l];p2.vec2.sub(c,c,n.centerOfMass)}p2.vec2.scale(s,n.centerOfMass,1),s[0]-=this.world.pxmi(this.sprite.width/2),s[1]-=this.world.pxmi(this.sprite.height/2),n.updateTriangles(),n.updateCenterOfMass(),n.updateBoundingRadius(),n.collisionGroup=e.filter.categoryBits,n.collisionMask=e.filter.maskBits,n.sensor=e.isSensor,this.data.addShape(n,s),t.push(n)}return t},loadPolygon:function(e,t){for(var n=this.game.cache.getPhysicsData(e,t),r=p2.vec2.create(),i=0;i<n.length;i++){for(var s=[],o=0;o<n[i].shape.length;o+=2)s.push([this.world.pxmi(n[i].shape[o]),this.world.pxmi(n[i].shape[o+1])]);for(var u=new p2.Convex(s),a=0;a!==u.vertices.length;a++){var f=u.vertices[a];p2.vec2.sub(f,f,u.centerOfMass)}p2.vec2.scale(r,u.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),u.updateTriangles(),u.updateCenterOfMass(),u.updateBoundingRadius(),this.data.addShape(u,r)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0},loadData:function(e,t){var n=this.game.cache.getPhysicsData(e,t);return n&&n.shape?(this.mass=n.density,this.loadPolygon(e,t)):void 0}},Phaser.Physics.P2.Body.prototype.constructor=Phaser.Physics.P2.Body,Phaser.Physics.P2.Body.DYNAMIC=1,Phaser.Physics.P2.Body.STATIC=2,Phaser.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(Phaser.Physics.P2.Body.prototype,"static",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.STATIC},set:function(e){e&&this.data.motionState!==Phaser.Physics.P2.Body.STATIC?(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0):e||this.data.motionState!==Phaser.Physics.P2.Body.STATIC||(this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1))}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC},set:function(e){e&&this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC?(this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1)):e||this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC||(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC},set:function(e){e&&this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC?(this.data.motionState=Phaser.Physics.P2.Body.KINEMATIC,this.mass=4):e||this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC||(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(e){e!==this.data.allowSleep&&(this.data.allowSleep=e)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.angle))},set:function(e){this.data.angle=Phaser.Math.degToRad(Phaser.Math.wrapAngle(e))}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(e){this.data.angularDamping=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(e){this.data.angularForce=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(e){this.data.angularVelocity=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(e){this.data.damping=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(e){e!==this.data.fixedRotation&&(this.data.fixedRotation=e)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(e){this.data.inertia=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(e){e!==this.data.mass&&(this.data.mass=e,this.data.updateMassProperties())}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.motionState},set:function(e){e!==this.data.motionState&&(this.data.motionState=e)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(e){this.data.angle=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(e){this.data.sleepSpeedLimit=e}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(e){this.data.position[0]=this.world.pxmi(e)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(e){this.data.position[1]=this.world.pxmi(e)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(e){e&&!this.debugBody?this.debugBody=new Phaser.Physics.P2.BodyDebug(this.game,this.data):!e&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(e){e&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!e&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),Phaser.Physics.P2.BodyDebug=function(e,t,n){Phaser.Group.call(this,e);var r={pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Phaser.Utils.extend(r,n),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=t,this.canvas=new Phaser.Graphics(e),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw()},Phaser.Physics.P2.BodyDebug.prototype=Object.create(Phaser.Group.prototype),Phaser.Physics.P2.BodyDebug.prototype.constructor=Phaser.Physics.P2.BodyDebug,Phaser.Utils.extend(Phaser.Physics.P2.BodyDebug.prototype,{update:function(){this.updateSpriteTransform()},updateSpriteTransform:function(){return this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;if(u=this.body,f=this.canvas,f.clear(),n=parseInt(this.randomPastelHex(),16),s=16711680,o=this.lineWidth,u instanceof p2.Body&&u.shapes.length){var v=u.shapes.length;for(r=0;r!==v;){if(t=u.shapes[r],a=u.shapeOffsets[r],e=u.shapeAngles[r],a=a||0,e=e||0,t instanceof p2.Circle)this.drawCircle(f,a[0]*this.ppu,a[1]*this.ppu,e,t.radius*this.ppu,n,o);else if(t instanceof p2.Convex){for(c=[],h=p2.vec2.create(),i=p=0,d=t.vertices.length;d>=0?d>p:p>d;i=d>=0?++p:--p)l=t.vertices[i],p2.vec2.rotate(h,l,e),c.push([(h[0]+a[0])*this.ppu,-(h[1]+a[1])*this.ppu]);this.drawConvex(f,c,t.triangles,s,n,o,this.settings.debugPolygons,[a[0]*this.ppu,-a[1]*this.ppu])}else t instanceof p2.Plane?this.drawPlane(f,a[0]*this.ppu,-a[1]*this.ppu,n,s,5*o,10*o,10*o,100*this.ppu,e):t instanceof p2.Line?this.drawLine(f,t.length*this.ppu,s,o):t instanceof p2.Rectangle&&this.drawRectangle(f,a[0]*this.ppu,-a[1]*this.ppu,e,t.width*this.ppu,t.height*this.ppu,s,n,o);r++}}},drawRectangle:function(e,t,n,r,i,s,o,u,a){"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=0),e.lineStyle(a,o,1),e.beginFill(u),e.drawRect(t-i/2,n-s/2,i,s)},drawCircle:function(e,t,n,r,i,s,o){"undefined"==typeof o&&(o=1),"undefined"==typeof s&&(s=16777215),e.lineStyle(o,0,1),e.beginFill(s,1),e.drawCircle(t,n,-i),e.endFill(),e.moveTo(t,n),e.lineTo(t+i*Math.cos(-r),n+i*Math.sin(-r))},drawLine:function(e,t,n,r){"undefined"==typeof r&&(r=1),"undefined"==typeof n&&(n=0),e.lineStyle(5*r,n,1),e.moveTo(-t/2,0),e.lineTo(t/2,0)},drawConvex:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y;if("undefined"==typeof s&&(s=1),"undefined"==typeof r&&(r=0),o){for(a=[16711680,65280,255],f=0;f!==t.length+1;)c=t[f%t.length],h=t[(f+1)%t.length],d=c[0],g=c[1],v=h[0],y=h[1],e.lineStyle(s,a[f%a.length],1),e.moveTo(d,-g),e.lineTo(v,-y),e.drawCircle(d,-g,2*s),f++;return e.lineStyle(s,0,1),e.drawCircle(u[0],u[1],2*s)}for(e.lineStyle(s,r,1),e.beginFill(i),f=0;f!==t.length;)l=t[f],p=l[0],m=l[1],0===f?e.moveTo(p,-m):e.lineTo(p,-m),f++;return e.endFill(),t.length>2?(e.moveTo(t[t.length-1][0],-t[t.length-1][1]),e.lineTo(t[0][0],-t[0][1])):void 0},drawPath:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g;for("undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=0),e.lineStyle(i,n,1),"number"==typeof r&&e.beginFill(r),u=null,a=null,o=0;o<t.length;)v=t[o],m=v[0],g=v[1],(m!==u||g!==a)&&(0===o?e.moveTo(m,g):(f=u,l=a,c=m,h=g,p=t[(o+1)%t.length][0],d=t[(o+1)%t.length][1],s=(c-f)*(d-l)-(p-f)*(h-l),0!==s&&e.lineTo(m,g)),u=m,a=g),o++;"number"==typeof r&&e.endFill(),t.length>2&&"number"==typeof r&&(e.moveTo(t[t.length-1][0],t[t.length-1][1]),e.lineTo(t[0][0],t[0][1]))},drawPlane:function(e,t,n,r,i,s,o,u,a,f){var l,c,h;"undefined"==typeof s&&(s=1),"undefined"==typeof r&&(r=16777215),e.lineStyle(s,i,11),e.beginFill(r),l=a,e.moveTo(t,-n),c=t+Math.cos(f)*this.game.width,h=n+Math.sin(f)*this.game.height,e.lineTo(c,-h),e.moveTo(t,-n),c=t+Math.cos(f)*-this.game.width,h=n+Math.sin(f)*-this.game.height,e.lineTo(c,-h)},randomPastelHex:function(){var e,t,n,r;return n=[255,255,255],r=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),r=Math.floor((r+3*n[0])/4),t=Math.floor((t+3*n[1])/4),e=Math.floor((e+3*n[2])/4),this.rgbToHex(r,t,e)},rgbToHex:function(e,t,n){return this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(n)},componentToHex:function(e){var t;return t=e.toString(16),2===t.len?t:t+"0"}}),Phaser.Physics.P2.Spring=function(e,t,n,r,i,s,o,u,a,f){this.game=e.game,this.world=e,"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=100),"undefined"==typeof s&&(s=1),r=e.pxm(r);var l={restLength:r,stiffness:i,damping:s};"undefined"!=typeof o&&null!==o&&(l.worldAnchorA=[e.pxm(o[0]),e.pxm(o[1])]),"undefined"!=typeof u&&null!==u&&(l.worldAnchorB=[e.pxm(u[0]),e.pxm(u[1])]),"undefined"!=typeof a&&null!==a&&(l.localAnchorA=[e.pxm(a[0]),e.pxm(a[1])]),"undefined"!=typeof f&&null!==f&&(l.localAnchorB=[e.pxm(f[0]),e.pxm(f[1])]),p2.Spring.call(this,t,n,l)},Phaser.Physics.P2.Spring.prototype=Object.create(p2.Spring.prototype),Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring,Phaser.Physics.P2.Material=function(e){this.name=e,p2.Material.call(this)},Phaser.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),Phaser.Physics.P2.Material.prototype.constructor=Phaser.Physics.P2.Material,Phaser.Physics.P2.ContactMaterial=function(e,t,n){p2.ContactMaterial.call(this,e,t,n)},Phaser.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),Phaser.Physics.P2.ContactMaterial.prototype.constructor=Phaser.Physics.P2.ContactMaterial,Phaser.Physics.P2.CollisionGroup=function(e){this.mask=e},Phaser.Physics.P2.DistanceConstraint=function(e,t,n,r,i){"undefined"==typeof r&&(r=100),this.game=e.game,this.world=e,r=e.pxm(r),p2.DistanceConstraint.call(this,t,n,r,{maxForce:i})},Phaser.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),Phaser.Physics.P2.DistanceConstraint.prototype.constructor=Phaser.Physics.P2.DistanceConstraint,Phaser.Physics.P2.GearConstraint=function(e,t,n,r,i){"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=1),this.game=e.game,this.world=e;var s={angle:r,ratio:i};p2.GearConstraint.call(this,t,n,s)},Phaser.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),Phaser.Physics.P2.GearConstraint.prototype.constructor=Phaser.Physics.P2.GearConstraint,Phaser.Physics.P2.LockConstraint=function(e,t,n,r,i,s){"undefined"==typeof r&&(r=[0,0]),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=Number.MAX_VALUE),this.game=e.game,this.world=e,r=[e.pxm(r[0]),e.pxm(r[1])];var o={localOffsetB:r,localAngleB:i,maxForce:s};p2.LockConstraint.call(this,t,n,o)},Phaser.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),Phaser.Physics.P2.LockConstraint.prototype.constructor=Phaser.Physics.P2.LockConstraint,Phaser.Physics.P2.PrismaticConstraint=function(e,t,n,r,i,s,o,u){"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=[0,0]),"undefined"==typeof s&&(s=[0,0]),"undefined"==typeof o&&(o=[0,0]),"undefined"==typeof u&&(u=Number.MAX_VALUE),this.game=e.game,this.world=e,i=[e.pxmi(i[0]),e.pxmi(i[1])],s=[e.pxmi(s[0]),e.pxmi(s[1])];var a={localAnchorA:i,localAnchorB:s,localAxisA:o,maxForce:u,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,t,n,a)},Phaser.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),Phaser.Physics.P2.PrismaticConstraint.prototype.constructor=Phaser.Physics.P2.PrismaticConstraint,Phaser.Physics.P2.RevoluteConstraint=function(e,t,n,r,i,s){"undefined"==typeof s&&(s=Number.MAX_VALUE),this.game=e.game,this.world=e,n=[e.pxmi(n[0]),e.pxmi(n[1])],i=[e.pxmi(i[0]),e.pxmi(i[1])],p2.RevoluteConstraint.call(this,t,n,r,i,{maxForce:s})},Phaser.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),Phaser.Physics.P2.RevoluteConstraint.prototype.constructor=Phaser.Physics.P2.RevoluteConstraint,define("phaser",function(){}),define("views/game",["jquery","backbone","game/states/load","game/states/start","game/states/play","game/states/end","phaser"],function(e,t,n,r,i,s){var o=t.View.extend({el:e(".gameContainer"),initialize:function(){this.render()},render:function(){var e=this,t=new Phaser.Game(800,500,Phaser.AUTO,"game");n.init(t,"START"),t.state.add("LOAD",n.getState()),r.init(t,"PLAY"),t.state.add("START",r.getState()),i.init(t,"END"),t.state.add("PLAY",i.getState()),s.init(t,"PLAY"),t.state.add("END",s.getState()),t.state.start("LOAD")}});return o}),require.config({urlArgs:"noCache="+(new Date).getTime(),paths:{jquery:"vendor/jquery/dist/jquery.min",underscore:"vendor/underscore/underscore-min",backbone:"vendor/backbone/backbone",text:"vendor/requirejs-text/text",phaser:"vendor/phaser-official/build/phaser.min"}}),require(["views/game"],function(e){var t=new e}),define("initGame",function(){});